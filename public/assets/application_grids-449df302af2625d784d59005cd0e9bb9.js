/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
if(function(e){e.fn.drag=function(t,o,i){var r="string"==typeof t?t:"",n=e.isFunction(t)?t:e.isFunction(o)?o:null;return 0!==r.indexOf("drag")&&(r="drag"+r),i=(t==n?o:i)||{},n?this.bind(r,i,n):this.trigger(r)};var t=e.event,o=t.special,i=o.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var o=e.data(this,i.datakey),r=t.data||{};o.related+=1,e.each(i.defaults,function(e){void 0!==r[e]&&(o[e]=r[e])})},remove:function(){e.data(this,i.datakey).related-=1},setup:function(){if(!e.data(this,i.datakey)){var o=e.extend({related:0},i.defaults);e.data(this,i.datakey,o),t.add(this,"touchstart mousedown",i.init,o),this.attachEvent&&this.attachEvent("ondragstart",i.dontstart)}},teardown:function(){var o=e.data(this,i.datakey)||{};o.related||(e.removeData(this,i.datakey),t.remove(this,"touchstart mousedown",i.init),i.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",i.dontstart))},init:function(r){if(!i.touched){var n,s=r.data;if(!(0!=r.which&&s.which>0&&r.which!=s.which||e(r.target).is(s.not)||s.handle&&!e(r.target).closest(s.handle,r.currentTarget).length||(i.touched="touchstart"==r.type?this:null,s.propagates=1,s.mousedown=this,s.interactions=[i.interaction(this,s)],s.target=r.target,s.pageX=r.pageX,s.pageY=r.pageY,s.dragging=null,n=i.hijack(r,"draginit",s),!s.propagates)))return n=i.flatten(n),n&&n.length&&(s.interactions=[],e.each(n,function(){s.interactions.push(i.interaction(this,s))})),s.propagates=s.interactions.length,s.drop!==!1&&o.drop&&o.drop.handler(r,s),i.textselect(!1),i.touched?t.add(i.touched,"touchmove touchend",i.handler,s):t.add(document,"mousemove mouseup",i.handler,s),!i.touched||s.live?!1:void 0}},interaction:function(t,o){var r=e(t)[o.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new i.callback,droppable:[],offset:r}},handler:function(r){var n=r.data;switch(r.type){case!n.dragging&&"touchmove":r.preventDefault();case!n.dragging&&"mousemove":if(Math.pow(r.pageX-n.pageX,2)+Math.pow(r.pageY-n.pageY,2)<Math.pow(n.distance,2))break;r.target=n.target,i.hijack(r,"dragstart",n),n.propagates&&(n.dragging=!0);case"touchmove":r.preventDefault();case"mousemove":if(n.dragging){if(i.hijack(r,"drag",n),n.propagates){n.drop!==!1&&o.drop&&o.drop.handler(r,n);break}r.type="mouseup"}case"touchend":case"mouseup":default:i.touched?t.remove(i.touched,"touchmove touchend",i.handler):t.remove(document,"mousemove mouseup",i.handler),n.dragging&&(n.drop!==!1&&o.drop&&o.drop.handler(r,n),i.hijack(r,"dragend",n)),i.textselect(!0),n.click===!1&&n.dragging&&e.data(n.mousedown,"suppress.click",(new Date).getTime()+5),n.dragging=i.touched=!1}},hijack:function(o,r,n,s,a){if(n){var l,u,c,d={event:o.originalEvent,type:o.type},h=r.indexOf("drop")?"drag":"drop",p=s||0,_=isNaN(s)?n.interactions.length:s;o.type=r,o.originalEvent=null,n.results=[];do if(u=n.interactions[p]){if("dragend"!==r&&u.cancelled)continue;c=i.properties(o,n,u),u.results=[],e(a||u[h]||n.droppable).each(function(s,a){return c.target=a,o.isPropagationStopped=function(){return!1},l=a?t.dispatch.call(a,o,c):null,l===!1?("drag"==h&&(u.cancelled=!0,n.propagates-=1),"drop"==r&&(u[h][s]=null)):"dropinit"==r&&u.droppable.push(i.element(l)||a),"dragstart"==r&&(u.proxy=e(i.element(l)||u.drag)[0]),u.results.push(l),delete o.result,"dropinit"!==r?l:void 0}),n.results[p]=i.flatten(u.results),"dropinit"==r&&(u.droppable=i.flatten(u.droppable)),"dragstart"!=r||u.cancelled||c.update()}while(++p<_);return o.type=d.type,o.originalEvent=d.event,i.flatten(n.results)}},properties:function(e,t,o){var r=o.callback;return r.drag=o.drag,r.proxy=o.proxy||o.drag,r.startX=t.pageX,r.startY=t.pageY,r.deltaX=e.pageX-t.pageX,r.deltaY=e.pageY-t.pageY,r.originalX=o.offset.left,r.originalY=o.offset.top,r.offsetX=r.originalX+r.deltaX,r.offsetY=r.originalY+r.deltaY,r.drop=i.flatten((o.drop||[]).slice()),r.available=i.flatten((o.droppable||[]).slice()),r},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?i.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",i.dontstart).css("MozUserSelect",t?"":"none"),document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};i.callback.prototype={update:function(){o.drop&&this.available.length&&e.each(this.available,function(e){o.drop.locate(this,e)})}};var r=t.dispatch;t.dispatch=function(t){return e.data(this,"suppress."+t.type)-(new Date).getTime()>0?(e.removeData(this,"suppress."+t.type),void 0):r.apply(this,arguments)};var n=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,o){if(o){var i=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0]||null;i&&e.each(n.props,function(e,o){t[o]=i[o]})}return t}};o.draginit=o.dragstart=o.dragend=i}(jQuery),function(e){function t(){var e=!1,t=!1;this.stopPropagation=function(){e=!0},this.isPropagationStopped=function(){return e},this.stopImmediatePropagation=function(){t=!0},this.isImmediatePropagationStopped=function(){return t}}function o(){var e=[];this.subscribe=function(t){e.push(t)},this.unsubscribe=function(t){for(var o=e.length-1;o>=0;o--)e[o]===t&&e.splice(o,1)},this.notify=function(o,i,r){i=i||new t,r=r||this;for(var n,s=0;s<e.length&&!i.isPropagationStopped()&&!i.isImmediatePropagationStopped();s++)n=e[s].call(r,i,o);return n}}function i(){var e=[];this.subscribe=function(t,o){return e.push({event:t,handler:o}),t.subscribe(o),this},this.unsubscribe=function(t,o){for(var i=e.length;i--;)if(e[i].event===t&&e[i].handler===o)return e.splice(i,1),t.unsubscribe(o),void 0;return this},this.unsubscribeAll=function(){for(var t=e.length;t--;)e[t].event.unsubscribe(e[t].handler);return e=[],this}}function r(e,t,o,i){void 0===o&&void 0===i&&(o=e,i=t),this.fromRow=Math.min(e,o),this.fromCell=Math.min(t,i),this.toRow=Math.max(e,o),this.toCell=Math.max(t,i),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(e,t){return e>=this.fromRow&&e<=this.toRow&&t>=this.fromCell&&t<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function n(){this.__nonDataRow=!0}function s(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function a(){this.__groupTotals=!0,this.group=null,this.initialized=!1}function l(){var e=null;this.isActive=function(t){return t?e===t:null!==e},this.activate=function(t){if(t!==e){if(null!==e)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!t.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!t.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";e=t}},this.deactivate=function(t){if(e!==t)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";e=null},this.commitCurrentEdit=function(){return e?e.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return e?e.cancelCurrentEdit():!0}}e.extend(!0,window,{Slick:{Event:o,EventData:t,EventHandler:i,Range:r,NonDataRow:n,Group:s,GroupTotals:a,EditorLock:l,GlobalEditorLock:new l}}),s.prototype=new n,s.prototype.equals=function(e){return this.value===e.value&&this.count===e.count&&this.collapsed===e.collapsed&&this.title===e.title},a.prototype=new n}(jQuery),"undefined"==typeof jQuery)throw"SlickGrid requires jquery module to be loaded";if(!jQuery.fn.drag)throw"SlickGrid requires jquery.event.drag module to be loaded";if("undefined"==typeof Slick)throw"slick.core.js not loaded";!function($){function SlickGrid(container,data,columns,options){function init(){if($container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,columnsById={};for(var e=0;e<columns.length;e++){var t=columns[e]=$.extend({},columnDefaults,columns[e]);columnsById[t.id]=e,t.minWidth&&t.width<t.minWidth&&(t.width=t.minWidth),t.maxWidth&&t.width>t.maxWidth&&(t.width=t.maxWidth)}if(options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");editController={commitCurrentEdit:commitCurrentEdit,cancelCurrentEdit:cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$headerScroller=$("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headers=$("<div class='slick-header-columns' style='left:-1000px' />").appendTo($headerScroller),$headers.width(getHeadersWidth()),$headerRowScroller=$("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$headerRow=$("<div class='slick-headerrow-columns' />").appendTo($headerRowScroller),$headerRowSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($headerRowScroller),$topPanelScroller=$("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($container),$topPanel=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScroller),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewport=$("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo($container),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),$canvas=$("<div class='grid-canvas' />").appendTo($viewport),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,viewportW=parseFloat($.css($container[0],"width",!0)),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.bind("selectstart.ui",function(e){return $(e.target).is("input,textarea")}),updateColumnCaches(),createColumnHeaders(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.bind("resize.slickgrid",resizeCanvas),$viewport.bind("scroll",handleScroll),$headerScroller.bind("contextmenu",handleHeaderContextMenu).bind("click",handleHeaderClick).delegate(".slick-header-column","mouseenter",handleHeaderMouseEnter).delegate(".slick-header-column","mouseleave",handleHeaderMouseLeave),$headerRowScroller.bind("scroll",handleHeaderRowScroll),$focusSink.add($focusSink2).bind("keydown",handleKeyDown),$canvas.bind("keydown",handleKeyDown).bind("click",handleClick).bind("mousedown",handleMouseDown).bind("dblclick",handleDblClick).bind("contextmenu",handleContextMenu).bind("draginit",handleDragInit).bind("dragstart",{distance:3},handleDragStart).bind("drag",handleDrag).bind("dragend",handleDragEnd).delegate(".slick-cell","mouseenter",handleMouseEnter).delegate(".slick-cell","mouseleave",handleMouseLeave),navigator.userAgent.toLowerCase().match(/webkit/)&&navigator.userAgent.toLowerCase().match(/macintosh/)&&$canvas.bind("mousewheel",handleMouseWheel))}function registerPlugin(e){plugins.unshift(e),e.init(self)}function unregisterPlugin(e){for(var t=plugins.length;t>=0;t--)if(plugins[t]===e){plugins[t].destroy&&plugins[t].destroy(),plugins.splice(t,1);break}}function setSelectionModel(e){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=e,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(){return $canvas[0]}function measureScrollbar(){var e=$("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body"),t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),t}function getHeadersWidth(){for(var e=0,t=0,o=columns.length;o>t;t++){var i=columns[t].width;e+=i}return e+=scrollbarDimensions.width,Math.max(e,viewportW)+1e3}function getCanvasWidth(){for(var e=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,t=0,o=columns.length;o--;)t+=columns[o].width;return options.fullWidthRows?Math.max(t,e):t}function updateCanvasWidth(e){var t=canvasWidth;canvasWidth=getCanvasWidth(),canvasWidth!=t&&($canvas.width(canvasWidth),$headerRow.width(canvasWidth),$headers.width(getHeadersWidth()),viewportHasHScroll=canvasWidth>viewportW-scrollbarDimensions.width),$headerRowSpacer.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),(canvasWidth!=t||e)&&applyColumnWidths()}function disableSelection(e){e&&e.jquery&&e.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var e=1e6,t=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,o=$("<div style='display:none' />").appendTo(document.body);;){var i=2*e;if(o.css("height",i),i>t||o.height()!==i)break;e=i}return o.remove(),e}function bindAncestorScrollEvents(){for(var e=$canvas[0];(e=e.parentNode)!=document.body&&null!=e;)if(e==$viewport[0]||e.scrollWidth!=e.clientWidth||e.scrollHeight!=e.clientHeight){var t=$(e);$boundAncestors=$boundAncestors?$boundAncestors.add(t):t,t.bind("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.unbind("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(e,t,o){if(initialized){var i=getColumnIndex(e);if(null!=i){var r=columns[i],n=$headers.children().eq(i);n&&(void 0!==t&&(columns[i].name=t),void 0!==o&&(columns[i].toolTip=o),trigger(self.onBeforeHeaderCellDestroy,{node:n[0],column:r}),n.attr("title",o||"").children().eq(0).html(t),trigger(self.onHeaderCellRendered,{node:n[0],column:r}))}}}function getHeaderRow(){return $headerRow[0]}function getHeaderRowColumn(e){var t=getColumnIndex(e),o=$headerRow.children().eq(t);return o&&o[0]}function createColumnHeaders(){function e(){$(this).addClass("ui-state-hover")}function t(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var e=$(this).data("column");e&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:e})}),$headers.empty(),$headers.width(getHeadersWidth()),$headerRow.find(".slick-headerrow-column").each(function(){var e=$(this).data("column");e&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:e})}),$headerRow.empty();for(var o=0;o<columns.length;o++){var i=columns[o],r=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+i.name+"</span>").width(i.width-headerColumnWidthDiff).attr("id",""+uid+i.id).attr("title",i.toolTip||"").data("column",i).addClass(i.headerCssClass||"").appendTo($headers);if((options.enableColumnReorder||i.sortable)&&r.on("mouseenter",e).on("mouseleave",t),i.sortable&&(r.addClass("slick-header-sortable"),r.append("<span class='slick-sort-indicator' />")),trigger(self.onHeaderCellRendered,{node:r[0],column:i}),options.showHeaderRow){var n=$("<div class='ui-state-default slick-headerrow-column l"+o+" r"+o+"'></div>").data("column",i).appendTo($headerRow);trigger(self.onHeaderRowCellRendered,{node:n[0],column:i})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&setupColumnReorder()}function setupColumnSort(){$headers.click(function(e){if(e.metaKey=e.metaKey||e.ctrlKey,!$(e.target).hasClass("slick-resizable-handle")){var t=$(e.target).closest(".slick-header-column");if(t.length){var o=t.data("column");if(o.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var i=null,r=0;r<sortColumns.length;r++)if(sortColumns[r].columnId==o.id){i=sortColumns[r],i.sortAsc=!i.sortAsc;break}e.metaKey&&options.multiColumnSort?i&&sortColumns.splice(r,1):((e.shiftKey||e.metaKey)&&options.multiColumnSort||(sortColumns=[]),i?0==sortColumns.length&&sortColumns.push(i):(i={columnId:o.id,sortAsc:o.defaultSortAsc},sortColumns.push(i))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(e){return{sortCol:columns[getColumnIndex(e.columnId)],sortAsc:e.sortAsc}})},e):trigger(self.onSort,{multiColumnSort:!1,sortCol:o,sortAsc:i.sortAsc},e)}}}})}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy"),$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",start:function(e,t){t.placeholder.width(t.helper.outerWidth()-headerColumnWidthDiff),$(t.helper).addClass("slick-header-column-active")},beforeStop:function(e,t){$(t.helper).removeClass("slick-header-column-active")},stop:function(e){if(!getEditorLock().commitCurrentEdit())return $(this).sortable("cancel"),void 0;for(var t=$headers.sortable("toArray"),o=[],i=0;i<t.length;i++)o.push(columns[getColumnIndex(t[i].replace(uid,""))]);setColumns(o),trigger(self.onColumnsReordered,{}),e.stopPropagation(),setupColumnResize()}})}function setupColumnResize(){var e,t,o,i,r,n,s,a,l;r=$headers.children(),r.find(".slick-resizable-handle").remove(),r.each(function(e){columns[e].resizable&&(void 0===a&&(a=e),l=e)}),void 0!==a&&r.each(function(u,c){a>u||options.forceFitColumns&&u>=l||(e=$(c),$("<div class='slick-resizable-handle' />").appendTo(c).bind("dragstart",function(e){if(!getEditorLock().commitCurrentEdit())return!1;i=e.pageX,$(this).parent().addClass("slick-header-column-active");var a=null,l=null;if(r.each(function(e,t){columns[e].previousWidth=$(t).outerWidth()}),options.forceFitColumns)for(a=0,l=0,t=u+1;t<r.length;t++)o=columns[t],o.resizable&&(null!==l&&(o.maxWidth?l+=o.maxWidth-o.previousWidth:l=null),a+=o.previousWidth-Math.max(o.minWidth||0,absoluteColumnMinWidth));var c=0,d=0;for(t=0;u>=t;t++)o=columns[t],o.resizable&&(null!==d&&(o.maxWidth?d+=o.maxWidth-o.previousWidth:d=null),c+=o.previousWidth-Math.max(o.minWidth||0,absoluteColumnMinWidth));null===a&&(a=1e5),null===c&&(c=1e5),null===l&&(l=1e5),null===d&&(d=1e5),s=i+Math.min(a,d),n=i-Math.min(c,l)}).bind("drag",function(e){var a,l,c=Math.min(s,Math.max(n,e.pageX))-i;if(0>c){for(l=c,t=u;t>=0;t--)o=columns[t],o.resizable&&(a=Math.max(o.minWidth||0,absoluteColumnMinWidth),l&&o.previousWidth+l<a?(l+=o.previousWidth-a,o.width=a):(o.width=o.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,t=u+1;t<r.length;t++)o=columns[t],o.resizable&&(l&&o.maxWidth&&o.maxWidth-o.previousWidth<l?(l-=o.maxWidth-o.previousWidth,o.width=o.maxWidth):(o.width=o.previousWidth+l,l=0))}else{for(l=c,t=u;t>=0;t--)o=columns[t],o.resizable&&(l&&o.maxWidth&&o.maxWidth-o.previousWidth<l?(l-=o.maxWidth-o.previousWidth,o.width=o.maxWidth):(o.width=o.previousWidth+l,l=0));if(options.forceFitColumns)for(l=-c,t=u+1;t<r.length;t++)o=columns[t],o.resizable&&(a=Math.max(o.minWidth||0,absoluteColumnMinWidth),l&&o.previousWidth+l<a?(l+=o.previousWidth-a,o.width=a):(o.width=o.previousWidth+l,l=0))}applyColumnHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths()}).bind("dragend",function(){var e;for($(this).parent().removeClass("slick-header-column-active"),t=0;t<r.length;t++)o=columns[t],e=$(r[t]).outerWidth(),o.previousWidth!==e&&o.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{})}))})}function getVBoxDelta(e){var t=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],o=0;return $.each(t,function(t,i){o+=parseFloat(e.css(i))||0}),o}function measureCellPaddingAndBorder(){var e,t=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],o=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];e=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,"border-box"!=e.css("box-sizing")&&"border-box"!=e.css("-moz-box-sizing")&&"border-box"!=e.css("-webkit-box-sizing")&&($.each(t,function(t,o){headerColumnWidthDiff+=parseFloat(e.css(o))||0}),$.each(o,function(t,o){headerColumnHeightDiff+=parseFloat(e.css(o))||0})),e.remove();var i=$("<div class='slick-row' />").appendTo($canvas);e=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(i),cellWidthDiff=cellHeightDiff=0,"border-box"!=e.css("box-sizing")&&"border-box"!=e.css("-moz-box-sizing")&&"border-box"!=e.css("-webkit-box-sizing")&&($.each(t,function(t,o){cellWidthDiff+=parseFloat(e.css(o))||0}),$.each(o,function(t,o){cellHeightDiff+=parseFloat(e.css(o))||0})),i.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet' />").appendTo($("head"));for(var e=options.rowHeight-cellHeightDiff,t=["."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-cell { height:"+e+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],o=0;o<columns.length;o++)t.push("."+uid+" .l"+o+" { }"),t.push("."+uid+" .r"+o+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=t.join(" "):$style[0].appendChild(document.createTextNode(t.join(" ")))}function getColumnCssRules(e){if(!stylesheet){for(var t=document.styleSheets,o=0;o<t.length;o++)if((t[o].ownerNode||t[o].owningElement)==$style[0]){stylesheet=t[o];break}if(!stylesheet)throw new Error("Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];for(var i,r,n=stylesheet.cssRules||stylesheet.rules,o=0;o<n.length;o++){var s=n[o].selectorText;(i=/\.l\d+/.exec(s))?(r=parseInt(i[0].substr(2,i[0].length-2),10),columnCssRulesL[r]=n[o]):(i=/\.r\d+/.exec(s))&&(r=parseInt(i[0].substr(2,i[0].length-2),10),columnCssRulesR[r]=n[o])}}return{left:columnCssRulesL[e],right:columnCssRulesR[e]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var e=plugins.length;e--;)unregisterPlugin(plugins[e]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.unbind(".slickgrid"),removeCssRules(),$canvas.unbind("draginit dragstart dragend drag"),$container.empty().removeClass(uid)}function trigger(e,t,o){return o=o||new Slick.EventData,t=t||{},t.grid=self,e.notify(t,o,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(e){return columnsById[e]}function autosizeColumns(){var e,t,o,i=[],r=0,n=0,s=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(e=0;e<columns.length;e++)t=columns[e],i.push(t.width),n+=t.width,t.resizable&&(r+=t.width-Math.max(t.minWidth,absoluteColumnMinWidth));for(o=n;n>s&&r;){var a=(n-s)/r;for(e=0;e<columns.length&&n>s;e++){t=columns[e];var l=i[e];if(!(!t.resizable||l<=t.minWidth||absoluteColumnMinWidth>=l)){var u=Math.max(t.minWidth,absoluteColumnMinWidth),c=Math.floor(a*(l-u))||1;c=Math.min(c,l-u),n-=c,r-=c,i[e]-=c}}if(n>=o)break;o=n}for(o=n;s>n;){var d=s/n;for(e=0;e<columns.length&&s>n;e++){t=columns[e];var h,p=i[e];h=!t.resizable||t.maxWidth<=p?0:Math.min(Math.floor(d*p)-p,t.maxWidth-p||1e6)||1,n+=h,i[e]+=h}if(o>=n)break;o=n}var _=!1;for(e=0;e<columns.length;e++)columns[e].rerenderOnResize&&columns[e].width!=i[e]&&(_=!0),columns[e].width=i[e];applyColumnHeaderWidths(),updateCanvasWidth(!0),_&&(invalidateAllRows(),render())}function applyColumnHeaderWidths(){if(initialized){for(var e,t=0,o=$headers.children(),i=o.length;i>t;t++)e=$(o[t]),e.width()!==columns[t].width-headerColumnWidthDiff&&e.width(columns[t].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){for(var e,t,o=0,i=0;i<columns.length;i++)e=columns[i].width,t=getColumnCssRules(i),t.left.style.left=o+"px",t.right.style.right=canvasWidth-o-e+"px",o+=columns[i].width}function setSortColumn(e,t){setSortColumns([{columnId:e,sortAsc:t}])}function setSortColumns(e){sortColumns=e;var t=$headers.children();t.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),$.each(sortColumns,function(e,o){null==o.sortAsc&&(o.sortAsc=!0);var i=getColumnIndex(o.columnId);null!=i&&t.eq(i).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(o.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(e,t){selectedRows=[];for(var o={},i=0;i<t.length;i++)for(var r=t[i].fromRow;r<=t[i].toRow;r++){o[r]||(selectedRows.push(r),o[r]={});for(var n=t[i].fromCell;n<=t[i].toCell;n++)canCellBeSelected(r,n)&&(o[r][columns[n].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,o),trigger(self.onSelectedRowsChanged,{rows:getSelectedRows()},e)}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var e=0,t=0,o=columns.length;o>t;t++)columnPosLeft[t]=e,columnPosRight[t]=e+columns[t].width,e+=columns[t].width}function setColumns(e){columns=e,columnsById={};for(var t=0;t<columns.length;t++){var o=columns[t]=$.extend({},columnDefaults,columns[t]);columnsById[o.id]=t,o.minWidth&&o.width<o.minWidth&&(o.width=o.minWidth),o.maxWidth&&o.width>o.maxWidth&&(o.width=o.maxWidth)}updateColumnCaches(),initialized&&(invalidateAllRows(),createColumnHeaders(),removeCssRules(),createCssRules(),resizeCanvas(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(e){getEditorLock().commitCurrentEdit()&&(makeActiveCellNormal(),options.enableAddRow!==e.enableAddRow&&invalidateRow(getDataLength()),options=$.extend(options,e),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),render())}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1)}function setData(e,t){data=e,invalidateAllRows(),updateRowCount(),t&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data.length}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow?1:0)}function getDataItem(e){return data.getItem?data.getItem(e):data[e]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(e){options.showTopPanel!=e&&(options.showTopPanel=e,e?$topPanelScroller.slideDown("fast",resizeCanvas):$topPanelScroller.slideUp("fast",resizeCanvas))}function setHeaderRowVisibility(e){options.showHeaderRow!=e&&(options.showHeaderRow=e,e?$headerRowScroller.slideDown("fast",resizeCanvas):$headerRowScroller.slideUp("fast",resizeCanvas))}function getContainerNode(){return $container.get(0)}function getRowTop(e){return options.rowHeight*e-offset}function getRowFromPosition(e){return Math.floor((e+offset)/options.rowHeight)}function scrollTo(e){e=Math.max(e,0),e=Math.min(e,th-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0));var t=offset;page=Math.min(n-1,Math.floor(e/ph)),offset=Math.round(page*cj);var o=e-offset;if(offset!=t){var i=getVisibleRange(o);cleanupRows(i),updateRowPositions()}prevScrollTop!=o&&(vScrollDir=o+offset>prevScrollTop+t?1:-1,$viewport[0].scrollTop=lastRenderedScrollTop=scrollTop=prevScrollTop=o,trigger(self.onViewportChanged,{}))}function defaultFormatter(e,t,o){return null==o?"":(o+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(e,t){var o=data.getItemMetadata&&data.getItemMetadata(e),i=o&&o.columns&&(o.columns[t.id]||o.columns[getColumnIndex(t.id)]);return i&&i.formatter||o&&o.formatter||t.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(t)||options.defaultFormatter}function getEditor(e,t){var o=columns[t],i=data.getItemMetadata&&data.getItemMetadata(e),r=i&&i.columns;return r&&r[o.id]&&void 0!==r[o.id].editor?r[o.id].editor:r&&r[t]&&void 0!==r[t].editor?r[t].editor:o.editor||options.editorFactory&&options.editorFactory.getEditor(o)}function getDataItemValueForColumn(e,t){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(e,t):e[t.field]}function appendRowHtml(e,t,o,i){var r=getDataItem(t),n=i>t&&!r,s="slick-row"+(n?" loading":"")+(t===activeRow?" active":"")+(1==t%2?" odd":" even");r||(s+=" "+options.addNewRowCssClass);var a=data.getItemMetadata&&data.getItemMetadata(t);a&&a.cssClasses&&(s+=" "+a.cssClasses),e.push("<div class='ui-widget-content "+s+"' style='top:"+getRowTop(t)+"px'>");for(var l,u,c=0,d=columns.length;d>c;c++){if(u=columns[c],l=1,a&&a.columns){var h=a.columns[u.id]||a.columns[c];l=h&&h.colspan||1,"*"===l&&(l=d-c)}if(columnPosRight[Math.min(d-1,c+l-1)]>o.leftPx){if(columnPosLeft[c]>o.rightPx)break;appendCellHtml(e,t,c,l,r)}l>1&&(c+=l-1)}e.push("</div>")}function appendCellHtml(e,t,o,i,r){var n=columns[o],s="slick-cell l"+o+" r"+Math.min(columns.length-1,o+i-1)+(n.cssClass?" "+n.cssClass:"");t===activeRow&&o===activeCell&&(s+=" active");for(var a in cellCssClasses)cellCssClasses[a][t]&&cellCssClasses[a][t][n.id]&&(s+=" "+cellCssClasses[a][t][n.id]);if(e.push("<div class='"+s+"'>"),r){var l=getDataItemValueForColumn(r,n);e.push(getFormatter(t,n)(t,o,l,n,r))}e.push("</div>"),rowsCache[t].cellRenderQueue.push(o),rowsCache[t].cellColSpans[o]=i}function cleanupRows(e){for(var t in rowsCache)(t=parseInt(t,10))!==activeRow&&(t<e.top||t>e.bottom)&&removeRowFromCache(t)}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var e in rowsCache)removeRowFromCache(e)}function removeRowFromCache(e){var t=rowsCache[e];t&&(rowNodeFromLastMouseWheelEvent==t.rowNode?(t.rowNode.style.display="none",zombieRowNodeFromLastMouseWheelEvent=rowNodeFromLastMouseWheelEvent):$canvas[0].removeChild(t.rowNode),delete rowsCache[e],delete postProcessedRows[e],renderedRows--,counter_rows_removed++)}function invalidateRows(e){var t,o;if(e&&e.length)for(vScrollDir=0,t=0,o=e.length;o>t;t++)currentEditor&&activeRow===e[t]&&makeActiveCellNormal(),rowsCache[e[t]]&&removeRowFromCache(e[t])}function invalidateRow(e){invalidateRows([e])}function updateCell(e,t){var o=getCellNode(e,t);if(o){var i=columns[t],r=getDataItem(e);currentEditor&&activeRow===e&&activeCell===t?currentEditor.loadValue(r):(o.innerHTML=r?getFormatter(e,i)(e,t,getDataItemValueForColumn(r,i),i,r):"",invalidatePostProcessingResults(e))}}function updateRow(e){var t=rowsCache[e];if(t){ensureCellNodesInRowsCache(e);var o=getDataItem(e);for(var i in t.cellNodesByColumnIdx)if(t.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var r=columns[i],n=t.cellNodesByColumnIdx[i];e===activeRow&&i===activeCell&&currentEditor?currentEditor.loadValue(o):n.innerHTML=o?getFormatter(e,r)(e,i,getDataItemValueForColumn(o,r),r,o):""}invalidatePostProcessingResults(e)}}function getViewportHeight(){return parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-parseFloat($.css($headerScroller[0],"height"))-getVBoxDelta($headerScroller)-(options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0)-(options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0)}function resizeCanvas(){initialized&&(viewportH=options.autoHeight?options.rowHeight*getDataLengthIncludingAddNew():getViewportHeight(),numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportW=parseFloat($.css($container[0],"width",!0)),options.autoHeight||$viewport.height(viewportH),options.forceFitColumns&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render())
}function updateRowCount(){if(initialized){var e=getDataLengthIncludingAddNew(),t=e+(options.leaveSpaceForNewRows?numVisibleRows-1:0),o=viewportHasVScroll;viewportHasVScroll=!options.autoHeight&&t*options.rowHeight>viewportH,makeActiveCellNormal();var i=e-1;for(var r in rowsCache)r>=i&&removeRowFromCache(r);activeCellNode&&activeRow>i&&resetActiveCell();var s=h;th=Math.max(options.rowHeight*t,viewportH-scrollbarDimensions.height),maxSupportedCssHeight>th?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1)),h!==s&&($canvas.css("height",h),scrollTop=$viewport[0].scrollTop);var a=th-viewportH>=scrollTop+offset;0==th||0==scrollTop?page=offset=0:a?scrollTo(scrollTop+offset):scrollTo(th-viewportH),h!=s&&options.autoHeight&&resizeCanvas(),options.forceFitColumns&&o!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(e,t){return null==e&&(e=scrollTop),null==t&&(t=scrollLeft),{top:getRowFromPosition(e),bottom:getRowFromPosition(e+viewportH)+1,leftPx:t,rightPx:t+viewportW}}function getRenderedRange(e,t){var o=getVisibleRange(e,t),i=Math.round(viewportH/options.rowHeight),r=3;return-1==vScrollDir?(o.top-=i,o.bottom+=r):1==vScrollDir?(o.top-=r,o.bottom+=i):(o.top-=r,o.bottom+=r),o.top=Math.max(0,o.top),o.bottom=Math.min(getDataLengthIncludingAddNew()-1,o.bottom),o.leftPx-=viewportW,o.rightPx+=viewportW,o.leftPx=Math.max(0,o.leftPx),o.rightPx=Math.min(canvasWidth,o.rightPx),o}function ensureCellNodesInRowsCache(e){var t=rowsCache[e];if(t&&t.cellRenderQueue.length)for(var o=t.rowNode.lastChild;t.cellRenderQueue.length;){var i=t.cellRenderQueue.pop();t.cellNodesByColumnIdx[i]=o,o=o.previousSibling}}function cleanUpCells(e,t){var o=0,i=rowsCache[t],r=[];for(var n in i.cellNodesByColumnIdx)if(i.cellNodesByColumnIdx.hasOwnProperty(n)){n=0|n;var s=i.cellColSpans[n];(columnPosLeft[n]>e.rightPx||columnPosRight[Math.min(columns.length-1,n+s-1)]<e.leftPx)&&(t!=activeRow||n!=activeCell)&&r.push(n)}for(var a;null!=(a=r.pop());)i.rowNode.removeChild(i.cellNodesByColumnIdx[a]),delete i.cellColSpans[a],delete i.cellNodesByColumnIdx[a],postProcessedRows[t]&&delete postProcessedRows[t][a],o++}function cleanUpAndRenderCells(e){for(var t,o,i,r=[],n=[],s=0,a=e.top,l=e.bottom;l>=a;a++)if(t=rowsCache[a]){ensureCellNodesInRowsCache(a),cleanUpCells(e,a),o=0;var u=data.getItemMetadata&&data.getItemMetadata(a);u=u&&u.columns;for(var c=getDataItem(a),d=0,h=columns.length;h>d&&!(columnPosLeft[d]>e.rightPx);d++)if(null==(i=t.cellColSpans[d])){if(i=1,u){var p=u[columns[d].id]||u[d];i=p&&p.colspan||1,"*"===i&&(i=h-d)}columnPosRight[Math.min(h-1,d+i-1)]>e.leftPx&&(appendCellHtml(r,a,d,i,c),o++),d+=i>1?i-1:0}else d+=i>1?i-1:0;o&&(s+=o,n.push(a))}if(r.length){var _=document.createElement("div");_.innerHTML=r.join("");for(var g,m;null!=(g=n.pop());){t=rowsCache[g];for(var f;null!=(f=t.cellRenderQueue.pop());)m=_.lastChild,t.rowNode.appendChild(m),t.cellNodesByColumnIdx[f]=m}}}function renderRows(e){for(var t=$canvas[0],o=[],i=[],r=!1,n=getDataLength(),s=e.top,a=e.bottom;a>=s;s++)rowsCache[s]||(renderedRows++,i.push(s),rowsCache[s]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(o,s,e,n),activeCellNode&&activeRow===s&&(r=!0),counter_rows_rendered++);if(i.length){var l=document.createElement("div");l.innerHTML=o.join("");for(var s=0,a=i.length;a>s;s++)rowsCache[i[s]].rowNode=t.appendChild(l.firstChild);r&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function invalidatePostProcessingResults(e){delete postProcessedRows[e],postProcessFromRow=Math.min(postProcessFromRow,e),postProcessToRow=Math.max(postProcessToRow,e),startPostProcessing()}function updateRowPositions(){for(var e in rowsCache)rowsCache[e].rowNode.style.top=getRowTop(e)+"px"}function render(){if(initialized){var e=getVisibleRange(),t=getRenderedRange();cleanupRows(t),lastRenderedScrollLeft!=scrollLeft&&cleanUpAndRenderCells(t),renderRows(t),postProcessFromRow=e.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,e.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,h_render=null}}function handleHeaderRowScroll(){var e=$headerRowScroller[0].scrollLeft;e!=$viewport[0].scrollLeft&&($viewport[0].scrollLeft=e)}function handleScroll(){scrollTop=$viewport[0].scrollTop,scrollLeft=$viewport[0].scrollLeft;var e=Math.abs(scrollTop-prevScrollTop),t=Math.abs(scrollLeft-prevScrollLeft);if(t&&(prevScrollLeft=scrollLeft,$headerScroller[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScroller[0].scrollLeft=scrollLeft),e)if(vScrollDir=scrollTop>prevScrollTop?1:-1,prevScrollTop=scrollTop,viewportH>e)scrollTo(scrollTop+offset);else{var o=offset;page=h==viewportH?0:Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),o!=offset&&invalidateAllRows()}(t||e)&&(h_render&&clearTimeout(h_render),(Math.abs(lastRenderedScrollTop-scrollTop)>20||Math.abs(lastRenderedScrollLeft-scrollLeft)>20)&&(options.forceSyncScrolling||Math.abs(lastRenderedScrollTop-scrollTop)<viewportH&&Math.abs(lastRenderedScrollLeft-scrollLeft)<viewportW?render():h_render=setTimeout(render,50),trigger(self.onViewportChanged,{}))),trigger(self.onScroll,{scrollLeft:scrollLeft,scrollTop:scrollTop})}function asyncPostProcessRows(){for(var e=getDataLength();postProcessToRow>=postProcessFromRow;){var t=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,o=rowsCache[t];if(o&&!(t>=e)){postProcessedRows[t]||(postProcessedRows[t]={}),ensureCellNodesInRowsCache(t);for(var i in o.cellNodesByColumnIdx)if(o.cellNodesByColumnIdx.hasOwnProperty(i)){i=0|i;var r=columns[i];if(r.asyncPostRender&&!postProcessedRows[t][i]){var n=o.cellNodesByColumnIdx[i];n&&r.asyncPostRender(n,t,getDataItem(t),r),postProcessedRows[t][i]=!0}}return h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay),void 0}}}function updateCellCssStylesOnRenderedRows(e,t){var o,i,r,n;for(var s in rowsCache){if(n=t&&t[s],r=e&&e[s],n)for(i in n)r&&n[i]==r[i]||(o=getCellNode(s,getColumnIndex(i)),o&&$(o).removeClass(n[i]));if(r)for(i in r)n&&n[i]==r[i]||(o=getCellNode(s,getColumnIndex(i)),o&&$(o).addClass(r[i]))}}function addCellCssStyles(e,t){if(cellCssClasses[e])throw"addCellCssStyles: cell CSS hash with key '"+e+"' already exists.";cellCssClasses[e]=t,updateCellCssStylesOnRenderedRows(t,null),trigger(self.onCellCssStylesChanged,{key:e,hash:t})}function removeCellCssStyles(e){cellCssClasses[e]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[e]),delete cellCssClasses[e],trigger(self.onCellCssStylesChanged,{key:e,hash:null}))}function setCellCssStyles(e,t){var o=cellCssClasses[e];cellCssClasses[e]=t,updateCellCssStylesOnRenderedRows(t,o),trigger(self.onCellCssStylesChanged,{key:e,hash:t})}function getCellCssStyles(e){return cellCssClasses[e]}function flashCell(e,t,o){function i(e){e&&setTimeout(function(){r.queue(function(){r.toggleClass(options.cellFlashingCssClass).dequeue(),i(e-1)})},o)}if(o=o||100,rowsCache[e]){var r=$(getCellNode(e,t));i(4)}}function handleMouseWheel(e){var t=$(e.target).closest(".slick-row")[0];t!=rowNodeFromLastMouseWheelEvent&&(zombieRowNodeFromLastMouseWheelEvent&&zombieRowNodeFromLastMouseWheelEvent!=t&&($canvas[0].removeChild(zombieRowNodeFromLastMouseWheelEvent),zombieRowNodeFromLastMouseWheelEvent=null),rowNodeFromLastMouseWheelEvent=t)}function handleDragInit(e,t){var o=getCellFromEvent(e);if(!o||!cellExists(o.row,o.cell))return!1;var i=trigger(self.onDragInit,t,e);return e.isImmediatePropagationStopped()?i:!1}function handleDragStart(e,t){var o=getCellFromEvent(e);if(!o||!cellExists(o.row,o.cell))return!1;var i=trigger(self.onDragStart,t,e);return e.isImmediatePropagationStopped()?i:!1}function handleDrag(e,t){return trigger(self.onDrag,t,e)}function handleDragEnd(e,t){trigger(self.onDragEnd,t,e)}function handleKeyDown(e){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},e);var t=e.isImmediatePropagationStopped();if(!t)if(e.shiftKey||e.altKey||e.ctrlKey)9!=e.which||!e.shiftKey||e.ctrlKey||e.altKey||(t=navigatePrev());else if(27==e.which){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else 34==e.which?(navigatePageDown(),t=!0):33==e.which?(navigatePageUp(),t=!0):37==e.which?t=navigateLeft():39==e.which?t=navigateRight():38==e.which?t=navigateUp():40==e.which?t=navigateDown():9==e.which?t=navigateNext():13==e.which&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable()),t=!0);if(t){e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(o){}}}function handleClick(e){currentEditor||(e.target!=document.activeElement||$(e.target).hasClass("slick-cell"))&&setFocus();var t=getCellFromEvent(e);!t||null!==currentEditor&&activeRow==t.row&&activeCell==t.cell||(trigger(self.onClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||activeCell==t.cell&&activeRow==t.row||!canCellBeActive(t.row,t.cell)||(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit())&&(scrollRowIntoView(t.row,!1),setActiveCellInternal(getCellNode(t.row,t.cell))))}function handleMouseDown(e){var t=getCellFromEvent(e);t&&(trigger(self.onMouseDown,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped())}function handleContextMenu(e){var t=$(e.target).closest(".slick-cell",$canvas);0!==t.length&&(activeCellNode!==t[0]||null===currentEditor)&&trigger(self.onContextMenu,{},e)}function handleDblClick(e){var t=getCellFromEvent(e);!t||null!==currentEditor&&activeRow==t.row&&activeCell==t.cell||(trigger(self.onDblClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||options.editable&&gotoCell(t.row,t.cell,!0))}function handleHeaderMouseEnter(e){trigger(self.onHeaderMouseEnter,{column:$(this).data("column")},e)}function handleHeaderMouseLeave(e){trigger(self.onHeaderMouseLeave,{column:$(this).data("column")},e)}function handleHeaderContextMenu(e){var t=$(e.target).closest(".slick-header-column",".slick-header-columns"),o=t&&t.data("column");trigger(self.onHeaderContextMenu,{column:o},e)}function handleHeaderClick(e){var t=$(e.target).closest(".slick-header-column",".slick-header-columns"),o=t&&t.data("column");o&&trigger(self.onHeaderClick,{column:o},e)}function handleMouseEnter(e){trigger(self.onMouseEnter,{},e)}function handleMouseLeave(e){trigger(self.onMouseLeave,{},e)}function cellExists(e,t){return!(0>e||e>=getDataLength()||0>t||t>=columns.length)}function getCellFromPoint(e,t){for(var o=getRowFromPosition(t),i=0,r=0,n=0;n<columns.length&&e>r;n++)r+=columns[n].width,i++;return 0>i&&(i=0),{row:o,cell:i-1}}function getCellFromNode(e){var t=/l\d+/.exec(e.className);if(!t)throw"getCellFromNode: cannot get cell - "+e.className;return parseInt(t[0].substr(1,t[0].length-1),10)}function getRowFromNode(e){for(var t in rowsCache)if(rowsCache[t].rowNode===e)return 0|t;return null}function getCellFromEvent(e){var t=$(e.target).closest(".slick-cell",$canvas);if(!t.length)return null;var o=getRowFromNode(t[0].parentNode),i=getCellFromNode(t[0]);return null==o||null==i?null:{row:o,cell:i}}function getCellNodeBox(e,t){if(!cellExists(e,t))return null;for(var o=getRowTop(e),i=o+options.rowHeight-1,r=0,n=0;t>n;n++)r+=columns[n].width;var s=r+columns[t].width;return{top:o,left:r,bottom:i,right:s}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){-1==tabbingDirection?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(e,t,o){scrollRowIntoView(e,o);var i=getColspan(e,t),r=columnPosLeft[t],n=columnPosRight[t+(i>1?i-1:0)],s=scrollLeft+viewportW;scrollLeft>r?($viewport.scrollLeft(r),handleScroll(),render()):n>s&&($viewport.scrollLeft(Math.min(r,n-$viewport[0].clientWidth)),handleScroll(),render())}function setActiveCellInternal(e,t){null!==activeCellNode&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active"));var o=activeCellNode!==e;activeCellNode=e,null!=activeCellNode?(activeRow=getRowFromNode(activeCellNode.parentNode),activeCell=activePosX=getCellFromNode(activeCellNode),null==t&&(t=activeRow==getDataLength()||options.autoEdit),$(activeCellNode).addClass("active"),$(rowsCache[activeRow].rowNode).addClass("active"),options.editable&&t&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable()},options.asyncEditorLoadDelay):makeActiveCellEditable())):activeRow=activeCell=null,o&&trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}else if(window.getSelection){var t=window.getSelection();t&&t.removeAllRanges&&t.removeAllRanges()}}function isCellPotentiallyEditable(e,t){var o=getDataLength();return o>e&&!getDataItem(e)?!1:columns[t].cannotTriggerInsert&&e>=o?!1:getEditor(e,t)?!0:!1}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var e=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),e){var t=columns[activeCell],o=getFormatter(activeRow,t);activeCellNode.innerHTML=o(activeRow,activeCell,getDataItemValueForColumn(e,t),t,e),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(e){if(activeCellNode){if(!options.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";if(clearTimeout(h_editorLoader),isCellPotentiallyEditable(activeRow,activeCell)){var t=columns[activeCell],o=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:o,column:t})===!1)return setFocus(),void 0;getEditorLock().activate(editController),$(activeCellNode).addClass("editable"),e||(activeCellNode.innerHTML=""),currentEditor=new(e||getEditor(activeRow,activeCell))({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:t,item:o||{},commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),o&&currentEditor.loadValue(o),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(e){var t={top:e.offsetTop,left:e.offsetLeft,bottom:0,right:0,width:$(e).outerWidth(),height:$(e).outerHeight(),visible:!0};t.bottom=t.top+t.height,t.right=t.left+t.width;for(var o=e.offsetParent;(e=e.parentNode)!=document.body;)t.visible&&e.scrollHeight!=e.offsetHeight&&"visible"!=$(e).css("overflowY")&&(t.visible=t.bottom>e.scrollTop&&t.top<e.scrollTop+e.clientHeight),t.visible&&e.scrollWidth!=e.offsetWidth&&"visible"!=$(e).css("overflowX")&&(t.visible=t.right>e.scrollLeft&&t.left<e.scrollLeft+e.clientWidth),t.left-=e.scrollLeft,t.top-=e.scrollTop,e===o&&(t.left+=e.offsetLeft,t.top+=e.offsetTop,o=e.offsetParent),t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var e=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(e.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(e)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(e,t){var o=e*options.rowHeight,i=(e+1)*options.rowHeight-viewportH+(viewportHasHScroll?scrollbarDimensions.height:0);(e+1)*options.rowHeight>scrollTop+viewportH+offset?(scrollTo(t?o:i),render()):e*options.rowHeight<scrollTop+offset&&(scrollTo(t?i:o),render())}function scrollRowToTop(e){scrollTo(e*options.rowHeight),render()}function scrollPage(e){var t=e*numVisibleRows;if(scrollTo((getRowFromPosition(scrollTop)+t)*options.rowHeight),render(),options.enableCellNavigation&&null!=activeRow){var o=activeRow+t,i=getDataLengthIncludingAddNew();o>=i&&(o=i-1),0>o&&(o=0);for(var r=0,n=null,s=activePosX;activePosX>=r;)canCellBeActive(o,r)&&(n=r),r+=getColspan(o,r);null!==n?(setActiveCellInternal(getCellNode(o,n)),activePosX=s):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function getColspan(e,t){var o=data.getItemMetadata&&data.getItemMetadata(e);if(!o||!o.columns)return 1;var i=o.columns[columns[t].id]||o.columns[t],r=i&&i.colspan;return r="*"===r?columns.length-t:r||1}function findFirstFocusableCell(e){for(var t=0;t<columns.length;){if(canCellBeActive(e,t))return t;t+=getColspan(e,t)}return null}function findLastFocusableCell(e){for(var t=0,o=null;t<columns.length;)canCellBeActive(e,t)&&(o=t),t+=getColspan(e,t);return o}function gotoRight(e,t){if(t>=columns.length)return null;do t+=getColspan(e,t);while(t<columns.length&&!canCellBeActive(e,t));return t<columns.length?{row:e,cell:t,posX:t}:null}function gotoLeft(e,t){if(0>=t)return null;var o=findFirstFocusableCell(e);if(null===o||o>=t)return null;for(var i,r={row:e,cell:o,posX:o};;){if(i=gotoRight(r.row,r.cell,r.posX),!i)return null;if(i.cell>=t)return r;r=i}}function gotoDown(e,t,o){for(var i,r=getDataLengthIncludingAddNew();;){if(++e>=r)return null;for(i=t=0;o>=t;)i=t,t+=getColspan(e,t);if(canCellBeActive(e,i))return{row:e,cell:i,posX:o}}}function gotoUp(e,t,o){for(var i;;){if(--e<0)return null;for(i=t=0;o>=t;)i=t,t+=getColspan(e,t);if(canCellBeActive(e,i))return{row:e,cell:i,posX:o}}}function gotoNext(e,t,o){if(null==e&&null==t&&(e=t=o=0,canCellBeActive(e,t)))return{row:e,cell:t,posX:t};var i=gotoRight(e,t,o);if(i)return i;for(var r=null,n=getDataLengthIncludingAddNew();++e<n;)if(r=findFirstFocusableCell(e),null!==r)return{row:e,cell:r,posX:r};return null}function gotoPrev(e,t,o){if(null==e&&null==t&&(e=getDataLengthIncludingAddNew()-1,t=o=columns.length-1,canCellBeActive(e,t)))return{row:e,cell:t,posX:t};for(var i,r;!i&&!(i=gotoLeft(e,t,o));){if(--e<0)return null;t=0,r=findLastFocusableCell(e),null!==r&&(i={row:e,cell:r,posX:r})}return i}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigate(e){if(!options.enableCellNavigation)return!1;if(!activeCellNode&&"prev"!=e&&"next"!=e)return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var t={up:-1,down:1,left:-1,right:1,prev:-1,next:1};tabbingDirection=t[e];var o={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext},i=o[e],r=i(activeRow,activeCell,activePosX);if(r){var n=r.row==getDataLength();return scrollCellIntoView(r.row,r.cell,!n),setActiveCellInternal(getCellNode(r.row,r.cell)),activePosX=r.posX,!0}return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(e,t){return rowsCache[e]?(ensureCellNodesInRowsCache(e),rowsCache[e].cellNodesByColumnIdx[t]):null}function setActiveCell(e,t){initialized&&(e>getDataLength()||0>e||t>=columns.length||0>t||options.enableCellNavigation&&(scrollCellIntoView(e,t,!1),setActiveCellInternal(getCellNode(e,t),!1)))}function canCellBeActive(e,t){if(!options.enableCellNavigation||e>=getDataLengthIncludingAddNew()||0>e||t>=columns.length||0>t)return!1;var o=data.getItemMetadata&&data.getItemMetadata(e);if(o&&"boolean"==typeof o.focusable)return o.focusable;var i=o&&o.columns;return i&&i[columns[t].id]&&"boolean"==typeof i[columns[t].id].focusable?i[columns[t].id].focusable:i&&i[t]&&"boolean"==typeof i[t].focusable?i[t].focusable:columns[t].focusable}function canCellBeSelected(e,t){if(e>=getDataLength()||0>e||t>=columns.length||0>t)return!1;var o=data.getItemMetadata&&data.getItemMetadata(e);if(o&&"boolean"==typeof o.selectable)return o.selectable;var i=o&&o.columns&&(o.columns[columns[t].id]||o.columns[t]);return i&&"boolean"==typeof i.selectable?i.selectable:columns[t].selectable}function gotoCell(e,t,o){if(initialized&&canCellBeActive(e,t)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(e,t,!1);var i=getCellNode(e,t);setActiveCellInternal(i,o||e===getDataLength()||options.autoEdit),currentEditor||setFocus()}}function commitCurrentEdit(){var e=getDataItem(activeRow),t=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var o=currentEditor.validate();if(o.valid){if(activeRow<getDataLength()){var i={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(e,this.serializedValue),updateRow(this.row),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:e})},undo:function(){this.editor.applyValue(e,this.prevSerializedValue),updateRow(this.row),trigger(self.onCellChange,{row:activeRow,cell:activeCell,item:e})}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(e,t,i)):(i.execute(),makeActiveCellNormal())}else{var r={};currentEditor.applyValue(r,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:r,column:t})}return!getEditorLock().isActive()}return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:o,row:activeRow,cell:activeCell,column:t}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(e){for(var t=[],o=columns.length-1,i=0;i<e.length;i++)t.push(new Slick.Range(e[i],0,e[i],o));return t}function getSelectedRows(){if(!selectionModel)throw"Selection model is not set";return selectedRows}function setSelectedRows(e){if(!selectionModel)throw"Selection model is not set";selectionModel.setSelectedRanges(rowsToRanges(e))}var defaults={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:defaultFormatter,forceSyncScrolling:!1,addNewRowCssClass:"new-row"},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2,$headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacer,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,absoluteColumnMinWidth,tabbingDirection=1,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],h_editorLoader=null,h_render=null,h_postrender=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,counter_rows_rendered=0,counter_rows_removed=0,rowNodeFromLastMouseWheelEvent,zombieRowNodeFromLastMouseWheelEvent;this.debug=function(){var e="";e+="\ncounter_rows_rendered:  "+counter_rows_rendered,e+="\ncounter_rows_removed:  "+counter_rows_removed,e+="\nrenderedRows:  "+renderedRows,e+="\nnumVisibleRows:  "+numVisibleRows,e+="\nmaxSupportedCssHeight:  "+maxSupportedCssHeight,e+="\nn(umber of pages):  "+n,e+="\n(current) page:  "+page,e+="\npage height (ph):  "+ph,e+="\nvScrollDir:  "+vScrollDir,alert(e)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.2",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onMouseDown:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:registerPlugin,unregisterPlugin:unregisterPlugin,getColumns:getColumns,setColumns:setColumns,getColumnIndex:getColumnIndex,updateColumnHeader:updateColumnHeader,setSortColumn:setSortColumn,setSortColumns:setSortColumns,getSortColumns:getSortColumns,autosizeColumns:autosizeColumns,getOptions:getOptions,setOptions:setOptions,getData:getData,getDataLength:getDataLength,getDataItem:getDataItem,setData:setData,getSelectionModel:getSelectionModel,setSelectionModel:setSelectionModel,getSelectedRows:getSelectedRows,setSelectedRows:setSelectedRows,getContainerNode:getContainerNode,render:render,invalidate:invalidate,invalidateRow:invalidateRow,invalidateRows:invalidateRows,invalidateAllRows:invalidateAllRows,updateCell:updateCell,updateRow:updateRow,getViewport:getVisibleRange,getRenderedRange:getRenderedRange,resizeCanvas:resizeCanvas,updateRowCount:updateRowCount,scrollRowIntoView:scrollRowIntoView,scrollRowToTop:scrollRowToTop,scrollCellIntoView:scrollCellIntoView,getCanvasNode:getCanvasNode,focus:setFocus,getCellFromPoint:getCellFromPoint,getCellFromEvent:getCellFromEvent,getActiveCell:getActiveCell,setActiveCell:setActiveCell,getActiveCellNode:getActiveCellNode,getActiveCellPosition:getActiveCellPosition,resetActiveCell:resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor:getCellEditor,getCellNode:getCellNode,getCellNodeBox:getCellNodeBox,canCellBeSelected:canCellBeSelected,canCellBeActive:canCellBeActive,navigatePrev:navigatePrev,navigateNext:navigateNext,navigateUp:navigateUp,navigateDown:navigateDown,navigateLeft:navigateLeft,navigateRight:navigateRight,navigatePageUp:navigatePageUp,navigatePageDown:navigatePageDown,gotoCell:gotoCell,getTopPanel:getTopPanel,setTopPanelVisibility:setTopPanelVisibility,setHeaderRowVisibility:setHeaderRowVisibility,getHeaderRow:getHeaderRow,getHeaderRowColumn:getHeaderRowColumn,getGridPosition:getGridPosition,flashCell:flashCell,addCellCssStyles:addCellCssStyles,setCellCssStyles:setCellCssStyles,removeCellCssStyles:removeCellCssStyles,getCellCssStyles:getCellCssStyles,init:finishInitialization,destroy:destroy,getEditorLock:getEditorLock,getEditController:getEditController}),init()}$.extend(!0,window,{Slick:{Grid:SlickGrid}});var scrollbarDimensions,maxSupportedCssHeight}(jQuery),function(e){function t(t){function o(){vt=!0}function i(){vt=!1,tt()}function r(e){bt=e}function n(e){st=e}function s(e){e=e||0;for(var t,o=e,i=ht.length;i>o;o++){if(t=ht[o][dt],void 0===t)throw"Each data element must implement a unique 'id' property";_t[t]=o}}function a(){for(var e,t=0,o=ht.length;o>t;t++)if(e=ht[t][dt],void 0===e||_t[e]!==t)throw"Each data element must implement a unique 'id' property"}function l(){return ht}function u(e,t){void 0!==t&&(dt=t),ht=yt=e,_t={},s(),a(),tt()}function c(e){void 0!=e.pageSize&&(Tt=e.pageSize,At=Tt?Math.min(At,Math.max(0,Math.ceil(qt/Tt)-1)):0),void 0!=e.pageNum&&(At=Math.min(e.pageNum,Math.max(0,Math.ceil(qt/Tt)-1))),Mt.notify(d(),null,ut),tt()}function d(){var e=Tt?Math.max(1,Math.ceil(qt/Tt)):1;return{pageSize:Tt,pageNum:At,totalRows:qt,totalPages:e}}function h(e,t){wt=t,nt=e,rt=null,t===!1&&ht.reverse(),ht.sort(e),t===!1&&ht.reverse(),_t={},s(),tt()}function p(e,t){wt=t,rt=e,nt=null;var o=Object.prototype.toString;Object.prototype.toString="function"==typeof e?e:function(){return this[e]},t===!1&&ht.reverse(),ht.sort(),Object.prototype.toString=o,t===!1&&ht.reverse(),_t={},s(),tt()}function _(){nt?h(nt,wt):rt&&p(rt,wt)}function g(e){mt=e,t.inlineFilters&&(at=j(),lt=K()),tt()}function m(){return xt}function f(o){t.groupItemMetadataProvider||(t.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider),Rt=[],St=[],o=o||[],xt=o instanceof Array?o:[o];for(var i=0;i<xt.length;i++){var r=xt[i]=e.extend(!0,{},$t,xt[i]);r.getterIsAFn="function"==typeof r.getter,r.compiledAccumulators=[];for(var n=r.aggregators.length;n--;)r.compiledAccumulators[n]=U(r.aggregators[n]);St[i]={}}tt()}function v(e,t,o){return null==e?(f([]),void 0):(f({getter:e,formatter:t,comparer:o}),void 0)}function w(e,t){if(!xt.length)throw new Error("At least one grouping must be specified before calling setAggregators().");xt[0].aggregators=e,xt[0].aggregateCollapsed=t,f(xt)}function b(e){return ht[e]}function C(e){return _t[e]}function y(){if(!gt){gt={};for(var e=0,t=pt.length;t>e;e++)gt[pt[e][dt]]=e}}function k(e){return y(),gt[e]}function $(e){return ht[_t[e]]}function x(e){var t=[];y();for(var o=0,i=e.length;i>o;o++){var r=gt[e[o]];null!=r&&(t[t.length]=r)}return t}function R(e){for(var t=[],o=0,i=e.length;i>o;o++)e[o]<pt.length&&(t[t.length]=pt[e[o]][dt]);return t}function S(e,t){if(void 0===_t[e]||e!==t[dt])throw"Invalid or non-matching id";ht[_t[e]]=t,ft||(ft={}),ft[e]=!0,tt()}function E(e,t){ht.splice(e,0,t),s(e),tt()}function T(e){ht.push(e),s(ht.length-1),tt()}function A(e){var t=_t[e];if(void 0===t)throw"Invalid id";delete _t[e],ht.splice(t,1),s(t),tt()}function q(){return pt.length}function D(e){var t=pt[e];if(t&&t.__group&&t.totals&&!t.totals.initialized){var o=xt[t.level];o.displayTotalsRow||(B(t.totals),t.title=o.formatter?o.formatter(t):t.value)}else t&&t.__groupTotals&&!t.initialized&&B(t);return t}function P(e){var o=pt[e];return void 0===o?null:o.__group?t.groupItemMetadataProvider.getGroupRowMetadata(o):o.__groupTotals?t.groupItemMetadataProvider.getTotalsRowMetadata(o):null}function M(e,t){if(null==e)for(var o=0;o<xt.length;o++)St[o]={},xt[o].collapsed=t;else St[e]={},xt[e].collapsed=t;tt()}function L(e){M(e,!0)}function I(e){M(e,!1)}function z(e,t,o){St[e][t]=xt[e].collapsed^o,tt()}function H(){var e=Array.prototype.slice.call(arguments),t=e[0];1==e.length&&-1!=t.indexOf(Et)?z(t.split(Et).length-1,t,!0):z(e.length-1,e.join(Et),!0)}function N(){var e=Array.prototype.slice.call(arguments),t=e[0];1==e.length&&-1!=t.indexOf(Et)?z(t.split(Et).length-1,t,!1):z(e.length-1,e.join(Et),!1)}function W(){return Rt}function F(e,t){for(var o,i,r,n=[],s={},a=t?t.level+1:0,l=xt[a],u=0,c=l.predefinedValues.length;c>u;u++)i=l.predefinedValues[u],o=s[i],o||(o=new Slick.Group,o.value=i,o.level=a,o.groupingKey=(t?t.groupingKey+Et:"")+i,n[n.length]=o,s[i]=o);for(var u=0,c=e.length;c>u;u++)r=e[u],i=l.getterIsAFn?l.getter(r):r[l.getter],o=s[i],o||(o=new Slick.Group,o.value=i,o.level=a,o.groupingKey=(t?t.groupingKey+Et:"")+i,n[n.length]=o,s[i]=o),o.rows[o.count++]=r;if(a<xt.length-1)for(var u=0;u<n.length;u++)o=n[u],o.groups=F(o.rows,o);return n.sort(xt[a].comparer),n}function B(e){var t,o=e.group,i=xt[o.level],r=o.level==xt.length,n=i.aggregators.length;
if(!r&&i.aggregateChildGroups)for(var s=o.groups.length;s--;)o.groups[s].initialized||B(o.groups[s]);for(;n--;)t=i.aggregators[n],t.init(),!r&&i.aggregateChildGroups?i.compiledAccumulators[n].call(t,o.groups):i.compiledAccumulators[n].call(t,o.rows),t.storeResult(e);e.initialized=!0}function V(e){var t=xt[e.level],o=new Slick.GroupTotals;o.group=e,e.totals=o,t.lazyTotalsCalculation||B(o)}function O(e,t){t=t||0;for(var o,i=xt[t],r=i.collapsed,n=St[t],s=e.length;s--;)o=e[s],(!o.collapsed||i.aggregateCollapsed)&&(o.groups&&O(o.groups,t+1),i.aggregators.length&&(i.aggregateEmpty||o.rows.length||o.groups&&o.groups.length)&&V(o),o.collapsed=r^n[o.groupingKey],o.title=i.formatter?i.formatter(o):o.value)}function G(e,t){t=t||0;for(var o,i,r=xt[t],n=[],s=0,a=0,l=e.length;l>a;a++){if(i=e[a],n[s++]=i,!i.collapsed){o=i.groups?G(i.groups,t+1):i.rows;for(var u=0,c=o.length;c>u;u++)n[s++]=o[u]}i.totals&&r.displayTotalsRow&&(!i.collapsed||r.aggregateCollapsed)&&(n[s++]=i.totals)}return n}function Y(e){var t=/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/,o=e.toString().match(t);return{params:o[1].split(","),body:o[2]}}function U(e){var t=Y(e.accumulate),o=new Function("_items","for (var "+t.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+t.params[0]+" = _items[_i]; "+t.body+"}");return o.displayName=o.name="compiledAccumulatorLoop",o}function j(){var e=Y(mt),t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ($1) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),o=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","$filter$; ","} ","return _retval; "].join("");o=o.replace(/\$filter\$/gi,t),o=o.replace(/\$item\$/gi,e.params[0]),o=o.replace(/\$args\$/gi,e.params[1]);var i=new Function("_items,_args",o);return i.displayName=i.name="compiledFilter",i}function K(){var e=Y(mt),t=e.body.replace(/return false\s*([;}]|$)/gi,"{ continue _coreloop; }$1").replace(/return true\s*([;}]|$)/gi,"{ _cache[_i] = true;_retval[_idx++] = $item$; continue _coreloop; }$1").replace(/return ([^;}]+?)\s*([;}]|$)/gi,"{ if ((_cache[_i] = $1)) { _retval[_idx++] = $item$; }; continue _coreloop; }$2"),o=["var _retval = [], _idx = 0; ","var $item$, $args$ = _args; ","_coreloop: ","for (var _i = 0, _il = _items.length; _i < _il; _i++) { ","$item$ = _items[_i]; ","if (_cache[_i]) { ","_retval[_idx++] = $item$; ","continue _coreloop; ","} ","$filter$; ","} ","return _retval; "].join("");o=o.replace(/\$filter\$/gi,t),o=o.replace(/\$item\$/gi,e.params[0]),o=o.replace(/\$args\$/gi,e.params[1]);var i=new Function("_items,_args,_cache",o);return i.displayName=i.name="compiledFilterWithCaching",i}function X(e,t){for(var o=[],i=0,r=0,n=e.length;n>r;r++)mt(e[r],t)&&(o[i++]=e[r]);return o}function J(e,t,o){for(var i,r=[],n=0,s=0,a=e.length;a>s;s++)i=e[s],o[s]?r[n++]=i:mt(i,t)&&(r[n++]=i,o[s]=!0);return r}function Q(e){if(mt){var o=t.inlineFilters?at:X,i=t.inlineFilters?lt:J;bt.isFilterNarrowing?yt=o(yt,st):bt.isFilterExpanding?yt=i(e,st,kt):bt.isFilterUnchanged||(yt=o(e,st))}else yt=Tt?e:e.concat();var r;return Tt?(yt.length<At*Tt&&(At=Math.floor(yt.length/Tt)),r=yt.slice(Tt*At,Tt*At+Tt)):r=yt,{totalRows:yt.length,rows:r}}function Z(e,t){var o,i,r,n=[],s=0,a=t.length;bt&&bt.ignoreDiffsBefore&&(s=Math.max(0,Math.min(t.length,bt.ignoreDiffsBefore))),bt&&bt.ignoreDiffsAfter&&(a=Math.min(t.length,Math.max(0,bt.ignoreDiffsAfter)));for(var l=s,u=e.length;a>l;l++)l>=u?n[n.length]=l:(o=t[l],i=e[l],(xt.length&&(r=o.__nonDataRow||i.__nonDataRow)&&o.__group!==i.__group||o.__group&&!o.equals(i)||r&&(o.__groupTotals||i.__groupTotals)||o[dt]!=i[dt]||ft&&ft[o[dt]])&&(n[n.length]=l));return n}function et(e){gt=null,(bt.isFilterNarrowing!=Ct.isFilterNarrowing||bt.isFilterExpanding!=Ct.isFilterExpanding)&&(kt=[]);var t=Q(e);qt=t.totalRows;var o=t.rows;Rt=[],xt.length&&(Rt=F(o),Rt.length&&(O(Rt),o=G(Rt)));var i=Z(pt,o);return pt=o,i}function tt(){if(!vt){var e=pt.length,t=qt,o=et(ht,mt);Tt&&At*Tt>qt&&(At=Math.max(0,Math.ceil(qt/Tt)-1),o=et(ht,mt)),ft=null,Ct=bt,bt={},t!=qt&&Mt.notify(d(),null,ut),e!=pt.length&&Dt.notify({previous:e,current:pt.length},null,ut),o.length>0&&Pt.notify({rows:o},null,ut)}}function ot(t,o,i){function r(e){l.join(",")!=e.join(",")&&(l=e,u.notify({grid:t,ids:l},new Slick.EventData,a))}function n(){if(l.length>0){s=!0;var e=a.mapIdsToRows(l);o||r(a.mapRowsToIds(e)),t.setSelectedRows(e),s=!1}}var s,a=this,l=a.mapRowsToIds(t.getSelectedRows()),u=new Slick.Event;return t.onSelectedRowsChanged.subscribe(function(){if(!s){var o=a.mapRowsToIds(t.getSelectedRows());if(i&&t.getOptions().multiSelect){var n=e.grep(l,function(e){return void 0===a.getRowById(e)});r(n.concat(o))}else r(o)}}),this.onRowsChanged.subscribe(n),this.onRowCountChanged.subscribe(n),u}function it(e,t){function o(e){r={};for(var t in e){var o=pt[t][dt];r[o]=e[t]}}function i(){if(r){n=!0,y();var o={};for(var i in r){var s=gt[i];void 0!=s&&(o[s]=r[i])}e.setCellCssStyles(t,o),n=!1}}var r,n;o(e.getCellCssStyles(t)),e.onCellCssStylesChanged.subscribe(function(e,i){n||t==i.key&&i.hash&&o(i.hash)}),this.onRowsChanged.subscribe(i),this.onRowCountChanged.subscribe(i)}var rt,nt,st,at,lt,ut=this,ct={groupItemMetadataProvider:null,inlineFilters:!1},dt="id",ht=[],pt=[],_t={},gt=null,mt=null,ft=null,vt=!1,wt=!0,bt={},Ct={},yt=[],kt=[],$t={getter:null,formatter:null,comparer:function(e,t){return e.value-t.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0,lazyTotalsCalculation:!1},xt=[],Rt=[],St=[],Et=":|:",Tt=0,At=0,qt=0,Dt=new Slick.Event,Pt=new Slick.Event,Mt=new Slick.Event;t=e.extend(!0,{},ct,t),e.extend(this,{beginUpdate:o,endUpdate:i,setPagingOptions:c,getPagingInfo:d,getItems:l,setItems:u,setFilter:g,sort:h,fastSort:p,reSort:_,setGrouping:f,getGrouping:m,groupBy:v,setAggregators:w,collapseAllGroups:L,expandAllGroups:I,collapseGroup:H,expandGroup:N,getGroups:W,getIdxById:C,getRowById:k,getItemById:$,getItemByIdx:b,mapRowsToIds:R,mapIdsToRows:x,setRefreshHints:r,setFilterArgs:n,refresh:tt,updateItem:S,insertItem:E,addItem:T,deleteItem:A,syncGridSelection:ot,syncGridCellCssStyles:it,getLength:q,getItem:D,getItemMetadata:P,onRowCountChanged:Dt,onRowsChanged:Pt,onPagingInfoChanged:Mt})}function o(e){this.field_=e,this.init=function(){this.count_=0,this.nonNullCount_=0,this.sum_=0},this.accumulate=function(e){var t=e[this.field_];this.count_++,null!=t&&""!==t&&0/0!==t&&(this.nonNullCount_++,this.sum_+=parseFloat(t))},this.storeResult=function(e){e.avg||(e.avg={}),0!=this.nonNullCount_&&(e.avg[this.field_]=this.sum_/this.nonNullCount_)}}function i(e){this.field_=e,this.init=function(){this.min_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(null==this.min_||t<this.min_)&&(this.min_=t)},this.storeResult=function(e){e.min||(e.min={}),e.min[this.field_]=this.min_}}function r(e){this.field_=e,this.init=function(){this.max_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(null==this.max_||t>this.max_)&&(this.max_=t)},this.storeResult=function(e){e.max||(e.max={}),e.max[this.field_]=this.max_}}function n(e){this.field_=e,this.init=function(){this.sum_=null},this.accumulate=function(e){var t=e[this.field_];null!=t&&""!==t&&0/0!==t&&(this.sum_+=parseFloat(t))},this.storeResult=function(e){e.sum||(e.sum={}),e.sum[this.field_]=this.sum_}}e.extend(!0,window,{Slick:{Data:{DataView:t,Aggregators:{Avg:o,Min:i,Max:r,Sum:n}}}})}(jQuery),function(e){function t(t){function o(o){t=e.extend(!0,{},a,t),s=o,t.enableForCells&&s.onMouseEnter.subscribe(r),t.enableForHeaderCells&&s.onHeaderMouseEnter.subscribe(n)}function i(){t.enableForCells&&s.onMouseEnter.unsubscribe(r),t.enableForHeaderCells&&s.onHeaderMouseEnter.unsubscribe(n)}function r(o){var i=s.getCellFromEvent(o);if(i){var r,n=e(s.getCellNode(i.row,i.cell));n.innerWidth()<n[0].scrollWidth?(r=e.trim(n.text()),t.maxToolTipLength&&r.length>t.maxToolTipLength&&(r=r.substr(0,t.maxToolTipLength-3)+"...")):r="",n.attr("title",r)}}function n(t,o){var i=o.column,r=e(t.target).closest(".slick-header-column");i.toolTip||r.attr("title",r.innerWidth()<r[0].scrollWidth?i.name:"")}var s,a={enableForCells:!0,enableForHeaderCells:!1,maxToolTipLength:null};e.extend(this,{init:o,destroy:i})}e.extend(!0,window,{Slick:{AutoTooltips:t}})}(jQuery),function(e){function t(t){function o(e,o,i,r,n){if(!t.enableExpandCollapse)return n.title;var s=15*n.level+"px";return"<span class='"+t.toggleCssClass+" "+(n.collapsed?t.toggleCollapsedCssClass:t.toggleExpandedCssClass)+"' style='margin-left:"+s+"'>"+"</span>"+"<span class='"+t.groupTitleCssClass+"' level='"+n.level+"'>"+n.title+"</span>"}function i(e,t,o,i,r){return i.groupTotalsFormatter&&i.groupTotalsFormatter(r,i)||""}function r(e){c=e,c.onClick.subscribe(s),c.onKeyDown.subscribe(a)}function n(){c&&(c.onClick.unsubscribe(s),c.onKeyDown.unsubscribe(a))}function s(o,i){var r=this.getDataItem(i.row);if(r&&r instanceof Slick.Group&&e(o.target).hasClass(t.toggleCssClass)){var n=c.getRenderedRange();this.getData().setRefreshHints({ignoreDiffsBefore:n.top,ignoreDiffsAfter:n.bottom}),r.collapsed?this.getData().expandGroup(r.groupingKey):this.getData().collapseGroup(r.groupingKey),o.stopImmediatePropagation(),o.preventDefault()}}function a(o){if(t.enableExpandCollapse&&o.which==e.ui.keyCode.SPACE){var i=this.getActiveCell();if(i){var r=this.getDataItem(i.row);if(r&&r instanceof Slick.Group){var n=c.getRenderedRange();this.getData().setRefreshHints({ignoreDiffsBefore:n.top,ignoreDiffsAfter:n.bottom}),r.collapsed?this.getData().expandGroup(r.groupingKey):this.getData().collapseGroup(r.groupingKey),o.stopImmediatePropagation(),o.preventDefault()}}}}function l(){return{selectable:!1,focusable:t.groupFocusable,cssClasses:t.groupCssClass,columns:{0:{colspan:"*",formatter:t.groupFormatter,editor:null}}}}function u(){return{selectable:!1,focusable:t.totalsFocusable,cssClasses:t.totalsCssClass,formatter:t.totalsFormatter,editor:null}}var c,d={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupFocusable:!0,totalsFocusable:!1,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:!0,groupFormatter:o,totalsFormatter:i};return t=e.extend(!0,{},d,t),{init:r,destroy:n,getGroupRowMetadata:l,getTotalsRowMetadata:u}}e.extend(!0,window,{Slick:{Data:{GroupItemMetadataProvider:t}}})}(jQuery),function(e){function t(t){function o(o){f=e.extend(!0,{},C,t),g=o,b.subscribe(g.onActiveCellChanged,r(h)),b.subscribe(g.onKeyDown,r(p)),b.subscribe(g.onClick,r(_))}function i(){b.unsubscribeAll()}function r(e){return function(){m||(m=!0,e.apply(this,arguments),m=!1)}}function n(e){for(var t=[],o=0;o<e.length;o++)for(var i=e[o].fromRow;i<=e[o].toRow;i++)t.push(i);return t}function s(e){for(var t=[],o=g.getColumns().length-1,i=0;i<e.length;i++)t.push(new Slick.Range(e[i],0,e[i],o));return t}function a(e,t){var o,i=[];for(o=e;t>=o;o++)i.push(o);for(o=t;e>o;o++)i.push(o);return i}function l(){return n(v)}function u(e){c(s(e))}function c(e){v=e,w.onSelectedRangesChanged.notify(v)}function d(){return v}function h(e,t){f.selectActiveRow&&null!=t.row&&c([new Slick.Range(t.row,0,t.row,g.getColumns().length-1)])}function p(e){var t=g.getActiveCell();if(t&&e.shiftKey&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&(38==e.which||40==e.which)){var o=l();o.sort(function(e,t){return e-t}),o.length||(o=[t.row]);var i,r=o[0],n=o[o.length-1];i=40==e.which?t.row<n||r==n?++n:++r:t.row<n?--n:--r,i>=0&&i<g.getDataLength()&&(g.scrollRowIntoView(i),v=s(a(r,n)),c(v)),e.preventDefault(),e.stopPropagation()}}function _(t){var o=g.getCellFromEvent(t);if(!o||!g.canCellBeActive(o.row,o.cell))return!1;if(!g.getOptions().multiSelect||!t.ctrlKey&&!t.shiftKey&&!t.metaKey)return!1;var i=n(v),r=e.inArray(o.row,i);if(-1===r&&(t.ctrlKey||t.metaKey))i.push(o.row),g.setActiveCell(o.row,o.cell);else if(-1!==r&&(t.ctrlKey||t.metaKey))i=e.grep(i,function(e){return e!==o.row}),g.setActiveCell(o.row,o.cell);else if(i.length&&t.shiftKey){var a=i.pop(),l=Math.min(o.row,a),u=Math.max(o.row,a);i=[];for(var d=l;u>=d;d++)d!==a&&i.push(d);i.push(a),g.setActiveCell(o.row,o.cell)}return v=s(i),c(v),t.stopImmediatePropagation(),!0}var g,m,f,v=[],w=this,b=new Slick.EventHandler,C={selectActiveRow:!0};e.extend(this,{getSelectedRows:l,setSelectedRows:u,getSelectedRanges:d,setSelectedRanges:c,init:o,destroy:i,onSelectedRangesChanged:new Slick.Event})}e.extend(!0,window,{Slick:{RowSelectionModel:t}})}(jQuery),function(e){function t(t){function o(e){d=e,h.subscribe(d.onSelectedRowsChanged,r).subscribe(d.onClick,s).subscribe(d.onHeaderClick,l).subscribe(d.onKeyDown,n)}function i(){h.unsubscribeAll()}function r(){var e,t,o=d.getSelectedRows(),i={};for(t=0;t<o.length;t++)e=o[t],i[e]=!0,i[e]!==p[e]&&(d.invalidateRow(e),delete p[e]);for(t in p)d.invalidateRow(t);p=i,d.render(),o.length&&o.length==d.getDataLength()?d.updateColumnHeader(g.columnId,"<input type='checkbox' checked='checked'>",g.toolTip):d.updateColumnHeader(g.columnId,"<input type='checkbox'>",g.toolTip)}function n(e,t){32==e.which&&d.getColumns()[t.cell].id===g.columnId&&((!d.getEditorLock().isActive()||d.getEditorLock().commitCurrentEdit())&&a(t.row),e.preventDefault(),e.stopImmediatePropagation())}function s(t,o){if(d.getColumns()[o.cell].id===g.columnId&&e(t.target).is(":checkbox")){if(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit())return t.preventDefault(),t.stopImmediatePropagation(),void 0;a(o.row),t.stopPropagation(),t.stopImmediatePropagation()}}function a(t){p[t]?d.setSelectedRows(e.grep(d.getSelectedRows(),function(e){return e!=t})):d.setSelectedRows(d.getSelectedRows().concat(t))}function l(t,o){if(o.column.id==g.columnId&&e(t.target).is(":checkbox")){if(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit())return t.preventDefault(),t.stopImmediatePropagation(),void 0;if(e(t.target).is(":checked")){for(var i=[],r=0;r<d.getDataLength();r++)i.push(r);d.setSelectedRows(i)}else d.setSelectedRows([]);t.stopPropagation(),t.stopImmediatePropagation()}}function u(){return{id:g.columnId,name:"<input type='checkbox'>",toolTip:g.toolTip,field:"sel",width:g.width,resizable:!1,sortable:!1,cssClass:g.cssClass,formatter:c}}function c(e,t,o,i,r){return r?p[e]?"<input type='checkbox' checked='checked'>":"<input type='checkbox'>":null}var d,h=new Slick.EventHandler,p={},_={columnId:"_checkbox_selector",cssClass:null,toolTip:"Select/Deselect All",width:30},g=e.extend(!0,{},_,t);e.extend(this,{init:o,destroy:i,getColumnDefinition:u})}e.extend(!0,window,{Slick:{CheckboxSelectColumn:t}})}(jQuery),/*!
 * accounting.js v0.3.2, copyright 2011 Joss Crowcroft, MIT license, http://josscrowcroft.github.com/accounting.js
 */
function(e,t){function o(e){return!!(""===e||e&&e.charCodeAt&&e.substr)}function i(e){return d?d(e):"[object Array]"===h.call(e)}function r(e){return"[object Object]"===h.call(e)}function n(e,t){var o,e=e||{},t=t||{};for(o in t)t.hasOwnProperty(o)&&null==e[o]&&(e[o]=t[o]);return e}function s(e,t,o){var i,r,n=[];if(!e)return n;if(c&&e.map===c)return e.map(t,o);for(i=0,r=e.length;r>i;i++)n[i]=t.call(o,e[i],i,e);return n}function a(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function l(e){var t=u.settings.currency.format;return"function"==typeof e&&(e=e()),o(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:e&&e.pos&&e.pos.match("%v")?e:o(t)?u.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t}var u={version:"0.3.2",settings:{currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}}},c=Array.prototype.map,d=Array.isArray,h=Object.prototype.toString,p=u.unformat=u.parse=function(e,t){if(i(e))return s(e,function(e){return p(e,t)});if(e=e||0,"number"==typeof e)return e;var t=t||".",o=RegExp("[^0-9-"+t+"]",["g"]),o=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(o,"").replace(t,"."));return isNaN(o)?0:o},_=u.toFixed=function(e,t){var t=a(t,u.settings.number.precision),o=Math.pow(10,t);return(Math.round(u.unformat(e)*o)/o).toFixed(t)},g=u.formatNumber=function(e,t,o,l){if(i(e))return s(e,function(e){return g(e,t,o,l)});var e=p(e),c=n(r(t)?t:{precision:t,thousand:o,decimal:l},u.settings.number),d=a(c.precision),h=0>e?"-":"",m=parseInt(_(Math.abs(e||0),d),10)+"",f=3<m.length?m.length%3:0;return h+(f?m.substr(0,f)+c.thousand:"")+m.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+c.thousand)+(d?c.decimal+_(Math.abs(e),d).split(".")[1]:"")},m=u.formatMoney=function(e,t,o,c,d,h){if(i(e))return s(e,function(e){return m(e,t,o,c,d,h)});var e=p(e),_=n(r(t)?t:{symbol:t,precision:o,thousand:c,decimal:d,format:h},u.settings.currency),f=l(_.format);return(e>0?f.pos:0>e?f.neg:f.zero).replace("%s",_.symbol).replace("%v",g(Math.abs(e),a(_.precision),_.thousand,_.decimal))};u.formatColumn=function(e,t,c,d,h,_){if(!e)return[];var m=n(r(t)?t:{symbol:t,precision:c,thousand:d,decimal:h,format:_},u.settings.currency),f=l(m.format),v=f.pos.indexOf("%s")<f.pos.indexOf("%v")?!0:!1,w=0,e=s(e,function(e){return i(e)?u.formatColumn(e,m):(e=p(e),e=(e>0?f.pos:0>e?f.neg:f.zero).replace("%s",m.symbol).replace("%v",g(Math.abs(e),a(m.precision),m.thousand,m.decimal)),e.length>w&&(w=e.length),e)});return s(e,function(e){return o(e)&&e.length<w?v?e.replace(m.symbol,m.symbol+Array(w-e.length+1).join(" ")):Array(w-e.length+1).join(" ")+e:e})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.accounting=u):"function"==typeof define&&define.amd?define([],function(){return u}):(u.noConflict=function(o){return function(){return e.accounting=o,u.noConflict=t,u}}(e.accounting),e.accounting=u)}(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.IBLoginManager=e=function(){function e(){this.show_captcha_pane=t(this.show_captcha_pane,this),this.render_ui=t(this.render_ui,this),this.handle_successful_login=t(this.handle_successful_login,this),this.show_auth_error=t(this.show_auth_error,this),this.handle_captcha_submitted=t(this.handle_captcha_submitted,this),this.handle_creds_submitted=t(this.handle_creds_submitted,this),this.show_progress_area=t(this.show_progress_area,this),this.show_area=t(this.show_area,this),this.failure_handler=t(this.failure_handler,this),this.prepare_for_login=t(this.prepare_for_login,this),this.$popup=$("#ib-login-modal"),this.$modal_footer=this.$popup.find(".modal-footer"),this.$progress_area=this.$popup.find(".progress-area"),this.$progress_area_title=this.$progress_area.find(".progress-title span"),this.$progress_area_subtitle=this.$progress_area.find(".progress-subtitle"),this.$cred_area=this.$popup.find(".creds"),this.$account_info_area=this.$popup.find(".account-info"),this.$cred_button=$("#ib-login-button"),this.$password_box=$("#ib-password-box"),this.$captcha_area=this.$popup.find(".captcha"),this.$captcha_button=$("#ib-captcha-button"),this.$captcha_box=$("#captcha-value-box"),this.$captcha_image=$("#ib-captcha-image"),this.$success_area=this.$popup.find(".success-area"),this.$close_button=$("#close-button"),this.$cancel_button=$("#cancel-button"),this.$auth_error_box=$("#auth-error-message-box"),this.$auth_error_container=this.$popup.find(".auth-error"),$(document).bind("do_broker_host_login",function(e){return function(t,o){return e.live_algo_id=o.id,$("#deploying_sector_etf").length>0?(e.$popup.removeClass("loading"),e.show_progress_area("Preparing trading account connection..."),e.$modal_footer.hide()):e.$popup.addClass("loading"),e.$popup.modal({backdrop:"static"}),quanto.is_employee_or_admin()?mixpanel.track("live algo login started employee",{id:e.live_algo_id}):mixpanel.track("live algo login started",{id:e.live_algo_id}),e.prepare_for_login()}}(this)),this.$cred_button.on("click",function(e){return function(){return e.handle_creds_submitted()}}(this)),this.$captcha_button.on("click",function(e){return function(){return e.handle_captcha_submitted()}}(this)),this.$captcha_box.on("keydown",function(e){return function(t){return 13===t.keyCode?e.handle_captcha_submitted():void 0}}(this)),this.$password_box.on("keydown",function(e){return function(t){return 13===t.keyCode?e.handle_creds_submitted():void 0}}(this))}return e.prototype.prepare_for_login=function(){var e;return e={id:this.live_algo_id,broker_name:"IB"},$.post("/live_algorithms/prepare_for_broker_login",e,function(e){return function(t){var o;if(o=new quanto.JsonResponse(t),o.ok()){if("logged_in"===o.data().state)return e.handle_successful_login(o.data());if("ready"===o.data().state)return e.trading_account_id=o.data().account_id,e.trading_account_number=o.data().account_number,e.trading_account_name=o.data().account_name,e.trading_account_username=o.data().account_username,e.$popup.removeClass("loading"),e.$modal_footer.show(),e.show_area("creds"),e.render_ui()}}}(this)).error(function(e){return function(t){var o,i;return o=new quanto.JsonResponse(t),"trading"===(null!=(i=o.data())?i.state:void 0)?(e.$popup.modal("hide"),alert("Can't log into this IB account because it is already in use.")):"no_hosts_available"===o.data()?(e.$popup.modal("hide"),mixpanel.track("no hosts available on live algo page"),quanto.show_error_popup("Error","Sorry, something went wrong with our IB infrastructure.  We're looking into it.")):void 0}}(this))},e.prototype.failure_handler=function(e,t){var o;return null==t&&(t=!1),o=new quanto.JsonResponse(e),"conflict"===o.data()?(this.$popup.modal("hide"),quanto.show_error_popup("IB account already logged in","Your IB account seems to be already in use, perhaps in another IB program.  Sign out of that one and try logging in again.")):"auth"===o.data()?(this.show_area("creds"),this.show_auth_error(t)):"start_over"===o.data()?(this.$popup.modal("hide"),alert("Login has taken too long.  Reload this page and start over.")):(this.$popup.modal("hide"),mixpanel.track("unknown error on live algo page"),quanto.show_error_popup("Unknown Error","Sorry, something went wrong."))},e.prototype.show_area=function(e){return this.$cred_area.addClass("hidden"),this.$captcha_area.addClass("hidden"),this.$progress_area.addClass("hidden"),this.$success_area.addClass("hidden"),this.$account_info_area.addClass("hidden"),this.$password_box.val(""),this.$captcha_box.val(""),this.$captcha_button.removeClass("disabled").html("Submit").addClass("hidden"),this.$cred_button.removeClass("disabled").html("Log In").addClass("hidden"),this.$close_button.removeClass("disabled").html("Close").addClass("hidden"),this.$cancel_button.removeClass("disabled").html("Close").removeClass("hidden"),"progress"===e?this.$progress_area.removeClass("hidden"):"creds"===e?(this.$cred_area.removeClass("hidden"),setTimeout(function(e){return function(){return e.$password_box.val("").focus()}}(this),100),this.$cred_button.removeClass("hidden")):"captcha"===e?(this.$captcha_area.removeClass("hidden"),setTimeout(function(e){return function(){return e.$captcha_box.val("").focus()}}(this),100),this.$captcha_button.removeClass("hidden")):"success"===e?(this.$success_area.removeClass("hidden"),this.$cancel_button.addClass("hidden"),this.$close_button.removeClass("hidden")):void 0},e.prototype.show_progress_area=function(e){return null!=e?(this.$progress_area_title.html(e),this.$progress_area_subtitle.html("")):(this.$progress_area_title.html("Authenticating with Interactive Brokers..."),this.$progress_area_subtitle.html("This can take up to two minutes.")),this.show_area("progress")},e.prototype.handle_creds_submitted=function(){var e,t;return this.$cred_button.addClass("disabled").html("Logging in..."),t=$.trim($("#ib-password-box").val()),this.$auth_error_box.html(""),this.$auth_error_container.addClass("hidden"),0===t.length?(alert("Enter password."),void 0):(e={id:this.live_algo_id,trading_account_id:this.trading_account_id,password:t,broker_name:"IB"},this.show_progress_area(),$.post("/live_algorithms/broker_authentication",e,function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()?(e.$cred_button.removeClass("disabled").html("Log In"),e.$password_box.val(""),"ready"===o.data().result?e.handle_successful_login(o.data()):"captcha"===o.data().result?e.show_captcha_pane(o.data().captcha_image_data):"trylater"===o.data().result?(e.$popup.modal("hide"),quanto.show_error_popup("Unable to connect","We are unable to connect to Interactive Brokers. We were unable to log you in. Please try again later.")):(e.$popup.modal("hide"),mixpanel.track("unknown error on live algo page"),quanto.show_error_popup("Unknown Error","Sorry, something went wrong."))):e.failure_handler(t)}}(this)).error(function(e){return function(t){return e.failure_handler(t)}}(this)))},e.prototype.handle_captcha_submitted=function(){var e,t;return this.$captcha_button.addClass("disabled").html("Submitting..."),e=$.trim(this.$captcha_box.val()),this.show_progress_area(),0===e.length?(alert("Enter value."),this.show_area("captcha"),void 0):(t={id:this.live_algo_id,trading_account_id:this.trading_account_id,captcha_value:e},$.post("/live_algorithms/broker_captcha",t,function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()?e.handle_successful_login(o.data()):e.failure_handler(t,!0)}}(this)).error(function(e){return function(t){return e.failure_handler(t,!0)}}(this)))},e.prototype.show_auth_error=function(e){return null==e&&(e=!1),this.$auth_error_container.removeClass("hidden"),e?this.$auth_error_box.html("IB reports your captcha response is invalid, starting over."):this.$auth_error_box.html("Invalid password."),setTimeout(function(e){return function(){return e.$password_box.focus()}}(this),100)},e.prototype.handle_successful_login=function(e){var t;return quanto.is_employee_or_admin()?mixpanel.track("live algo login success employee",{id:this.live_algo_id}):mixpanel.track("live algo login success",{id:this.live_algo_id}),this.show_area("success"),t={},null!=e.market_open&&e.market_open&&(t={market_open:!0,ws_url:e.ws_url,start_date_ms:e.start_date_ms}),$(document).trigger("successful_broker_login",[t]),this.show_area("success")},e.prototype.render_ui=function(){return $("#broker-login-account-name").html(quanto.escapeHTML(this.trading_account_name)),$("#broker-login-account-number").html(quanto.escapeHTML(this.trading_account_number)),$("#ib-username-label").html(quanto.escapeHTML(this.trading_account_username)),setTimeout(function(e){return function(){return e.$password_box.focus()}}(this),100)},e.prototype.show_captcha_pane=function(e){return this.show_area("captcha"),this.$captcha_image.attr("src","data:image/png;base64,"+e)},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.LiveTradingDataSource=e=function(){function e(e){this.generate_fake_data=t(this.generate_fake_data,this),this.close_ws=t(this.close_ws,this),this.consume=t(this.consume,this),this.load_data=t(this.load_data,this),this.data={},this.data_callback=e.callback,this.log_callback=e.log_callback,this.error_callback=e.error_callback,this.done_callback=e.done_callback,this.live_algo_id=e.live_algo_id,this.start_date=e.latest_results_date,this.given_ws_url=e.ws_url,this.is_public=e.is_public,this.initial_status=quanto.safeParseInt(e.live_algo_initial_status)}return e.prototype.load_data=function(){var e;e=function(e){return function(t,o){return e.data_buffer=[],e.consume(),e.ws=new WebSocket(t),e.ws.onopen=function(){return e.ws.send(JSON.stringify({e:"open",p:{cursor:0,include_txn:!0,a:o,start_date:new Date(e.start_date).toISOString()}})),e.session_count=0},e.ws.onmessage=quanto.debug_on()?function(t){return console.log(JSON.parse(t.data)),e.data_buffer.push(JSON.parse(t.data))}:function(t){return e.data_buffer.push(JSON.parse(t.data))},e.ws.onerror=function(){return console.log("websocket error!")},e.ws.onclose=function(){return $(document).trigger("websocket_unexpected_close"),console.log("websocket closed!")}}}(this),(1===this.initial_status||2===this.initial_status)&&quanto.get_server({success_callback:function(t){return function(o,i,r){return e(t.given_ws_url,r)}}(this),task_id:this.live_algo_id,skip_find_qexec:!0,anonymous:this.is_public})},e.prototype.consume=function(){var e,t,o,i,r,n,s,a,l,u,c,d,h,p,g,m,f;if(t=this.data_buffer,this.data_buffer=[],o=!1,t.length>0){for(c=[],e=_.groupBy(t,function(e){return"session_done"===e.e?"performance":e.e}),a=e.log,null!=a&&a.length>0&&(this.received_log_packets||(this.received_log_packets=[]),this.received_log_packets=this.received_log_packets.concat(a),s=_.last(a),null!=s.p&&null!=s.p.count&&this.log_callback(s.p.count)),m=e.performance||[],d=0,p=m.length;p>d;d++)if(n=m[d],l=n.p,"session_done"===n.e)c.push(n);else if(null!=(null!=l?l.minute:void 0))for(f=l.minute,h=0,g=f.length;g>h;h++)u=f[h],c.push(u);this.data_callback(c),r=e.exception,null!=r&&r.length>0&&(this.received_error_data=r[0].p,this.error_callback(this.received_error_data)),i=e.done,null!=i&&i.length>0&&(this.received_done_data=i[0].p,this.done_callback(this.received_done_data),o=!0)}return o?this.close_ws():setTimeout(function(e){return function(){return e.consume()}}(this),4e3)},e.prototype.close_ws=function(){var e;if(null!=this.ws){try{this.ws.send("ACK"),this.ws.onmessage=function(){},this.ws.onclose=function(){},this.ws.close()}catch(t){e=t}return this.ws=null}},e.prototype.generate_fake_data=function(e){var t,o,i,r,n;for("minute"===e?(this.date=132827946e4,this.delta=6e4):"daily"===e&&(this.date=new Date(2012,0,3,13,0).getTime(),this.delta=864e5),t=[],this.fake_count=1,i=n=0;30>=n;i=++n)this.data={},r=.007+.006*Math.random(),o=.007+.006*Math.random(),this.data.d=this.date,this.data.c={tr:r,br:o},t.push(this.data),this.date+=this.delta,this.fake_count+=1;return this.data_callback(t,"Charts")},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.LiveTradingManager=e=function(){function e(){this.reset_chart_values=t(this.reset_chart_values,this),this.display_perf_chart_values=t(this.display_perf_chart_values,this),this.toggle_public_sharing=t(this.toggle_public_sharing,this),this.initialize_public_sharing=t(this.initialize_public_sharing,this),this.initialize_code=t(this.initialize_code,this),this.initialize_perf_chart=t(this.initialize_perf_chart,this),this.show_risk_date_tooltip=t(this.show_risk_date_tooltip,this),this.show_date_tooltip=t(this.show_date_tooltip,this),this.initialize_exposure_chart=t(this.initialize_exposure_chart,this),this.reset_charts=t(this.reset_charts,this),this.initialize_risk=t(this.initialize_risk,this),this.hide_loading_orders_spinner=t(this.hide_loading_orders_spinner,this),this.show_loading_orders_spinner=t(this.show_loading_orders_spinner,this),this.load_older_orders_clicked=t(this.load_older_orders_clicked,this),this.initialize_orders_table=t(this.initialize_orders_table,this),this.initialize_position_table=t(this.initialize_position_table,this),this.initialize_layout=t(this.initialize_layout,this),this.initialize_logs=t(this.initialize_logs,this),this.update_charts=t(this.update_charts,this),this.post_update=t(this.post_update,this),this.add_point_to_exposure_chart=t(this.add_point_to_exposure_chart,this),this.add_point_to_custom_vars_chart=t(this.add_point_to_custom_vars_chart,this),this.get_series=t(this.get_series,this),this.populate_top_stats=t(this.populate_top_stats,this),this.add_point_to_series=t(this.add_point_to_series,this),this.remove_last_point_in_series=t(this.remove_last_point_in_series,this),this.add_point_to_returns_chart=t(this.add_point_to_returns_chart,this),this.populate_orders=t(this.populate_orders,this),this.populate_positions=t(this.populate_positions,this),this.add_point_to_risk_charts=t(this.add_point_to_risk_charts,this),this.add_point_to_charts=t(this.add_point_to_charts,this),this.replace_last_point=t(this.replace_last_point,this),this.refresh_custom_vars=t(this.refresh_custom_vars,this),this.populate_charts=t(this.populate_charts,this),this.sort_chart_data=t(this.sort_chart_data,this),this.set_charts_data=t(this.set_charts_data,this),this.process_websocket_frames=t(this.process_websocket_frames,this),this.process_charts_frames=t(this.process_charts_frames,this),this.process_orders_frames=t(this.process_orders_frames,this),this.process_top_level_stats_frames=t(this.process_top_level_stats_frames,this),this.process_frames=t(this.process_frames,this),this.populate_first_frame=t(this.populate_first_frame,this),this.add_custom_chart=t(this.add_custom_chart,this),this.initialize_custom_vars=t(this.initialize_custom_vars,this),this.clean_data=t(this.clean_data,this),this.last_session_continued=t(this.last_session_continued,this),this.handle_done=t(this.handle_done,this),this.show_stopped_ui=t(this.show_stopped_ui,this),this.clear_ui=t(this.clear_ui,this),this.build_exposure_labels=t(this.build_exposure_labels,this),this.resize_chart=t(this.resize_chart,this),this.resize_risk_charts=t(this.resize_risk_charts,this),this.resize_perf_chart=t(this.resize_perf_chart,this),this.done_resizing=t(this.done_resizing,this),this.initialize_events=t(this.initialize_events,this),this.initialize_charts=t(this.initialize_charts,this),this.initialize_helpers=t(this.initialize_helpers,this),this.handle_unexpected_disconnect=t(this.handle_unexpected_disconnect,this),this.hide_initializing_message=t(this.hide_initializing_message,this),this.show_initializing_message=t(this.show_initializing_message,this),this.handle_error=t(this.handle_error,this),this.authenticate=t(this.authenticate,this),this.start_websocket=t(this.start_websocket,this),this.format_positions_table=t(this.format_positions_table,this),this.maybe_open_websocket=t(this.maybe_open_websocket,this),this.done_with_initial_load=t(this.done_with_initial_load,this),this.load_charts=t(this.load_charts,this),this.load_orders=t(this.load_orders,this),this.load_recent_stats=t(this.load_recent_stats,this),this.get_more_orders=t(this.get_more_orders,this),this.load_last_snapshot=t(this.load_last_snapshot,this),this.show_error_message=t(this.show_error_message,this),this.handle_successful_broker_login=t(this.handle_successful_broker_login,this),this.get_market_hours=t(this.get_market_hours,this),this.check_market_hours=t(this.check_market_hours,this),this.mark_q2_message_seen=t(this.mark_q2_message_seen,this);var e,o;$("#broker_name").length>0&&(this.broker_name=$("#broker_name").val(),"IB"===this.broker_name?quanto.instances.iblm=new quanto.IBLoginManager:(this.display_broker_name=$("#display_broker_name").val(),this.oauth_login_redirect=!1,this.error_code=null,$("#oauth_login_redirect").length>0&&(this.oauth_login_redirect=$("#oauth_login_redirect").val()),$("#oauth_error_code").length>0&&(this.oauth_error_code=$("#oauth_error_code").val()),quanto.instances.oalm=new quanto.OauthLoginManager(this.broker_name,this.display_broker_name,this.oauth_login_redirect,this.oauth_error_code))),this.is_public="true"===$("#public-live-algo-view").val(),this.is_cloneable="true"===$("#public-live-algo-cloneable").val(),this.ORDER_PAGE_SIZE=20,this.TOP_LEVEL_STATS_DATA_TYPE=0,this.ORDERS_DATA_TYPE=1,this.CHARTS_DATA_TYPE=2,this.WEBSOCKET_DATA_TYPE=3,this.initialize_helpers(),this.initialize_layout(),this.initialize_position_table(),this.initialize_orders_table(),this.initialize_logs(),this.is_public||this.initialize_public_sharing(),(!this.is_public||this.is_cloneable)&&this.initialize_code(),this.load_last_snapshot(),this.initialize_events(),this.done_resizing(),(!this.is_public||quanto.is_employee_or_admin())&&($("#live_algo_auth_needed").length>0&&this.authenticate(),"true"===this.deploy_market_closed_popup&&("true"===this.show_contest_popup?quanto.show_message_popup("Success","<p>Congratulations on submitting an algorithm to the Quantopian Open!</p><p>We have automatically started a backtest and will notify you if there are any issues. After one day of paper trading, see how you rank on the <a href='https://www.quantopian.com/leaderboard?contest=upcoming'>leaderboard</a>.</p><p>Good luck!</p>"):quanto.show_message_popup("Market Closed","Please refresh this page when the market is open to view this algorithm.")),$(document).bind("successful_broker_login",function(e){return function(t,o){return e.handle_successful_broker_login(o)}}(this)),quanto.on_click(".reload-page",function(){return function(){return location.reload()}}(this))),this.live_algorithm_id=$("#live_algo_id").val(),this.check_market_hours(),$(".topbar").hasClass("algo-error")&&($(".pane-item.error").removeClass("hidden"),this.last_session_continued()?$(".topbar").hasClass("algo-is-stopped")?($(".widget-title.algo-still-running").html("There was an error."),$(".error-title .yourfault").html("This algorithm is stopped and will not restart. If you have any questions please <a href='#feedback-modal' data-toggle='modal'>send us feedback</a>.")):"true"===$("#market_open").val()?($(".topbar").removeClass("algo-error stopped").addClass("not-trading"),$(".widget-title.algo-still-running").html("There was an error and your live algorithm is not trading."),$(".error-title .yourfault").addClass("hidden"),$(".error-title .marked-continue").removeClass("hidden")):($(".topbar").removeClass("algo-error stopped").addClass("market-closed"),$(".widget-title.algo-still-running").html("There was an error."),$(".error-title .yourfault").addClass("hidden"),$(".error-title .marked-continue").removeClass("hidden")):($(".pane-item.error").trigger("mousedown"),$("#errorpane").addClass("fatal-error"),$.get("/live_algorithms/"+this.live_algorithm_id+"/exception_data",{},function(e){return function(t){return e.handle_error(t)}}(this)))),"true"!==$("#live_algo_should_see_q2_message").val()||$(".topbar").hasClass("algo-is-stopped")||(o="Important update",e="This algorithm was written using older API methods that have been updated in <a href='/quantopian2' target='_blank'>Quantopian 2</a>. Your algorithms performance may be different with Quantopian 2, and your algorithm may stop working when older API methods are fully deprecated. <br /><br/ >We recommend that you upgrade your algorithm to Quantopian 2. See the <a href='/quantopian2/migration' target='_blank'>migration guide</a> or contact support for assistance.",quanto.show_message_popup(o,e),this.mark_q2_message_seen())}return e.prototype.mark_q2_message_seen=function(){var e;return e={id:this.live_algorithm_id},$.post("/live_algorithms/mark_q2_message_seen",e,function(){return function(e){var t;return t=new quanto.JsonResponse(e),t.ok()?void 0:quanto.show_error_popup()}}(this))},e.prototype.check_market_hours=function(){return null!=this.market_hours?(new Date).getTime()>this.market_hours.open_date&&!this.market_hours.is_open?(window.location.reload(!0),setTimeout(function(){return function(){return quanto.show_message_popup("Market open","The market has opened.  Reload this page to see your live dashboard.")}}(this),3e4)):(new Date).getTime()>this.market_hours.close_date&&this.market_hours.is_open&&this.get_market_hours():this.get_market_hours(),this.check_market_hours_timer=setTimeout(this.check_market_hours,6e4)},e.prototype.get_market_hours=function(){return $.get("/live_algorithms/get_market_hours",{id:this.live_algorithm_id},function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()?e.market_hours=o.data():void 0}}(this)).error(function(e){return function(t){var o;return o=new quanto.JsonResponse(t),"stop"===o.data()?clearTimeout(e.check_market_hours_timer):void 0}}(this))},e.prototype.handle_successful_broker_login=function(e){return"IB"!==this.broker_name?window.location=window.location.pathname:null!=e.market_open&&e.market_open&&window.location.reload(!0),$(".topbar").removeClass("auth-needed"),$("#trading-setting-row").removeClass("hidden"),$(".broker-login-bar").addClass("hidden"),setTimeout(this.done_resizing,250)},e.prototype.show_error_message=function(e){return null==e&&(e=this.TOP_LEVEL_STATS_DATA_TYPE),e===this.CHARTS_DATA_TYPE?quanto.show_error_popup("Error","There was a problem reloading the charts, please try again or contact <a class='open-feedback-link'>feedback</a>."):e===this.ORDERS_DATA_TYPE?quanto.show_error_popup("Error","There was a problem loading more orders, please try again or contact <a class='open-feedback-link'>feedback</a>."):quanto.show_error_popup("Error","There was a problem loading your live algorithm, please try again or contact <a class='open-feedback-link'>feedback</a>.")},e.prototype.load_last_snapshot=function(){var e;if(null!=this.last_trading_session_id)return this.show_initializing_message(),$.get("/live_algorithms/"+this.live_algorithm_id+"/get_latest_results",function(e){return function(t){var o,i;return i=new quanto.JsonResponse(t),i.ok()?(o=i.data(),e.load_recent_stats(o)):e.show_error_message()}}(this)).error(function(e){return function(){return e.show_error_message()}}(this)),$.get("/live_algorithms/"+this.live_algorithm_id+"/get_latest_orders",{number_of_orders:this.ORDER_PAGE_SIZE},function(e){return function(t){var o,i;return i=new quanto.JsonResponse(t),i.ok()?(o=i.data(),e.load_orders(o)):e.show_error_message(e.ORDERS_DATA_TYPE)}}(this)).error(function(e){return function(){return e.show_error_message(e.ORDERS_DATA_TYPE)}}(this)),e=$("#perf-chart-container").width()||300,$.get("/live_algorithms/"+this.live_algorithm_id+"/get_latest_charts",{width:e},function(e){return function(t){var o,i;return i=new quanto.JsonResponse(t),i.ok()?(o=i.data(),e.load_charts(o)):(e.hide_initializing_message(),e.show_error_message())}}(this)).error(function(e){return function(){return e.hide_initializing_message(),e.show_error_message()}}(this))},e.prototype.get_more_orders=function(e){return $.get("/live_algorithms/"+this.live_algorithm_id+"/get_latest_orders",{number_of_orders:this.ORDER_PAGE_SIZE,oldest_order:e},function(e){return function(t){var o,i;return i=new quanto.JsonResponse(t),i.ok()?(o=i.data(),e.load_orders(o)):(e.show_error_message(e.ORDERS_DATA_TYPE),e.hide_loading_orders_spinner())}}(this)).error(function(e){return function(){return e.show_error_message(e.ORDERS_DATA_TYPE),e.hide_loading_orders_spinner()}}(this))},quanto.reload_chart_data=function(e){var t,o,i,r,n,s,a,l,u,c,d,h,p,_,g;for(r=null!=(u=quanto.instances)?null!=(c=u.ltm)?c.live_algorithm_id:void 0:void 0,n=quanto.perf_chart.plotWidth,s=e.min,i=e.max,o={width:n,start:s,end:i},p=null!=(d=quanto.instances)?null!=(h=d.ltm)?h.charts:void 0:void 0,a=0,l=p.length;l>a;a++)t=p[a],null!=t&&t.showLoading("Loading data from server...");return null!=(null!=(_=quanto.instances)?null!=(g=_.ltm)?g.position_helper:void 0:void 0)&&quanto.instances.ltm.position_helper.clear(),$.get("/live_algorithms/"+r+"/get_latest_charts",o,function(e){return function(t){var o,i,r;return i=new quanto.JsonResponse(t),i.ok()?(o=i.data(),null!=(r=quanto.instances.ltm)?r.load_charts(o):void 0):e.show_error_message(e.CHARTS_DATA_TYPE)}}(this)).error(function(e){return function(){return e.show_error_message(e.CHARTS_DATA_TYPE)}}(this))},e.prototype.load_recent_stats=function(e){return _.isEmpty(e)?this.latest_results_date=0:(e=e.daily||e.minute,this.latest_results_date=e[0].d,this.process_frames(this.clean_data(e,this.TOP_LEVEL_STATS_DATA_TYPE),this.TOP_LEVEL_STATS_DATA_TYPE)),this.initial_load_status.stats_done?void 0:(_.isEmpty(e)&&(this.stats_empty=!0),this.initial_load_status.stats_done=!0,this.maybe_open_websocket())},e.prototype.load_orders=function(e){return(null!=e?e.count:void 0)>0&&(e=[e],this.process_frames(this.clean_data(e,this.ORDERS_DATA_TYPE),this.ORDERS_DATA_TYPE)),this.initial_load_status.orders_done?void 0:(this.initial_load_status.orders_done=!0,this.maybe_open_websocket())},e.prototype.load_charts=function(e){var t,o;return o=e.data,this.benchmark_shown||0===o.length||(this.benchmark_shown=!0,t=_.first(o).bm,null!=t&&-1!==t&&quanto.set_benchmark(t,".red")),this.interval=e.interval,this.process_frames(this.clean_data(o,this.CHARTS_DATA_TYPE),this.CHARTS_DATA_TYPE),this.initial_load_status.charts_done?void 0:($(".initializing-message").find("span").hasClass("waiting-for-data")||this.hide_initializing_message(),this.initial_load_status.charts_done=!0,this.maybe_open_websocket())},e.prototype.done_with_initial_load=function(){var e,t,o,i;for(i=_.values(this.initial_load_status),t=0,o=i.length;o>t;t++)if(e=i[t],e===!1)return!1;return!0},e.prototype.maybe_open_websocket=function(){var e;return this.done_with_initial_load()&&this.stats_empty&&"2"===this.live_algo_initial_status&&("true"===this.show_contest_popup?quanto.show_message_popup("Success","<p>Congratulations on submitting an algorithm to the Quantopian Open!</p><p>We have automatically started a backtest and will notify you if there are any issues. After one day of paper trading, see how you rank on the <a href='https://www.quantopian.com/leaderboard?contest=upcoming'>leaderboard</a>.</p><p>Good luck!</p>"):quanto.show_message_popup("Success","Your algorithm is warming up. This may take some time.")),e=parseInt(this.live_algo_initial_status),isNaN(e)||e>2?void 0:!this.websocket_open&&this.done_with_initial_load()?(this.start_websocket(),this.websocket_open=!0):void 0},e.prototype.format_positions_table=function(){var e,t,o;return e=this.positions_dataView.getLength(),t=25*(e+1),t>213&&(t=213),$("#position-table").height(t),$("#positions_count").html("("+e+")"),null!=(o=this.positions_table)?o.resizeCanvas():void 0},e.prototype.start_websocket=function(){var e,t;return t=$("#ws_url").val(),e={live_algo_id:this.live_algorithm_id,live_algo_initial_status:this.live_algo_initial_status,latest_results_date:this.latest_results_date,ws_url:t,callback:function(e){return function(t){return e.process_frames(e.clean_data(t),e.WEBSOCKET_DATA_TYPE)}}(this),done_callback:this.handle_done,is_public:this.is_public,log_callback:this.log_mgr.update_max_count,error_callback:this.handle_error},this.data_source=new quanto.LiveTradingDataSource(e),this.data_source.load_data("minute")},e.prototype.authenticate=function(){return"IB"===this.broker_name?$(document).trigger("do_broker_host_login",[{id:this.live_algorithm_id}]):$(document).trigger("do_oauth_login",[{id:this.live_algorithm_id}])},e.prototype.handle_error=function(e){return $(".pane-item.error").removeClass("hidden"),this.hide_initializing_message(),quanto.instances.error_renderer=new quanto.LiveTradingErrorRenderer($("#errorcontainer"),e,!1,$("#code-copy").html()),this.error_received=!0},e.prototype.show_initializing_message=function(){return $(".initializing-message").show()},e.prototype.hide_initializing_message=function(){return $(".initializing-message").hide()},e.prototype.handle_unexpected_disconnect=function(){return this.hide_initializing_message()},e.prototype.initialize_helpers=function(){return this.live_algorithm_id=$("#live_algo_id").val(),this.last_trading_session_id=$("#last_ts_id").val(),this.deploy_market_closed_popup=$("#deploy_market_closed_popup").val(),this.show_contest_popup=$("#show_contest_popup").val(),this.live_algo_initial_status=$("#live_algo_last_session_state").val(),this.chart_initialized=!1,this.benchmark_shown=!1,this.showing_custom_chart=!1,this.initial_load_status={stats_done:!1,orders_done:!1,charts_done:!1},this.websocket_open=!1,this.show_load_more_button=!1,quanto.is_employee_or_admin()?mixpanel.track("live algo dashboard employee",{id:this.live_algorithm_id}):mixpanel.track("live algo dashboard",{id:this.live_algorithm_id}),Handlebars.registerHelper("fillDate",function(e){return quanto.date.format_date("%Y-%m-%d %H:%M:%S",new Date(e))
}),Handlebars.registerHelper("countShares",function(e){return 1===e?"1 share":""+e+" shares"}),Handlebars.registerHelper("toMoney",function(e){return quanto.safe_to_money(e)}),quanto.get_ticker_or_sid=function(e){return quanto.sid_cache.has_sid(e)?quanto.sid_cache.get_info_from_sid(e).ticker:e},this.sid_formatter=function(){return function(e,t,o){return"<span class='quanto-sid-"+o+"'>"+quanto.get_ticker_or_sid(o)+"</span>"}}(this),this.money_formatter=function(){return function(e,t,o){return quanto.safe_to_money(o)}}(this),this.money_formatter_with_color=function(){return function(e,t,o){var i;return i=quanto.safe_to_money(o),0>o?"<span class='money-red'>"+i+"</span>":o>0?"<span class='money-green'>"+i+"</span>":i}}(this),this.algo_title=$("#live_algo_title").val(),Highcharts.setOptions({global:{useUTC:!1}}),this.default_grouping_options={enabled:!0,approximation:"close",units:[["minute",[5,15,30]],["hour",[1]],["day",[1]]],groupPixelWidth:1}},e.prototype.initialize_charts=function(){return this.initialize_perf_chart(),this.initialize_exposure_chart(),this.initialize_risk(),setTimeout(this.done_resizing,250),this.chart_initialized=!0},e.prototype.initialize_events=function(){return $(".exposure-menu").click(function(e){return function(t){var o,i,r,n;return t.stopPropagation(),i=$(quanto.get_src_element(t)).closest(".exposure-option"),0!==i.length?(o=i.find(".quanto-checkbox-header"),n=!0,o.hasClass("icon-check")?(o.removeClass("icon-check").addClass("icon-check-empty"),n=!1):o.addClass("icon-check").removeClass("icon-check-empty"),r=i.data("series"),"transactions"===r?n?(e.get_series("buys",quanto.exposure_chart).show(),e.get_series("sells",quanto.exposure_chart).show()):(e.get_series("buys",quanto.exposure_chart).hide(),e.get_series("sells",quanto.exposure_chart).hide()):n?e.get_series(r,quanto.exposure_chart).show():e.get_series(r,quanto.exposure_chart).hide(),e.build_exposure_labels()):void 0}}(this)),$(window).resize(function(e){return function(){return null!=e.resize_timer&&clearTimeout(e.resize_timer),e.resize_timer=setTimeout(e.done_resizing,250)}}(this)),quanto.on_click("#stop-trading-button",function(e){return function(){return null==e.live_algorithm_id?(alert("Unexpected error, please contact Quantopian support."),void 0):($(".stop-live-trading-button").addClass("disabled").html("Stopping..."),$("#stop-trading-modal").find("#stop-trading-button").addClass("disabled").html("Stopping..."),e.hide_initializing_message(),$.post("/live_algorithms/stop_trading",{id:e.live_algorithm_id},function(t){var o,i;return o=new quanto.JsonResponse(t),o.ok()&&($("#stop-trading-modal").modal("hide"),"410"===(null!=(i=o.data())?i.code:void 0))?e.show_stopped_ui():void 0}).error(function(){return $(".stop-live-trading-button").removeClass("disabled").html("Stop Algorithm"),$("#stop-trading-modal").find("#stop-trading-button").removeClass("disabled").html("Stop Algorithm"),quanto.show_error_popup("Error","There was a problem stopping your live algorithm, please try again or contact Quantopian support.")}))}}(this)),quanto.on_click(".legend-item",function(e){return function(t){var o,i,r,n,s,a,l,u,c;if(o=$(quanto.get_src_element(t)).closest(".legend-item"),i=o.data("key"),null!=i){switch(r=i.toLowerCase()){case"returns":case"benchmark":s=[quanto.perf_chart.get(r)];break;case"long_exposure":case"short_exposure":case"cash":s=[quanto.exposure_chart.get(r)];break;case"transactions":s=[quanto.exposure_chart.get("buys"),quanto.exposure_chart.get("sells")];break;default:s=[e.custom_series_cache[i]]}if(null!=s&&s[0]){if(s[0].visible){for(a=0,u=s.length;u>a;a++)n=s[a],n.hide();return o.addClass("unselected")}for(l=0,c=s.length;c>l;l++)n=s[l],n.show();return o.removeClass("unselected")}}}}(this)),$(".broker-login-button").on("click",function(e){return function(){return e.authenticate()}}(this)),$(document).bind("capital_base_received",function(){return function(e,t){var o;return o=t.capital_base,null==o||isNaN(o)||"undefined"==typeof accounting||null===accounting?void 0:$(".capital-base-display").html(accounting.formatMoney(o))}}(this)),quanto.on_click("#clone-live-algo-button",function(e){return function(){return $("#clone-live-algo-button").html("Cloning live algorithm...").addClass("disabled"),$.post("/live_algorithms/"+e.live_algorithm_id+"/clone_live_algo",{},function(e){var t;return t=new quanto.JsonResponse(e),t.ok()||t.redirect()?void 0:($("#clone-live-algo-button").html("Clone this live algorithm").removeClass("disabled"),quanto.show_error_popup())}).error(function(){return $("#clone-live-algo-button").html("Clone this live algorithm").removeClass("disabled"),quanto.show_error_popup()})}}(this)),$(document).bind("websocket_unexpected_close",function(e){return function(){return e.handle_unexpected_disconnect()}}(this)),quanto.on_click(".load-older-orders-link",function(e){return function(){return e.load_older_orders_clicked()}}(this)),quanto.on_click(".load-older-orders-link",function(e){return function(){var t;return e.show_loading_orders_spinner(),t=e.order_book.get_oldest_order(),e.get_more_orders(t)}}(this))},e.prototype.done_resizing=function(){var e,t,o,i;return t=$(window).height(),400>t&&(t=400),e=150,$(".broker-login-bar").is(":visible")&&(e+=$(".broker-login-bar").height()),$(".viewing-public-url-bar").is(":visible")&&(e+=$(".viewing-public-url-bar").height()+10),$(".mainpane").height(t-e-10),$(".logs-panel").height(t-e-14),$(".stats-panel").hasClass("showing")&&this.resize_perf_chart(),$(".risk-panel").hasClass("showing")&&this.resize_risk_charts(),null!=(o=this.orders_table)&&o.resizeCanvas(),null!=(i=this.positions_table)?i.resizeCanvas():void 0},e.prototype.resize_perf_chart=function(){return this.resize_chart(quanto.perf_chart,$("#perf-chart-container")),null!=quanto.custom_chart&&this.resize_chart(quanto.custom_chart,$("#custom-chart-container")),this.resize_chart(quanto.exposure_chart,$("#exposure-chart-container"))},e.prototype.resize_risk_charts=function(){return this.resize_chart(quanto.risk_chart_1,$("#riskchart1")),this.resize_chart(quanto.risk_chart_2,$("#riskchart2"))},e.prototype.resize_chart=function(e,t){return null!=e?e.setSize(t.width(),t.height(),!1):void 0},e.prototype.build_exposure_labels=function(){var e,t,o,i;return o=Handlebars.compile("<div class='inline-block legend-item' data-key='{{key}}'><span class='square' style='background-color: {{color}}'></span><span style='color: {{color}}'>{{ui_label}}</span><span class='chart-value' style='color: {{color}}' data-key='{{key}}'></span></div>"),e=$("#livetrading-exposure-payload"),t=$("<div></div>"),i=function(e){return function(t){var o;return o=e.get_series(t,quanto.exposure_chart),null!=o&&o.visible}}(this),i("long_exposure")&&t.append(o({key:"long_exposure",color:"#DB843D",ui_label:"Long"})),i("short_exposure")&&t.append(o({key:"short_exposure",color:"#80699B",ui_label:"Short"})),i("cash")&&t.append(o({key:"cash",color:"#A47D7C",ui_label:"Cash"})),e.html(t)},e.prototype.clear_ui=function(){var e,t,o,i;for(this.order_book.clear(),this.populate_orders([]),this.populate_positions([]),i=[quanto.perf_chart,quanto.risk_chart_1,quanto.risk_chart_2],t=0,o=i.length;o>t;t++)e=i[t],null!=e&&(e.destroy(),e=null);return this.initialize_perf_chart(),this.initialize_exposure_chart(),this.initialize_risk(),$("#livetrading-customlabels-payload").html(""),this.showing_custom_chart=!1},e.prototype.show_stopped_ui=function(e){var t;return t=$(".stopped-info .quanto-date"),null!=e?t.attr("UTCms",e):t.attr("UTCms",(new Date).getTime()),quanto.date.render_date_value(t),$(".topbar").removeClass("market-closed market-open auth-needed").addClass("stopped"),$(".broker-login-bar").addClass("hidden"),setTimeout(this.done_resizing,250)},e.prototype.handle_done=function(e){if("success"===e.reason){if(!$(".topbar").hasClass("stopped"))return $(".topbar").removeClass("market-open").addClass("market-closed")}else{if("cancel"===e.reason)return this.show_stopped_ui(e.completed_at);if("error"===e.reason&&(this.show_stopped_ui(e.completed_at),$(".topbar").addClass("algo-error"),this.error_received&&!this.last_session_continued()))return $(".pane-item.error").trigger("mousedown"),$("#errorpane").addClass("fatal-error")}},e.prototype.last_session_continued=function(){var e;return e=$("#live_algo_last_session_continue"),e.length>0&&"true"===e.val()},e.prototype.clean_data=function(e,t){var o,i,r,n,s,a,l,u,c,d,h,p,_,g,m,f,v,w,b;for(null==t&&(t="Websocket"),r=[],_=0,f=e.length;f>_;_++)if(l=e[_],"session_done"!==l.e){if(null!=l.cb&&(o=parseFloat(l.cb),null==o||isNaN(o)||(s={live_algo_id:this.live_algo_id,capital_base:o},$(document).trigger("capital_base_received",[s]))),u=0,i={date:quanto.pick_property(l,"d","date"),benchmark:l.bm,custom_vars:quanto.pick_property(l,"rv","recorded_vars"),current_cash:quanto.pick_property(l,"ending_cash","ec"),granularity:"minute"},d=quanto.pick_property(l,"positions","p"),i.positions=null!=d&&d.length>0?d.map(function(e){var t,o,i,r,n,s;return o=quanto.pick_property(e,"cost_basis","cb"),i=quanto.pick_property(e,"last_sale_price","ls"),t=quanto.pick_property(e,"amount","a"),s=i*t,n=(i-o)*t,r="position_"+u,u+=1,{id:r,sid:quanto.pick_property(e,"sid","s"),shares:t,price:i,cost_basis:o,value:s,unrealized:n}}):[],c=quanto.pick_property(l,"orders","o"),i.orders=null!=c&&c.length>0?c.map(function(){return function(e){var t;switch(t={id:e.id,date:e.c,sid:e.sid,amount:e.a,limit_price:e.l,stop_price:e.s,sequence_number:e.sn,message:e.rsn,_collapsed:!0},e.st){case 0:t.status="Open";break;case 1:t.status="Filled";break;case 2:t.status="Cancelled";break;case 3:t.status="Rejected";break;case 4:t.status="Held";break;default:t.status="Unknown"}return t.type=null!=e.l&&null!=e.s?"Stop limit":null!=e.l?"Limit":null!=e.s?"Stop":"Market",t}}(this)):[],h=quanto.pick_property(l,"transactions","t"),null!=h&&h.length>0)i.transactions=h.map(function(){return function(e){return{order_id:e.oid,date:e.d,amount:e.a,price:e.p,commission:e.c,sid:e.s}}}(this));else if(t===this.ORDERS_DATA_TYPE)for(i.transactions=[],g=0,v=c.length;v>g;g++)for(a=c[g],b=a.t,m=0,w=b.length;w>m;m++)p=b[m],p={order_id:p.oid,date:p.d,amount:p.a,price:p.p,commission:p.c,sid:p.s},i.transactions.push(p);else i.transactions=[];n=quanto.pick_property(l,"cumulative","c"),null!=n&&(i.stats={returns:quanto.pick_property(n,"total_returns","tr"),benchmark_returns:quanto.pick_property(n,"benchmark_returns","br"),dollar_pnl:n.pnl,portfolio_value:quanto.pick_property("portfolio_value","pv"),alpha:quanto.pick_property(n,"alpha","al"),beta:quanto.pick_property(n,"beta","be"),sharpe:quanto.pick_property(n,"sharpe","sh"),sortino:quanto.pick_property(n,"sortino","so"),information:quanto.pick_property(n,"information","in"),volatility:quanto.pick_property(n,"volatility","vo")}),r.push(i)}return r},e.prototype.initialize_custom_vars=function(e){var t,o,i,r;if(!this.showing_custom_chart){for(t=!1,i=0,r=e.length;r>i;i++)if(o=e[i],null!=o.custom_vars&&_.keys(o.custom_vars).length>0){t=!0;break}if(t)return this.add_custom_chart()}},e.prototype.add_custom_chart=function(){var e;return e={chart:{renderTo:"custom-chart-container",alignTicks:!0,spacingRight:40,extraTopMargin:0,spacingTop:0,spacingBottom:0},credits:{enabled:!1},navigator:{enabled:!1,adaptToUpdatedData:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},yAxis:[{id:"custom-axis",title:{text:null},top:0,height:100,opposite:!0,lineWidth:1,showLastLabel:!0,labels:{x:20,y:5,useHTML:!0,align:"right"}}],xAxis:{top:0,offset:-10,height:110,ordinal:!0,type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray"},plotOptions:quanto.global_plotOptions,events:{mouseMove:function(){return function(e){var t,o;return null!=(t=quanto.perf_chart)&&t.pointer.runPointActions(e),null!=(o=quanto.exposure_chart)?o.pointer.runPointActions(e):void 0}}(this)},tooltip:{hideCallback:function(){var e;return null!=(e=quanto.instances.ltm)?e.reset_charts():void 0},formatter:function(){var e,t,o,i,r,n;if(null==this.points||0===this.points.length)return!1;for(i=this.points,t=0,o=i.length;o>t;t++)e=i[t],$(".legend-item[data-key="+e.series.name+"]").find(".chart-value").html(""+Math.round(100*e.y)/100);return null!=(r=quanto.instances.ltm)&&r.show_date_tooltip(this.x),null!=(n=quanto.instances.ltm)&&(n.tooltips_dirty=!0),!1}}},$(".custom-placeholder").addClass("hidden"),$(".custom-real").removeClass("hidden"),quanto.custom_chart=new Highcharts.StockChart(e),this.showing_custom_chart=!0},e.prototype.populate_first_frame=function(e){return $(".first-frame-date").attr("UTCms",e.date),quanto.date.render_all_date_values()},e.prototype.process_frames=function(e,t){var o;return 0===e.length?(t===this.CHARTS_DATA_TYPE&&$(".topbar").hasClass("market-open")&&$(".initializing-message").find("span").addClass("waiting-for-data").html("Waiting for data..."),void 0):(null==this.first_frame&&(this.first_frame=e[0],this.populate_first_frame(this.first_frame)),this.initialize_custom_vars(e),this.order_book||(this.order_book=new quanto.OrderBook),this.position_book||(this.position_book=new quanto.PositionBook),this.position_helper||(this.position_helper=new quanto.PositionBook),o=_.last(e),t===this.TOP_LEVEL_STATS_DATA_TYPE?this.process_top_level_stats_frames(e,o):t===this.ORDERS_DATA_TYPE?this.process_orders_frames(e,o):t===this.CHARTS_DATA_TYPE?this.process_charts_frames(e,o):this.process_websocket_frames(e,o),this.post_update(e,t))},e.prototype.process_top_level_stats_frames=function(e,t){var o,i,r,n,s,a,l,u;for(n=0,a=e.length;a>n;n++){if(i=e[n],o=i.date,null!=i.positions&&i.positions.length>0)for(u=i.positions,s=0,l=u.length;l>s;s++)r=u[s],this.position_book.add_position(o,r);else this.position_book.add_position(o,null);this.position_book.add_cash(o,i.current_cash)}return this.populate_positions(this.position_book.get_latest_positions()),this.populate_top_stats(t)},e.prototype.process_orders_frames=function(e,t){var o,i,r,n,s,a,l,u,c,d,h,p,_;for(s=0,u=e.length;u>s;s++){for(i=e[s],o=i.date,h=i.orders,a=0,c=h.length;c>a;a++)r=h[a],this.order_book.add_order(r);for(p=i.transactions,l=0,d=p.length;d>l;l++)n=p[l],this.order_book.add_txn(o,n)}return this.show_load_more_button=(null!=(_=t.orders[t.orders.length-1])?_.sequence_number:void 0)>0?!0:!1,this.populate_orders(this.order_book.get_order_list())},e.prototype.process_charts_frames=function(e,t){var o,i,r,n,s,a,l,u,c,d,h;this.charts_data={returns:[],benchmark_returns:[],long_exposure:[],short_exposure:[],cash:[],buys:[],sells:[],alpha:[],beta:[],sharpe:[],sortino:[],information:[],volatility:[],custom_vars:{}},d=t.custom_vars;for(r in d)s=d[r],this.charts_data.custom_vars[r]=[];for(a=0,u=e.length;u>a;a++){if(i=e[a],o=i.date,null!=i.positions&&i.positions.length>0)for(h=i.positions,l=0,c=h.length;c>l;l++)n=h[l],this.position_helper.add_position(o,n);else this.position_helper.add_position(o,null);this.position_helper.add_cash(o,i.current_cash),this.set_charts_data(o,i)}return this.chart_initialized||this.initialize_charts(),this.populate_charts()},e.prototype.process_websocket_frames=function(e,t){var o,i,r,n,s,a,l,u,c,d,h,p,g,m,f,v,w,b,C,y,k,$,x,R,S,E,T,A,q,D;for(this.benchmark_shown||(this.benchmark_shown=!0,r=_.first(e),o=r.benchmark,null!=o&&-1!==o&&quanto.set_benchmark(o,".red")),this.chart_initialized||(this.charts_data={returns:[],benchmark_returns:[],long_exposure:[],short_exposure:[],cash:[],buys:[],sells:[],alpha:[],beta:[],sharpe:[],sortino:[],information:[],volatility:[],custom_vars:{}},this.initialize_charts()),s=this.order_book.get_oldest_order(),d=0,m=e.length;m>d;d++){for(n=e[d],i=n.date,c={},S=n.transactions,h=0,f=S.length;f>h;h++)u=S[h],c[x=u.order_id]||(c[x]=[]),c[u.order_id].push(u);if(null!=s){for(E=n.orders,p=0,v=E.length;v>p;p++)if(a=E[p],(a.date>s.date||a.date===s.date&&this.order_book.has_order(a.id))&&this.order_book.add_order(a),a.date>s.date&&this.order_book.has_order(a.id))for(T=c[a.id]||[],g=0,w=T.length;w>g;g++)u=T[g],this.order_book.add_txn(i,u)}else{for(A=n.orders,k=0,b=A.length;b>k;k++)a=A[k],this.order_book.add_order(a);for(q=n.transactions,$=0,C=q.length;C>$;$++)u=q[$],this.order_book.add_txn(i,u)}if((null!=n?n.date:void 0)>this.latest_results_date){if(null!=n.positions&&n.positions.length>0)for(D=n.positions,R=0,y=D.length;y>R;R++)l=D[R],this.position_book.add_position(i,l);else this.position_book.add_position(i,null);this.position_book.add_cash(i,n.current_cash),this.add_point_to_charts(i,n)}this.populate_orders(this.order_book.get_order_list())}return this.populate_positions(this.position_book.get_latest_positions()),this.populate_top_stats(t)},e.prototype.set_charts_data=function(e,t){var o,i,r,n,s,a,l;if(null!=(null!=(l=t.stats)?l.returns:void 0)&&null!=t.stats.benchmark_returns&&(s=t.stats,this.charts_data.returns.push([e,s.returns]),this.charts_data.benchmark_returns.push([e,s.benchmark_returns]),this.charts_data.alpha.push([e,s.alpha]),this.charts_data.beta.push([e,s.beta]),this.charts_data.sharpe.push([e,s.sharpe]),this.charts_data.sortino.push([e,s.sortino]),this.charts_data.information.push([e,s.information]),this.charts_data.volatility.push([e,s.volatility])),null!=t.custom_vars){i=t.custom_vars;for(n in i)a=i[n],this.charts_data.custom_vars[n].push([e,a])}return r=this.position_helper.get_exposure_info_for_date(e),o=this.position_helper.get_cash_for_date(e),this.charts_data.long_exposure.push([e,r.long]),this.charts_data.short_exposure.push([e,r.short]),this.charts_data.cash.push([e,o])},e.prototype.sort_chart_data=function(){var e,t,o,i,r;for(i=[this.charts_data.returns,this.charts_data.benchmark_returns,this.charts_data.long_exposure,this.charts_data.short_exposure,this.charts_data.cash,this.charts_data.alpha,this.charts_data.beta,this.charts_data.sharpe,this.charts_data.sortino,this.charts_data.information,this.charts_data.volatility],r=[],t=0,o=i.length;o>t;t++)e=i[t],r.push(e.sort(function(){return function(e,t){return e[0]-t[0]}}(this)));return r},e.prototype.populate_charts=function(){var e,t,o,i,r,n,s;return this.sort_chart_data(),r=this.get_series("returns",quanto.perf_chart),e=this.get_series("benchmark",quanto.perf_chart),i=this.get_series("long_exposure",quanto.exposure_chart),s=this.get_series("short_exposure",quanto.exposure_chart),o=this.get_series("cash",quanto.exposure_chart),t=this.get_series("buys",quanto.exposure_chart),n=this.get_series("sells",quanto.exposure_chart),r.setData(this.charts_data.returns),e.setData(this.charts_data.benchmark_returns),i.setData(this.charts_data.long_exposure),s.setData(this.charts_data.short_exposure),o.setData(this.charts_data.cash),this.risk_series.alpha.setData(this.charts_data.alpha),this.risk_series.beta.setData(this.charts_data.beta),this.risk_series.sharpe.setData(this.charts_data.sharpe),this.risk_series.sortino.setData(this.charts_data.sortino),this.risk_series.information.setData(this.charts_data.information),this.risk_series.volatility.setData(this.charts_data.volatility),this.showing_custom_chart?this.refresh_custom_vars():void 0},e.prototype.refresh_custom_vars=function(){for(var e,t,o,i,r,n;quanto.custom_chart.series.length>0;)quanto.custom_chart.series[0].remove(!1);$("#livetrading-customlabels-payload").html(""),r=this.charts_data.custom_vars,n=[];for(t in r)i=r[t],e=quanto.custom_chart_colors[quanto.custom_chart.series.length%quanto.custom_chart_colors.length],o={type:"line",id:t,name:t,data:i,dataGrouping:this.default_grouping_options,yAxis:"custom-axis",lineWidth:1,color:e},this.custom_series_cache||(this.custom_series_cache={}),this.custom_series_cache[t]=quanto.custom_chart.addSeries(o,!1),this.custom_series_template=Handlebars.compile("<div class='inline-block legend-item' data-key='{{key}}'><span class='square' style='background-color: {{color}}'></span><span style='color: {{color}}'>{{key}}</span><span class='chart-value' style='color: {{color}}' data-key='{{key}}'></span></div>"),n.push($("#livetrading-customlabels-payload").append(this.custom_series_template({key:t,color:e})));return n},e.prototype.replace_last_point=function(e){var t,o,i;return i=new Date(e.date),o=i.getMinutes(),t=i.getHours(),"1d"===this.interval?!(9===t&&31===o):"30min"===this.interval?!(1===o%30||9===t&&32===o):"5min"===this.interval?!(1===o%5||9===t&&32===o):!1},e.prototype.add_point_to_charts=function(e,t){var o,i;return o=this.replace_last_point(t),null!=(null!=(i=t.stats)?i.returns:void 0)&&null!=t.stats.benchmark_returns&&(this.add_point_to_returns_chart(e,t.stats,o),this.add_point_to_risk_charts(e,t.stats,o)),null!=t.custom_vars&&this.add_point_to_custom_vars_chart(e,t.custom_vars,o),this.add_point_to_exposure_chart(e,null,o)},e.prototype.add_point_to_risk_charts=function(e,t,o){var i,r,n,s,a,l,u,c;for(l=["alpha","beta","sharpe","sortino","information","volatility"],r=0,s=l.length;s>r;r++)i=l[r],o&&this.remove_last_point_in_series(this.risk_series[i]),this.risk_series[i].addPoint([e,t[i]],!1);for(u=["sharpe","volatility"],c=[],n=0,a=u.length;a>n;n++)i=u[n],c.push(this.risk_series[i].updateNavigator(e));return c},e.prototype.populate_positions=function(e){return this.positions_dataView.beginUpdate(),this.positions_dataView.setItems(e),this.positions_dataView.endUpdate(),this.positions_table.invalidateAllRows(),this.positions_table.render(),0===e.length?($("#position-table").removeClass("hasdata"),$(".no-positions").removeClass("hidden")):($("#position-table").addClass("hasdata"),$(".no-positions").addClass("hidden"))},e.prototype.populate_orders=function(e){var t,o,i,r,n,s,a,l,u,c,d,h;for(null!=quanto.orders_dataview.getItemById("load_more_button")&&this.dataView.deleteItem("load_more_button"),l=[],u=0,d=e.length;d>u;u++){if(a=e[u],l.push(a),i=this.order_book.get_txns_for_order(a.id),null!=i&&i.length>0)for(r=c=0,h=i.length;h>c;r=++c)t=i[r],o={id:"fill_"+t.order_id+"_"+r,order_id:t.order_id,date:t.date,amount:t.amount,price:t.price,commission:t.commission,sid:t.sid,limit_price:null,stop_price:null,status:null,is_fill:!0,indent:1,parent_id:a.id},l.push(o);["Rejected","Held"].indexOf(a.status)>-1&&(n=this.order_book.get_message_for_order(a.id),null!=n&&(s={id:"message_"+a.id,order_id:a.id,date:a.date,sid:a.sid,message:a.message.replace("Order rejected - reason:",""),limit_price:null,stop_price:null,status:null,is_message:!0,indent:1,parent_id:a.id},l.push(s)))}return this.dataView.beginUpdate(),this.dataView.setItems(l),this.dataView.setFilter(quanto.filter),this.dataView.endUpdate(),this.orders_table.invalidateAllRows(),this.orders_table.render(),0===l.length?($("#orders-table").removeClass("hasdata"),$(".no-orders").removeClass("hidden")):($("#orders-table").addClass("hasdata"),$(".no-orders").addClass("hidden")),this.show_load_more_button?(this.dataView.beginUpdate(),this.dataView.addItem({id:"load_more_button",date:"<a class='load-older-orders-link'><i class='icon icon-chevron-down margin_5r'></i>Load older orders</a>",load_more_button:!0}),this.dataView.endUpdate()):void 0},e.prototype.add_point_to_returns_chart=function(e,t,o){return o&&(this.remove_last_point_in_series(this.get_series("returns",quanto.perf_chart)),this.remove_last_point_in_series(this.get_series("benchmark",quanto.perf_chart))),this.add_point_to_series(this.get_series("returns",quanto.perf_chart),e,t.returns),this.add_point_to_series(this.get_series("benchmark",quanto.perf_chart),e,t.benchmark_returns),this.get_series("long_exposure",quanto.exposure_chart).updateNavigator(e)},e.prototype.remove_last_point_in_series=function(e){var t;return null!=e.data&&(t=e.data.length-1,t>=0)?e.data[t].remove(!1,!1):void 0},e.prototype.add_point_to_series=function(e,t,o){return e.addPoint([t,o],!1,!1,!1)},e.prototype.populate_top_stats=function(e){var t,o,i,r,n,s,a,l,u,c,d,h,p,_,g,m;for(a=function(){return function(e){return null!=p[e]&&!isNaN(p[e])}}(this),p=e.stats,c=e.positions,n=e.current_cash,o=$("#livetrading-stats-returns"),o.removeClass("money-green money-red"),a("returns")?(d=new Number(100*p.returns).toFixed(2),o.html(""+d+"%"),d>0?o.addClass("money-green"):0>d&&o.addClass("money-red"),_=new Number(100*p.returns).toFixed(1),"-0.0"===_&&(_="0.0"),window.document.title=""+_+"% "+this.algo_title):(o.html("--"),window.document.title=this.algo_title),t=$("#livetrading-stats-dollarpnl"),t.removeClass("money-green money-red"),a("dollar_pnl")?(s=p.dollar_pnl,t.html(new Number(s).toMoney(2)),s>0?t.addClass("money-green"):0>s&&t.addClass("money-red")):t.html("--"),i=$("#livetrading-stats-sharpe"),a("sharpe")?i.html(new Number(p.sharpe).toFixed(2)):i.html("--"),h=0,l=0,g=0,m=c.length;m>g;g++)u=c[g],u.value<0?h+=u.value:l+=u.value;return $("#livetrading-stats-longexposure").html(new Number(l).toMoney(2)),$("#livetrading-stats-shortexposure").html(new Number(h).toMoney(2)),$("#livetrading-stats-currentcash").removeClass("money-red"),isNaN(n)?$("#livetrading-stats-currentcash").html("--"):(r=new Number(n).toMoney(2),$("#livetrading-stats-currentcash").html(r),0>n?$("#livetrading-stats-currentcash").addClass("money-red"):void 0)},e.prototype.get_series=function(e,t){var o,i,r,n;if(o=t.get(e),null!=o)return o;for(n=t.series,i=0,r=n.length;r>i;i++)if(o=n[i],o.name===e)return o;return null},e.prototype.add_point_to_custom_vars_chart=function(e,t,o){var i,r,n,s,a;null==o&&(o=!1),a=[];for(r in t)s=t[r],null==this.get_series(r,quanto.custom_chart)&&(i=quanto.custom_chart_colors[quanto.custom_chart.series.length%quanto.custom_chart_colors.length],n={type:"line",id:r,name:r,data:[],dataGrouping:this.default_grouping_options,yAxis:"custom-axis",lineWidth:1,color:i},this.custom_series_cache||(this.custom_series_cache={}),this.custom_series_cache[r]=quanto.custom_chart.addSeries(n,!1),this.custom_series_template=Handlebars.compile("<div class='inline-block legend-item' data-key='{{key}}'><span class='square' style='background-color: {{color}}'></span><span style='color: {{color}}'>{{key}}</span><span class='chart-value' style='color: {{color}}' data-key='{{key}}'></span></div>"),$("#livetrading-customlabels-payload").append(this.custom_series_template({key:r,color:i}))),o&&this.remove_last_point_in_series(this.custom_series_cache[r]),a.push(this.add_point_to_series(this.custom_series_cache[r],e,s));return a},e.prototype.add_point_to_exposure_chart=function(e,t,o){var i,r;return null==t&&(t=null),null==o&&(o=!1),t||(t=e),r=this.position_book.get_exposure_info_for_date(t),i=this.position_book.get_cash_for_date(t),o&&(this.remove_last_point_in_series(this.get_series("long_exposure",quanto.exposure_chart)),this.remove_last_point_in_series(this.get_series("short_exposure",quanto.exposure_chart)),this.remove_last_point_in_series(this.get_series("cash",quanto.exposure_chart))),this.add_point_to_series(this.get_series("long_exposure",quanto.exposure_chart),e,r.long),this.add_point_to_series(this.get_series("short_exposure",quanto.exposure_chart),e,r.short),this.add_point_to_series(this.get_series("cash",quanto.exposure_chart),e,i)},e.prototype.post_update=function(e,t){var o,i;return this.format_positions_table(),null!=(i=this.orders_table)&&i.resizeCanvas(),(t===this.CHARTS_DATA_TYPE||t===this.WEBSOCKET_DATA_TYPE)&&this.update_charts(),o=_.union(this.order_book.get_all_sids(),this.position_book.get_all_sids()),quanto.sid_cache.populate_sid_list_in_ui(o)},e.prototype.update_charts=function(){var e,t,o,i,r,n;for(this.charts=[quanto.perf_chart,quanto.custom_chart,quanto.exposure_chart,quanto.risk_chart_1,quanto.risk_chart_2],r=this.charts,n=[],o=0,i=r.length;i>o;o++)if(e=r[o],null!=e)try{e.redraw(!0),n.push(e.hideLoading())}catch(s){t=s}else n.push(void 0);return n},e.prototype.initialize_logs=function(){return this.log_mgr=new quanto.LiveAlgorithmLogManager({container_selector:"#logspane .logs-display",live_algorithm_id:this.live_algorithm_id,live_algorithm_state:2,live_algorithm_log_count:quanto.safeParseInt($("#live_algorithm_log_count").val())||-1})},e.prototype.initialize_layout=function(){return $(document).on("mousedown",".pane-selector .pane-item",function(){return function(e){var t,o,i,r;return o=$(quanto.get_src_element(e)).closest(".pane-item"),o.hasClass("selected")?void 0:(r=o.data("pane"),t=$(".datapane.showing"),i=$(".datapane[data-pane="+r+"]"),i.removeClass("hidden").addClass("showing"),t.removeClass("showing").addClass("hidden"),$(".pane-item.selected").removeClass("selected"),o.addClass("selected"),$(document).trigger("trading_sidebar_shown",[r]))}}(this)),this.current_tab="results",$(document).on("trading_sidebar_shown",function(e){return function(t,o){var i,r;return e.current_tab=o,"logs"===o?$("#logspane .logs-display").removeClass("hidden"):$("#logspane .logs-display").addClass("hidden"),"results"===o?(e.resize_perf_chart(),null!=(i=e.positions_table)&&i.resizeCanvas(),null!=(r=e.orders_table)?r.resizeCanvas():void 0):"risk"===o?setTimeout(function(){return null!=quanto.risk_chart_1&&null!=quanto.risk_chart_2?(quanto.risk_chart_1.redraw(!0),quanto.risk_chart_2.redraw(!0),e.resize_risk_charts()):void 0},10):"code"===o?quanto.editor.refresh():void 0}}(this)),this.error_received=!1},e.prototype.initialize_position_table=function(){var e,t;return this.positions_data_source=[],e=[{id:"sid",name:"Security",field:"sid",formatter:this.sid_formatter,sortable:!1},{id:"shares",name:"Shares",field:"shares",sortable:!0},{id:"price",name:"Price",field:"price",formatter:this.money_formatter,sortable:!0},{id:"cost_basis",name:"Avg Cost",field:"cost_basis",formatter:this.money_formatter,sortable:!0},{id:"value",name:"Value",field:"value",formatter:this.money_formatter,sortable:!0},{id:"unrealized",name:"Unrealized",field:"unrealized",formatter:this.money_formatter_with_color,sortable:!0}],this.positions_dataView=new Slick.Data.DataView,this.positions_dataView.beginUpdate(),this.positions_dataView.setItems([]),this.positions_dataView.endUpdate(),quanto.positions_dataview=this.positions_dataView,t={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0,fullWidthRows:!0},this.positions_table=new Slick.Grid("#position-table",this.positions_dataView,e,t),this.positions_dataView.onRowCountChanged.subscribe(function(e){return function(){return e.positions_table.updateRowCount(),e.positions_table.render()}}(this)),this.positions_dataView.onRowsChanged.subscribe(function(e){return function(t,o){return e.positions_table.invalidateRows(o.rows),e.positions_table.render()}}(this)),this.positions_table.onSort.subscribe(function(){return function(e,t){var o,i;return o=t.sortCol.field,i=t.sortAsc?1:-1,$(document).trigger("sort_positions",[{field:o,dir:i}])}}(this)),$(document).bind("sort_positions",function(e){return function(t,o){var i,r;return r=o.field,i=o.dir,e.populate_positions(e.position_book.get_latest_positions({field:r,dir:i}))}}(this))},e.prototype.initialize_orders_table=function(){var e,t,o,i;return this.fill_template=Handlebars.compile("<div class='margin_30l'>Fill:<span class='fill-shares'>{{countShares amount}}</span> at <span class='fill-price'>{{toMoney price}}</span> on <span class='fill-date'>{{fillDate date}}</span></div>"),t=function(e){return function(t,o,i,r,n){var s,a;return a=quanto.orders_dataview.getItemById(n.id),a.load_more_button?i:a.is_message?s=a.message:a.is_fill?s=e.fill_template(a):quanto.date.format_date("%Y-%m-%d %H:%M:%S",new Date(i))}}(this),i=function(e){return function(t,o,i,r,n){return null==i||n.is_fill||n.is_message?"":"Cancelled"===i||"Open"===i&&!e.order_book.has_txn(n.id)?"<span class='order-status-trigger'>"+i+"</span>":n._collapsed?"<span class='order-status-trigger'>"+i+"<i class='icon icon-sort-down'></i></span>":"<span class='order-status-trigger expanded'>"+i+"<i class='icon icon-sort-up'></i></span>"}}(this),e=[{id:"date",name:"Date",field:"date",width:133,formatter:t,sortable:!0},{id:"sid",name:"Security",field:"sid",width:100,formatter:this.sid_formatter,sortable:!1},{id:"type",name:"Type",field:"type",width:75,sortable:!0},{id:"amount",name:"Shares",field:"amount",width:68,sortable:!0},{id:"limit_price",name:"Limit",field:"limit_price",width:68,formatter:this.money_formatter,sortable:!0},{id:"stop_price",name:"Stop",field:"stop_price",width:68,formatter:this.money_formatter,sortable:!0},{id:"status",name:"Status",field:"status",width:68,minWidth:70,sortable:!0,formatter:i,cssClass:"order-status-cell"}],quanto.filter=function(){return function(e){var t;return null!==e.parent_id&&(t=quanto.orders_dataview.getItemById(e.parent_id),null!=t&&t._collapsed)?!1:!0}}(this),this.dataView=new Slick.Data.DataView,this.dataView.beginUpdate(),this.dataView.setItems([]),this.dataView.setFilter(quanto.filter),this.dataView.endUpdate(),quanto.orders_dataview=this.dataView,this.dataView.getItemMetadata=function(e){var t,o,i;if(i=this.getItem(e),null!=i.parent_id){if(i.is_fill)return{cssClasses:"fill-row",columns:{0:{colspan:"*"}}};
if(i.is_message)return{cssClasses:"message-row",columns:{0:{colspan:"*"}}}}else if(null!=i.load_more_button)return{cssClasses:"load-button-row",columns:{0:{colspan:"*"}}};try{if(o=this.getItem(e+1),(o.is_fill||o.is_message)&&!i._collapsed)return{cssClasses:"row-expanded"}}catch(r){return t=r,null}},o={enableCellNavigation:!0,enableColumnReorder:!1,forceFitColumns:!0,fullWidthRows:!0},this.orders_table=new Slick.Grid("#orders-table",this.dataView,e,o),this.orders_table.registerPlugin(new Slick.AutoTooltips),this.orders_table.onCellChange.subscribe(function(){return function(e,t){return dataView.updateItem(t.item.id,t.item)}}(this)),this.orders_table.onMouseDown.subscribe(function(){return function(e,t){var o;return $(e.target).closest(".order-status-cell").length>0?(o=quanto.orders_dataview.getItem(t.row),null!=o&&(o._collapsed=o._collapsed?!1:!0,quanto.orders_dataview.updateItem(o.id,o)),e.stopImmediatePropagation()):void 0}}(this)),this.orders_table.onSort.subscribe(function(){return function(e,t){var o,i;return o=t.sortCol.field,i=t.sortAsc?1:-1,$(document).trigger("sort_orders",[{field:o,dir:i}])}}(this)),this.dataView.onRowCountChanged.subscribe(function(e){return function(){return e.orders_table.updateRowCount(),e.orders_table.render()}}(this)),this.dataView.onRowsChanged.subscribe(function(e){return function(t,o){return e.orders_table.invalidateRows(o.rows),e.orders_table.render()}}(this)),$(document).bind("sort_orders",function(e){return function(t,o){var i,r;return r=o.field,i=o.dir,e.populate_orders(e.order_book.get_order_list({field:r,dir:i}))}}(this))},e.prototype.load_older_orders_clicked=function(){var e;return this.show_loading_orders_spinner(),e=this.order_book.get_oldest_order(),this.get_more_orders(e)},e.prototype.show_loading_orders_spinner=function(){return $(".load-older-orders-link").find("i").removeClass("icon-chevron-down").addClass("icon-spin icon-spinner")},e.prototype.hide_loading_orders_spinner=function(){return $(".load-older-orders-link").find("i").removeClass("icon-spin icon-spinner").addClass("icon-chevron-down")},e.prototype.initialize_risk=function(){var e,t,o,i,r,n,s,a,l;for(t={chart:{alignTicks:!0},credits:{enabled:!1},rangeSelector:{enabled:!1},events:{mouseMove:function(){return function(e,t){return null!=e.synthetic&&e.synthetic?void 0:(e.synthetic=!0,"riskchart1"===t.options.chart.name?quanto.risk_chart_2.pointer.runPointActions(e):"riskchart2"===t.options.chart.name?quanto.risk_chart_1.pointer.runPointActions(e):void 0)}}(this)},scrollbar:{liveRedraw:!1},navigator:{enabled:!0,adaptToUpdatedData:!1,series:{color:"transparent",lineWidth:0},height:20,maskFill:"rgba(180, 198, 220, 0.75)",xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"}}},title:{text:null},xAxis:{type:"datetime",ordinal:!0,dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray",events:{setExtremes:function(e){var t,o,i,r;return("navigator"===e.trigger||"zoom"===e.trigger)&&quanto.reload_chart_data(e),null!=(o=quanto.perf_chart)&&o.xAxis[0].setExtremes(e.min,e.max,!0,!1),null!=(i=quanto.custom_chart)&&i.xAxis[0].setExtremes(e.min,e.max,!0),null!=(r=quanto.exposure_chart)&&r.xAxis[0].setExtremes(e.min,e.max,!0,!1),t=function(t){return function(){return"riskchart1"===t.chart.options.chart.name?quanto.risk_chart_2.xAxis[0].setExtremes(e.min,e.max,!0,!1,{preventEventFire:!0}):"riskchart2"===t.chart.options.chart.name?quanto.risk_chart_1.xAxis[0].setExtremes(e.min,e.max,!0,!1,{preventEventFire:!0}):void 0}}(this),setTimeout(function(){return function(){return t()}}(this),100),!0}}},plotOptions:quanto.global_plotOptions,tooltip:{hideCallback:function(){var e,t,o,i,r,n,s,a,l,u,c,d,h;for(u=[quanto.risk_chart_1,quanto.risk_chart_2],n=0,a=u.length;a>n;n++)if(e=u[n],null!=e&&null!=e.hoverPoints)for(c=e.hoverPoints,s=0,l=c.length;l>s;s++)o=c[s],o.setState("");if(null!=(d=quanto.instances.ltm)?d.risk_tooltips_dirty:void 0){h=quanto.instances.ltm.risk_series;for(r in h)i=h[r],t=_.last(i.points||[]),null!=t?$("#livetrading-"+t.series.name+"-val").html(Math.floor(100*t.y)/100):$("#livetrading-"+i.name+"-val").html("--");return quanto.instances.ltm.risk_tooltips_dirty=!1,$("#risk1-chart-date-label").html("").addClass("hidden"),$("#risk2-chart-date-label").html("").addClass("hidden")}},formatter:function(){var e,t,o,i,r,n,s;if(null==this.points||0===this.points.length)return!1;for(r=this.points,o=0,i=r.length;i>o;o++)t=r[o],e=$("#livetrading-"+t.series.name+"-val").html(Math.floor(100*t.y)/100);return null!=(n=quanto.instances.ltm)&&(n.risk_tooltips_dirty=!0),null!=(s=quanto.instances.ltm)&&s.show_risk_date_tooltip(this.x),!1}}},e=function(){return function(e,t){return{id:e,title:{text:null},height:100,top:t,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}]}}}(this),quanto.risk_chart_1=new Highcharts.StockChart(_.defaults({chart:{name:"riskchart1",renderTo:"riskchart1",height:498},series:[{id:"alpha",type:"line",data:this.charts_data.alpha,lineWidth:2,name:"alpha",color:"#457a27",yAxis:0},{id:"beta",type:"line",data:this.charts_data.beta,lineWidth:2,name:"beta",color:"#457a27",yAxis:1},{id:"sharpe",type:"line",data:this.charts_data.sharpe,lineWidth:2,name:"sharpe",color:"#89A54E",yAxis:2}],yAxis:[e("alpha-axis",10),e("beta-axis",168),e("sharpe-axis",326)]},t)),quanto.risk_chart_2=new Highcharts.StockChart(_.defaults({chart:{name:"riskchart2",renderTo:"riskchart2"},series:[{id:"sortino",type:"line",data:this.charts_data.sortino,lineWidth:2,name:"sortino",color:"#80699B",yAxis:0},{id:"information",type:"line",data:this.charts_data.information,lineWidth:2,name:"information",color:"#18a5ca",yAxis:1},{id:"volatility",type:"line",data:this.charts_data.volatility,lineWidth:2,name:"volatility",color:"#DB843D",yAxis:2}],yAxis:[e("sortino-axis",10),e("information-axis",168),e("volatility-axis",326)]},t)),this.risk_series={},a=quanto.risk_chart_1.series,i=0,n=a.length;n>i;i++)switch(o=a[i],o.name){case"alpha":this.risk_series.alpha=o;break;case"beta":this.risk_series.beta=o;break;case"sharpe":this.risk_series.sharpe=o}for(l=quanto.risk_chart_2.series,r=0,s=l.length;s>r;r++)switch(o=l[r],o.name){case"sortino":this.risk_series.sortino=o;break;case"information":this.risk_series.information=o;break;case"volatility":this.risk_series.volatility=o}return $("#riskchart1").removeClass("hidden"),$("#riskchart2").removeClass("hidden")},e.prototype.reset_charts=function(){var e,t,o,i;for(i=[quanto.perf_chart,quanto.custom_chart,quanto.exposure_chart],t=0,o=i.length;o>t;t++)e=i[t],null!=e&&null!=e.hoverPoints&&e.hoverPoints.length>0&&$.each(e.hoverPoints,function(e,t){return t.setState("")});return this.tooltips_dirty?($("#livetrading-date-chart-label").html("").addClass("hidden"),this.reset_chart_values(),this.tooltips_dirty=!1):void 0},e.prototype.initialize_exposure_chart=function(){var e;return e={chart:{renderTo:"exposure-chart-container",alignTicks:!0,spacingRight:40,animation:!1,extraTopMargin:0,spacingTop:0,spacingBottom:2},credits:{enabled:!1},scrollbar:{liveRedraw:!1},navigator:{enabled:!0,adaptToUpdatedData:!1,series:{color:"transparent",lineWidth:0},height:20,maskFill:"rgba(180, 198, 220, 0.75)",xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"}}},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{id:"long_exposure",name:"long_exposure",step:!0,data:this.charts_data.long_exposure,color:"#DB843D",yAxis:0,dataGrouping:this.default_grouping_options},{id:"short_exposure",name:"short_exposure",step:!0,data:this.charts_data.short_exposure,color:"#80699B",yAxis:0,visible:!1,dataGrouping:this.default_grouping_options},{id:"cash",name:"cash",step:!0,data:this.charts_data.cash,color:"#A47D7C",yAxis:0,dataGrouping:this.default_grouping_options}],yAxis:[{id:"exposure-axis",title:{text:null},height:100,top:0,opposite:!0,offset:0,lineWidth:1,forceTickRecalculate:!0,showLastLabel:!0,labels:{x:20,y:5,isMoney:!0,useHTML:!0,align:"right"}}],xAxis:{top:0,height:100,ordinal:!0,type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray",events:{setExtremes:function(e){var t,o,i;return("navigator"===e.trigger||"zoom"===e.trigger)&&quanto.reload_chart_data(e),null!=(o=quanto.perf_chart)&&o.xAxis[0].setExtremes(e.min,e.max,!0,!1),null!=(i=quanto.custom_chart)&&i.xAxis[0].setExtremes(e.min,e.max,!0),t=function(){return function(){return quanto.risk_chart_2.xAxis[0].setExtremes(e.min,e.max,!0,!1,{preventEventFire:!0}),quanto.risk_chart_1.xAxis[0].setExtremes(e.min,e.max,!0,!1,{preventEventFire:!0})}}(this),setTimeout(function(){return function(){return t()}}(this),100),!0}}},plotOptions:quanto.global_plotOptions,events:{mouseMove:function(){return function(e){var t,o;return null!=(t=quanto.perf_chart)&&t.pointer.runPointActions(e),null!=(o=quanto.custom_chart)?o.pointer.runPointActions(e):void 0}}(this)},tooltip:{hideCallback:function(){var e;return null!=(e=quanto.instances.ltm)?e.reset_charts():void 0},formatter:function(){var e,t,o,i,r,n,s,a,l,u,c,d,h,p,_,g;if(null==this.points||0===this.points.length)return!1;for(e=null,s=null,i=null,u=null,o=null,p=this.points,d=0,h=p.length;h>d;d++)switch(n=p[d],l=n.series.name,c=new Number(n.y),r=c.toMoney(),l){case"End":continue;case"buys":e=c;break;case"sells":s=c;break;case"long_exposure":i=r;break;case"short_exposure":u=r;break;case"cash":o=r}return $(".legend-item[data-key=long_exposure]").find(".chart-value").html(i),$(".legend-item[data-key=short_exposure]").find(".chart-value").html(u),$(".legend-item[data-key=cash]").find(".chart-value").html(o),t=e>0?""+e.toMoney(0)+" bought":"",s>0?(a=""+s.toMoney(0)+" sold",e>0&&(t+=", ")):a="",$("#livetrading-transactions-value").html(""+t+a),null!=(_=quanto.instances.ltm)&&_.show_date_tooltip(this.x),null!=(g=quanto.instances.ltm)&&(g.tooltips_dirty=!0),!1}}},quanto.exposure_chart=new Highcharts.StockChart(e),$(".exposure-dropdown-container .btn").removeClass("disabled"),this.build_exposure_labels()},e.prototype.show_date_tooltip=function(e){return $("#livetrading-date-chart-label").html(quanto.date.format_date("%m/%d/%Y %H:%M",new Date(e))).removeClass("hidden")},e.prototype.show_risk_date_tooltip=function(e){var t;return t=quanto.date.format_date("%m/%d/%Y %H:%M",new Date(e)),$("#risk1-chart-date-label").html(t).removeClass("hidden"),$("#risk2-chart-date-label").html(t).removeClass("hidden")},e.prototype.initialize_perf_chart=function(){var e;return e={chart:{renderTo:"perf-chart-container",alignTicks:!0,spacingRight:40,extraTopMargin:0,spacingTop:0,spacingBottom:0},credits:{enabled:!1},navigator:{enabled:!1,adaptToUpdatedData:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{type:"area",name:"Returns",id:"returns",data:this.charts_data.returns,yAxis:0,color:"#4572A7",fillOpacity:.1,dataGrouping:this.default_grouping_options},{type:"line",id:"benchmark",name:"Benchmark",data:this.charts_data.benchmark_returns,yAxis:0,lineWidth:1,color:"#aa4643",dataGrouping:this.default_grouping_options}],yAxis:[{id:"perf-axis",title:{text:null},height:125,top:0,offset:0,labels:{formatter:function(){return""+100*this.value+"%"},x:20,y:5,align:"right",useHTML:!0},minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}],showLastLabel:!0}],xAxis:{top:0,offset:-10,height:135,ordinal:!0,type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray"},plotOptions:quanto.global_plotOptions,events:{mouseMove:function(){return function(e){var t,o;return null!=(t=quanto.custom_chart)&&t.pointer.runPointActions(e),null!=(o=quanto.exposure_chart)?o.pointer.runPointActions(e):void 0}}(this)},tooltip:{hideCallback:function(){var e;return null!=(e=quanto.instances.ltm)?e.reset_charts():void 0},formatter:function(){var e,t,o,i,r,n,s,a,l,u;if(null==this.points||0===this.points.length)return!1;for(t=null,e=null,s=this.points,r=0,n=s.length;n>r;r++)o=s[r],i=o.series.name,"Returns"===i?t=o.y:"Benchmark"===i&&(e=o.y);return null!=(a=quanto.instances.ltm)&&a.display_perf_chart_values(t,e),null!=(l=quanto.instances.ltm)&&l.show_date_tooltip(this.x),null!=(u=quanto.instances.ltm)&&(u.tooltips_dirty=!0),!1}}},quanto.perf_chart=new Highcharts.StockChart(e),$(".chart-border").removeClass("hidden"),$(".chart-legend .payload").removeClass("hidden")},e.prototype.initialize_code=function(){var e;return e=$("#codepane-div"),e.length>0?quanto.editor=CodeMirror.fromTextArea(e[0],{lineNumbers:!0,mode:"python",indentUnit:4,readOnly:!0}):void 0},e.prototype.initialize_public_sharing=function(){return this.$sharing_checkbox=$("#enable-sharing-checkbox"),this.$sharing_checkbox.change(function(e){return function(){return e.manual_setting?void 0:e.$sharing_checkbox.is(":checked")?e.toggle_public_sharing(!0):confirm("Disabling public sharing will invalidate the existing share link.  Disable?")?e.toggle_public_sharing(!1):(e.manual_setting=!0,e.$sharing_checkbox.prop("checked",!0),e.manual_setting=!1)}}(this)),this.$public_sharing_spinner=$("#public-sharing-spinner"),this.$share_form=$("#public-share-info-form"),this.$share_url_box=this.$share_form.find("input"),this.$share_url_box.click(function(e){return function(){return e.$share_url_box.select()}}(this)),this.$regenerate_link=this.$share_form.find("a.regenerate-share-url"),this.$regenerate_link.on("click",function(e){return function(){return e.toggle_public_sharing(!0)}}(this))},e.prototype.toggle_public_sharing=function(e){return e?(this.$public_sharing_spinner.removeClass("hidden"),this.$sharing_checkbox.addClass("disabled"),$.post("/live_algorithms/"+this.live_algorithm_id+"/set_public_sharing",{sharing_enabled:!0},function(e){return function(t){var o,i,r;return i=new quanto.JsonResponse(t),i.ok()?(e.$sharing_checkbox.removeClass("disabled"),r=i.data().share_url,o=i.data().generated_at,e.$share_form.find("input").val(r),e.$share_form.find(".quanto-date").attr("UTCms",o),quanto.date.render_date_value(e.$share_form.find(".quanto-date")),e.$share_form.removeClass("hidden"),e.$public_sharing_spinner.addClass("hidden")):void 0}}(this))):(this.$public_sharing_spinner.removeClass("hidden"),this.$sharing_checkbox.addClass("disabled"),$.post("/live_algorithms/"+this.live_algorithm_id+"/set_public_sharing",{sharing_enabled:!1},function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()?(e.$share_form.addClass("hidden"),e.$public_sharing_spinner.addClass("hidden")):void 0}}(this)))},e.prototype.display_perf_chart_values=function(e,t){var o,i;return i=Math.floor(1e4*e)/100,o=Math.floor(1e4*t)/100,$("#livetrading-performance-value").html(""+i+"%"),$("#livetrading-benchmark-value").html(""+o+"%"),0>i?$("#livetrading-performance-value").addClass("negative"):$("#livetrading-performance-value").removeClass("negative"),0>o?$("#livetrading-benchmark-value").addClass("negative"):$("#livetrading-benchmark-value").removeClass("negative")},e.prototype.reset_chart_values=function(){var e,t,o,i,r,n,s,a,l,u,c,d,h,p;if(r=function(e){return function(t,o){var i;return null!=t&&null!=t.series?(i=e.get_series(o,t).points,null!=i&&i.length>0?_.last(i).y:null):void 0}}(this),a=r(quanto.perf_chart,"returns"),e=r(quanto.perf_chart,"benchmark"),null!=a&&null!=e&&this.display_perf_chart_values(a,e),null!=this.custom_series_cache){d=this.custom_series_cache;for(o in d)t=d[o],null!=t.points&&(n=_.last(t.points),$(".legend-item[data-key="+o+"]").find(".chart-value").html(Math.round(100*n.y)/100))}for(h=["long_exposure","short_exposure","cash"],p=[],u=0,c=h.length;c>u;u++)i=h[u],l=this.get_series(i,quanto.exposure_chart),null!=l&&l.visible&&l.points?(s=_.last(l.points),p.push($(".legend-item[data-key="+i+"]").find(".chart-value").html(""+new Number(s.y).toMoney()))):p.push(void 0);return p},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var r in t)o.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};quanto.LiveTradingManagerTest=e=function(e){function o(){this.initialize_helpers=t(this.initialize_helpers,this),o.__super__.constructor.call(this)}return i(o,e),o.prototype.initialize_helpers=function(){},o}(quanto.LiveTradingManager)}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.OauthLoginManager=e=function(){function e(e,o,i,r){this.render_ui=t(this.render_ui,this),this.handle_successful_login=t(this.handle_successful_login,this),this.show_area=t(this.show_area,this),this.failure_handler=t(this.failure_handler,this),this.prepare_for_login=t(this.prepare_for_login,this);var n;this.broker_name=e,this.display_broker_name=o,this.$popup=$("#oauth-login-modal"),this.$modal_footer=this.$popup.find(".modal-footer"),this.$cred_area=this.$popup.find(".creds"),this.$account_info_area=this.$popup.find(".account-info"),this.$success_area=this.$popup.find(".success-area"),this.$close_button=$("#close-button"),this.$cancel_button=$("#cancel-button"),this.$auth_error_box=$("#auth-error-message-box"),this.$auth_error_container=this.$popup.find(".auth-error"),this.$authentication_btn=$("#oauth-redirect-btn"),"true"===i?(this.$popup.addClass("loading"),this.$popup.modal({backdrop:"static"}),"incorrect_username"===r?(this.$popup.modal("hide"),$("#error-modal").find(".btn").on("click",function(){return function(){return window.location=window.location.pathname}}(this)),quanto.show_error_popup("Incorrect Username","The "+this.broker_name+" account you've authenticated with does not match the one in our record. Please check your username and try again.")):"error"===r?(this.$popup.modal("hide"),$("#error-modal").find(".btn").on("click",function(){return function(){return window.location=window.location.pathname}}(this)),quanto.show_error_popup("Unable to connect","We are unable to connect to "+this.broker_name+". Please try again later.")):(n={id:$("#live_algo_id").val(),broker_name:this.broker_name,trading_account_id:$("#oauth_id").val()},$.post("/live_algorithms/broker_authentication",n,function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()?"ready"===o.data().result?e.handle_successful_login(o.data()):"trylater"===o.data().result?(e.$popup.modal("hide"),quanto.show_error_popup("Unable to connect","We are unable to connect to "+e.broker_name+". We were unable to log you in. Please try again later.")):(e.$popup.modal("hide"),mixpanel.track("unknown error on live algo page"),quanto.show_error_popup("Unknown Error","Sorry, something went wrong.")):("kill_switch"===o.data()&&(e.$popup.modal("hide"),quanto.show_error_popup("Unable to connect","We are unable to connect to "+e.broker_name+". Please check http://status.quantopian.com for full details.")),e.failure_handler(t))}}(this)).error(function(e){return function(t){return e.failure_handler(t)}}(this)))):$(document).bind("do_oauth_login",function(e){return function(t,o){return e.live_algo_id=o.id,e.$popup.addClass("loading"),e.$popup.modal({backdrop:"static"}),quanto.is_employee_or_admin()?mixpanel.track("live algo login started employee",{id:e.live_algo_id}):mixpanel.track("live algo login started",{id:e.live_algo_id}),e.prepare_for_login()}}(this))}return e.prototype.prepare_for_login=function(){var e;return e={id:this.live_algo_id,broker_name:this.broker_name},$.post("/live_algorithms/prepare_for_broker_login",e,function(e){return function(t){var o;return o=new quanto.JsonResponse(t),o.ok()&&"ready"===o.data().state?(e.trading_account_id=o.data().account_id,e.trading_account_number=o.data().account_number,e.trading_account_name=o.data().account_name,e.trading_account_username=o.data().account_username,e.authentication_link=o.data().authentication_link,e.$popup.removeClass("loading"),e.$modal_footer.show(),e.show_area("creds"),e.render_ui()):void 0}}(this)).error(function(e){return function(t){var o,i;return o=new quanto.JsonResponse(t),"trading"===(null!=(i=o.data())?i.state:void 0)?(e.$popup.modal("hide"),alert("Can't log into this "+e.broker_name+" account because it is already in use.")):void 0}}(this))},e.prototype.failure_handler=function(e,t){var o;return null==t&&(t=!1),o=new quanto.JsonResponse(e),"auth"===o.data()?(this.show_area("creds"),this.show_auth_error()):"start_over"===o.data()?(this.$popup.modal("hide"),alert("Login has taken too long.  Reload this page and start over.")):(this.$popup.modal("hide"),mixpanel.track("unknown error on live algo page"),quanto.show_error_popup("Unknown Error","Sorry, something went wrong."))},e.prototype.show_area=function(e){return this.$cred_area.addClass("hidden"),this.$success_area.addClass("hidden"),this.$account_info_area.addClass("hidden"),this.$close_button.removeClass("disabled").html("Close").addClass("hidden"),this.$cancel_button.removeClass("disabled").html("Close").removeClass("hidden"),"creds"===e?(this.$cred_area.removeClass("hidden"),this.$authentication_btn.attr("href",this.authentication_link)):"success"===e?(this.$success_area.removeClass("hidden"),this.$cancel_button.addClass("hidden"),this.$close_button.removeClass("hidden")):void 0},e.prototype.handle_successful_login=function(e){var t;return quanto.is_employee_or_admin()?mixpanel.track("live algo login success employee",{id:this.live_algo_id}):mixpanel.track("live algo login success",{id:this.live_algo_id}),t={},null!=e.market_open&&e.market_open&&(t={market_open:!0,ws_url:e.ws_url,start_date_ms:e.start_date_ms}),this.$popup.removeClass("loading"),this.$close_button.on("click",function(){return function(){return $(document).trigger("successful_broker_login",[t])}}(this)),this.show_area("success")},e.prototype.render_ui=function(){return $("#broker-login-account-name").html(quanto.escapeHTML(this.trading_account_name)),$("#oauth-username-label").html(quanto.escapeHTML(this.trading_account_username))},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.OrderBook=e=function(){function e(){this.get_txn_value_info=t(this.get_txn_value_info,this),this.get_cumulative_txn_value_since_date=t(this.get_cumulative_txn_value_since_date,this),this.get_txn_value_for_date=t(this.get_txn_value_for_date,this),this.get_message_for_order=t(this.get_message_for_order,this),this.get_txns_for_order=t(this.get_txns_for_order,this),this.get_oldest_order=t(this.get_oldest_order,this),this.get_order_count=t(this.get_order_count,this),this.get_order_list=t(this.get_order_list,this),this.get_all_sids=t(this.get_all_sids,this),this.add_txn=t(this.add_txn,this),this.txn_equal=t(this.txn_equal,this),this.has_txn=t(this.has_txn,this),this.has_order=t(this.has_order,this),this.add_order=t(this.add_order,this),this.clear=t(this.clear,this),this.clear()}return e.prototype.clear=function(){return this.orders={},this.transactions={}},e.prototype.add_order=function(e){return null!=this.orders[e.id]?(this.orders[e.id].status=e.status,this.orders[e.id].message=e.message):this.orders[e.id]=e},e.prototype.has_order=function(e){return null!=this.orders[e]},e.prototype.has_txn=function(e){var t;return t=this.orders[e],null==t?!1:null!=t.fills&&t.fills.length>0},e.prototype.txn_equal=function(e,t){var o,i,r,n,s,a;if(o=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t),o.length!==i.length)return!1;for(r=s=0,a=o.length;a>=s;r=s+=1)if(n=o[r],e[n]!==t[n])return!1;return!0},e.prototype.add_txn=function(e,t){var o,i,r,n,s,a,l;if(i=this.orders[t.order_id],null==i)throw new Error("cannot find order with id = "+t.order_id);for((r=this.orders[i.id]).fills||(r.fills=[]),l=this.orders[i.id].fills,s=0,a=l.length;a>s;s++)if(o=l[s],this.txn_equal(o,t))return;return this.orders[i.id].fills.push(t),(n=this.transactions)[e]||(n[e]=[]),this.transactions[e].push(t)},e.prototype.get_all_sids=function(){return _.uniq(_.values(this.orders).map(function(){return function(e){return e.sid}}(this)))},e.prototype.get_order_list=function(e){var t,o,i;return null==e&&(e=null),t=_.values(this.orders),null!=e?(i=e.field,o=e.dir):(i="date",o=-1),t=_.sortBy(t,function(){return function(e){return e[i]}}(this)),-1===o&&(t=t.reverse()),t},e.prototype.get_order_count=function(){return _.keys(this.orders).length},e.prototype.get_oldest_order=function(){var e,t,o,i,r,n,s;if(!_.isEmpty(this.orders)){r=_.values(this.orders),n=_.map(this.orders,function(e){return e.sequence_number}),n=_.select(n,function(e){return null!=e}),t=_.min(n),s=this.orders;for(e in s)i=s[e],i.sequence_number===t&&(o=i)}return o},e.prototype.get_txns_for_order=function(e){var t;return t=this.orders[e],null==t?[]:null!=t.fills&&t.fills.length>0?t.fills.reverse():null},e.prototype.get_message_for_order=function(e){var t;return t=this.orders[e],null==t?null:null!=t.message&&t.message.length>0?t.message:null},e.prototype.get_txn_value_for_date=function(e){var t;return t=this.transactions[e],null==t||0===t.length?{buys_dollar_total:0,sells_dollar_total:0}:this.get_txn_value_info(t)},e.prototype.get_cumulative_txn_value_since_date=function(e){var t,o,i,r;i=[],r=this.transactions;for(o in r)t=r[o],parseInt(o)>=e&&i.push(t);return this.get_txn_value_info(_.flatten(i))},e.prototype.get_txn_value_info=function(e){var t,o,i,r,n,s,a;for(t=0,r=0,s=0,a=e.length;a>s;s++)n=e[s],i=this.orders[n.order_id],o=n.amount*n.price,null==i||(i.amount>0?t+=o:i.amount<0&&(r+=o));return{buys_dollar_total:t,sells_dollar_total:r}},e}()}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.PositionBook=e=function(){function e(){this.get_all_sids=t(this.get_all_sids,this),this.get_cash_for_date=t(this.get_cash_for_date,this),this.get_exposure_info_for_date=t(this.get_exposure_info_for_date,this),this.get_latest_positions=t(this.get_latest_positions,this),this.add_cash=t(this.add_cash,this),this.add_position=t(this.add_position,this),this.clear=t(this.clear,this),this.clear()}return e.prototype.clear=function(){return this.positions={},this.cash={},this.last_date=null},e.prototype.add_position=function(e,t){var o;return(o=this.positions)[e]||(o[e]=[]),null!=t&&this.positions[e].push(t),!this.last_date||this.last_date<e?this.last_date=e:void 0},e.prototype.add_cash=function(e,t){return this.cash[e]=t},e.prototype.get_latest_positions=function(e){var t,o,i;return null==e&&(e=null),null==this.last_date?[]:(t=this.positions[this.last_date],null!=e?(i=e.field,o=e.dir):(i="value",o=-1),t=_.sortBy(t,function(){return function(e){return e[i]}}(this)),-1===o&&(t=t.reverse()),t)},e.prototype.get_exposure_info_for_date=function(e){var t,o,i,r,n,s;if(i=this.positions[e],null==i||0===i.length)return{"long":0,"short":0};for(t=0,r=0,n=0,s=i.length;s>n;n++)o=i[n],o.value<0?r+=o.value:t+=o.value;return{"long":t,"short":r}},e.prototype.get_cash_for_date=function(e){return this.cash[e]},e.prototype.get_all_sids=function(){return _.uniq(this.get_latest_positions().map(function(){return function(e){return e.sid}}(this)))},e}()}.call(this);