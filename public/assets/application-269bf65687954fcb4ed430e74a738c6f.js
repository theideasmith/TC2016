/*!
 * jQuery JavaScript Library v1.8.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Thu Aug 30 2012 17:17:22 GMT-0400 (Eastern Daylight Time)
 */
!function(t,e){function n(t){var e=_e[t]={};return K.each(t.split(ee),function(t,n){e[n]=!0}),e}function i(t,n,i){if(i===e&&1===t.nodeType){var r="data-"+n.replace(me,"-$1").toLowerCase();if(i=t.getAttribute(r),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:fe.test(i)?K.parseJSON(i):i}catch(o){}K.data(t,n,i)}else i=e}return i}function r(t){var e;for(e in t)if(("data"!==e||!K.isEmptyObject(t[e]))&&"toJSON"!==e)return!1;return!0}function o(){return!1}function a(){return!0}function s(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function l(t,e){do t=t[e];while(t&&1!==t.nodeType);return t}function u(t,e,n){if(e=e||0,K.isFunction(e))return K.grep(t,function(t,i){var r=!!e.call(t,i,t);return r===n});if(e.nodeType)return K.grep(t,function(t){return t===e===n});if("string"==typeof e){var i=K.grep(t,function(t){return 1===t.nodeType});if(Pe.test(e))return K.filter(e,i,!n);e=K.filter(e,i)}return K.grep(t,function(t){return K.inArray(t,e)>=0===n})}function c(t){var e=Re.split("|"),n=t.createDocumentFragment();if(n.createElement)for(;e.length;)n.createElement(e.pop());return n}function d(t,e){return t.getElementsByTagName(e)[0]||t.appendChild(t.ownerDocument.createElement(e))}function h(t,e){if(1===e.nodeType&&K.hasData(t)){var n,i,r,o=K._data(t),a=K._data(e,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s)for(i=0,r=s[n].length;r>i;i++)K.event.add(e,n,s[n][i])}a.data&&(a.data=K.extend({},a.data))}}function p(t,e){var n;1===e.nodeType&&(e.clearAttributes&&e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(t),n=e.nodeName.toLowerCase(),"object"===n?(e.parentNode&&(e.outerHTML=t.outerHTML),K.support.html5Clone&&t.innerHTML&&!K.trim(e.innerHTML)&&(e.innerHTML=t.innerHTML)):"input"===n&&Ve.test(t.type)?(e.defaultChecked=e.checked=t.checked,e.value!==t.value&&(e.value=t.value)):"option"===n?e.selected=t.defaultSelected:"input"===n||"textarea"===n?e.defaultValue=t.defaultValue:"script"===n&&e.text!==t.text&&(e.text=t.text),e.removeAttribute(K.expando))}function _(t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName("*"):"undefined"!=typeof t.querySelectorAll?t.querySelectorAll("*"):[]}function f(t){Ve.test(t.type)&&(t.defaultChecked=t.checked)}function m(t,e){if(e in t)return e;for(var n=e.charAt(0).toUpperCase()+e.slice(1),i=e,r=vn.length;r--;)if(e=vn[r]+n,e in t)return e;return i}function g(t,e){return t=e||t,"none"===K.css(t,"display")||!K.contains(t.ownerDocument,t)}function v(t,e){for(var n,i,r=[],o=0,a=t.length;a>o;o++)n=t[o],n.style&&(r[o]=K._data(n,"olddisplay"),e?(r[o]||"none"!==n.style.display||(n.style.display=""),""===n.style.display&&g(n)&&(r[o]=K._data(n,"olddisplay",k(n.nodeName)))):(i=nn(n,"display"),r[o]||"none"===i||K._data(n,"olddisplay",i)));for(o=0;a>o;o++)n=t[o],n.style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[o]||"":"none"));return t}function b(t,e,n){var i=dn.exec(e);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):e}function y(t,e,n,i){for(var r=n===(i?"border":"content")?4:"width"===e?1:0,o=0;4>r;r+=2)"margin"===n&&(o+=K.css(t,n+gn[r],!0)),i?("content"===n&&(o-=parseFloat(nn(t,"padding"+gn[r]))||0),"margin"!==n&&(o-=parseFloat(nn(t,"border"+gn[r]+"Width"))||0)):(o+=parseFloat(nn(t,"padding"+gn[r]))||0,"padding"!==n&&(o+=parseFloat(nn(t,"border"+gn[r]+"Width"))||0));return o}function w(t,e,n){var i="width"===e?t.offsetWidth:t.offsetHeight,r=!0,o=K.support.boxSizing&&"border-box"===K.css(t,"boxSizing");if(0>=i||null==i){if(i=nn(t,e),(0>i||null==i)&&(i=t.style[e]),hn.test(i))return i;r=o&&(K.support.boxSizingReliable||i===t.style[e]),i=parseFloat(i)||0}return i+y(t,e,n||(o?"border":"content"),r)+"px"}function k(t){if(_n[t])return _n[t];var e=K("<"+t+">").appendTo(I.body),n=e.css("display");return e.remove(),("none"===n||""===n)&&(rn=I.body.appendChild(rn||K.extend(I.createElement("iframe"),{frameBorder:0,width:0,height:0})),on&&rn.createElement||(on=(rn.contentWindow||rn.contentDocument).document,on.write("<!doctype html><html><body>"),on.close()),e=on.body.appendChild(on.createElement(t)),n=nn(e,"display"),I.body.removeChild(rn)),_n[t]=n,n}function $(t,e,n,i){var r;if(K.isArray(e))K.each(e,function(e,r){n||wn.test(t)?i(t,r):$(t+"["+("object"==typeof r?e:"")+"]",r,n,i)});else if(n||"object"!==K.type(e))i(t,e);else for(r in e)$(t+"["+r+"]",e[r],n,i)}function x(t){return function(e,n){"string"!=typeof e&&(n=e,e="*");var i,r,o,a=e.toLowerCase().split(ee),s=0,l=a.length;if(K.isFunction(n))for(;l>s;s++)i=a[s],o=/^\+/.test(i),o&&(i=i.substr(1)||"*"),r=t[i]=t[i]||[],r[o?"unshift":"push"](n)}}function C(t,n,i,r,o,a){o=o||n.dataTypes[0],a=a||{},a[o]=!0;for(var s,l=t[o],u=0,c=l?l.length:0,d=t===Ln;c>u&&(d||!s);u++)s=l[u](n,i,r),"string"==typeof s&&(!d||a[s]?s=e:(n.dataTypes.unshift(s),s=C(t,n,i,r,s,a)));return!d&&s||a["*"]||(s=C(t,n,i,r,"*",a)),s}function q(t,n){var i,r,o=K.ajaxSettings.flatOptions||{};for(i in n)n[i]!==e&&((o[i]?t:r||(r={}))[i]=n[i]);r&&K.extend(!0,t,r)}function T(t,n,i){var r,o,a,s,l=t.contents,u=t.dataTypes,c=t.responseFields;for(o in c)o in i&&(n[c[o]]=i[o]);for(;"*"===u[0];)u.shift(),r===e&&(r=t.mimeType||n.getResponseHeader("content-type"));if(r)for(o in l)if(l[o]&&l[o].test(r)){u.unshift(o);break}if(u[0]in i)a=u[0];else{for(o in i){if(!u[0]||t.converters[o+" "+u[0]]){a=o;break}s||(s=o)}a=a||s}return a?(a!==u[0]&&u.unshift(a),i[a]):void 0}function S(t,e){var n,i,r,o,a=t.dataTypes.slice(),s=a[0],l={},u=0;if(t.dataFilter&&(e=t.dataFilter(e,t.dataType)),a[1])for(n in t.converters)l[n.toLowerCase()]=t.converters[n];for(;r=a[++u];)if("*"!==r){if("*"!==s&&s!==r){if(n=l[s+" "+r]||l["* "+r],!n)for(i in l)if(o=i.split(" "),o[1]===r&&(n=l[s+" "+o[0]]||l["* "+o[0]])){n===!0?n=l[i]:l[i]!==!0&&(r=o[0],a.splice(u--,0,r));break}if(n!==!0)if(n&&t["throws"])e=n(e);else try{e=n(e)}catch(c){return{state:"parsererror",error:n?c:"No conversion from "+s+" to "+r}}}s=r}return{state:"success",data:e}}function E(){try{return new t.XMLHttpRequest}catch(e){}}function D(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function M(){return setTimeout(function(){Yn=e},0),Yn=K.now()}function A(t,e){K.each(e,function(e,n){for(var i=(ti[e]||[]).concat(ti["*"]),r=0,o=i.length;o>r;r++)if(i[r].call(t,e,n))return})}function N(t,e,n){var i,r=0,o=Zn.length,a=K.Deferred().always(function(){delete s.elem}),s=function(){for(var e=Yn||M(),n=Math.max(0,l.startTime+l.duration-e),i=1-(n/l.duration||0),r=0,o=l.tweens.length;o>r;r++)l.tweens[r].run(i);return a.notifyWith(t,[l,i,n]),1>i&&o?n:(a.resolveWith(t,[l]),!1)},l=a.promise({elem:t,props:K.extend({},e),opts:K.extend(!0,{specialEasing:{}},n),originalProperties:e,originalOptions:n,startTime:Yn||M(),duration:n.duration,tweens:[],createTween:function(e,n){var i=K.Tween(t,l.opts,e,n,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(i),i},stop:function(e){for(var n=0,i=e?l.tweens.length:0;i>n;n++)l.tweens[n].run(1);return e?a.resolveWith(t,[l,e]):a.rejectWith(t,[l,e]),this}}),u=l.props;for(F(u,l.opts.specialEasing);o>r;r++)if(i=Zn[r].call(l,t,u,l.opts))return i;return A(l,u),K.isFunction(l.opts.start)&&l.opts.start.call(t,l),K.fx.timer(K.extend(s,{anim:l,queue:l.opts.queue,elem:t})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function F(t,e){var n,i,r,o,a;for(n in t)if(i=K.camelCase(n),r=e[i],o=t[n],K.isArray(o)&&(r=o[1],o=t[n]=o[0]),n!==i&&(t[i]=o,delete t[n]),a=K.cssHooks[i],a&&"expand"in a){o=a.expand(o),delete t[i];for(n in o)n in t||(t[n]=o[n],e[n]=r)}else e[i]=r}function z(t,e,n){var i,r,o,a,s,l,u,c,d=this,h=t.style,p={},_=[],f=t.nodeType&&g(t);n.queue||(u=K._queueHooks(t,"fx"),null==u.unqueued&&(u.unqueued=0,c=u.empty.fire,u.empty.fire=function(){u.unqueued||c()}),u.unqueued++,d.always(function(){d.always(function(){u.unqueued--,K.queue(t,"fx").length||u.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],"inline"===K.css(t,"display")&&"none"===K.css(t,"float")&&(K.support.inlineBlockNeedsLayout&&"inline"!==k(t.nodeName)?h.zoom=1:h.display="inline-block")),n.overflow&&(h.overflow="hidden",K.support.shrinkWrapBlocks||d.done(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(i in e)if(o=e[i],Qn.exec(o)){if(delete e[i],o===(f?"hide":"show"))continue;_.push(i)}if(a=_.length)for(s=K._data(t,"fxshow")||K._data(t,"fxshow",{}),f?K(t).show():d.done(function(){K(t).hide()}),d.done(function(){var e;K.removeData(t,"fxshow",!0);for(e in p)K.style(t,e,p[e])}),i=0;a>i;i++)r=_[i],l=d.createTween(r,f?s[r]:0),p[r]=s[r]||K.style(t,r),r in s||(s[r]=l.start,f&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}function P(t,e,n,i,r){return new P.prototype.init(t,e,n,i,r)}function L(t,e){var n,i={height:t},r=0;for(e=e?1:0;4>r;r+=2-e)n=gn[r],i["margin"+n]=i["padding"+n]=t;return e&&(i.opacity=i.width=t),i}function j(t){return K.isWindow(t)?t:9===t.nodeType?t.defaultView||t.parentWindow:!1}var R,O,I=t.document,H=t.location,B=t.navigator,W=t.jQuery,U=t.$,J=Array.prototype.push,G=Array.prototype.slice,Y=Array.prototype.indexOf,V=Object.prototype.toString,Q=Object.prototype.hasOwnProperty,X=String.prototype.trim,K=function(t,e){return new K.fn.init(t,e,R)},Z=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,te=/\S/,ee=/\s+/,ne=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ie=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,re=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,oe=/^[\],:{}\s]*$/,ae=/(?:^|:|,)(?:\s*\[)+/g,se=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,le=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ue=/^-ms-/,ce=/-([\da-z])/gi,de=function(t,e){return(e+"").toUpperCase()},he=function(){I.addEventListener?(I.removeEventListener("DOMContentLoaded",he,!1),K.ready()):"complete"===I.readyState&&(I.detachEvent("onreadystatechange",he),K.ready())},pe={};K.fn=K.prototype={constructor:K,init:function(t,n,i){var r,o,a;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("string"==typeof t){if(r="<"===t.charAt(0)&&">"===t.charAt(t.length-1)&&t.length>=3?[null,t,null]:ie.exec(t),!r||!r[1]&&n)return!n||n.jquery?(n||i).find(t):this.constructor(n).find(t);if(r[1])return n=n instanceof K?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:I,t=K.parseHTML(r[1],a,!0),re.test(r[1])&&K.isPlainObject(n)&&this.attr.call(t,n,!0),K.merge(this,t);if(o=I.getElementById(r[2]),o&&o.parentNode){if(o.id!==r[2])return i.find(t);this.length=1,this[0]=o}return this.context=I,this.selector=t,this}return K.isFunction(t)?i.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),K.makeArray(t,this))},selector:"",jquery:"1.8.1",length:0,size:function(){return this.length},toArray:function(){return G.call(this)},get:function(t){return null==t?this.toArray():0>t?this[this.length+t]:this[t]},pushStack:function(t,e,n){var i=K.merge(this.constructor(),t);return i.prevObject=this,i.context=this.context,"find"===e?i.selector=this.selector+(this.selector?" ":"")+n:e&&(i.selector=this.selector+"."+e+"("+n+")"),i},each:function(t,e){return K.each(this,t,e)},ready:function(t){return K.ready.promise().done(t),this},eq:function(t){return t=+t,-1===t?this.slice(t):this.slice(t,t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(G.apply(this,arguments),"slice",G.call(arguments).join(","))},map:function(t){return this.pushStack(K.map(this,function(e,n){return t.call(e,n,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:J,sort:[].sort,splice:[].splice},K.fn.init.prototype=K.fn,K.extend=K.fn.extend=function(){var t,n,i,r,o,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||K.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++)if(null!=(t=arguments[l]))for(n in t)i=s[n],r=t[n],s!==r&&(c&&r&&(K.isPlainObject(r)||(o=K.isArray(r)))?(o?(o=!1,a=i&&K.isArray(i)?i:[]):a=i&&K.isPlainObject(i)?i:{},s[n]=K.extend(c,a,r)):r!==e&&(s[n]=r));return s},K.extend({noConflict:function(e){return t.$===K&&(t.$=U),e&&t.jQuery===K&&(t.jQuery=W),K},isReady:!1,readyWait:1,holdReady:function(t){t?K.readyWait++:K.ready(!0)},ready:function(t){if(t===!0?!--K.readyWait:!K.isReady){if(!I.body)return setTimeout(K.ready,1);K.isReady=!0,t!==!0&&--K.readyWait>0||(O.resolveWith(I,[K]),K.fn.trigger&&K(I).trigger("ready").off("ready"))}},isFunction:function(t){return"function"===K.type(t)},isArray:Array.isArray||function(t){return"array"===K.type(t)},isWindow:function(t){return null!=t&&t==t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null==t?String(t):pe[V.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==K.type(t)||t.nodeType||K.isWindow(t))return!1;try{if(t.constructor&&!Q.call(t,"constructor")&&!Q.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in t);return i===e||Q.call(t,i)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},error:function(t){throw new Error(t)},parseHTML:function(t,e,n){var i;return t&&"string"==typeof t?("boolean"==typeof e&&(n=e,e=0),e=e||I,(i=re.exec(t))?[e.createElement(i[1])]:(i=K.buildFragment([t],e,n?null:[]),K.merge([],(i.cacheable?K.clone(i.fragment):i.fragment).childNodes))):null},parseJSON:function(e){return e&&"string"==typeof e?(e=K.trim(e),t.JSON&&t.JSON.parse?t.JSON.parse(e):oe.test(e.replace(se,"@").replace(le,"]").replace(ae,""))?new Function("return "+e)():(K.error("Invalid JSON: "+e),void 0)):null},parseXML:function(n){var i,r;if(!n||"string"!=typeof n)return null;try{t.DOMParser?(r=new DOMParser,i=r.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=e}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||K.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(e){e&&te.test(e)&&(t.execScript||function(e){t.eval.call(t,e)})(e)},camelCase:function(t){return t.replace(ue,"ms-").replace(ce,de)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,n,i){var r,o=0,a=t.length,s=a===e||K.isFunction(t);if(i)if(s){for(r in t)if(n.apply(t[r],i)===!1)break}else for(;a>o&&n.apply(t[o++],i)!==!1;);else if(s){for(r in t)if(n.call(t[r],r,t[r])===!1)break}else for(;a>o&&n.call(t[o],o,t[o++])!==!1;);return t},trim:X&&!X.call("﻿ ")?function(t){return null==t?"":X.call(t)}:function(t){return null==t?"":t.toString().replace(ne,"")},makeArray:function(t,e){var n,i=e||[];return null!=t&&(n=K.type(t),null==t.length||"string"===n||"function"===n||"regexp"===n||K.isWindow(t)?J.call(i,t):K.merge(i,t)),i},inArray:function(t,e,n){var i;if(e){if(Y)return Y.call(e,t,n);for(i=e.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in e&&e[n]===t)return n}return-1},merge:function(t,n){var i=n.length,r=t.length,o=0;if("number"==typeof i)for(;i>o;o++)t[r++]=n[o];else for(;n[o]!==e;)t[r++]=n[o++];return t.length=r,t},grep:function(t,e,n){var i,r=[],o=0,a=t.length;for(n=!!n;a>o;o++)i=!!e(t[o],o),n!==i&&r.push(t[o]);return r},map:function(t,n,i){var r,o,a=[],s=0,l=t.length,u=t instanceof K||l!==e&&"number"==typeof l&&(l>0&&t[0]&&t[l-1]||0===l||K.isArray(t));if(u)for(;l>s;s++)r=n(t[s],s,i),null!=r&&(a[a.length]=r);else for(o in t)r=n(t[o],o,i),null!=r&&(a[a.length]=r);return a.concat.apply([],a)},guid:1,proxy:function(t,n){var i,r,o;return"string"==typeof n&&(i=t[n],n=t,t=i),K.isFunction(t)?(r=G.call(arguments,2),o=function(){return t.apply(n,r.concat(G.call(arguments)))},o.guid=t.guid=t.guid||o.guid||K.guid++,o):e},access:function(t,n,i,r,o,a,s){var l,u=null==i,c=0,d=t.length;if(i&&"object"==typeof i){for(c in i)K.access(t,n,c,i[c],1,a,r);o=1}else if(r!==e){if(l=s===e&&K.isFunction(r),u&&(l?(l=n,n=function(t,e,n){return l.call(K(t),n)}):(n.call(t,r),n=null)),n)for(;d>c;c++)n(t[c],i,l?r.call(t[c],c,n(t[c],i)):r,s);o=1}return o?t:u?n.call(t):d?n(t[0],i):a},now:function(){return(new Date).getTime()}}),K.ready.promise=function(e){if(!O)if(O=K.Deferred(),"complete"===I.readyState)setTimeout(K.ready,1);else if(I.addEventListener)I.addEventListener("DOMContentLoaded",he,!1),t.addEventListener("load",K.ready,!1);else{I.attachEvent("onreadystatechange",he),t.attachEvent("onload",K.ready);var n=!1;try{n=null==t.frameElement&&I.documentElement}catch(i){}n&&n.doScroll&&!function r(){if(!K.isReady){try{n.doScroll("left")}catch(t){return setTimeout(r,50)}K.ready()}}()}return O.promise(e)},K.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){pe["[object "+e+"]"]=e.toLowerCase()}),R=K(I);var _e={};K.Callbacks=function(t){t="string"==typeof t?_e[t]||n(t):K.extend({},t);var i,r,o,a,s,l,u=[],c=!t.once&&[],d=function(e){for(i=t.memory&&e,r=!0,l=a||0,a=0,s=u.length,o=!0;u&&s>l;l++)if(u[l].apply(e[0],e[1])===!1&&t.stopOnFalse){i=!1;break}o=!1,u&&(c?c.length&&d(c.shift()):i?u=[]:h.disable())},h={add:function(){if(u){var e=u.length;!function n(e){K.each(e,function(e,i){var r=K.type(i);"function"!==r||t.unique&&h.has(i)?i&&i.length&&"string"!==r&&n(i):u.push(i)})}(arguments),o?s=u.length:i&&(a=e,d(i))}return this},remove:function(){return u&&K.each(arguments,function(t,e){for(var n;(n=K.inArray(e,u,n))>-1;)u.splice(n,1),o&&(s>=n&&s--,l>=n&&l--)}),this},has:function(t){return K.inArray(t,u)>-1},empty:function(){return u=[],this},disable:function(){return u=c=i=e,this},disabled:function(){return!u},lock:function(){return c=e,i||h.disable(),this},locked:function(){return!c},fireWith:function(t,e){return e=e||[],e=[t,e.slice?e.slice():e],!u||r&&!c||(o?c.push(e):d(e)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!r}};return h},K.extend({Deferred:function(t){var e=[["resolve","done",K.Callbacks("once memory"),"resolved"],["reject","fail",K.Callbacks("once memory"),"rejected"],["notify","progress",K.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var t=arguments;return K.Deferred(function(n){K.each(e,function(e,i){var o=i[0],a=t[e];r[i[1]](K.isFunction(a)?function(){var t=a.apply(this,arguments);t&&K.isFunction(t.promise)?t.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n:this,[t])}:n[o])}),t=null}).promise()},promise:function(t){return"object"==typeof t?K.extend(t,i):i}},r={};return i.pipe=i.then,K.each(e,function(t,o){var a=o[2],s=o[3];i[o[1]]=a.add,s&&a.add(function(){n=s},e[1^t][2].disable,e[2][2].lock),r[o[0]]=a.fire,r[o[0]+"With"]=a.fireWith}),i.promise(r),t&&t.call(r,r),r},when:function(t){var e,n,i,r=0,o=G.call(arguments),a=o.length,s=1!==a||t&&K.isFunction(t.promise)?a:0,l=1===s?t:K.Deferred(),u=function(t,n,i){return function(r){n[t]=this,i[t]=arguments.length>1?G.call(arguments):r,i===e?l.notifyWith(n,i):--s||l.resolveWith(n,i)}};if(a>1)for(e=new Array(a),n=new Array(a),i=new Array(a);a>r;r++)o[r]&&K.isFunction(o[r].promise)?o[r].promise().done(u(r,i,o)).fail(l.reject).progress(u(r,n,e)):--s;return s||l.resolveWith(i,o),l.promise()}}),K.support=function(){var e,n,i,r,o,a,s,l,u,c,d,h=I.createElement("div");if(h.setAttribute("className","t"),h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=h.getElementsByTagName("*"),i=h.getElementsByTagName("a")[0],i.style.cssText="top:1px;float:left;opacity:.5",!n||!n.length||!i)return{};r=I.createElement("select"),o=r.appendChild(I.createElement("option")),a=h.getElementsByTagName("input")[0],e={leadingWhitespace:3===h.firstChild.nodeType,tbody:!h.getElementsByTagName("tbody").length,htmlSerialize:!!h.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:"on"===a.value,optSelected:o.selected,getSetAttribute:"t"!==h.className,enctype:!!I.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==I.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===I.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,e.noCloneChecked=a.cloneNode(!0).checked,r.disabled=!0,e.optDisabled=!o.disabled;try{delete h.test}catch(p){e.deleteExpando=!1}if(!h.addEventListener&&h.attachEvent&&h.fireEvent&&(h.attachEvent("onclick",d=function(){e.noCloneEvent=!1}),h.cloneNode(!0).fireEvent("onclick"),h.detachEvent("onclick",d)),a=I.createElement("input"),a.value="t",a.setAttribute("type","radio"),e.radioValue="t"===a.value,a.setAttribute("checked","checked"),a.setAttribute("name","t"),h.appendChild(a),s=I.createDocumentFragment(),s.appendChild(h.lastChild),e.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,e.appendChecked=a.checked,s.removeChild(a),s.appendChild(h),h.attachEvent)for(u in{submit:!0,change:!0,focusin:!0})l="on"+u,c=l in h,c||(h.setAttribute(l,"return;"),c="function"==typeof h[l]),e[u+"Bubbles"]=c;return K(function(){var n,i,r,o,a="padding:0;margin:0;border:0;display:block;overflow:hidden;",s=I.getElementsByTagName("body")[0];s&&(n=I.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",s.insertBefore(n,s.firstChild),i=I.createElement("div"),n.appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",r=i.getElementsByTagName("td"),r[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===r[0].offsetHeight,r[0].style.display="",r[1].style.display="none",e.reliableHiddenOffsets=c&&0===r[0].offsetHeight,i.innerHTML="",i.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",e.boxSizing=4===i.offsetWidth,e.doesNotIncludeMarginInBodyOffset=1!==s.offsetTop,t.getComputedStyle&&(e.pixelPosition="1%"!==(t.getComputedStyle(i,null)||{}).top,e.boxSizingReliable="4px"===(t.getComputedStyle(i,null)||{width:"4px"}).width,o=I.createElement("div"),o.style.cssText=i.style.cssText=a,o.style.marginRight=o.style.width="0",i.style.width="1px",i.appendChild(o),e.reliableMarginRight=!parseFloat((t.getComputedStyle(o,null)||{}).marginRight)),"undefined"!=typeof i.style.zoom&&(i.innerHTML="",i.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1",e.inlineBlockNeedsLayout=3===i.offsetWidth,i.style.display="block",i.style.overflow="visible",i.innerHTML="<div></div>",i.firstChild.style.width="5px",e.shrinkWrapBlocks=3!==i.offsetWidth,n.style.zoom=1),s.removeChild(n),n=i=r=o=null)}),s.removeChild(h),n=i=r=o=a=s=h=null,e}();var fe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,me=/([A-Z])/g;K.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(K.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return t=t.nodeType?K.cache[t[K.expando]]:t[K.expando],!!t&&!r(t)},data:function(t,n,i,r){if(K.acceptData(t)){var o,a,s=K.expando,l="string"==typeof n,u=t.nodeType,c=u?K.cache:t,d=u?t[s]:t[s]&&s;if(d&&c[d]&&(r||c[d].data)||!l||i!==e)return d||(u?t[s]=d=K.deletedIds.pop()||++K.uuid:d=s),c[d]||(c[d]={},u||(c[d].toJSON=K.noop)),("object"==typeof n||"function"==typeof n)&&(r?c[d]=K.extend(c[d],n):c[d].data=K.extend(c[d].data,n)),o=c[d],r||(o.data||(o.data={}),o=o.data),i!==e&&(o[K.camelCase(n)]=i),l?(a=o[n],null==a&&(a=o[K.camelCase(n)])):a=o,a}},removeData:function(t,e,n){if(K.acceptData(t)){var i,o,a,s=t.nodeType,l=s?K.cache:t,u=s?t[K.expando]:K.expando;if(l[u]){if(e&&(i=n?l[u]:l[u].data)){K.isArray(e)||(e in i?e=[e]:(e=K.camelCase(e),e=e in i?[e]:e.split(" ")));for(o=0,a=e.length;a>o;o++)delete i[e[o]];if(!(n?r:K.isEmptyObject)(i))return}(n||(delete l[u].data,r(l[u])))&&(s?K.cleanData([t],!0):K.support.deleteExpando||l!=l.window?delete l[u]:l[u]=null)}}},_data:function(t,e,n){return K.data(t,e,n,!0)},acceptData:function(t){var e=t.nodeName&&K.noData[t.nodeName.toLowerCase()];return!e||e!==!0&&t.getAttribute("classid")===e}}),K.fn.extend({data:function(t,n){var r,o,a,s,l,u=this[0],c=0,d=null;if(t===e){if(this.length&&(d=K.data(u),1===u.nodeType&&!K._data(u,"parsedAttrs"))){for(a=u.attributes,l=a.length;l>c;c++)s=a[c].name,0===s.indexOf("data-")&&(s=K.camelCase(s.substring(5)),i(u,s,d[s]));K._data(u,"parsedAttrs",!0)}return d}return"object"==typeof t?this.each(function(){K.data(this,t)}):(r=t.split(".",2),r[1]=r[1]?"."+r[1]:"",o=r[1]+"!",K.access(this,function(n){return n===e?(d=this.triggerHandler("getData"+o,[r[0]]),d===e&&u&&(d=K.data(u,t),d=i(u,t,d)),d===e&&r[1]?this.data(r[0]):d):(r[1]=n,this.each(function(){var e=K(this);e.triggerHandler("setData"+o,r),K.data(this,t,n),e.triggerHandler("changeData"+o,r)}),void 0)},null,n,arguments.length>1,null,!1))},removeData:function(t){return this.each(function(){K.removeData(this,t)})}}),K.extend({queue:function(t,e,n){var i;return t?(e=(e||"fx")+"queue",i=K._data(t,e),n&&(!i||K.isArray(n)?i=K._data(t,e,K.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(t,e){e=e||"fx";var n=K.queue(t,e),i=n.length,r=n.shift(),o=K._queueHooks(t,e),a=function(){K.dequeue(t,e)};"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===e&&n.unshift("inprogress"),delete o.stop,r.call(t,a,o)),!i&&o&&o.empty.fire()},_queueHooks:function(t,e){var n=e+"queueHooks";return K._data(t,n)||K._data(t,n,{empty:K.Callbacks("once memory").add(function(){K.removeData(t,e+"queue",!0),K.removeData(t,n,!0)})})}}),K.fn.extend({queue:function(t,n){var i=2;return"string"!=typeof t&&(n=t,t="fx",i--),arguments.length<i?K.queue(this[0],t):n===e?this:this.each(function(){var e=K.queue(this,t,n);K._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&K.dequeue(this,t)})},dequeue:function(t){return this.each(function(){K.dequeue(this,t)})},delay:function(t,e){return t=K.fx?K.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,n){var i=setTimeout(e,t);n.stop=function(){clearTimeout(i)}})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,n){var i,r=1,o=K.Deferred(),a=this,s=this.length,l=function(){--r||o.resolveWith(a,[a])};for("string"!=typeof t&&(n=t,t=e),t=t||"fx";s--;)i=K._data(a[s],t+"queueHooks"),i&&i.empty&&(r++,i.empty.add(l));return l(),o.promise(n)}});var ge,ve,be,ye=/[\t\r\n]/g,we=/\r/g,ke=/^(?:button|input)$/i,$e=/^(?:button|input|object|select|textarea)$/i,xe=/^a(?:rea|)$/i,Ce=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,qe=K.support.getSetAttribute;K.fn.extend({attr:function(t,e){return K.access(this,K.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){K.removeAttr(this,t)})},prop:function(t,e){return K.access(this,K.prop,t,e,arguments.length>1)},removeProp:function(t){return t=K.propFix[t]||t,this.each(function(){try{this[t]=e,delete this[t]}catch(n){}})},addClass:function(t){var e,n,i,r,o,a,s;if(K.isFunction(t))return this.each(function(e){K(this).addClass(t.call(this,e,this.className))});if(t&&"string"==typeof t)for(e=t.split(ee),n=0,i=this.length;i>n;n++)if(r=this[n],1===r.nodeType)if(r.className||1!==e.length){for(o=" "+r.className+" ",a=0,s=e.length;s>a;a++)~o.indexOf(" "+e[a]+" ")||(o+=e[a]+" ");r.className=K.trim(o)}else r.className=t;return this},removeClass:function(t){var n,i,r,o,a,s,l;if(K.isFunction(t))return this.each(function(e){K(this).removeClass(t.call(this,e,this.className))});if(t&&"string"==typeof t||t===e)for(n=(t||"").split(ee),s=0,l=this.length;l>s;s++)if(r=this[s],1===r.nodeType&&r.className){for(i=(" "+r.className+" ").replace(ye," "),o=0,a=n.length;a>o;o++)for(;i.indexOf(" "+n[o]+" ")>-1;)i=i.replace(" "+n[o]+" "," ");r.className=t?K.trim(i):""}return this},toggleClass:function(t,e){var n=typeof t,i="boolean"==typeof e;return K.isFunction(t)?this.each(function(n){K(this).toggleClass(t.call(this,n,this.className,e),e)}):this.each(function(){if("string"===n)for(var r,o=0,a=K(this),s=e,l=t.split(ee);r=l[o++];)s=i?s:!a.hasClass(r),a[s?"addClass":"removeClass"](r);else("undefined"===n||"boolean"===n)&&(this.className&&K._data(this,"__className__",this.className),this.className=this.className||t===!1?"":K._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ye," ").indexOf(e)>-1)return!0;return!1},val:function(t){var n,i,r,o=this[0];{if(arguments.length)return r=K.isFunction(t),this.each(function(i){var o,a=K(this);1===this.nodeType&&(o=r?t.call(this,i,a.val()):t,null==o?o="":"number"==typeof o?o+="":K.isArray(o)&&(o=K.map(o,function(t){return null==t?"":t+""})),n=K.valHooks[this.type]||K.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,o,"value")!==e||(this.value=o))});if(o)return n=K.valHooks[o.type]||K.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(i=n.get(o,"value"))!==e?i:(i=o.value,"string"==typeof i?i.replace(we,""):null==i?"":i)}}}),K.extend({valHooks:{option:{get:function(t){var e=t.attributes.value;return!e||e.specified?t.value:t.text}},select:{get:function(t){var e,n,i,r,o=t.selectedIndex,a=[],s=t.options,l="select-one"===t.type;if(0>o)return null;for(n=l?o:0,i=l?o+1:s.length;i>n;n++)if(r=s[n],!(!r.selected||(K.support.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&K.nodeName(r.parentNode,"optgroup"))){if(e=K(r).val(),l)return e;a.push(e)}return l&&!a.length&&s.length?K(s[o]).val():a},set:function(t,e){var n=K.makeArray(e);return K(t).find("option").each(function(){this.selected=K.inArray(K(this).val(),n)>=0}),n.length||(t.selectedIndex=-1),n}}},attrFn:{},attr:function(t,n,i,r){var o,a,s,l=t.nodeType;if(t&&3!==l&&8!==l&&2!==l)return r&&K.isFunction(K.fn[n])?K(t)[n](i):"undefined"==typeof t.getAttribute?K.prop(t,n,i):(s=1!==l||!K.isXMLDoc(t),s&&(n=n.toLowerCase(),a=K.attrHooks[n]||(Ce.test(n)?ve:ge)),i!==e?null===i?(K.removeAttr(t,n),void 0):a&&"set"in a&&s&&(o=a.set(t,i,n))!==e?o:(t.setAttribute(n,""+i),i):a&&"get"in a&&s&&null!==(o=a.get(t,n))?o:(o=t.getAttribute(n),null===o?e:o))},removeAttr:function(t,e){var n,i,r,o,a=0;if(e&&1===t.nodeType)for(i=e.split(ee);a<i.length;a++)r=i[a],r&&(n=K.propFix[r]||r,o=Ce.test(r),o||K.attr(t,r,""),t.removeAttribute(qe?r:n),o&&n in t&&(t[n]=!1))},attrHooks:{type:{set:function(t,e){if(ke.test(t.nodeName)&&t.parentNode)K.error("type property can't be changed");else if(!K.support.radioValue&&"radio"===e&&K.nodeName(t,"input")){var n=t.value;return t.setAttribute("type",e),n&&(t.value=n),e}}},value:{get:function(t,e){return ge&&K.nodeName(t,"button")?ge.get(t,e):e in t?t.value:null},set:function(t,e,n){return ge&&K.nodeName(t,"button")?ge.set(t,e,n):(t.value=e,void 0)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(t,n,i){var r,o,a,s=t.nodeType;if(t&&3!==s&&8!==s&&2!==s)return a=1!==s||!K.isXMLDoc(t),a&&(n=K.propFix[n]||n,o=K.propHooks[n]),i!==e?o&&"set"in o&&(r=o.set(t,i,n))!==e?r:t[n]=i:o&&"get"in o&&null!==(r=o.get(t,n))?r:t[n]},propHooks:{tabIndex:{get:function(t){var n=t.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$e.test(t.nodeName)||xe.test(t.nodeName)&&t.href?0:e}}}}),ve={get:function(t,n){var i,r=K.prop(t,n);return r===!0||"boolean"!=typeof r&&(i=t.getAttributeNode(n))&&i.nodeValue!==!1?n.toLowerCase():e},set:function(t,e,n){var i;return e===!1?K.removeAttr(t,n):(i=K.propFix[n]||n,i in t&&(t[i]=!0),t.setAttribute(n,n.toLowerCase())),n}},qe||(be={name:!0,id:!0,coords:!0},ge=K.valHooks.button={get:function(t,n){var i;return i=t.getAttributeNode(n),i&&(be[n]?""!==i.value:i.specified)?i.value:e},set:function(t,e,n){var i=t.getAttributeNode(n);return i||(i=I.createAttribute(n),t.setAttributeNode(i)),i.value=e+""}},K.each(["width","height"],function(t,e){K.attrHooks[e]=K.extend(K.attrHooks[e],{set:function(t,n){return""===n?(t.setAttribute(e,"auto"),n):void 0}})}),K.attrHooks.contenteditable={get:ge.get,set:function(t,e,n){""===e&&(e="false"),ge.set(t,e,n)}}),K.support.hrefNormalized||K.each(["href","src","width","height"],function(t,n){K.attrHooks[n]=K.extend(K.attrHooks[n],{get:function(t){var i=t.getAttribute(n,2);return null===i?e:i}})}),K.support.style||(K.attrHooks.style={get:function(t){return t.style.cssText.toLowerCase()||e},set:function(t,e){return t.style.cssText=""+e}}),K.support.optSelected||(K.propHooks.selected=K.extend(K.propHooks.selected,{get:function(t){var e=t.parentNode;return e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex),null}})),K.support.enctype||(K.propFix.enctype="encoding"),K.support.checkOn||K.each(["radio","checkbox"],function(){K.valHooks[this]={get:function(t){return null===t.getAttribute("value")?"on":t.value
}}}),K.each(["radio","checkbox"],function(){K.valHooks[this]=K.extend(K.valHooks[this],{set:function(t,e){return K.isArray(e)?t.checked=K.inArray(K(t).val(),e)>=0:void 0}})});var Te=/^(?:textarea|input|select)$/i,Se=/^([^\.]*|)(?:\.(.+)|)$/,Ee=/(?:^|\s)hover(\.\S+|)\b/,De=/^key/,Me=/^(?:mouse|contextmenu)|click/,Ae=/^(?:focusinfocus|focusoutblur)$/,Ne=function(t){return K.event.special.hover?t:t.replace(Ee,"mouseenter$1 mouseleave$1")};K.event={add:function(t,n,i,r,o){var a,s,l,u,c,d,h,p,_,f,m;if(3!==t.nodeType&&8!==t.nodeType&&n&&i&&(a=K._data(t))){for(i.handler&&(_=i,i=_.handler,o=_.selector),i.guid||(i.guid=K.guid++),l=a.events,l||(a.events=l={}),s=a.handle,s||(a.handle=s=function(t){return"undefined"==typeof K||t&&K.event.triggered===t.type?e:K.event.dispatch.apply(s.elem,arguments)},s.elem=t),n=K.trim(Ne(n)).split(" "),u=0;u<n.length;u++)c=Se.exec(n[u])||[],d=c[1],h=(c[2]||"").split(".").sort(),m=K.event.special[d]||{},d=(o?m.delegateType:m.bindType)||d,m=K.event.special[d]||{},p=K.extend({type:d,origType:c[1],data:r,handler:i,guid:i.guid,selector:o,namespace:h.join(".")},_),f=l[d],f||(f=l[d]=[],f.delegateCount=0,m.setup&&m.setup.call(t,r,h,s)!==!1||(t.addEventListener?t.addEventListener(d,s,!1):t.attachEvent&&t.attachEvent("on"+d,s))),m.add&&(m.add.call(t,p),p.handler.guid||(p.handler.guid=i.guid)),o?f.splice(f.delegateCount++,0,p):f.push(p),K.event.global[d]=!0;t=null}},global:{},remove:function(t,e,n,i,r){var o,a,s,l,u,c,d,h,p,_,f,m=K.hasData(t)&&K._data(t);if(m&&(h=m.events)){for(e=K.trim(Ne(e||"")).split(" "),o=0;o<e.length;o++)if(a=Se.exec(e[o])||[],s=l=a[1],u=a[2],s){for(p=K.event.special[s]||{},s=(i?p.delegateType:p.bindType)||s,_=h[s]||[],c=_.length,u=u?new RegExp("(^|\\.)"+u.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d=0;d<_.length;d++)f=_[d],!r&&l!==f.origType||n&&n.guid!==f.guid||u&&!u.test(f.namespace)||i&&i!==f.selector&&("**"!==i||!f.selector)||(_.splice(d--,1),f.selector&&_.delegateCount--,p.remove&&p.remove.call(t,f));0===_.length&&c!==_.length&&(p.teardown&&p.teardown.call(t,u,m.handle)!==!1||K.removeEvent(t,s,m.handle),delete h[s])}else for(s in h)K.event.remove(t,s+e[o],n,i,!0);K.isEmptyObject(h)&&(delete m.handle,K.removeData(t,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,i,r,o){if(!r||3!==r.nodeType&&8!==r.nodeType){var a,s,l,u,c,d,h,p,_,f,m=n.type||n,g=[];if(!Ae.test(m+K.event.triggered)&&(m.indexOf("!")>=0&&(m=m.slice(0,-1),s=!0),m.indexOf(".")>=0&&(g=m.split("."),m=g.shift(),g.sort()),r&&!K.event.customEvent[m]||K.event.global[m]))if(n="object"==typeof n?n[K.expando]?n:new K.Event(m,n):new K.Event(m),n.type=m,n.isTrigger=!0,n.exclusive=s,n.namespace=g.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d=m.indexOf(":")<0?"on"+m:"",r){if(n.result=e,n.target||(n.target=r),i=null!=i?K.makeArray(i):[],i.unshift(n),h=K.event.special[m]||{},!h.trigger||h.trigger.apply(r,i)!==!1){if(_=[[r,h.bindType||m]],!o&&!h.noBubble&&!K.isWindow(r)){for(f=h.delegateType||m,u=Ae.test(f+m)?r:r.parentNode,c=r;u;u=u.parentNode)_.push([u,f]),c=u;c===(r.ownerDocument||I)&&_.push([c.defaultView||c.parentWindow||t,f])}for(l=0;l<_.length&&!n.isPropagationStopped();l++)u=_[l][0],n.type=_[l][1],p=(K._data(u,"events")||{})[n.type]&&K._data(u,"handle"),p&&p.apply(u,i),p=d&&u[d],p&&K.acceptData(u)&&p.apply(u,i)===!1&&n.preventDefault();return n.type=m,o||n.isDefaultPrevented()||h._default&&h._default.apply(r.ownerDocument,i)!==!1||"click"===m&&K.nodeName(r,"a")||!K.acceptData(r)||d&&r[m]&&("focus"!==m&&"blur"!==m||0!==n.target.offsetWidth)&&!K.isWindow(r)&&(c=r[d],c&&(r[d]=null),K.event.triggered=m,r[m](),K.event.triggered=e,c&&(r[d]=c)),n.result}}else{a=K.cache;for(l in a)a[l].events&&a[l].events[m]&&K.event.trigger(n,i,a[l].handle.elem,!0)}}},dispatch:function(n){n=K.event.fix(n||t.event);var i,r,o,a,s,l,u,c,d,h=(K._data(this,"events")||{})[n.type]||[],p=h.delegateCount,_=[].slice.call(arguments),f=!n.exclusive&&!n.namespace,m=K.event.special[n.type]||{},g=[];if(_[0]=n,n.delegateTarget=this,!m.preDispatch||m.preDispatch.call(this,n)!==!1){if(p&&(!n.button||"click"!==n.type))for(o=n.target;o!=this;o=o.parentNode||this)if(o.disabled!==!0||"click"!==n.type){for(s={},u=[],i=0;p>i;i++)c=h[i],d=c.selector,s[d]===e&&(s[d]=K(d,this).index(o)>=0),s[d]&&u.push(c);u.length&&g.push({elem:o,matches:u})}for(h.length>p&&g.push({elem:this,matches:h.slice(p)}),i=0;i<g.length&&!n.isPropagationStopped();i++)for(l=g[i],n.currentTarget=l.elem,r=0;r<l.matches.length&&!n.isImmediatePropagationStopped();r++)c=l.matches[r],(f||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))&&(n.data=c.data,n.handleObj=c,a=((K.event.special[c.origType]||{}).handle||c.handler).apply(l.elem,_),a!==e&&(n.result=a,a===!1&&(n.preventDefault(),n.stopPropagation())));return m.postDispatch&&m.postDispatch.call(this,n),n.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,n){var i,r,o,a=n.button,s=n.fromElement;return null==t.pageX&&null!=n.clientX&&(i=t.target.ownerDocument||I,r=i.documentElement,o=i.body,t.pageX=n.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),t.pageY=n.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),!t.relatedTarget&&s&&(t.relatedTarget=s===t.target?n.toElement:s),t.which||a===e||(t.which=1&a?1:2&a?3:4&a?2:0),t}},fix:function(t){if(t[K.expando])return t;var e,n,i=t,r=K.event.fixHooks[t.type]||{},o=r.props?this.props.concat(r.props):this.props;for(t=K.Event(i),e=o.length;e;)n=o[--e],t[n]=i[n];return t.target||(t.target=i.srcElement||I),3===t.target.nodeType&&(t.target=t.target.parentNode),t.metaKey=!!t.metaKey,r.filter?r.filter(t,i):t},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(t,e,n){K.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(t,e,n,i){var r=K.extend(new K.Event,n,{type:t,isSimulated:!0,originalEvent:{}});i?K.event.trigger(r,null,e):K.event.dispatch.call(e,r),r.isDefaultPrevented()&&n.preventDefault()}},K.event.handle=K.event.dispatch,K.removeEvent=I.removeEventListener?function(t,e,n){t.removeEventListener&&t.removeEventListener(e,n,!1)}:function(t,e,n){var i="on"+e;t.detachEvent&&("undefined"==typeof t[i]&&(t[i]=null),t.detachEvent(i,n))},K.Event=function(t,e){return this instanceof K.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()?a:o):this.type=t,e&&K.extend(this,e),this.timeStamp=t&&t.timeStamp||K.now(),this[K.expando]=!0,void 0):new K.Event(t,e)},K.Event.prototype={preventDefault:function(){this.isDefaultPrevented=a;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=a;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=a,this.stopPropagation()},isDefaultPrevented:o,isPropagationStopped:o,isImmediatePropagationStopped:o},K.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){K.event.special[t]={delegateType:e,bindType:e,handle:function(t){var n,i=this,r=t.relatedTarget,o=t.handleObj;return o.selector,(!r||r!==i&&!K.contains(i,r))&&(t.type=o.origType,n=o.handler.apply(this,arguments),t.type=e),n}}}),K.support.submitBubbles||(K.event.special.submit={setup:function(){return K.nodeName(this,"form")?!1:(K.event.add(this,"click._submit keypress._submit",function(t){var n=t.target,i=K.nodeName(n,"input")||K.nodeName(n,"button")?n.form:e;i&&!K._data(i,"_submit_attached")&&(K.event.add(i,"submit._submit",function(t){t._submit_bubble=!0}),K._data(i,"_submit_attached",!0))}),void 0)},postDispatch:function(t){t._submit_bubble&&(delete t._submit_bubble,this.parentNode&&!t.isTrigger&&K.event.simulate("submit",this.parentNode,t,!0))},teardown:function(){return K.nodeName(this,"form")?!1:(K.event.remove(this,"._submit"),void 0)}}),K.support.changeBubbles||(K.event.special.change={setup:function(){return Te.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(K.event.add(this,"propertychange._change",function(t){"checked"===t.originalEvent.propertyName&&(this._just_changed=!0)}),K.event.add(this,"click._change",function(t){this._just_changed&&!t.isTrigger&&(this._just_changed=!1),K.event.simulate("change",this,t,!0)})),!1):(K.event.add(this,"beforeactivate._change",function(t){var e=t.target;Te.test(e.nodeName)&&!K._data(e,"_change_attached")&&(K.event.add(e,"change._change",function(t){!this.parentNode||t.isSimulated||t.isTrigger||K.event.simulate("change",this.parentNode,t,!0)}),K._data(e,"_change_attached",!0))}),void 0)},handle:function(t){var e=t.target;return this!==e||t.isSimulated||t.isTrigger||"radio"!==e.type&&"checkbox"!==e.type?t.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return K.event.remove(this,"._change"),!Te.test(this.nodeName)}}),K.support.focusinBubbles||K.each({focus:"focusin",blur:"focusout"},function(t,e){var n=0,i=function(t){K.event.simulate(e,t.target,K.event.fix(t),!0)};K.event.special[e]={setup:function(){0===n++&&I.addEventListener(t,i,!0)},teardown:function(){0===--n&&I.removeEventListener(t,i,!0)}}}),K.fn.extend({on:function(t,n,i,r,a){var s,l;if("object"==typeof t){"string"!=typeof n&&(i=i||n,n=e);for(l in t)this.on(l,n,i,t[l],a);return this}if(null==i&&null==r?(r=n,i=n=e):null==r&&("string"==typeof n?(r=i,i=e):(r=i,i=n,n=e)),r===!1)r=o;else if(!r)return this;return 1===a&&(s=r,r=function(t){return K().off(t),s.apply(this,arguments)},r.guid=s.guid||(s.guid=K.guid++)),this.each(function(){K.event.add(this,t,r,i,n)})},one:function(t,e,n,i){return this.on(t,e,n,i,1)},off:function(t,n,i){var r,a;if(t&&t.preventDefault&&t.handleObj)return r=t.handleObj,K(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof t){for(a in t)this.off(a,n,t[a]);return this}return(n===!1||"function"==typeof n)&&(i=n,n=e),i===!1&&(i=o),this.each(function(){K.event.remove(this,t,i,n)})},bind:function(t,e,n){return this.on(t,null,e,n)},unbind:function(t,e){return this.off(t,null,e)},live:function(t,e,n){return K(this.context).on(t,this.selector,e,n),this},die:function(t,e){return K(this.context).off(t,this.selector||"**",e),this},delegate:function(t,e,n,i){return this.on(e,t,n,i)},undelegate:function(t,e,n){return 1==arguments.length?this.off(t,"**"):this.off(e,t||"**",n)},trigger:function(t,e){return this.each(function(){K.event.trigger(t,e,this)})},triggerHandler:function(t,e){return this[0]?K.event.trigger(t,e,this[0],!0):void 0},toggle:function(t){var e=arguments,n=t.guid||K.guid++,i=0,r=function(n){var r=(K._data(this,"lastToggle"+t.guid)||0)%i;return K._data(this,"lastToggle"+t.guid,r+1),n.preventDefault(),e[r].apply(this,arguments)||!1};for(r.guid=n;i<e.length;)e[i++].guid=n;return this.click(r)},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),K.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){K.fn[e]=function(t,n){return null==n&&(n=t,t=null),arguments.length>0?this.on(e,null,t,n):this.trigger(e)},De.test(e)&&(K.event.fixHooks[e]=K.event.keyHooks),Me.test(e)&&(K.event.fixHooks[e]=K.event.mouseHooks)}),/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2012 jQuery Foundation and other contributors
 *  Released under the MIT license
 *  http://sizzlejs.com/
 */
function(t,e){function n(t,e,n,i){n=n||[],e=e||S;var r,o,a,s,l=e.nodeType;if(1!==l&&9!==l)return[];if(!t||"string"!=typeof t)return n;if(a=y(e),!a&&!i&&(r=V.exec(t)))if(s=r[1]){if(9===l){if(o=e.getElementById(s),!o||!o.parentNode)return n;if(o.id===s)return n.push(o),n}else if(e.ownerDocument&&(o=e.ownerDocument.getElementById(s))&&w(e,o)&&o.id===s)return n.push(o),n}else{if(r[2])return A.apply(n,M.call(e.getElementsByTagName(t),0)),n;if((s=r[3])&&se&&e.getElementsByClassName)return A.apply(n,M.call(e.getElementsByClassName(s),0)),n}return _(t,e,n,i,a)}function i(t){return function(e){var n=e.nodeName.toLowerCase();return"input"===n&&e.type===t}}function r(t){return function(e){var n=e.nodeName.toLowerCase();return("input"===n||"button"===n)&&e.type===t}}function o(t,e,n){if(t===e)return n;for(var i=t.nextSibling;i;){if(i===e)return-1;i=i.nextSibling}return 1}function a(t,e,i,r){var o,a,s,l,u,c,d,h,p,_,f=!i&&e!==S,m=(f?"<s>":"")+t.replace(U,"$1<s>"),g=P[T][m];if(g)return r?0:M.call(g,0);for(u=t,c=[],h=0,p=v.preFilter,_=v.filter;u;){(!o||(a=J.exec(u)))&&(a&&(u=u.slice(a[0].length),s.selector=d),c.push(s=[]),d="",f&&(u=" "+u)),o=!1,(a=G.exec(u))&&(d+=a[0],u=u.slice(a[0].length),o=s.push({part:a.pop().replace(U," "),string:a[0],captures:a}));for(l in _)!(a=ne[l].exec(u))||p[l]&&!(a=p[l](a,e,i))||(d+=a[0],u=u.slice(a[0].length),o=s.push({part:l,string:a.shift(),captures:a}));if(!o)break}return d&&(s.selector=d),r?u.length:u?n.error(t):M.call(P(m,c),0)}function s(t,e,n,i){var r=e.dir,o=D++;return t||(t=function(t){return t===n}),e.first?function(e){for(;e=e[r];)if(1===e.nodeType)return t(e)&&e}:i?function(e){for(;e=e[r];)if(1===e.nodeType&&t(e))return e}:function(e){for(var n,i=o+"."+f,a=i+"."+m;e=e[r];)if(1===e.nodeType){if((n=e[T])===a)return e.sizset;if("string"==typeof n&&0===n.indexOf(i)){if(e.sizset)return e}else{if(e[T]=a,t(e))return e.sizset=!0,e;e.sizset=!1}}}}function l(t,e){return t?function(n){var i=e(n);return i&&t(i===!0?n:i)}:e}function u(t,e,n){for(var i,r,o=0;i=t[o];o++)r=v.relative[i.part]?s(r,v.relative[i.part],e,n):l(r,v.filter[i.part].apply(null,i.captures.concat(e,n)));return r}function c(t){return function(e){for(var n,i=0;n=t[i];i++)if(n(e))return!0;return!1}}function d(t,e,i,r){for(var o=0,a=e.length;a>o;o++)n(t,e[o],i,r)}function h(t,e,i,r,o,a){var s,l=v.setFilters[e.toLowerCase()];return l||n.error(e),(t||!(s=o))&&d(t||"*",r,s=[],o),s.length>0?l(s,i,a):[]}function p(t,i,r,o){for(var a,s,l,u,c,p,_,f,m,g,v,b,y,w=0,k=t.length,$=ne.POS,x=new RegExp("^"+$.source+"(?!"+j+")","i"),C=function(){for(var t=1,n=arguments.length-2;n>t;t++)arguments[t]===e&&(m[t]=e)};k>w;w++){for(a=t[w],s="",f=o,l=0,u=a.length;u>l;l++){if(c=a[l],p=c.string,"PSEUDO"===c.part)for($.exec(""),_=0;m=$.exec(p);)g=!0,v=$.lastIndex=m.index+m[0].length,v>_&&(s+=p.slice(_,m.index),_=v,b=[i],G.test(s)&&(f&&(b=f),f=o),(y=X.test(s))&&(s=s.slice(0,-5).replace(G,"$&*"),_++),m.length>1&&m[0].replace(x,C),f=h(s,m[1],m[2],b,f,y)),s="";g||(s+=p),g=!1}s?G.test(s)?d(s,f||[i],r,o):n(s,i,r,o?o.concat(f):f):A.apply(r,f)}return 1===k?r:n.uniqueSort(r)}function _(t,e,n,i,r){t=t.replace(U,"$1");var o,s,l,u,c,d,h,_,g,b=a(t,e,r),y=e.nodeType;if(ne.POS.test(t))return p(b,e,n,i);if(i)o=M.call(i,0);else if(1===b.length){if((c=M.call(b[0],0)).length>2&&"ID"===(d=c[0]).part&&9===y&&!r&&v.relative[c[1].part]){if(e=v.find.ID(d.captures[0].replace(ee,""),e,r)[0],!e)return n;t=t.slice(c.shift().string.length)}for(_=(b=Q.exec(c[0].string))&&!b.index&&e.parentNode||e,h="",u=c.length-1;u>=0&&(d=c[u],g=d.part,h=d.string+h,!v.relative[g]);u--)if(v.order.test(g)){if(o=v.find[g](d.captures[0].replace(ee,""),_,r),null==o)continue;t=t.slice(0,t.length-h.length)+h.replace(ne[g],""),t||A.apply(n,M.call(o,0));break}}if(t)for(s=k(t,e,r),f=s.dirruns++,null==o&&(o=v.find.TAG("*",Q.test(t)&&e.parentNode||e)),u=0;l=o[u];u++)m=s.runs++,s(l)&&n.push(l);return n}var f,m,g,v,b,y,w,k,$,x,C=!0,q="undefined",T=("sizcache"+Math.random()).replace(".",""),S=t.document,E=S.documentElement,D=0,M=[].slice,A=[].push,N=function(t,e){return t[T]=e||!0,t},F=function(){var t={},e=[];return N(function(n,i){return e.push(n)>v.cacheLength&&delete t[e.shift()],t[n]=i},t)},z=F(),P=F(),L=F(),j="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",O=R.replace("w","w#"),I="([*^$|!~]?=)",H="\\["+j+"*("+R+")"+j+"*(?:"+I+j+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+O+")|)|)"+j+"*\\]",B=":("+R+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+H+")|[^:]|\\\\.)*|.*))\\)|)",W=":(nth|eq|gt|lt|first|last|even|odd)(?:\\(((?:-\\d)?\\d*)\\)|)(?=[^-]|$)",U=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),J=new RegExp("^"+j+"*,"+j+"*"),G=new RegExp("^"+j+"*([\\x20\\t\\r\\n\\f>+~])"+j+"*"),Y=new RegExp(B),V=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Q=/[\x20\t\r\n\f]*[+~]/,X=/:not\($/,Z=/h\d/i,te=/input|select|textarea|button/i,ee=/\\(?!\\)/g,ne={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),NAME:new RegExp("^\\[name=['\"]?("+R+")['\"]?\\]"),TAG:new RegExp("^("+R.replace("w","w*")+")"),ATTR:new RegExp("^"+H),PSEUDO:new RegExp("^"+B),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),POS:new RegExp(W,"ig"),needsContext:new RegExp("^"+j+"*[>+~]|"+W,"i")},ie=function(t){var e=S.createElement("div");try{return t(e)}catch(n){return!1}finally{e=null}},re=ie(function(t){return t.appendChild(S.createComment("")),!t.getElementsByTagName("*").length}),oe=ie(function(t){return t.innerHTML="<a href='#'></a>",t.firstChild&&typeof t.firstChild.getAttribute!==q&&"#"===t.firstChild.getAttribute("href")}),ae=ie(function(t){t.innerHTML="<select></select>";var e=typeof t.lastChild.getAttribute("multiple");return"boolean"!==e&&"string"!==e}),se=ie(function(t){return t.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",t.getElementsByClassName&&t.getElementsByClassName("e").length?(t.lastChild.className="e",2===t.getElementsByClassName("e").length):!1}),le=ie(function(t){t.id=T+0,t.innerHTML="<a name='"+T+"'></a><div name='"+T+"'></div>",E.insertBefore(t,E.firstChild);var e=S.getElementsByName&&S.getElementsByName(T).length===2+S.getElementsByName(T+0).length;return g=!S.getElementById(T),E.removeChild(t),e});try{M.call(E.childNodes,0)[0].nodeType}catch(ue){M=function(t){for(var e,n=[];e=this[t];t++)n.push(e);return n}}n.matches=function(t,e){return n(t,null,null,e)},n.matchesSelector=function(t,e){return n(e,null,null,[t]).length>0},b=n.getText=function(t){var e,n="",i=0,r=t.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=b(t)}else if(3===r||4===r)return t.nodeValue}else for(;e=t[i];i++)n+=b(e);return n},y=n.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},w=n.contains=E.contains?function(t,e){var n=9===t.nodeType?t.documentElement:t,i=e&&e.parentNode;return t===i||!!(i&&1===i.nodeType&&n.contains&&n.contains(i))}:E.compareDocumentPosition?function(t,e){return e&&!!(16&t.compareDocumentPosition(e))}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},n.attr=function(t,e){var n,i=y(t);return i||(e=e.toLowerCase()),v.attrHandle[e]?v.attrHandle[e](t):ae||i?t.getAttribute(e):(n=t.getAttributeNode(e),n?"boolean"==typeof t[e]?t[e]?e:null:n.specified?n.value:null:null)},v=n.selectors={cacheLength:50,createPseudo:N,match:ne,order:new RegExp("ID|TAG"+(le?"|NAME":"")+(se?"|CLASS":"")),attrHandle:oe?{}:{href:function(t){return t.getAttribute("href",2)},type:function(t){return t.getAttribute("type")}},find:{ID:g?function(t,e,n){if(typeof e.getElementById!==q&&!n){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}}:function(t,n,i){if(typeof n.getElementById!==q&&!i){var r=n.getElementById(t);return r?r.id===t||typeof r.getAttributeNode!==q&&r.getAttributeNode("id").value===t?[r]:e:[]}},TAG:re?function(t,e){return typeof e.getElementsByTagName!==q?e.getElementsByTagName(t):void 0}:function(t,e){var n=e.getElementsByTagName(t);if("*"===t){for(var i,r=[],o=0;i=n[o];o++)1===i.nodeType&&r.push(i);return r}return n},NAME:function(t,e){return typeof e.getElementsByName!==q?e.getElementsByName(name):void 0},CLASS:function(t,e,n){return typeof e.getElementsByClassName===q||n?void 0:e.getElementsByClassName(t)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(ee,""),t[3]=(t[4]||t[5]||"").replace(ee,""),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1]?(t[2]||n.error(t[0]),t[3]=+(t[3]?t[4]+(t[5]||1):2*("even"===t[2]||"odd"===t[2])),t[4]=+(t[6]+t[7]||"odd"===t[2])):t[2]&&n.error(t[0]),t},PSEUDO:function(t,e,n){var i,r;return ne.CHILD.test(t[0])?null:(t[3]?t[2]=t[3]:(i=t[4])&&(Y.test(i)&&(r=a(i,e,n,!0))&&(r=i.indexOf(")",i.length-r)-i.length)&&(i=i.slice(0,r),t[0]=t[0].slice(0,r)),t[2]=i),t.slice(0,3))}},filter:{ID:g?function(t){return t=t.replace(ee,""),function(e){return e.getAttribute("id")===t}}:function(t){return t=t.replace(ee,""),function(e){var n=typeof e.getAttributeNode!==q&&e.getAttributeNode("id");return n&&n.value===t}},TAG:function(t){return"*"===t?function(){return!0}:(t=t.replace(ee,"").toLowerCase(),function(e){return e.nodeName&&e.nodeName.toLowerCase()===t})},CLASS:function(t){var e=z[T][t];return e||(e=z(t,new RegExp("(^|"+j+")"+t+"("+j+"|$)"))),function(t){return e.test(t.className||typeof t.getAttribute!==q&&t.getAttribute("class")||"")}},ATTR:function(t,e,i){return e?function(r){var o=n.attr(r,t),a=o+"";if(null==o)return"!="===e;switch(e){case"=":return a===i;case"!=":return a!==i;case"^=":return i&&0===a.indexOf(i);case"*=":return i&&a.indexOf(i)>-1;case"$=":return i&&a.substr(a.length-i.length)===i;case"~=":return(" "+a+" ").indexOf(i)>-1;case"|=":return a===i||a.substr(0,i.length+1)===i+"-"}}:function(e){return null!=n.attr(e,t)}},CHILD:function(t,e,n,i){if("nth"===t){var r=D++;return function(t){var e,o,a=0,s=t;if(1===n&&0===i)return!0;if(e=t.parentNode,e&&(e[T]!==r||!t.sizset)){for(s=e.firstChild;s&&(1!==s.nodeType||(s.sizset=++a,s!==t));s=s.nextSibling);e[T]=r}return o=t.sizset-i,0===n?0===o:0===o%n&&o/n>=0}}return function(e){var n=e;switch(t){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"===t)return!0;n=e;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0}}},PSEUDO:function(t,e,i,r){var o,a=v.pseudos[t]||v.pseudos[t.toLowerCase()];return a||n.error("unsupported pseudo: "+t),a[T]?a(e,i,r):a.length>1?(o=[t,t,"",e],function(t){return a(t,0,o)}):a}},pseudos:{not:N(function(t,e,n){var i=k(t.replace(U,"$1"),e,n);return function(t){return!i(t)}}),enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},parent:function(t){return!v.pseudos.empty(t)},empty:function(t){var e;for(t=t.firstChild;t;){if(t.nodeName>"@"||3===(e=t.nodeType)||4===e)return!1;t=t.nextSibling}return!0},contains:N(function(t){return function(e){return(e.textContent||e.innerText||b(e)).indexOf(t)>-1}}),has:N(function(t){return function(e){return n(t,e).length>0}}),header:function(t){return Z.test(t.nodeName)},text:function(t){var e,n;return"input"===t.nodeName.toLowerCase()&&"text"===(e=t.type)&&(null==(n=t.getAttribute("type"))||n.toLowerCase()===e)},radio:i("radio"),checkbox:i("checkbox"),file:i("file"),password:i("password"),image:i("image"),submit:r("submit"),reset:r("reset"),button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},input:function(t){return te.test(t.nodeName)},focus:function(t){var e=t.ownerDocument;return!(t!==e.activeElement||e.hasFocus&&!e.hasFocus()||!t.type&&!t.href)},active:function(t){return t===t.ownerDocument.activeElement}},setFilters:{first:function(t,e,n){return n?t.slice(1):[t[0]]},last:function(t,e,n){var i=t.pop();return n?t:[i]},even:function(t,e,n){for(var i=[],r=n?1:0,o=t.length;o>r;r+=2)i.push(t[r]);return i},odd:function(t,e,n){for(var i=[],r=n?0:1,o=t.length;o>r;r+=2)i.push(t[r]);return i},lt:function(t,e,n){return n?t.slice(+e):t.slice(0,+e)},gt:function(t,e,n){return n?t.slice(0,+e+1):t.slice(+e+1)},eq:function(t,e,n){var i=t.splice(+e,1);return n?t:i}}},$=E.compareDocumentPosition?function(t,e){return t===e?(x=!0,0):(t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e):t.compareDocumentPosition)?-1:1}:function(t,e){if(t===e)return x=!0,0;if(t.sourceIndex&&e.sourceIndex)return t.sourceIndex-e.sourceIndex;var n,i,r=[],a=[],s=t.parentNode,l=e.parentNode,u=s;if(s===l)return o(t,e);if(!s)return-1;if(!l)return 1;for(;u;)r.unshift(u),u=u.parentNode;for(u=l;u;)a.unshift(u),u=u.parentNode;n=r.length,i=a.length;for(var c=0;n>c&&i>c;c++)if(r[c]!==a[c])return o(r[c],a[c]);return c===n?o(t,a[c],-1):o(r[c],e,1)},[0,0].sort($),C=!x,n.uniqueSort=function(t){var e,n=1;if(x=C,t.sort($),x)for(;e=t[n];n++)e===t[n-1]&&t.splice(n--,1);return t},n.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},k=n.compile=function(t,e,n){var i,r,o,s=L[T][t];if(s&&s.context===e)return s;for(i=a(t,e,n),r=0,o=i.length;o>r;r++)i[r]=u(i[r],e,n);return s=L(t,c(i)),s.context=e,s.runs=s.dirruns=0,s},S.querySelectorAll&&!function(){var t,e=_,i=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,o=[],s=[":active"],l=E.matchesSelector||E.mozMatchesSelector||E.webkitMatchesSelector||E.oMatchesSelector||E.msMatchesSelector;ie(function(t){t.innerHTML="<select><option selected=''></option></select>",t.querySelectorAll("[selected]").length||o.push("\\["+j+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),t.querySelectorAll(":checked").length||o.push(":checked")}),ie(function(t){t.innerHTML="<p test=''></p>",t.querySelectorAll("[test^='']").length&&o.push("[*^$]="+j+"*(?:\"\"|'')"),t.innerHTML="<input type='hidden'/>",t.querySelectorAll(":enabled").length||o.push(":enabled",":disabled")}),o=o.length&&new RegExp(o.join("|")),_=function(t,n,r,s,l){if(!(s||l||o&&o.test(t)))if(9===n.nodeType)try{return A.apply(r,M.call(n.querySelectorAll(t),0)),r}catch(u){}else if(1===n.nodeType&&"object"!==n.nodeName.toLowerCase()){var c,d,h,p=n.getAttribute("id"),_=p||T,f=Q.test(t)&&n.parentNode||n;for(p?_=_.replace(i,"\\$&"):n.setAttribute("id",_),c=a(t,n,l),_="[id='"+_+"']",d=0,h=c.length;h>d;d++)c[d]=_+c[d].selector;try{return A.apply(r,M.call(f.querySelectorAll(c.join(",")),0)),r}catch(u){}finally{p||n.removeAttribute("id")}}return e(t,n,r,s,l)},l&&(ie(function(e){t=l.call(e,"div");try{l.call(e,"[test!='']:sizzle"),s.push(ne.PSEUDO.source,ne.POS.source,"!=")}catch(n){}}),s=new RegExp(s.join("|")),n.matchesSelector=function(e,i){if(i=i.replace(r,"='$1']"),!(y(e)||s.test(i)||o&&o.test(i)))try{var a=l.call(e,i);if(a||t||e.document&&11!==e.document.nodeType)return a}catch(u){}return n(i,null,null,[e]).length>0})}(),v.setFilters.nth=v.setFilters.eq,v.filters=v.pseudos,n.attr=K.attr,K.find=n,K.expr=n.selectors,K.expr[":"]=K.expr.pseudos,K.unique=n.uniqueSort,K.text=n.getText,K.isXMLDoc=n.isXML,K.contains=n.contains}(t);var Fe=/Until$/,ze=/^(?:parents|prev(?:Until|All))/,Pe=/^.[^:#\[\.,]*$/,Le=K.expr.match.needsContext,je={children:!0,contents:!0,next:!0,prev:!0};K.fn.extend({find:function(t){var e,n,i,r,o,a,s=this;if("string"!=typeof t)return K(t).filter(function(){for(e=0,n=s.length;n>e;e++)if(K.contains(s[e],this))return!0});for(a=this.pushStack("","find",t),e=0,n=this.length;n>e;e++)if(i=a.length,K.find(t,this[e],a),e>0)for(r=i;r<a.length;r++)for(o=0;i>o;o++)if(a[o]===a[r]){a.splice(r--,1);break}return a},has:function(t){var e,n=K(t,this),i=n.length;return this.filter(function(){for(e=0;i>e;e++)if(K.contains(this,n[e]))return!0})},not:function(t){return this.pushStack(u(this,t,!1),"not",t)},filter:function(t){return this.pushStack(u(this,t,!0),"filter",t)},is:function(t){return!!t&&("string"==typeof t?Le.test(t)?K(t,this.context).index(this[0])>=0:K.filter(t,this).length>0:this.filter(t).length>0)},closest:function(t,e){for(var n,i=0,r=this.length,o=[],a=Le.test(t)||"string"!=typeof t?K(t,e||this.context):0;r>i;i++)for(n=this[i];n&&n.ownerDocument&&n!==e&&11!==n.nodeType;){if(a?a.index(n)>-1:K.find.matchesSelector(n,t)){o.push(n);break}n=n.parentNode}return o=o.length>1?K.unique(o):o,this.pushStack(o,"closest",t)},index:function(t){return t?"string"==typeof t?K.inArray(this[0],K(t)):K.inArray(t.jquery?t[0]:t,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(t,e){var n="string"==typeof t?K(t,e):K.makeArray(t&&t.nodeType?[t]:t),i=K.merge(this.get(),n);return this.pushStack(s(n[0])||s(i[0])?i:K.unique(i))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),K.fn.andSelf=K.fn.addBack,K.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return K.dir(t,"parentNode")},parentsUntil:function(t,e,n){return K.dir(t,"parentNode",n)},next:function(t){return l(t,"nextSibling")},prev:function(t){return l(t,"previousSibling")},nextAll:function(t){return K.dir(t,"nextSibling")},prevAll:function(t){return K.dir(t,"previousSibling")},nextUntil:function(t,e,n){return K.dir(t,"nextSibling",n)},prevUntil:function(t,e,n){return K.dir(t,"previousSibling",n)},siblings:function(t){return K.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return K.sibling(t.firstChild)},contents:function(t){return K.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:K.merge([],t.childNodes)}},function(t,e){K.fn[t]=function(n,i){var r=K.map(this,e,n);return Fe.test(t)||(i=n),i&&"string"==typeof i&&(r=K.filter(i,r)),r=this.length>1&&!je[t]?K.unique(r):r,this.length>1&&ze.test(t)&&(r=r.reverse()),this.pushStack(r,t,G.call(arguments).join(","))}}),K.extend({filter:function(t,e,n){return n&&(t=":not("+t+")"),1===e.length?K.find.matchesSelector(e[0],t)?[e[0]]:[]:K.find.matches(t,e)},dir:function(t,n,i){for(var r=[],o=t[n];o&&9!==o.nodeType&&(i===e||1!==o.nodeType||!K(o).is(i));)1===o.nodeType&&r.push(o),o=o[n];return r},sibling:function(t,e){for(var n=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&n.push(t);return n}});var Re="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Oe=/ jQuery\d+="(?:null|\d+)"/g,Ie=/^\s+/,He=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Be=/<([\w:]+)/,We=/<tbody/i,Ue=/<|&#?\w+;/,Je=/<(?:script|style|link)/i,Ge=/<(?:script|object|embed|option|style)/i,Ye=new RegExp("<(?:"+Re+")[\\s/>]","i"),Ve=/^(?:checkbox|radio)$/,Qe=/checked\s*(?:[^=]|=\s*.checked.)/i,Xe=/\/(java|ecma)script/i,Ke=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Ze={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},tn=c(I),en=tn.appendChild(I.createElement("div"));Ze.optgroup=Ze.option,Ze.tbody=Ze.tfoot=Ze.colgroup=Ze.caption=Ze.thead,Ze.th=Ze.td,K.support.htmlSerialize||(Ze._default=[1,"X<div>","</div>"]),K.fn.extend({text:function(t){return K.access(this,function(t){return t===e?K.text(this):this.empty().append((this[0]&&this[0].ownerDocument||I).createTextNode(t))},null,t,arguments.length)},wrapAll:function(t){if(K.isFunction(t))return this.each(function(e){K(this).wrapAll(t.call(this,e))});if(this[0]){var e=K(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return K.isFunction(t)?this.each(function(e){K(this).wrapInner(t.call(this,e))}):this.each(function(){var e=K(this),n=e.contents();n.length?n.wrapAll(t):e.append(t)})},wrap:function(t){var e=K.isFunction(t);return this.each(function(n){K(this).wrapAll(e?t.call(this,n):t)})},unwrap:function(){return this.parent().each(function(){K.nodeName(this,"body")||K(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){(1===this.nodeType||11===this.nodeType)&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(t,this.firstChild)})},before:function(){if(!s(this[0]))return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=K.clean(arguments);return this.pushStack(K.merge(t,this),"before",this.selector)}},after:function(){if(!s(this[0]))return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=K.clean(arguments);return this.pushStack(K.merge(this,t),"after",this.selector)}},remove:function(t,e){for(var n,i=0;null!=(n=this[i]);i++)(!t||K.filter(t,[n]).length)&&(e||1!==n.nodeType||(K.cleanData(n.getElementsByTagName("*")),K.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&K.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return K.clone(this,t,e)})},html:function(t){return K.access(this,function(t){var n=this[0]||{},i=0,r=this.length;if(t===e)return 1===n.nodeType?n.innerHTML.replace(Oe,""):e;if(!("string"!=typeof t||Je.test(t)||!K.support.htmlSerialize&&Ye.test(t)||!K.support.leadingWhitespace&&Ie.test(t)||Ze[(Be.exec(t)||["",""])[1].toLowerCase()])){t=t.replace(He,"<$1></$2>");try{for(;r>i;i++)n=this[i]||{},1===n.nodeType&&(K.cleanData(n.getElementsByTagName("*")),n.innerHTML=t);n=0}catch(o){}}n&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(t){return s(this[0])?this.length?this.pushStack(K(K.isFunction(t)?t():t),"replaceWith",t):this:K.isFunction(t)?this.each(function(e){var n=K(this),i=n.html();n.replaceWith(t.call(this,e,i))}):("string"!=typeof t&&(t=K(t).detach()),this.each(function(){var e=this.nextSibling,n=this.parentNode;K(this).remove(),e?K(e).before(t):K(n).append(t)}))},detach:function(t){return this.remove(t,!0)},domManip:function(t,n,i){t=[].concat.apply([],t);var r,o,a,s,l=0,u=t[0],c=[],h=this.length;if(!K.support.checkClone&&h>1&&"string"==typeof u&&Qe.test(u))return this.each(function(){K(this).domManip(t,n,i)});if(K.isFunction(u))return this.each(function(r){var o=K(this);t[0]=u.call(this,r,n?o.html():e),o.domManip(t,n,i)});if(this[0]){if(r=K.buildFragment(t,this,c),a=r.fragment,o=a.firstChild,1===a.childNodes.length&&(a=o),o)for(n=n&&K.nodeName(o,"tr"),s=r.cacheable||h-1;h>l;l++)i.call(n&&K.nodeName(this[l],"table")?d(this[l],"tbody"):this[l],l===s?a:K.clone(a,!0,!0));a=o=null,c.length&&K.each(c,function(t,e){e.src?K.ajax?K.ajax({url:e.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):K.error("no ajax"):K.globalEval((e.text||e.textContent||e.innerHTML||"").replace(Ke,"")),e.parentNode&&e.parentNode.removeChild(e)})}return this}}),K.buildFragment=function(t,n,i){var r,o,a,s=t[0];return n=n||I,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,!(1===t.length&&"string"==typeof s&&s.length<512&&n===I&&"<"===s.charAt(0))||Ge.test(s)||!K.support.checkClone&&Qe.test(s)||!K.support.html5Clone&&Ye.test(s)||(o=!0,r=K.fragments[s],a=r!==e),r||(r=n.createDocumentFragment(),K.clean(t,n,r,i),o&&(K.fragments[s]=a&&r)),{fragment:r,cacheable:o}},K.fragments={},K.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){K.fn[t]=function(n){var i,r=0,o=[],a=K(n),s=a.length,l=1===this.length&&this[0].parentNode;if((null==l||l&&11===l.nodeType&&1===l.childNodes.length)&&1===s)return a[e](this[0]),this;for(;s>r;r++)i=(r>0?this.clone(!0):this).get(),K(a[r])[e](i),o=o.concat(i);return this.pushStack(o,t,a.selector)}}),K.extend({clone:function(t,e,n){var i,r,o,a;if(K.support.html5Clone||K.isXMLDoc(t)||!Ye.test("<"+t.nodeName+">")?a=t.cloneNode(!0):(en.innerHTML=t.outerHTML,en.removeChild(a=en.firstChild)),!(K.support.noCloneEvent&&K.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||K.isXMLDoc(t)))for(p(t,a),i=_(t),r=_(a),o=0;i[o];++o)r[o]&&p(i[o],r[o]);if(e&&(h(t,a),n))for(i=_(t),r=_(a),o=0;i[o];++o)h(i[o],r[o]);return i=r=null,a},clean:function(t,e,n,i){var r,o,a,s,l,u,d,h,p,_,m,g=e===I&&tn,v=[];for(e&&"undefined"!=typeof e.createDocumentFragment||(e=I),r=0;null!=(a=t[r]);r++)if("number"==typeof a&&(a+=""),a){if("string"==typeof a)if(Ue.test(a)){for(g=g||c(e),d=e.createElement("div"),g.appendChild(d),a=a.replace(He,"<$1></$2>"),s=(Be.exec(a)||["",""])[1].toLowerCase(),l=Ze[s]||Ze._default,u=l[0],d.innerHTML=l[1]+a+l[2];u--;)d=d.lastChild;if(!K.support.tbody)for(h=We.test(a),p="table"!==s||h?"<table>"!==l[1]||h?[]:d.childNodes:d.firstChild&&d.firstChild.childNodes,o=p.length-1;o>=0;--o)K.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o]);!K.support.leadingWhitespace&&Ie.test(a)&&d.insertBefore(e.createTextNode(Ie.exec(a)[0]),d.firstChild),a=d.childNodes,d.parentNode.removeChild(d)}else a=e.createTextNode(a);a.nodeType?v.push(a):K.merge(v,a)}if(d&&(a=d=g=null),!K.support.appendChecked)for(r=0;null!=(a=v[r]);r++)K.nodeName(a,"input")?f(a):"undefined"!=typeof a.getElementsByTagName&&K.grep(a.getElementsByTagName("input"),f);if(n)for(_=function(t){return!t.type||Xe.test(t.type)?i?i.push(t.parentNode?t.parentNode.removeChild(t):t):n.appendChild(t):void 0},r=0;null!=(a=v[r]);r++)K.nodeName(a,"script")&&_(a)||(n.appendChild(a),"undefined"!=typeof a.getElementsByTagName&&(m=K.grep(K.merge([],a.getElementsByTagName("script")),_),v.splice.apply(v,[r+1,0].concat(m)),r+=m.length));return v},cleanData:function(t,e){for(var n,i,r,o,a=0,s=K.expando,l=K.cache,u=K.support.deleteExpando,c=K.event.special;null!=(r=t[a]);a++)if((e||K.acceptData(r))&&(i=r[s],n=i&&l[i])){if(n.events)for(o in n.events)c[o]?K.event.remove(r,o):K.removeEvent(r,o,n.handle);l[i]&&(delete l[i],u?delete r[s]:r.removeAttribute?r.removeAttribute(s):r[s]=null,K.deletedIds.push(i))}}}),function(){var t,e;K.uaMatch=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},t=K.uaMatch(B.userAgent),e={},t.browser&&(e[t.browser]=!0,e.version=t.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),K.browser=e,K.sub=function(){function t(e,n){return new t.fn.init(e,n)}K.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.sub=this.sub,t.fn.init=function(n,i){return i&&i instanceof K&&!(i instanceof t)&&(i=t(i)),K.fn.init.call(this,n,i,e)},t.fn.init.prototype=t.fn;var e=t(I);return t}}();var nn,rn,on,an=/alpha\([^)]*\)/i,sn=/opacity=([^)]*)/,ln=/^(top|right|bottom|left)$/,un=/^(none|table(?!-c[ea]).+)/,cn=/^margin/,dn=new RegExp("^("+Z+")(.*)$","i"),hn=new RegExp("^("+Z+")(?!px)[a-z%]+$","i"),pn=new RegExp("^([-+])=("+Z+")","i"),_n={},fn={position:"absolute",visibility:"hidden",display:"block"},mn={letterSpacing:0,fontWeight:400},gn=["Top","Right","Bottom","Left"],vn=["Webkit","O","Moz","ms"],bn=K.fn.toggle;K.fn.extend({css:function(t,n){return K.access(this,function(t,n,i){return i!==e?K.style(t,n,i):K.css(t,n)},t,n,arguments.length>1)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(t,e){var n="boolean"==typeof t;return K.isFunction(t)&&K.isFunction(e)?bn.apply(this,arguments):this.each(function(){(n?t:g(this))?K(this).show():K(this).hide()})}}),K.extend({cssHooks:{opacity:{get:function(t,e){if(e){var n=nn(t,"opacity");return""===n?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":K.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,n,i,r){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var o,a,s,l=K.camelCase(n),u=t.style;if(n=K.cssProps[l]||(K.cssProps[l]=m(u,l)),s=K.cssHooks[n]||K.cssHooks[l],i===e)return s&&"get"in s&&(o=s.get(t,!1,r))!==e?o:u[n];if(a=typeof i,"string"===a&&(o=pn.exec(i))&&(i=(o[1]+1)*o[2]+parseFloat(K.css(t,n)),a="number"),!(null==i||"number"===a&&isNaN(i)||("number"!==a||K.cssNumber[l]||(i+="px"),s&&"set"in s&&(i=s.set(t,i,r))===e)))try{u[n]=i}catch(c){}}},css:function(t,n,i,r){var o,a,s,l=K.camelCase(n);return n=K.cssProps[l]||(K.cssProps[l]=m(t.style,l)),s=K.cssHooks[n]||K.cssHooks[l],s&&"get"in s&&(o=s.get(t,!0,r)),o===e&&(o=nn(t,n)),"normal"===o&&n in mn&&(o=mn[n]),i||r!==e?(a=parseFloat(o),i||K.isNumeric(a)?a||0:o):o},swap:function(t,e,n){var i,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];i=n.call(t);for(r in e)t.style[r]=o[r];return i}}),t.getComputedStyle?nn=function(e,n){var i,r,o,a,s=t.getComputedStyle(e,null),l=e.style;return s&&(i=s[n],""!==i||K.contains(e.ownerDocument,e)||(i=K.style(e,n)),hn.test(i)&&cn.test(n)&&(r=l.width,o=l.minWidth,a=l.maxWidth,l.minWidth=l.maxWidth=l.width=i,i=s.width,l.width=r,l.minWidth=o,l.maxWidth=a)),i}:I.documentElement.currentStyle&&(nn=function(t,e){var n,i,r=t.currentStyle&&t.currentStyle[e],o=t.style;return null==r&&o&&o[e]&&(r=o[e]),hn.test(r)&&!ln.test(e)&&(n=o.left,i=t.runtimeStyle&&t.runtimeStyle.left,i&&(t.runtimeStyle.left=t.currentStyle.left),o.left="fontSize"===e?"1em":r,r=o.pixelLeft+"px",o.left=n,i&&(t.runtimeStyle.left=i)),""===r?"auto":r}),K.each(["height","width"],function(t,e){K.cssHooks[e]={get:function(t,n,i){return n?0===t.offsetWidth&&un.test(nn(t,"display"))?K.swap(t,fn,function(){return w(t,e,i)}):w(t,e,i):void 0},set:function(t,n,i){return b(t,n,i?y(t,e,i,K.support.boxSizing&&"border-box"===K.css(t,"boxSizing")):0)}}}),K.support.opacity||(K.cssHooks.opacity={get:function(t,e){return sn.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(t,e){var n=t.style,i=t.currentStyle,r=K.isNumeric(e)?"alpha(opacity="+100*e+")":"",o=i&&i.filter||n.filter||"";n.zoom=1,e>=1&&""===K.trim(o.replace(an,""))&&n.removeAttribute&&(n.removeAttribute("filter"),i&&!i.filter)||(n.filter=an.test(o)?o.replace(an,r):o+" "+r)}}),K(function(){K.support.reliableMarginRight||(K.cssHooks.marginRight={get:function(t,e){return K.swap(t,{display:"inline-block"},function(){return e?nn(t,"marginRight"):void 0})}}),!K.support.pixelPosition&&K.fn.position&&K.each(["top","left"],function(t,e){K.cssHooks[e]={get:function(t,n){if(n){var i=nn(t,e);return hn.test(i)?K(t).position()[e]+"px":i}}}})}),K.expr&&K.expr.filters&&(K.expr.filters.hidden=function(t){return 0===t.offsetWidth&&0===t.offsetHeight||!K.support.reliableHiddenOffsets&&"none"===(t.style&&t.style.display||nn(t,"display"))},K.expr.filters.visible=function(t){return!K.expr.filters.hidden(t)}),K.each({margin:"",padding:"",border:"Width"},function(t,e){K.cssHooks[t+e]={expand:function(n){var i,r="string"==typeof n?n.split(" "):[n],o={};for(i=0;4>i;i++)o[t+gn[i]+e]=r[i]||r[i-2]||r[0];return o}},cn.test(t)||(K.cssHooks[t+e].set=b)});var yn=/%20/g,wn=/\[\]$/,kn=/\r?\n/g,$n=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,xn=/^(?:select|textarea)/i;K.fn.extend({serialize:function(){return K.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?K.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||xn.test(this.nodeName)||$n.test(this.type))}).map(function(t,e){var n=K(this).val();return null==n?null:K.isArray(n)?K.map(n,function(t){return{name:e.name,value:t.replace(kn,"\r\n")}}):{name:e.name,value:n.replace(kn,"\r\n")}}).get()}}),K.param=function(t,n){var i,r=[],o=function(t,e){e=K.isFunction(e)?e():null==e?"":e,r[r.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(n===e&&(n=K.ajaxSettings&&K.ajaxSettings.traditional),K.isArray(t)||t.jquery&&!K.isPlainObject(t))K.each(t,function(){o(this.name,this.value)});else for(i in t)$(i,t[i],n,o);return r.join("&").replace(yn,"+")};var Cn,qn,Tn=/#.*$/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,En=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Dn=/^(?:GET|HEAD)$/,Mn=/^\/\//,An=/\?/,Nn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Fn=/([?&])_=[^&]*/,zn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Pn=K.fn.load,Ln={},jn={},Rn=["*/"]+["*"];
try{Cn=H.href}catch(On){Cn=I.createElement("a"),Cn.href="",Cn=Cn.href}qn=zn.exec(Cn.toLowerCase())||[],K.fn.load=function(t,n,i){if("string"!=typeof t&&Pn)return Pn.apply(this,arguments);if(!this.length)return this;var r,o,a,s=this,l=t.indexOf(" ");return l>=0&&(r=t.slice(l,t.length),t=t.slice(0,l)),K.isFunction(n)?(i=n,n=e):n&&"object"==typeof n&&(o="POST"),K.ajax({url:t,type:o,dataType:"html",data:n,complete:function(t,e){i&&s.each(i,a||[t.responseText,e,t])}}).done(function(t){a=arguments,s.html(r?K("<div>").append(t.replace(Nn,"")).find(r):t)}),this},K.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){K.fn[e]=function(t){return this.on(e,t)}}),K.each(["get","post"],function(t,n){K[n]=function(t,i,r,o){return K.isFunction(i)&&(o=o||r,r=i,i=e),K.ajax({type:n,url:t,data:i,success:r,dataType:o})}}),K.extend({getScript:function(t,n){return K.get(t,e,n,"script")},getJSON:function(t,e,n){return K.get(t,e,n,"json")},ajaxSetup:function(t,e){return e?q(t,K.ajaxSettings):(e=t,t=K.ajaxSettings),q(t,e),t},ajaxSettings:{url:Cn,isLocal:En.test(qn[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Rn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":t.String,"text html":!0,"text json":K.parseJSON,"text xml":K.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:x(Ln),ajaxTransport:x(jn),ajax:function(t,n){function i(t,n,i,a){var u,d,v,b,w,$=n;2!==y&&(y=2,l&&clearTimeout(l),s=e,o=a||"",k.readyState=t>0?4:0,i&&(b=T(h,k,i)),t>=200&&300>t||304===t?(h.ifModified&&(w=k.getResponseHeader("Last-Modified"),w&&(K.lastModified[r]=w),w=k.getResponseHeader("Etag"),w&&(K.etag[r]=w)),304===t?($="notmodified",u=!0):(u=S(h,b),$=u.state,d=u.data,v=u.error,u=!v)):(v=$,(!$||t)&&($="error",0>t&&(t=0))),k.status=t,k.statusText=""+(n||$),u?f.resolveWith(p,[d,$,k]):f.rejectWith(p,[k,$,v]),k.statusCode(g),g=e,c&&_.trigger("ajax"+(u?"Success":"Error"),[k,h,u?d:v]),m.fireWith(p,[k,$]),c&&(_.trigger("ajaxComplete",[k,h]),--K.active||K.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=e),n=n||{};var r,o,a,s,l,u,c,d,h=K.ajaxSetup({},n),p=h.context||h,_=p!==h&&(p.nodeType||p instanceof K)?K(p):K.event,f=K.Deferred(),m=K.Callbacks("once memory"),g=h.statusCode||{},v={},b={},y=0,w="canceled",k={readyState:0,setRequestHeader:function(t,e){if(!y){var n=t.toLowerCase();t=b[n]=b[n]||t,v[t]=e}return this},getAllResponseHeaders:function(){return 2===y?o:null},getResponseHeader:function(t){var n;if(2===y){if(!a)for(a={};n=Sn.exec(o);)a[n[1].toLowerCase()]=n[2];n=a[t.toLowerCase()]}return n===e?null:n},overrideMimeType:function(t){return y||(h.mimeType=t),this},abort:function(t){return t=t||w,s&&s.abort(t),i(0,t),this}};if(f.promise(k),k.success=k.done,k.error=k.fail,k.complete=m.add,k.statusCode=function(t){if(t){var e;if(2>y)for(e in t)g[e]=[g[e],t[e]];else e=t[k.status],k.always(e)}return this},h.url=((t||h.url)+"").replace(Tn,"").replace(Mn,qn[1]+"//"),h.dataTypes=K.trim(h.dataType||"*").toLowerCase().split(ee),null==h.crossDomain&&(u=zn.exec(h.url.toLowerCase()),h.crossDomain=!(!u||u[1]==qn[1]&&u[2]==qn[2]&&(u[3]||("http:"===u[1]?80:443))==(qn[3]||("http:"===qn[1]?80:443)))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=K.param(h.data,h.traditional)),C(Ln,h,n,k),2===y)return k;if(c=h.global,h.type=h.type.toUpperCase(),h.hasContent=!Dn.test(h.type),c&&0===K.active++&&K.event.trigger("ajaxStart"),!h.hasContent&&(h.data&&(h.url+=(An.test(h.url)?"&":"?")+h.data,delete h.data),r=h.url,h.cache===!1)){var $=K.now(),x=h.url.replace(Fn,"$1_="+$);h.url=x+(x===h.url?(An.test(h.url)?"&":"?")+"_="+$:"")}(h.data&&h.hasContent&&h.contentType!==!1||n.contentType)&&k.setRequestHeader("Content-Type",h.contentType),h.ifModified&&(r=r||h.url,K.lastModified[r]&&k.setRequestHeader("If-Modified-Since",K.lastModified[r]),K.etag[r]&&k.setRequestHeader("If-None-Match",K.etag[r])),k.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Rn+"; q=0.01":""):h.accepts["*"]);for(d in h.headers)k.setRequestHeader(d,h.headers[d]);if(h.beforeSend&&(h.beforeSend.call(p,k,h)===!1||2===y))return k.abort();w="abort";for(d in{success:1,error:1,complete:1})k[d](h[d]);if(s=C(jn,h,n,k)){k.readyState=1,c&&_.trigger("ajaxSend",[k,h]),h.async&&h.timeout>0&&(l=setTimeout(function(){k.abort("timeout")},h.timeout));try{y=1,s.send(v,i)}catch(q){if(!(2>y))throw q;i(-1,q)}}else i(-1,"No Transport");return k},active:0,lastModified:{},etag:{}});var In=[],Hn=/\?/,Bn=/(=)\?(?=&|$)|\?\?/,Wn=K.now();K.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=In.pop()||K.expando+"_"+Wn++;return this[t]=!0,t}}),K.ajaxPrefilter("json jsonp",function(n,i,r){var o,a,s,l=n.data,u=n.url,c=n.jsonp!==!1,d=c&&Bn.test(u),h=c&&!d&&"string"==typeof l&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(l);return"jsonp"===n.dataTypes[0]||d||h?(o=n.jsonpCallback=K.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a=t[o],d?n.url=u.replace(Bn,"$1"+o):h?n.data=l.replace(Bn,"$1"+o):c&&(n.url+=(Hn.test(u)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||K.error(o+" was not called"),s[0]},n.dataTypes[0]="json",t[o]=function(){s=arguments},r.always(function(){t[o]=a,n[o]&&(n.jsonpCallback=i.jsonpCallback,In.push(o)),s&&K.isFunction(a)&&a(s[0]),s=a=e}),"script"):void 0}),K.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return K.globalEval(t),t}}}),K.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),K.ajaxTransport("script",function(t){if(t.crossDomain){var n,i=I.head||I.getElementsByTagName("head")[0]||I.documentElement;return{send:function(r,o){n=I.createElement("script"),n.async="async",t.scriptCharset&&(n.charset=t.scriptCharset),n.src=t.url,n.onload=n.onreadystatechange=function(t,r){(r||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=e,r||o(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Un,Jn=t.ActiveXObject?function(){for(var t in Un)Un[t](0,1)}:!1,Gn=0;K.ajaxSettings.xhr=t.ActiveXObject?function(){return!this.isLocal&&E()||D()}:E,function(t){K.extend(K.support,{ajax:!!t,cors:!!t&&"withCredentials"in t})}(K.ajaxSettings.xhr()),K.support.ajax&&K.ajaxTransport(function(n){if(!n.crossDomain||K.support.cors){var i;return{send:function(r,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields)for(s in n.xhrFields)l[s]=n.xhrFields[s];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType),n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(s in r)l.setRequestHeader(s,r[s])}catch(u){}l.send(n.hasContent&&n.data||null),i=function(t,r){var s,u,c,d,h;try{if(i&&(r||4===l.readyState))if(i=e,a&&(l.onreadystatechange=K.noop,Jn&&delete Un[a]),r)4!==l.readyState&&l.abort();else{s=l.status,c=l.getAllResponseHeaders(),d={},h=l.responseXML,h&&h.documentElement&&(d.xml=h);try{d.text=l.responseText}catch(t){}try{u=l.statusText}catch(p){u=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=d.text?200:404}}catch(_){r||o(-1,_)}d&&o(s,u,d,c)},n.async?4===l.readyState?setTimeout(i,0):(a=++Gn,Jn&&(Un||(Un={},K(t).unload(Jn)),Un[a]=i),l.onreadystatechange=i):i()},abort:function(){i&&i(0,1)}}}});var Yn,Vn,Qn=/^(?:toggle|show|hide)$/,Xn=new RegExp("^(?:([-+])=|)("+Z+")([a-z%]*)$","i"),Kn=/queueHooks$/,Zn=[z],ti={"*":[function(t,e){var n,i,r,o=this.createTween(t,e),a=Xn.exec(e),s=o.cur(),l=+s||0,u=1;if(a){if(n=+a[2],i=a[3]||(K.cssNumber[t]?"":"px"),"px"!==i&&l){l=K.css(o.elem,t,!0)||n||1;do r=u=u||".5",l/=u,K.style(o.elem,t,l+i),u=o.cur()/s;while(1!==u&&u!==r)}o.unit=i,o.start=l,o.end=a[1]?l+(a[1]+1)*n:n}return o}]};K.Animation=K.extend(N,{tweener:function(t,e){K.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var n,i=0,r=t.length;r>i;i++)n=t[i],ti[n]=ti[n]||[],ti[n].unshift(e)},prefilter:function(t,e){e?Zn.unshift(t):Zn.push(t)}}),K.Tween=P,P.prototype={constructor:P,init:function(t,e,n,i,r,o){this.elem=t,this.prop=n,this.easing=r||"swing",this.options=e,this.start=this.now=this.cur(),this.end=i,this.unit=o||(K.cssNumber[n]?"":"px")},cur:function(){var t=P.propHooks[this.prop];return t&&t.get?t.get(this):P.propHooks._default.get(this)},run:function(t){var e,n=P.propHooks[this.prop];return this.pos=e=this.options.duration?K.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):P.propHooks._default.set(this),this}},P.prototype.init.prototype=P.prototype,P.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=K.css(t.elem,t.prop,!1,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){K.fx.step[t.prop]?K.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[K.cssProps[t.prop]]||K.cssHooks[t.prop])?K.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},P.propHooks.scrollTop=P.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},K.each(["toggle","show","hide"],function(t,e){var n=K.fn[e];K.fn[e]=function(i,r,o){return null==i||"boolean"==typeof i||!t&&K.isFunction(i)&&K.isFunction(r)?n.apply(this,arguments):this.animate(L(e,!0),i,r,o)}}),K.fn.extend({fadeTo:function(t,e,n,i){return this.filter(g).css("opacity",0).show().end().animate({opacity:e},t,n,i)},animate:function(t,e,n,i){var r=K.isEmptyObject(t),o=K.speed(e,n,i),a=function(){var e=N(this,K.extend({},t),o);r&&e.stop(!0)};return r||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(t,n,i){var r=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=n,n=t,t=e),n&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,n=null!=t&&t+"queueHooks",o=K.timers,a=K._data(this);if(n)a[n]&&a[n].stop&&r(a[n]);else for(n in a)a[n]&&a[n].stop&&Kn.test(n)&&r(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=t&&o[n].queue!==t||(o[n].anim.stop(i),e=!1,o.splice(n,1));(e||!i)&&K.dequeue(this,t)})}}),K.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){K.fn[t]=function(t,n,i){return this.animate(e,t,n,i)}}),K.speed=function(t,e,n){var i=t&&"object"==typeof t?K.extend({},t):{complete:n||!n&&e||K.isFunction(t)&&t,duration:t,easing:n&&e||e&&!K.isFunction(e)&&e};return i.duration=K.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in K.fx.speeds?K.fx.speeds[i.duration]:K.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){K.isFunction(i.old)&&i.old.call(this),i.queue&&K.dequeue(this,i.queue)},i},K.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},K.timers=[],K.fx=P.prototype.init,K.fx.tick=function(){for(var t,e=K.timers,n=0;n<e.length;n++)t=e[n],t()||e[n]!==t||e.splice(n--,1);e.length||K.fx.stop()},K.fx.timer=function(t){t()&&K.timers.push(t)&&!Vn&&(Vn=setInterval(K.fx.tick,K.fx.interval))},K.fx.interval=13,K.fx.stop=function(){clearInterval(Vn),Vn=null},K.fx.speeds={slow:600,fast:200,_default:400},K.fx.step={},K.expr&&K.expr.filters&&(K.expr.filters.animated=function(t){return K.grep(K.timers,function(e){return t===e.elem}).length});var ei=/^(?:body|html)$/i;K.fn.offset=function(t){if(arguments.length)return t===e?this:this.each(function(e){K.offset.setOffset(this,t,e)});var n,i,r,o,a,s,l,u,c,d,h=this[0],p=h&&h.ownerDocument;if(p)return(r=p.body)===h?K.offset.bodyOffset(h):(i=p.documentElement,K.contains(i,h)?(n=h.getBoundingClientRect(),o=j(p),a=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,l=o.pageYOffset||i.scrollTop,u=o.pageXOffset||i.scrollLeft,c=n.top+l-a,d=n.left+u-s,{top:c,left:d}):{top:0,left:0})},K.offset={bodyOffset:function(t){var e=t.offsetTop,n=t.offsetLeft;return K.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(K.css(t,"marginTop"))||0,n+=parseFloat(K.css(t,"marginLeft"))||0),{top:e,left:n}},setOffset:function(t,e,n){var i=K.css(t,"position");"static"===i&&(t.style.position="relative");var r,o,a=K(t),s=a.offset(),l=K.css(t,"top"),u=K.css(t,"left"),c=("absolute"===i||"fixed"===i)&&K.inArray("auto",[l,u])>-1,d={},h={};c?(h=a.position(),r=h.top,o=h.left):(r=parseFloat(l)||0,o=parseFloat(u)||0),K.isFunction(e)&&(e=e.call(t,n,s)),null!=e.top&&(d.top=e.top-s.top+r),null!=e.left&&(d.left=e.left-s.left+o),"using"in e?e.using.call(t,d):a.css(d)}},K.fn.extend({position:function(){if(this[0]){var t=this[0],e=this.offsetParent(),n=this.offset(),i=ei.test(e[0].nodeName)?{top:0,left:0}:e.offset();return n.top-=parseFloat(K.css(t,"marginTop"))||0,n.left-=parseFloat(K.css(t,"marginLeft"))||0,i.top+=parseFloat(K.css(e[0],"borderTopWidth"))||0,i.left+=parseFloat(K.css(e[0],"borderLeftWidth"))||0,{top:n.top-i.top,left:n.left-i.left}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||I.body;t&&!ei.test(t.nodeName)&&"static"===K.css(t,"position");)t=t.offsetParent;return t||I.body})}}),K.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,n){var i=/Y/.test(n);K.fn[t]=function(r){return K.access(this,function(t,r,o){var a=j(t);return o===e?a?n in a?a[n]:a.document.documentElement[r]:t[r]:(a?a.scrollTo(i?K(a).scrollLeft():o,i?o:K(a).scrollTop()):t[r]=o,void 0)},t,r,arguments.length,null)}}),K.each({Height:"height",Width:"width"},function(t,n){K.each({padding:"inner"+t,content:n,"":"outer"+t},function(i,r){K.fn[r]=function(r,o){var a=arguments.length&&(i||"boolean"!=typeof r),s=i||(r===!0||o===!0?"margin":"border");return K.access(this,function(n,i,r){var o;return K.isWindow(n)?n.document.documentElement["client"+t]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+t],o["scroll"+t],n.body["offset"+t],o["offset"+t],o["client"+t])):r===e?K.css(n,i,r,s):K.style(n,i,r,s)},n,a?r:e,a,null)}})}),t.jQuery=t.$=K,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return K})}(window),function(t,e){var n=function(){var e=t._data(document,"events");return e&&e.click&&t.grep(e.click,function(t){return"rails"===t.namespace}).length};n()&&t.error("jquery-ujs has already been loaded!");var i;t.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var n=t('meta[name="csrf-token"]').attr("content");n&&e.setRequestHeader("X-CSRF-Token",n)},fire:function(e,n,i){var r=t.Event(n);return e.trigger(r,i),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(n){var r,o,a,s,l,u,c,d;if(i.fire(n,"ajax:before")){if(s=n.data("cross-domain"),l=s===e?null:s,u=n.data("with-credentials")||null,c=n.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,n.is("form")){r=n.attr("method"),o=n.attr("action"),a=n.serializeArray();var h=n.data("ujs:submit-button");h&&(a.push(h),n.data("ujs:submit-button",null))}else n.is(i.inputChangeSelector)?(r=n.data("method"),o=n.data("url"),a=n.serialize(),n.data("params")&&(a=a+"&"+n.data("params"))):(r=n.data("method"),o=i.href(n),a=n.data("params")||null);d={type:r||"GET",data:a,dataType:c,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),i.fire(n,"ajax:beforeSend",[t,r])},success:function(t,e,i){n.trigger("ajax:success",[t,e,i])},complete:function(t,e){n.trigger("ajax:complete",[t,e])},error:function(t,e,i){n.trigger("ajax:error",[t,e,i])},xhrFields:{withCredentials:u},crossDomain:l},o&&(d.url=o);var p=i.ajax(d);return n.trigger("ajax:send",p),p}return!1},handleMethod:function(n){var r=i.href(n),o=n.data("method"),a=n.attr("target"),s=t("meta[name=csrf-token]").attr("content"),l=t("meta[name=csrf-param]").attr("content"),u=t('<form method="post" action="'+r+'"></form>'),c='<input name="_method" value="'+o+'" type="hidden" />';l!==e&&s!==e&&(c+='<input name="'+l+'" value="'+s+'" type="hidden" />'),a&&u.attr("target",a),u.hide().append(c).appendTo("body"),u.submit()},disableFormElements:function(e){e.find(i.disableSelector).each(function(){var e=t(this),n=e.is("button")?"html":"val";e.data("ujs:enable-with",e[n]()),e[n](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(i.enableSelector).each(function(){var e=t(this),n=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[n](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,n=t.data("confirm"),r=!1;return n?(i.fire(t,"confirm")&&(r=i.confirm(n),e=i.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,n,i){var r,o,a=t(),s=n||"input,textarea",l=e.find(s);return l.each(function(){if(r=t(this),o=r.is(":checkbox,:radio")?r.is(":checked"):r.val(),!o==!i){if(r.is(":radio")&&l.filter('input:radio:checked[name="'+r.attr("name")+'"]').length)return!0;a=a.add(r)}}),a.length?a:!1},nonBlankInputs:function(t,e){return i.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},callFormSubmitBindings:function(n,i){var r=n.data("events"),o=!0;return r!==e&&r.submit!==e&&t.each(r.submit,function(t,e){return"function"==typeof e.handler?o=e.handler(i):void 0}),o},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return i.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.data("ujs:enable-with",!1)),t.unbind("click.railsDisable")}},i.fire(t(document),"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,n){t.crossDomain||i.CSRFProtection(n)}),t(document).delegate(i.linkDisableSelector,"ajax:complete",function(){i.enableElement(t(this))}),t(document).delegate(i.linkClickSelector,"click.rails",function(n){var r=t(this),o=r.data("method"),a=r.data("params");if(!i.allowAction(r))return i.stopEverything(n);if(r.is(i.linkDisableSelector)&&i.disableElement(r),r.data("remote")!==e){if(!(!n.metaKey&&!n.ctrlKey||o&&"GET"!==o||a))return!0;var s=i.handleRemote(r);return s===!1?i.enableElement(r):s.error(function(){i.enableElement(r)}),!1}return r.data("method")?(i.handleMethod(r),!1):void 0}),t(document).delegate(i.inputChangeSelector,"change.rails",function(e){var n=t(this);return i.allowAction(n)?(i.handleRemote(n),!1):i.stopEverything(e)}),t(document).delegate(i.formSubmitSelector,"submit.rails",function(n){var r=t(this),o=r.data("remote")!==e,a=i.blankInputs(r,i.requiredInputSelector),s=i.nonBlankInputs(r,i.fileInputSelector);if(!i.allowAction(r))return i.stopEverything(n);if(a&&r.attr("novalidate")==e&&i.fire(r,"ajax:aborted:required",[a]))return i.stopEverything(n);if(o){if(s){setTimeout(function(){i.disableFormElements(r)},13);var l=i.fire(r,"ajax:aborted:file",[s]);return l||setTimeout(function(){i.enableFormElements(r)},13),l}return!t.support.submitBubbles&&t().jquery<"1.7"&&i.callFormSubmitBindings(r,n)===!1?i.stopEverything(n):(i.handleRemote(r),!1)}setTimeout(function(){i.disableFormElements(r)},13)}),t(document).delegate(i.formInputClickSelector,"click.rails",function(e){var n=t(this);if(!i.allowAction(n))return i.stopEverything(e);var r=n.attr("name"),o=r?{name:r,value:n.val()}:null;n.closest("form").data("ujs:submit-button",o)}),t(document).delegate(i.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&i.disableFormElements(t(this))}),t(document).delegate(i.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&i.enableFormElements(t(this))}),t(function(){csrf_token=t("meta[name=csrf-token]").attr("content"),csrf_param=t("meta[name=csrf-param]").attr("content"),t('form input[name="'+csrf_param+'"]').val(csrf_token)}))}(jQuery),/**
 * jGestures: a jQuery plugin for gesture events
 * Copyright 2010-2011 Neue Digitale / Razorfish GmbH
 * Copyright 2011-2012, Razorfish GmbH
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * @copyright Razorfish GmbH
 * @author martin.krause@razorfish.de
 * @version 0.90-shake
 * @requires jQuery JavaScript Library v1.4.2 - http://jquery.com/- Copyright 2010, John Resig- Dual licensed under the MIT or GPL Version 2 licenses. http://jquery.org/license
 */
function(t){function e(t){t.startMove=t.startMove?t.startMove:{startX:null,startY:null,timestamp:null};var e,n,i=(new Date).getTime();return t.touches&&(n=[{lastX:t.deltaX,lastY:t.deltaY,moved:null,startX:t.screenX-t.startMove.screenX,startY:t.screenY-t.startMove.screenY}],e={vector:t.vector||null,orientation:window.orientation||null,lastX:n[0].lastX>0?1:n[0].lastX<0?-1:0,lastY:n[0].lastY>0?1:n[0].lastY<0?-1:0,startX:n[0].startX>0?1:n[0].startX<0?-1:0,startY:n[0].startY>0?1:n[0].startY<0?-1:0},n[0].moved=Math.sqrt(Math.pow(Math.abs(n[0].startX),2)+Math.pow(Math.abs(n[0].startY),2))),{type:t.type||null,originalEvent:t.event||null,delta:n||null,direction:e||{orientation:window.orientation||null,vector:t.vector||null},duration:t.duration?t.duration:t.startMove.timestamp?i-t.timestamp:null,rotation:t.rotation||null,scale:t.scale||null,description:t.description||[t.type,":",t.touches,":",0!=n[0].lastX?n[0].lastX>0?"right":"left":"steady",":",0!=n[0].lastY?n[0].lastY>0?"down":"up":"steady"].join("")}}function n(){var e=["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"];t(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",e[window.orientation/90+1],window.orientation].join("")})}function i(n){var i,r,o,a,s=jQuery(window),l=s.data("ojQueryGestures"),u=t.jGestures.defaults.thresholdShake,c=l.oDeviceMotionLastDevicePosition||{accelerationIncludingGravity:{x:0,y:0,z:0},shake:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeleftright:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakefrontback:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeupdown:{eventCount:0,intervalsPassed:0,intervalsFreeze:0}},d={accelerationIncludingGravity:{x:n.accelerationIncludingGravity.x,y:n.accelerationIncludingGravity.y,z:n.accelerationIncludingGravity.z},shake:{eventCount:c.shake.eventCount,intervalsPassed:c.shake.intervalsPassed,intervalsFreeze:c.shake.intervalsFreeze},shakeleftright:{eventCount:c.shakeleftright.eventCount,intervalsPassed:c.shakeleftright.intervalsPassed,intervalsFreeze:c.shakeleftright.intervalsFreeze},shakefrontback:{eventCount:c.shakefrontback.eventCount,intervalsPassed:c.shakefrontback.intervalsPassed,intervalsFreeze:c.shakefrontback.intervalsFreeze},shakeupdown:{eventCount:c.shakeupdown.eventCount,intervalsPassed:c.shakeupdown.intervalsPassed,intervalsFreeze:c.shakeupdown.intervalsFreeze}};for(i in l){switch(i){case"shake":case"shakeleftright":case"shakefrontback":case"shakeupdown":if(r=[],o=[],r.push(i),++d[i].intervalsFreeze>u.freezeShakes&&d[i].intervalsFreeze<2*u.freezeShakes)break;d[i].intervalsFreeze=0,d[i].intervalsPassed++,"shake"!==i&&"shakeleftright"!==i||!(d.accelerationIncludingGravity.x>u.leftright.sensitivity||d.accelerationIncludingGravity.x<-1*u.leftright.sensitivity)||(r.push("leftright"),r.push("x-axis")),"shake"!==i&&"shakefrontback"!==i||!(d.accelerationIncludingGravity.y>u.frontback.sensitivity||d.accelerationIncludingGravity.y<-1*u.frontback.sensitivity)||(r.push("frontback"),r.push("y-axis")),"shake"!==i&&"shakeupdown"!==i||!(d.accelerationIncludingGravity.z+9.81>u.updown.sensitivity||d.accelerationIncludingGravity.z+9.81<-1*u.updown.sensitivity)||(r.push("updown"),r.push("z-axis")),r.length>1&&(++d[i].eventCount==u.requiredShakes&&d[i].intervalsPassed<u.freezeShakes?(s.triggerHandler(i,e({type:i,description:r.join(":"),event:n,duration:5*d[i].intervalsPassed})),d[i].eventCount=0,d[i].intervalsPassed=0,d[i].intervalsFreeze=u.freezeShakes+1):d[i].eventCount==u.requiredShakes&&d[i].intervalsPassed>u.freezeShakes&&(d[i].eventCount=0,d[i].intervalsPassed=0))}a={},a.oDeviceMotionLastDevicePosition=d,s.data("ojQueryGestures",t.extend(!0,l,a))}}function r(e){var n=jQuery(e.currentTarget);n.triggerHandler(t.jGestures.events.touchstart,e),t.hasGestures?(e.currentTarget.addEventListener("touchmove",o,!1),e.currentTarget.addEventListener("touchend",a,!1)):(n.bind("mousemove",o),n.bind("mouseup",a));var i=n.data("ojQueryGestures"),r=e.touches?e.touches[0]:e,s={};s.oLastSwipemove={screenX:r.screenX,screenY:r.screenY,timestamp:(new Date).getTime()},s.oStartTouch={screenX:r.screenX,screenY:r.screenY,timestamp:(new Date).getTime()},n.data("ojQueryGestures",t.extend(!0,i,s))}function o(n){var i,r=jQuery(n.currentTarget),o=r.data("ojQueryGestures"),a=!!n.touches,s=a?n.changedTouches[0].screenX:n.screenX,l=a?n.changedTouches[0].screenY:n.screenY,u=o.oLastSwipemove,c=s-u.screenX,d=l-u.screenY;o.oLastSwipemove&&(i=e({type:"swipemove",touches:a?n.touches.length:"1",screenY:l,screenX:s,deltaY:d,deltaX:c,startMove:u,event:n,timestamp:u.timestamp}),r.triggerHandler(i.type,i));var h={},p=n.touches?n.touches[0]:n;h.oLastSwipemove={screenX:p.screenX,screenY:p.screenY,timestamp:(new Date).getTime()},r.data("ojQueryGestures",t.extend(!0,o,h))}function a(n){var i=jQuery(n.currentTarget),r=!!n.changedTouches,s=r?n.changedTouches.length:"1",l=r?n.changedTouches[0].screenX:n.screenX,u=r?n.changedTouches[0].screenY:n.screenY;i.triggerHandler(t.jGestures.events.touchendStart,n),t.hasGestures?(n.currentTarget.removeEventListener("touchmove",o,!1),n.currentTarget.removeEventListener("touchend",a,!1)):(i.unbind("mousemove",o),i.unbind("mouseup",a));var c,d,h,p,_,f,m,g=i.data("ojQueryGestures"),v=Math.abs(g.oStartTouch.screenX-l)>t.jGestures.defaults.thresholdMove||Math.abs(g.oStartTouch.screenY-u)>t.jGestures.defaults.thresholdMove?!0:!1,b=Math.abs(g.oStartTouch.screenX-l)>t.jGestures.defaults.thresholdSwipe||Math.abs(g.oStartTouch.screenY-u)>t.jGestures.defaults.thresholdSwipe?!0:!1,y=["zero","one","two","three","four"];for(c in g){switch(d=g.oStartTouch,h={},l=r?n.changedTouches[0].screenX:n.screenX,u=r?n.changedTouches[0].screenY:n.screenY,p=l-d.screenX,_=u-d.screenY,f=e({type:"swipe",touches:s,screenY:u,screenX:l,deltaY:_,deltaX:p,startMove:d,event:n,timestamp:d.timestamp}),m=!1,c){case"swipeone":if(r===!1&&1==s&&v===!1)break;(r===!1||1==s&&v===!0&&b===!0)&&(m=!0,f.type=["swipe",y[s]].join(""),i.triggerHandler(f.type,f));break;case"swipetwo":r&&2==s&&v===!0&&b===!0&&(m=!0,f.type=["swipe",y[s]].join(""),i.triggerHandler(f.type,f));break;case"swipethree":r&&3==s&&v===!0&&b===!0&&(m=!0,f.type=["swipe",y[s]].join(""),i.triggerHandler(f.type,f));break;case"swipefour":r&&4==s&&v===!0&&b===!0&&(m=!0,f.type=["swipe",y[s]].join(""),i.triggerHandler(f.type,f));break;case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":r&&v===!0&&b===!0&&(m=!0,f.type=["swipe",0!=f.delta[0].lastX?f.delta[0].lastX>0?"right":"left":"",0!=f.delta[0].lastY?f.delta[0].lastY>0?"down":"up":""].join(""),i.triggerHandler(f.type,f));break;case"tapone":case"taptwo":case"tapthree":case"tapfour":v!==!0&&m!==!0&&y[s]==c.slice(3)&&(f.description=["tap",y[s]].join(""),f.type=["tap",y[s]].join(""),i.triggerHandler(f.type,f))}var w={};i.data("ojQueryGestures",t.extend(!0,g,w)),i.data("ojQueryGestures",t.extend(!0,g,w))}i.triggerHandler(t.jGestures.events.touchendProcessed,n)}function s(e){var n=jQuery(e.currentTarget);n.triggerHandler(t.jGestures.events.gesturestart,e);var i=n.data("ojQueryGestures"),r={};r.oStartTouch={timestamp:(new Date).getTime()},n.data("ojQueryGestures",t.extend(!0,i,r))}function l(n){var i,r,o,a,s=jQuery(n.currentTarget),l=s.data("ojQueryGestures");for(a in l)switch(a){case"pinch":i=n.scale,(1>i&&i%1<1-t.jGestures.defaults.thresholdPinchclose||i>1&&i%1>t.jGestures.defaults.thresholdPinchopen)&&(r=1>i?-1:1,o=e({type:"pinch",scale:i,touches:null,startMove:l.oStartTouch,event:n,timestamp:l.oStartTouch.timestamp,vector:r,description:["pinch:",r,":",1>i?"close":"open"].join("")}),s.triggerHandler(o.type,o));break;case"rotate":i=n.rotation,(1>i&&-1*i>t.jGestures.defaults.thresholdRotateccw||i>1&&i>t.jGestures.defaults.thresholdRotatecw)&&(r=1>i?-1:1,o=e({type:"rotate",rotation:i,touches:null,startMove:l.oStartTouch,event:n,timestamp:l.oStartTouch.timestamp,vector:r,description:["rotate:",r,":",1>i?"counterclockwise":"clockwise"].join("")}),s.triggerHandler(o.type,o))}}function u(n){var i=jQuery(n.currentTarget);i.triggerHandler(t.jGestures.events.gestureendStart,n);var r,o,a=i.data("ojQueryGestures");for(o in a)switch(o){case"pinchclose":r=n.scale,1>r&&r%1<1-t.jGestures.defaults.thresholdPinchclose&&i.triggerHandler("pinchclose",e({type:"pinchclose",scale:r,vector:-1,touches:null,startMove:a.oStartTouch,event:n,timestamp:a.oStartTouch.timestamp,description:"pinch:-1:close"}));break;case"pinchopen":r=n.scale,r>1&&r%1>t.jGestures.defaults.thresholdPinchopen&&i.triggerHandler("pinchopen",e({type:"pinchopen",scale:r,vector:1,touches:null,startMove:a.oStartTouch,event:n,timestamp:a.oStartTouch.timestamp,description:"pinch:+1:open"}));break;case"rotatecw":r=n.rotation,r>1&&r>t.jGestures.defaults.thresholdRotatecw&&i.triggerHandler("rotatecw",e({type:"rotatecw",rotation:r,vector:1,touches:null,startMove:a.oStartTouch,event:n,timestamp:a.oStartTouch.timestamp,description:"rotate:+1:clockwise"}));break;case"rotateccw":r=n.rotation,1>r&&-1*r>t.jGestures.defaults.thresholdRotateccw&&i.triggerHandler("rotateccw",e({type:"rotateccw",rotation:r,vector:-1,touches:null,startMove:a.oStartTouch,event:n,timestamp:a.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}i.triggerHandler(t.jGestures.events.gestureendProcessed,n)}t.jGestures={},t.jGestures.defaults={},t.jGestures.defaults.thresholdShake={requiredShakes:10,freezeShakes:100,frontback:{sensitivity:10},leftright:{sensitivity:10},updown:{sensitivity:10}},t.jGestures.defaults.thresholdPinchopen=.05,t.jGestures.defaults.thresholdPinchmove=.05,t.jGestures.defaults.thresholdPinch=.05,t.jGestures.defaults.thresholdPinchclose=.05,t.jGestures.defaults.thresholdRotatecw=5,t.jGestures.defaults.thresholdRotateccw=5,t.jGestures.defaults.thresholdMove=20,t.jGestures.defaults.thresholdSwipe=100,t.jGestures.data={},t.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"],t.jGestures.data.hasGestures=function(){var e;for(e=0;e<t.jGestures.data.capableDevicesInUserAgentString.length;e++)if(-1!==navigator.userAgent.indexOf(t.jGestures.data.capableDevicesInUserAgentString[e]))return!0;return!1}(),t.hasGestures=t.jGestures.data.hasGestures,t.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"},jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour",devicemotion_shake01:"shake",devicemotion_shake02:"shakefrontback",devicemotion_shake03:"shakeleftright",devicemotion_shake04:"shakeupdown"},function(e,c){jQuery.event.special[c]={setup:function(){var o,a,c=e.split("_"),d=c[0],h=c[1].slice(0,c[1].length-2),p=jQuery(this);if(!p.data("ojQueryGestures")||!p.data("ojQueryGestures")[d])if(o=p.data("ojQueryGestures")||{},a={},a[d]=!0,t.extend(!0,o,a),p.data("ojQueryGestures",o),t.hasGestures)switch(h){case"orientationchange":p.get(0).addEventListener("orientationchange",n,!1);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":p.get(0).addEventListener("devicemotion",i,!1);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":p.get(0).addEventListener("touchstart",r,!1);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":p.get(0).addEventListener("gesturestart",s,!1),p.get(0).addEventListener("gestureend",u,!1);break;case"pinch":case"rotate":p.get(0).addEventListener("gesturestart",s,!1),p.get(0).addEventListener("gesturechange",l,!1)}else switch(h){case"tap":case"swipe":p.bind("mousedown",r);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":}return!1},add:function(t){var e=jQuery(this),n=e.data("ojQueryGestures");return n[t.type]={originalType:t.type},!1},remove:function(t){var e=jQuery(this),n=e.data("ojQueryGestures");return n[t.type]=!1,e.data("ojQueryGestures",n),!1},teardown:function(){var c,d,h=e.split("_"),p=h[0],_=h[1].slice(0,h[1].length-2),f=jQuery(this);if(!f.data("ojQueryGestures")||!f.data("ojQueryGestures")[p])if(c=f.data("ojQueryGestures")||{},d={},d[p]=!1,t.extend(!0,c,d),f.data("ojQueryGestures",c),t.hasGestures)switch(_){case"orientationchange":f.get(0).removeEventListener("orientationchange",n,!1);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":f.get(0).removeEventListener("devicemotion",i,!1);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":f.get(0).removeEventListener("touchstart",r,!1),f.get(0).removeEventListener("touchmove",o,!1),f.get(0).removeEventListener("touchend",a,!1);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":f.get(0).removeEventListener("gesturestart",s,!1),f.get(0).removeEventListener("gestureend",u,!1);break;case"pinch":case"rotate":f.get(0).removeEventListener("gesturestart",s,!1),f.get(0).removeEventListener("gesturechange",l,!1)}else switch(_){case"tap":case"swipe":f.unbind("mousedown",r),f.unbind("mousemove",o),f.unbind("mouseup",a);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":}return!1}}})}(jQuery),/* ===================================================
 * bootstrap-transition.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#transitions
 * ===================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(t){"use strict";t(function(){t.support.transition=function(){var t=function(){var t,e=document.createElement("bootstrap"),n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(t in n)if(void 0!==e.style[t])return n[t]}();return t&&{end:t}}()})}(window.jQuery),/* ==========================================================
 * bootstrap-alert.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#alerts
 * ==========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(t){"use strict";var e='[data-dismiss="alert"]',n=function(n){t(n).on("click",e,this.close)};n.prototype.close=function(e){function n(){i.trigger("closed").remove()}var i,r=t(this),o=r.attr("data-target");o||(o=r.attr("href"),o=o&&o.replace(/.*(?=#[^\s]*$)/,"")),i=t(o),e&&e.preventDefault(),i.length||(i=r.hasClass("alert")?r:r.parent()),i.trigger(e=t.Event("close")),e.isDefaultPrevented()||(i.removeClass("in"),t.support.transition&&i.hasClass("fade")?i.on(t.support.transition.end,n):n())};var i=t.fn.alert;t.fn.alert=function(e){return this.each(function(){var i=t(this),r=i.data("alert");r||i.data("alert",r=new n(this)),"string"==typeof e&&r[e].call(i)})},t.fn.alert.Constructor=n,t.fn.alert.noConflict=function(){return t.fn.alert=i,this},t(document).on("click.alert.data-api",e,n.prototype.close)}(window.jQuery),/* ============================================================
 * bootstrap-button.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#buttons
 * ============================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.button.defaults,n)};e.prototype.setState=function(t){var e="disabled",n=this.$element,i=n.data(),r=n.is("input")?"val":"html";t+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[t]||this.options[t]),setTimeout(function(){"loadingText"==t?n.addClass(e).attr(e,e):n.removeClass(e).removeAttr(e)},0)},e.prototype.toggle=function(){var t=this.$element.closest('[data-toggle="buttons-radio"]');t&&t.find(".active").removeClass("active"),this.$element.toggleClass("active")};var n=t.fn.button;t.fn.button=function(n){return this.each(function(){var i=t(this),r=i.data("button"),o="object"==typeof n&&n;r||i.data("button",r=new e(this,o)),"toggle"==n?r.toggle():n&&r.setState(n)})},t.fn.button.defaults={loadingText:"loading..."},t.fn.button.Constructor=e,t.fn.button.noConflict=function(){return t.fn.button=n,this},t(document).on("click.button.data-api","[data-toggle^=button]",function(e){var n=t(e.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})}(window.jQuery),/* ==========================================================
 * bootstrap-carousel.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#carousel
 * ==========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,"hover"==this.options.pause&&this.$element.on("mouseenter",t.proxy(this.pause,this)).on("mouseleave",t.proxy(this.cycle,this))};e.prototype={cycle:function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(t.proxy(this.next,this),this.options.interval)),this},getActiveIndex:function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},to:function(e){var n=this.getActiveIndex(),i=this;if(!(e>this.$items.length-1||0>e))return this.sliding?this.$element.one("slid",function(){i.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",t(this.$items[e]))},pause:function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&t.support.transition.end&&(this.$element.trigger(t.support.transition.end),this.cycle(!0)),clearInterval(this.interval),this.interval=null,this},next:function(){return this.sliding?void 0:this.slide("next")},prev:function(){return this.sliding?void 0:this.slide("prev")},slide:function(e,n){var i,r=this.$element.find(".item.active"),o=n||r[e](),a=this.interval,s="next"==e?"left":"right",l="next"==e?"first":"last",u=this;if(this.sliding=!0,a&&this.pause(),o=o.length?o:this.$element.find(".item")[l](),i=t.Event("slide",{relatedTarget:o[0],direction:s}),!o.hasClass("active")){if(this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid",function(){var e=t(u.$indicators.children()[u.getActiveIndex()]);e&&e.addClass("active")})),t.support.transition&&this.$element.hasClass("slide")){if(this.$element.trigger(i),i.isDefaultPrevented())return;o.addClass(e),o[0].offsetWidth,r.addClass(s),o.addClass(s),this.$element.one(t.support.transition.end,function(){o.removeClass([e,s].join(" ")).addClass("active"),r.removeClass(["active",s].join(" ")),u.sliding=!1,setTimeout(function(){u.$element.trigger("slid")},0)})}else{if(this.$element.trigger(i),i.isDefaultPrevented())return;r.removeClass("active"),o.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return a&&this.cycle(),this}}};var n=t.fn.carousel;t.fn.carousel=function(n){return this.each(function(){var i=t(this),r=i.data("carousel"),o=t.extend({},t.fn.carousel.defaults,"object"==typeof n&&n),a="string"==typeof n?n:o.slide;r||i.data("carousel",r=new e(this,o)),"number"==typeof n?r.to(n):a?r[a]():o.interval&&r.pause().cycle()})},t.fn.carousel.defaults={interval:5e3,pause:"hover"},t.fn.carousel.Constructor=e,t.fn.carousel.noConflict=function(){return t.fn.carousel=n,this},t(document).on("click.carousel.data-api","[data-slide], [data-slide-to]",function(e){var n,i,r=t(this),o=t(r.attr("data-target")||(n=r.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"")),a=t.extend({},o.data(),r.data());o.carousel(a),(i=r.attr("data-slide-to"))&&o.data("carousel").pause().to(i).cycle(),e.preventDefault()})}(window.jQuery),/* =============================================================
 * bootstrap-collapse.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#collapse
 * =============================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.collapse.defaults,n),this.options.parent&&(this.$parent=t(this.options.parent)),this.options.toggle&&this.toggle()};e.prototype={constructor:e,dimension:function(){var t=this.$element.hasClass("width");return t?"width":"height"},show:function(){var e,n,i,r;if(!this.transitioning&&!this.$element.hasClass("in")){if(e=this.dimension(),n=t.camelCase(["scroll",e].join("-")),i=this.$parent&&this.$parent.find("> .accordion-group > .in"),i&&i.length){if(r=i.data("collapse"),r&&r.transitioning)return;i.collapse("hide"),r||i.data("collapse",null)}this.$element[e](0),this.transition("addClass",t.Event("show"),"shown"),t.support.transition&&this.$element[e](this.$element[0][n])}},hide:function(){var e;!this.transitioning&&this.$element.hasClass("in")&&(e=this.dimension(),this.reset(this.$element[e]()),this.transition("removeClass",t.Event("hide"),"hidden"),this.$element[e](0))},reset:function(t){var e=this.dimension();return this.$element.removeClass("collapse")[e](t||"auto")[0].offsetWidth,this.$element[null!==t?"addClass":"removeClass"]("collapse"),this},transition:function(e,n,i){var r=this,o=function(){"show"==n.type&&r.reset(),r.transitioning=0,r.$element.trigger(i)};this.$element.trigger(n),n.isDefaultPrevented()||(this.transitioning=1,this.$element[e]("in"),t.support.transition&&this.$element.hasClass("collapse")?this.$element.one(t.support.transition.end,o):o())},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}};var n=t.fn.collapse;t.fn.collapse=function(n){return this.each(function(){var i=t(this),r=i.data("collapse"),o=t.extend({},t.fn.collapse.defaults,i.data(),"object"==typeof n&&n);r||i.data("collapse",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.collapse.defaults={toggle:!0},t.fn.collapse.Constructor=e,t.fn.collapse.noConflict=function(){return t.fn.collapse=n,this},t(document).on("click.collapse.data-api","[data-toggle=collapse]",function(e){var n,i=t(this),r=i.attr("data-target")||e.preventDefault()||(n=i.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,""),o=t(r).data("collapse")?"toggle":i.data();i[t(r).hasClass("in")?"addClass":"removeClass"]("collapsed"),t(r).collapse(o)})}(window.jQuery),/* ============================================================
 * bootstrap-dropdown.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#dropdowns
 * ============================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(t){"use strict";function e(){t(".dropdown-backdrop").remove(),t(i).each(function(){n(t(this)).removeClass("open")})}function n(e){var n,i=e.attr("data-target");return i||(i=e.attr("href"),i=i&&/#/.test(i)&&i.replace(/.*(?=#[^\s]*$)/,""),"#"===i&&(i=null)),n=i&&t(i),n&&n.length||(n=e.parent()),n}var i="[data-toggle=dropdown]",r=function(e){var n=t(e).on("click.dropdown.data-api",this.toggle);t("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};r.prototype={constructor:r,toggle:function(){var i,r,o=t(this);if(!o.is(".disabled, :disabled")&&!o.closest(".nav").hasClass("open-on-hover"))return i=n(o),r=i.hasClass("open"),e(),r||("ontouchstart"in document.documentElement&&t('<div class="dropdown-backdrop"/>').insertBefore(t(this)).on("click",e),i.toggleClass("open")),o.focus(),!1},keydown:function(e){var r,o,a,s,l;if(/(38|40|27)/.test(e.keyCode)&&(r=t(this),e.preventDefault(),e.stopPropagation(),!r.is(".disabled, :disabled"))){if(a=n(r),s=a.hasClass("open"),!s||s&&27==e.keyCode)return 27==e.which&&a.find(i).focus(),r.click();o=t("[role=menu] li:not(.divider):visible a",a),o.length&&(l=o.index(o.filter(":focus")),38==e.keyCode&&l>0&&l--,40==e.keyCode&&l<o.length-1&&l++,~l||(l=0),o.eq(l).focus())}}};var o=t.fn.dropdown;t.fn.dropdown=function(e){return this.each(function(){var n=t(this),i=n.data("dropdown");i||n.data("dropdown",i=new r(this)),"string"==typeof e&&i[e].call(n)})},t.fn.dropdown.Constructor=r,t.fn.dropdown.noConflict=function(){return t.fn.dropdown=o,this},t(document).on("click.dropdown.data-api",function(n){var i=t(n.srcElement);i.hasClass("stay-open-on-click")||i.closest(".stay-open-on-click").length>0||i.hasClass("datepicker")||e()}).on("click.dropdown.data-api",".dropdown form",function(t){t.stopPropagation()}).on("click.dropdown.data-api",i,r.prototype.toggle).on("keydown.dropdown.data-api",i+", [role=menu]",r.prototype.keydown)}(window.jQuery),/* =========================================================
 * bootstrap-modal.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#modals
 * =========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */
!function(t){"use strict";var e=function(e,n){this.options=n,this.$element=t(e).delegate('[data-dismiss="modal"]',"click.dismiss.modal",t.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};e.prototype={constructor:e,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var e=this,n=t.Event("show");this.$element.trigger(n),this.isShown||n.isDefaultPrevented()||(this.isShown=!0,this.escape(),t("body").addClass("modal-open"),this.backdrop(function(){var n=t.support.transition&&e.$element.hasClass("fade");e.$element.parent().length||e.$element.appendTo(document.body),e.$element.show(),n&&e.$element[0].offsetWidth,e.$element.addClass("in").attr("aria-hidden",!1),e.enforceFocus(),n?e.$element.one(t.support.transition.end,function(){e.$element.focus().trigger("shown")}):e.$element.focus().trigger("shown")}))},hide:function(e){e&&e.preventDefault(),e=t.Event("hide"),t("body").removeClass("modal-open"),t("div.modal.in").length<=1&&this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),t(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),t.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var e=this;t(document).on("focusin.modal",function(t){e.$element[0]===t.target||e.$element.has(t.target).length||e.$element.focus()})},escape:function(){var t=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&t.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var e=this,n=setTimeout(function(){e.$element.off(t.support.transition.end),e.hideModal()},500);this.$element.one(t.support.transition.end,function(){clearTimeout(n),e.hideModal()})},hideModal:function(){var t=this;this.$element.hide(),this.backdrop(function(){t.removeBackdrop(),t.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){var n=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=t.support.transition&&n;if(this.$backdrop=t('<div class="modal-backdrop '+n+'" />').appendTo(document.body),this.$backdrop.click("static"==this.options.backdrop?t.proxy(this.$element[0].focus,this.$element[0]):t.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;i?this.$backdrop.one(t.support.transition.end,e):e()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),t.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(t.support.transition.end,e):e()):e&&e()}};var n=t.fn.modal;t.fn.modal=function(n){return this.each(function(){var i=t(this),r=i.data("modal"),o=t.extend({},t.fn.modal.defaults,i.data(),"object"==typeof n&&n);r?r.options=o:i.data("modal",r=new e(this,o)),"string"==typeof n?r[n]():o.show&&r.show()})},t.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},t.fn.modal.Constructor=e,t.fn.modal.noConflict=function(){return t.fn.modal=n,this},t(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var n=t(this),i=n.attr("href"),r=t(n.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=r.data("modal")?"toggle":t.extend({remote:!/#/.test(i)&&i},r.data(),n.data());e.preventDefault(),r.modal(o).one("hide",function(){n.focus()})})}(window.jQuery),/* ===========================================================
 * bootstrap-tooltip.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#tooltips
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ===========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(t){"use strict";var e=function(t,e){this.init("tooltip",t,e)};e.prototype={constructor:e,init:function(e,n,i){var r,o,a,s,l;for(this.type=e,this.$element=t(n),this.options=this.getOptions(i),this.enabled=!0,a=this.options.trigger.split(" "),l=a.length;l--;)s=a[l],"click"==s?this.$element.on("click."+this.type,this.options.selector,t.proxy(this.toggle,this)):"manual"!=s&&(r="hover"==s?"mouseenter":"focus",o="hover"==s?"mouseleave":"blur",this.$element.on(r+"."+this.type,this.options.selector,t.proxy(this.enter,this)),this.$element.on(o+"."+this.type,this.options.selector,t.proxy(this.leave,this)));this.options.selector?this._options=t.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(e){return e=t.extend({},t.fn[this.type].defaults,this.$element.data(),e),e.delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e},enter:function(e){var n,i=t.fn[this.type].defaults,r={};return this._options&&t.each(this._options,function(t,e){i[t]!=e&&(r[t]=e)},this),n=t(e.currentTarget)[this.type](r).data(this.type),n.options.delay&&n.options.delay.show?(clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show),void 0):n.show()},leave:function(e){var n=t(e.currentTarget)[this.type](this._options).data(this.type);return this.timeout&&clearTimeout(this.timeout),n.options.delay&&n.options.delay.hide?(n.hoverState="out",this.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide),void 0):n.hide()},show:function(){var e,n,i,r,o,a,s=t.Event("show");if(this.hasContent()&&this.enabled){if(this.$element.trigger(s),s.isDefaultPrevented())return;switch(e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),o="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,e.detach().css({top:0,left:0,display:"block"}),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element),n=this.getPosition(),i=e[0].offsetWidth,r=e[0].offsetHeight,o){case"bottom":a={top:n.top+n.height,left:n.left+n.width/2-i/2};break;case"top":a={top:n.top-r,left:n.left+n.width/2-i/2};break;case"left":a={top:n.top+n.height/2-r/2,left:n.left-i};break;case"right":a={top:n.top+n.height/2-r/2,left:n.left+n.width}}this.applyPlacement(a,o),this.$element.trigger("shown")}},applyPlacement:function(t,e){var n,i,r,o,a=this.tip(),s=a[0].offsetWidth,l=a[0].offsetHeight;a.offset(t).addClass(e).addClass("in"),n=a[0].offsetWidth,i=a[0].offsetHeight,"top"==e&&i!=l&&(t.top=t.top+l-i,o=!0),"bottom"==e||"top"==e?(r=0,t.left<0&&(r=-2*t.left,t.left=0,a.offset(t),n=a[0].offsetWidth,i=a[0].offsetHeight),this.replaceArrow(r-s+n,n,"left")):this.replaceArrow(i-l,i,"top"),o&&a.offset(t)},replaceArrow:function(t,e,n){this.arrow().css(n,t?50*(1-t/e)+"%":"")},setContent:function(){var t=this.tip(),e=this.getTitle();t.find(".tooltip-inner")[this.options.html?"html":"text"](e),t.removeClass("fade in top bottom left right")},hide:function(){function e(){var e=setTimeout(function(){n.off(t.support.transition.end).detach()},500);n.one(t.support.transition.end,function(){clearTimeout(e),n.detach()})}var n=this.tip(),i=t.Event("hide");return this.$element.trigger(i),i.isDefaultPrevented()?void 0:(n.removeClass("in"),t.support.transition&&this.$tip.hasClass("fade")?e():n.detach(),this.$element.trigger("hidden"),this)},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("data-original-title"))&&t.attr("data-original-title",t.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var e=this.$element[0];return t.extend({},"function"==typeof e.getBoundingClientRect?e.getBoundingClientRect():{width:e.offsetWidth,height:e.offsetHeight},this.$element.offset())},getTitle:function(){var t,e=this.$element,n=this.options;return t=e.attr("data-original-title")||("function"==typeof n.title?n.title.call(e[0]):n.title)},tip:function(){return this.$tip=this.$tip||t(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(e){var n=e?t(e.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=t.fn.tooltip;t.fn.tooltip=function(n){return this.each(function(){var i=t(this),r=i.data("tooltip"),o="object"==typeof n&&n;r||i.data("tooltip",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.tooltip.Constructor=e,t.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.fn.tooltip.noConflict=function(){return t.fn.tooltip=n,this}}(window.jQuery),/* ===========================================================
 * bootstrap-popover.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#popovers
 * ===========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =========================================================== */
!function(t){"use strict";var e=function(t,e){this.init("popover",t,e)};e.prototype=t.extend({},t.fn.tooltip.Constructor.prototype,{constructor:e,setContent:function(){var t=this.tip(),e=this.getTitle(),n=this.getContent();t.find(".popover-title")[this.options.html?"html":"text"](e),t.find(".popover-content")[this.options.html?"html":"text"](n),t.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var t,e=this.$element,n=this.options;return t=("function"==typeof n.content?n.content.call(e[0]):n.content)||e.attr("data-content")},tip:function(){return this.$tip||(this.$tip=t(this.options.template),this.$element.data("width")&&this.$tip.css("width",this.$element.data("width"))),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var n=t.fn.popover;t.fn.popover=function(n){return this.each(function(){var i=t(this),r=i.data("popover"),o="object"==typeof n&&n;r||i.data("popover",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.popover.Constructor=e,t.fn.popover.defaults=t.extend({},t.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.fn.popover.noConflict=function(){return t.fn.popover=n,this}}(window.jQuery),/* =============================================================
 * bootstrap-scrollspy.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#scrollspy
 * =============================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================== */
!function(t){"use strict";function e(e,n){var i,r=t.proxy(this.process,this),o=t(e).is("body")?t(window):t(e);this.options=t.extend({},t.fn.scrollspy.defaults,n),this.$scrollElement=o.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(i=t(e).attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=t("body"),this.refresh(),this.process()}e.prototype={constructor:e,refresh:function(){var e,n=this;this.offsets=t([]),this.targets=t([]),e=this.$body.find(this.selector).map(function(){var e=t(this),i=e.data("target")||e.attr("href"),r=/^#\w/.test(i)&&t(i);return r&&r.length&&[[r.position().top+(!t.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(t,e){return t[0]-e[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},process:function(){var t,e=this.$scrollElement.scrollTop()+this.options.offset,n=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,i=n-this.$scrollElement.height(),r=this.offsets,o=this.targets,a=this.activeTarget;if(e>=i)return a!=(t=o.last()[0])&&this.activate(t);for(t=r.length;t--;)a!=o[t]&&e>=r[t]&&(!r[t+1]||e<=r[t+1])&&this.activate(o[t])},activate:function(e){var n,i;this.activeTarget=e,t(this.selector).parent(".active").removeClass("active"),i=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',n=t(i).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}};var n=t.fn.scrollspy;t.fn.scrollspy=function(n){return this.each(function(){var i=t(this),r=i.data("scrollspy"),o="object"==typeof n&&n;r||i.data("scrollspy",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.scrollspy.Constructor=e,t.fn.scrollspy.defaults={offset:10},t.fn.scrollspy.noConflict=function(){return t.fn.scrollspy=n,this},t(window).on("load",function(){t('[data-spy="scroll"]').each(function(){var e=t(this);e.scrollspy(e.data())})})}(window.jQuery),/* ========================================================
 * bootstrap-tab.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#tabs
 * ========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ======================================================== */
!function(t){"use strict";var e=function(e){this.element=t(e)};e.prototype={constructor:e,show:function(){var e,n,i,r=this.element,o=r.closest("ul:not(.dropdown-menu)"),a=r.attr("data-target");a||(a=r.attr("href"),a=a&&a.replace(/.*(?=#[^\s]*$)/,"")),r.parent("li").hasClass("active")||(e=o.find(".active:last a")[0],i=t.Event("show",{relatedTarget:e}),r.trigger(i),i.isDefaultPrevented()||(n=t(a),this.activate(r.parent("li"),o),this.activate(n,n.parent(),function(){r.trigger({type:"shown",relatedTarget:e})})))},activate:function(e,n,i){function r(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),e.addClass("active"),a?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu")&&e.closest("li.dropdown").addClass("active"),i&&i()}var o=n.find("> .active"),a=i&&t.support.transition&&o.hasClass("fade");a?o.one(t.support.transition.end,r):r(),o.removeClass("in")}};var n=t.fn.tab;t.fn.tab=function(n){return this.each(function(){var i=t(this),r=i.data("tab");r||i.data("tab",r=new e(this)),"string"==typeof n&&r[n]()})},t.fn.tab.Constructor=e,t.fn.tab.noConflict=function(){return t.fn.tab=n,this},t(document).on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(e){e.preventDefault(),t(this).tab("show")})}(window.jQuery),/* =============================================================
 * bootstrap-typeahead.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#typeahead
 * =============================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ============================================================ */
!function(t){"use strict";var e=function(e,n){this.$element=t(e),this.options=t.extend({},t.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.listen()};e.prototype={constructor:e,select:function(){var t=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(t)).change(),this.hide()},updater:function(t){return t},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:e.top+e.height,left:e.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var e;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this)},process:function(e){var n=this;return e=t.grep(e,function(t){return n.matcher(t)}),e=this.sorter(e),e.length?this.render(e.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(t){return~t.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,n=[],i=[],r=[];e=t.shift();)e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?i.push(e):r.push(e):n.push(e);return n.concat(i,r)},highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},render:function(e){var n=this;return e=t(e).map(function(e,i){return e=t(n.options.item).attr("data-value",i),e.find("a").html(n.highlighter(i)),e[0]}),e.first().addClass("active"),this.$menu.html(e),this},next:function(){var e=this.$menu.find(".active").removeClass("active"),n=e.next();n.length||(n=t(this.$menu.find("li")[0])),n.addClass("active")},prev:function(){var t=this.$menu.find(".active").removeClass("active"),e=t.prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var n=t.fn.typeahead;t.fn.typeahead=function(n){return this.each(function(){var i=t(this),r=i.data("typeahead"),o="object"==typeof n&&n;r||i.data("typeahead",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},t.fn.typeahead.Constructor=e,t.fn.typeahead.noConflict=function(){return t.fn.typeahead=n,this},t(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var e=t(this);e.data("typeahead")||e.typeahead(e.data())})}(window.jQuery),/* ==========================================================
 * bootstrap-affix.js v2.3.2
 * http://twbs.github.com/bootstrap/javascript.html#affix
 * ==========================================================
 * Copyright 2013 Twitter, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================== */
!function(t){"use strict";var e=function(e,n){this.options=t.extend({},t.fn.affix.defaults,n),this.$window=t(window).on("scroll.affix.data-api",t.proxy(this.checkPosition,this)).on("click.affix.data-api",t.proxy(function(){setTimeout(t.proxy(this.checkPosition,this),1)},this)),this.$element=t(e),this.checkPosition()};e.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e,n=t(document).height(),i=this.$window.scrollTop(),r=this.$element.offset(),o=this.options.offset,a=o.bottom,s=o.top,l="affix affix-top affix-bottom";"object"!=typeof o&&(a=s=o),"function"==typeof s&&(s=o.top()),"function"==typeof a&&(a=o.bottom()),e=null!=this.unpin&&i+this.unpin<=r.top?!1:null!=a&&r.top+this.$element.height()>=n-a?"bottom":null!=s&&s>=i?"top":!1,this.affixed!==e&&(this.affixed=e,this.unpin="bottom"==e?r.top-i:null,this.$element.removeClass(l).addClass("affix"+(e?"-"+e:"")))}};var n=t.fn.affix;t.fn.affix=function(n){return this.each(function(){var i=t(this),r=i.data("affix"),o="object"==typeof n&&n;r||i.data("affix",r=new e(this,o)),"string"==typeof n&&r[n]()})},t.fn.affix.Constructor=e,t.fn.affix.defaults={offset:0},t.fn.affix.noConflict=function(){return t.fn.affix=n,this},t(window).on("load",function(){t('[data-spy="affix"]').each(function(){var e=t(this),n=e.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),e.affix(n)})})}(window.jQuery),function(t){"use strict";var e='[data-toggle="context"]',n=function(e,n){this.$element=t(e),this.before=n.before||this.before,this.onItem=n.onItem||this.onItem,this.scopes=n.scopes||null,n.target&&this.$element.data("target",n.target),n.no_automatic?this.listen(!1):this.listen(!0)};n.prototype={constructor:n,show:function(e){var n,i,r,o,a={relatedTarget:this};if(!this.isDisabled()&&(this.closemenu(),this.before.call(this,e,t(e.currentTarget))))return n=this.getMenu(),n.trigger(i=t.Event("show.bs.context",a)),r=this.getPosition(e,n),o="li:not(.divider)",n.attr("style","").css(r).addClass("open").on("click.context.data-api",o,t.proxy(this.onItem,this,t(e.currentTarget))).trigger("shown.bs.context",a),t("html").on("click.context.data-api",n.selector,t.proxy(this.closemenu,this)),!1},closemenu:function(){var e,n,i,r;return e=this.getMenu(),e.hasClass("open")?(r={relatedTarget:this},e.trigger(n=t.Event("hide.bs.context",r)),i="li:not(.divider)",e.removeClass("open").off("click.context.data-api",i).trigger("hidden.bs.context",r),t("html").off("click.context.data-api",e.selector),!1):void 0},before:function(){return!0},onItem:function(){return!0},listen:function(e){"undefined"==typeof e&&(e=!0),t("html").on("click.context.data-api",t.proxy(this.closemenu,this)),e&&this.$element.on("contextmenu.context.data-api",this.scopes,t.proxy(this.show,this))},destroy:function(){this.$element.off(".context.data-api").removeData("context"),t("html").off(".context.data-api")},isDisabled:function(){return this.$element.hasClass(".disabled")||this.$element.attr("disabled")},getMenu:function(){var e,n=this.$element.data("target");return n||(n=this.$element.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),e=t(n),e&&e.length?e:this.$element.find(n)},getPosition:function(e,n){var i,r,o,a=e.clientX,s=e.clientY,l=t(window).width(),u=t(window).height(),c=n.find(".bootstrap-dropdown-menu").outerWidth(),d=n.find(".bootstrap-dropdown-menu").outerHeight(),h={position:"absolute","z-index":9999};return i=s+d>u?{top:s-d+t(window).scrollTop()}:{top:s+t(window).scrollTop()},r=a+c>l&&a-c>0?{left:a-c+t(window).scrollLeft()}:{left:a+t(window).scrollLeft()},o=n.offsetParent().offset(),r.left=r.left-o.left,i.top=i.top-o.top,t.extend(h,i,r)}},t.fn.contextmenu=function(e,i){return this.each(function(){var r=t(this),o=r.data("context"),a="object"==typeof e&&e;o||r.data("context",o=new n(r,a)),"string"==typeof e&&o[e].call(o,i)})},t.fn.contextmenu.Constructor=n,t(document).on("contextmenu.context.data-api",e,function(e){t(this).contextmenu("show",e),e.preventDefault()})}(jQuery),function(){function t(e,n,i){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;if(e._chain&&(e=e._wrapped),n._chain&&(n=n._wrapped),e.isEqual&&w.isFunction(e.isEqual))return e.isEqual(n);if(n.isEqual&&w.isFunction(n.isEqual))return n.isEqual(e);var r=l.call(e);if(r!=l.call(n))return!1;switch(r){case"[object String]":return e==String(n);case"[object Number]":return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case"[object Date]":case"[object Boolean]":return+e==+n;case"[object RegExp]":return e.source==n.source&&e.global==n.global&&e.multiline==n.multiline&&e.ignoreCase==n.ignoreCase}if("object"!=typeof e||"object"!=typeof n)return!1;for(var o=i.length;o--;)if(i[o]==e)return!0;i.push(e);var o=0,a=!0;if("[object Array]"==r){if(o=e.length,a=o==n.length)for(;o--&&(a=o in e==o in n&&t(e[o],n[o],i)););}else{if("constructor"in e!="constructor"in n||e.constructor!=n.constructor)return!1;for(var s in e)if(w.has(e,s)&&(o++,!(a=w.has(n,s)&&t(e[s],n[s],i))))break;if(a){for(s in n)if(w.has(n,s)&&!o--)break;a=!o}}return i.pop(),a}var e=this,n=e._,i={},r=Array.prototype,o=Object.prototype,a=r.slice,s=r.unshift,l=o.toString,u=o.hasOwnProperty,c=r.forEach,d=r.map,h=r.reduce,p=r.reduceRight,_=r.filter,f=r.every,m=r.some,g=r.indexOf,v=r.lastIndexOf,o=Array.isArray,b=Object.keys,y=Function.prototype.bind,w=function(t){return new S(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):e._=w,w.VERSION="1.3.1";var k=w.each=w.forEach=function(t,e,n){if(null!=t)if(c&&t.forEach===c)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,o=t.length;o>r&&!(r in t&&e.call(n,t[r],r,t)===i);r++);else for(r in t)if(w.has(t,r)&&e.call(n,t[r],r,t)===i)break};w.map=w.collect=function(t,e,n){var i=[];return null==t?i:d&&t.map===d?t.map(e,n):(k(t,function(t,r,o){i[i.length]=e.call(n,t,r,o)}),t.length===+t.length&&(i.length=t.length),i)},w.reduce=w.foldl=w.inject=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),h&&t.reduce===h)return i&&(e=w.bind(e,i)),r?t.reduce(e,n):t.reduce(e);if(k(t,function(t,o,a){r?n=e.call(i,n,t,o,a):(n=t,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},w.reduceRight=w.foldr=function(t,e,n,i){var r=arguments.length>2;if(null==t&&(t=[]),p&&t.reduceRight===p)return i&&(e=w.bind(e,i)),r?t.reduceRight(e,n):t.reduceRight(e);var o=w.toArray(t).reverse();return i&&!r&&(e=w.bind(e,i)),r?w.reduce(o,e,n,i):w.reduce(o,e)},w.find=w.detect=function(t,e,n){var i;return $(t,function(t,r,o){return e.call(n,t,r,o)?(i=t,!0):void 0}),i},w.filter=w.select=function(t,e,n){var i=[];return null==t?i:_&&t.filter===_?t.filter(e,n):(k(t,function(t,r,o){e.call(n,t,r,o)&&(i[i.length]=t)}),i)},w.reject=function(t,e,n){var i=[];return null==t?i:(k(t,function(t,r,o){e.call(n,t,r,o)||(i[i.length]=t)}),i)},w.every=w.all=function(t,e,n){var r=!0;return null==t?r:f&&t.every===f?t.every(e,n):(k(t,function(t,o,a){return(r=r&&e.call(n,t,o,a))?void 0:i}),r)};var $=w.some=w.any=function(t,e,n){e||(e=w.identity);var r=!1;return null==t?r:m&&t.some===m?t.some(e,n):(k(t,function(t,o,a){return r||(r=e.call(n,t,o,a))?i:void 0}),!!r)};w.include=w.contains=function(t,e){var n=!1;return null==t?n:g&&t.indexOf===g?-1!=t.indexOf(e):n=$(t,function(t){return t===e})},w.invoke=function(t,e){var n=a.call(arguments,2);return w.map(t,function(t){return(w.isFunction(e)?e||t:t[e]).apply(t,n)})},w.pluck=function(t,e){return w.map(t,function(t){return t[e]})},w.max=function(t,e,n){if(!e&&w.isArray(t))return Math.max.apply(Math,t);if(!e&&w.isEmpty(t))return-1/0;var i={computed:-1/0};return k(t,function(t,r,o){r=e?e.call(n,t,r,o):t,r>=i.computed&&(i={value:t,computed:r})}),i.value},w.min=function(t,e,n){if(!e&&w.isArray(t))return Math.min.apply(Math,t);if(!e&&w.isEmpty(t))return 1/0;var i={computed:1/0};return k(t,function(t,r,o){r=e?e.call(n,t,r,o):t,r<i.computed&&(i={value:t,computed:r})}),i.value},w.shuffle=function(t){var e,n=[];return k(t,function(t,i){0==i?n[0]=t:(e=Math.floor(Math.random()*(i+1)),n[i]=n[e],n[e]=t)}),n},w.sortBy=function(t,e,n){return w.pluck(w.map(t,function(t,i,r){return{value:t,criteria:e.call(n,t,i,r)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;return i>n?-1:n>i?1:0}),"value")},w.groupBy=function(t,e){var n={},i=w.isFunction(e)?e:function(t){return t[e]};return k(t,function(t,e){var r=i(t,e);(n[r]||(n[r]=[])).push(t)}),n},w.sortedIndex=function(t,e,n){n||(n=w.identity);for(var i=0,r=t.length;r>i;){var o=i+r>>1;n(t[o])<n(e)?i=o+1:r=o}return i},w.toArray=function(t){return t?t.toArray?t.toArray():w.isArray(t)?a.call(t):w.isArguments(t)?a.call(t):w.values(t):[]},w.size=function(t){return w.toArray(t).length},w.first=w.head=function(t,e,n){return null==e||n?t[0]:a.call(t,0,e)},w.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},w.last=function(t,e,n){return null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},w.rest=w.tail=function(t,e,n){return a.call(t,null==e||n?1:e)},w.compact=function(t){return w.filter(t,function(t){return!!t})},w.flatten=function(t,e){return w.reduce(t,function(t,n){return w.isArray(n)?t.concat(e?n:w.flatten(n)):(t[t.length]=n,t)},[])},w.without=function(t){return w.difference(t,a.call(arguments,1))},w.uniq=w.unique=function(t,e,n){var n=n?w.map(t,n):t,i=[];return w.reduce(n,function(n,r,o){return 0!=o&&(e===!0?w.last(n)==r:w.include(n,r))||(n[n.length]=r,i[i.length]=t[o]),n},[]),i},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(t){var e=a.call(arguments,1);return w.filter(w.uniq(t),function(t){return w.every(e,function(e){return w.indexOf(e,t)>=0})})},w.difference=function(t){var e=w.flatten(a.call(arguments,1));return w.filter(t,function(t){return!w.include(e,t)})},w.zip=function(){for(var t=a.call(arguments),e=w.max(w.pluck(t,"length")),n=Array(e),i=0;e>i;i++)n[i]=w.pluck(t,""+i);return n},w.indexOf=function(t,e,n){if(null==t)return-1;var i;if(n)return n=w.sortedIndex(t,e),t[n]===e?n:-1;if(g&&t.indexOf===g)return t.indexOf(e);for(n=0,i=t.length;i>n;n++)if(n in t&&t[n]===e)return n;return-1},w.lastIndexOf=function(t,e){if(null==t)return-1;if(v&&t.lastIndexOf===v)return t.lastIndexOf(e);for(var n=t.length;n--;)if(n in t&&t[n]===e)return n;return-1},w.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0);for(var n=arguments[2]||1,i=Math.max(Math.ceil((e-t)/n),0),r=0,o=Array(i);i>r;)o[r++]=t,t+=n;return o};var x=function(){};w.bind=function(t,e){var n,i;if(t.bind===y&&y)return y.apply(t,a.call(arguments,1));if(!w.isFunction(t))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return t.apply(e,i.concat(a.call(arguments)));x.prototype=t.prototype;var r=new x,o=t.apply(r,i.concat(a.call(arguments)));return Object(o)===o?o:r}},w.bindAll=function(t){var e=a.call(arguments,1);return 0==e.length&&(e=w.functions(t)),k(e,function(e){t[e]=w.bind(t[e],t)}),t},w.memoize=function(t,e){var n={};return e||(e=w.identity),function(){var i=e.apply(this,arguments);return w.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},w.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(t,n)},e)},w.defer=function(t){return w.delay.apply(w,[t,1].concat(a.call(arguments,1)))},w.throttle=function(t,e){var n,i,r,o,a,s=w.debounce(function(){a=o=!1},e);return function(){n=this,i=arguments,r||(r=setTimeout(function(){r=null,a&&t.apply(n,i),s()},e)),o?a=!0:t.apply(n,i),s(),o=!0}},w.debounce=function(t,e){var n;return function(){var i=this,r=arguments;clearTimeout(n),n=setTimeout(function(){n=null,t.apply(i,r)},e)}},w.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}},w.wrap=function(t,e){return function(){var n=[t].concat(a.call(arguments,0));return e.apply(this,n)}},w.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},w.after=function(t,e){return 0>=t?e():function(){return--t<1?e.apply(this,arguments):void 0}},w.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e,n=[];for(e in t)w.has(t,e)&&(n[n.length]=e);return n},w.values=function(t){return w.map(t,w.identity)},w.functions=w.methods=function(t){var e,n=[];for(e in t)w.isFunction(t[e])&&n.push(e);return n.sort()},w.extend=function(t){return k(a.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t},w.defaults=function(t){return k(a.call(arguments,1),function(e){for(var n in e)null==t[n]&&(t[n]=e[n])}),t},w.clone=function(t){return w.isObject(t)?w.isArray(t)?t.slice():w.extend({},t):t},w.tap=function(t,e){return e(t),t},w.isEqual=function(e,n){return t(e,n,[])},w.isEmpty=function(t){if(w.isArray(t)||w.isString(t))return 0===t.length;for(var e in t)if(w.has(t,e))return!1;return!0},w.isElement=function(t){return!(!t||1!=t.nodeType)},w.isArray=o||function(t){return"[object Array]"==l.call(t)},w.isObject=function(t){return t===Object(t)},w.isArguments=function(t){return"[object Arguments]"==l.call(t)},w.isArguments(arguments)||(w.isArguments=function(t){return!(!t||!w.has(t,"callee"))}),w.isFunction=function(t){return"[object Function]"==l.call(t)},w.isString=function(t){return"[object String]"==l.call(t)},w.isNumber=function(t){return"[object Number]"==l.call(t)},w.isNaN=function(t){return t!==t},w.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==l.call(t)},w.isDate=function(t){return"[object Date]"==l.call(t)},w.isRegExp=function(t){return"[object RegExp]"==l.call(t)},w.isNull=function(t){return null===t},w.isUndefined=function(t){return void 0===t},w.has=function(t,e){return u.call(t,e)},w.noConflict=function(){return e._=n,this},w.identity=function(t){return t},w.times=function(t,e,n){for(var i=0;t>i;i++)e.call(n,i)},w.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.mixin=function(t){k(w.functions(t),function(e){D(e,w[e]=t[e])})};var C=0;w.uniqueId=function(t){var e=C++;return t?t+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/.^/,T=function(t){return t.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};w.template=function(t,e){var n=w.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(n.escape||q,function(t,e){return"',_.escape("+T(e)+"),'"}).replace(n.interpolate||q,function(t,e){return"',"+T(e)+",'"}).replace(n.evaluate||q,function(t,e){return"');"+T(e).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj","_",n);return e?i(e,w):function(t){return i.call(this,t,w)}},w.chain=function(t){return w(t).chain()};var S=function(t){this._wrapped=t};w.prototype=S.prototype;var E=function(t,e){return e?w(t).chain():t},D=function(t,e){S.prototype[t]=function(){var t=a.call(arguments);return s.call(t,this._wrapped),E(e.apply(w,t),this._chain)}};w.mixin(w),k("pop,push,reverse,shift,sort,splice,unshift".split(","),function(t){var e=r[t];S.prototype[t]=function(){var n=this._wrapped;e.apply(n,arguments);var i=n.length;return("shift"==t||"splice"==t)&&0===i&&delete n[0],E(n,this._chain)}}),k(["concat","join","slice"],function(t){var e=r[t];S.prototype[t]=function(){return E(e.apply(this._wrapped,arguments),this._chain)}}),S.prototype.chain=function(){return this._chain=!0,this},S.prototype.value=function(){return this._wrapped}}.call(this),function(t){var e=String.prototype.trim,n=function(t,e){for(var n=[];e>0;n[--e]=t);return n.join("")},i=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),n=0;n<e.length;n++)e[n]=null==e[n]?"":""+e[n];return t.apply(null,e)}},r=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var e=function(){return e.cache.hasOwnProperty(arguments[0])||(e.cache[arguments[0]]=e.parse(arguments[0])),e.format.call(null,e.cache[arguments[0]],arguments)};return e.format=function(e,i){var o,a,s,l,u=1,c=e.length,d="",h=[];for(o=0;c>o;o++)if(d=t(e[o]),"string"===d)h.push(e[o]);else if("array"===d){if(s=e[o],s[2])for(d=i[u],a=0;a<s[2].length;a++){if(!d.hasOwnProperty(s[2][a]))throw r('[_.sprintf] property "%s" does not exist',s[2][a]);d=d[s[2][a]]}else d=s[1]?i[s[1]]:i[u++];if(/[^s]/.test(s[8])&&"number"!=t(d))throw r("[_.sprintf] expecting number but found %s",t(d));switch(s[8]){case"b":d=d.toString(2);break;case"c":d=String.fromCharCode(d);break;case"d":d=parseInt(d,10);break;case"e":d=s[7]?d.toExponential(s[7]):d.toExponential();break;case"f":d=s[7]?parseFloat(d).toFixed(s[7]):parseFloat(d);break;case"o":d=d.toString(8);break;case"s":d=(d=String(d))&&s[7]?d.substring(0,s[7]):d;break;case"u":d=Math.abs(d);break;case"x":d=d.toString(16);break;case"X":d=d.toString(16).toUpperCase()}d=/[def]/.test(s[8])&&s[3]&&d>=0?"+"+d:d,a=s[4]?"0"==s[4]?"0":s[4].charAt(1):" ",l=s[6]-String(d).length,a=s[6]?n(a,l):"",h.push(s[5]?d+a:a+d)}return h.join("")},e.cache={},e.parse=function(t){for(var e=[],n=[],i=0;t;){if(null!==(e=/^[^\x25]+/.exec(t)))n.push(e[0]);else if(null!==(e=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(e=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[_.sprintf] huh?";if(e[2]){i|=1;var r=[],o=e[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[_.sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[_.sprintf] huh?";r.push(a[1])}e[2]=r}else i|=2;if(3===i)throw"[_.sprintf] mixing positional and named placeholders is not (yet) supported";n.push(e)}t=t.substring(e[0].length)}return n},e}(),o={VERSION:"1.2.0",isBlank:i(function(t){return/^\s*$/.test(t)}),stripTags:i(function(t){return t.replace(/<\/?[^>]+>/gi,"")}),capitalize:i(function(t){return t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()}),chop:i(function(t,e){for(var e=1*e||0||t.length,n=[],i=0;i<t.length;)n.push(t.slice(i,i+e)),i+=e;return n}),clean:i(function(t){return o.strip(t.replace(/\s+/g," "))}),count:i(function(t,e){for(var n,i=0,r=0;r<t.length;)n=t.indexOf(e,r),n>=0&&i++,r=r+(n>=0?n:0)+e.length;return i}),chars:i(function(t){return t.split("")}),escapeHTML:i(function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}),unescapeHTML:i(function(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&")}),escapeRegExp:i(function(t){return t.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}),insert:i(function(t,e,n){return t=t.split(""),t.splice(1*e||0,0,n),t.join("")}),include:i(function(t,e){return-1!==t.indexOf(e)}),join:i(function(){var t=Array.prototype.slice.call(arguments);return t.join(t.shift())}),lines:i(function(t){return t.split("\n")}),reverse:i(function(t){return Array.prototype.reverse.apply(String(t).split("")).join("")}),splice:i(function(t,e,n,i){return t=t.split(""),t.splice(1*e||0,1*n||0,i),t.join("")}),startsWith:i(function(t,e){return t.length>=e.length&&t.substring(0,e.length)===e}),endsWith:i(function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}),succ:i(function(t){var e=t.split("");return e.splice(t.length-1,1,String.fromCharCode(t.charCodeAt(t.length-1)+1)),e.join("")}),titleize:i(function(t){for(var e,t=t.split(" "),n=0;n<t.length;n++)e=t[n].split(""),"undefined"!=typeof e[0]&&(e[0]=e[0].toUpperCase()),t[n]=n+1===t.length?e.join(""):e.join("")+" ";return t.join("")}),camelize:i(function(t){return o.trim(t).replace(/(\-|_|\s)+(.)?/g,function(t,e,n){return n?n.toUpperCase():""})}),underscored:function(t){return o.trim(t).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/\-|\s+/g,"_").toLowerCase()},dasherize:function(t){return o.trim(t).replace(/([a-z\d])([A-Z]+)/g,"$1-$2").replace(/^([A-Z]+)/,"-$1").replace(/\_|\s+/g,"-").toLowerCase()},humanize:function(t){return o.capitalize(this.underscored(t).replace(/_id$/,"").replace(/_/g," "))},trim:i(function(t,n){return!n&&e?e.call(t):(n=n?o.escapeRegExp(n):"\\s",t.replace(RegExp("^["+n+"]+|["+n+"]+$","g"),""))}),ltrim:i(function(t,e){return e=e?o.escapeRegExp(e):"\\s",t.replace(RegExp("^["+e+"]+","g"),"")}),rtrim:i(function(t,e){return e=e?o.escapeRegExp(e):"\\s",t.replace(RegExp("["+e+"]+$","g"),"")}),truncate:i(function(t,e,n){return e=1*e||0,t.length>e?t.slice(0,e)+(n||"..."):t}),prune:i(function(t,e,n){var n=n||"...",e=1*e||0,i="",i=0===t.substring(e-1,e+1).search(/^\w\w$/)?o.rtrim(t.slice(0,e).replace(/([\W][\w]*)$/,"")):o.rtrim(t.slice(0,e)),i=i.replace(/\W+$/,"");return i.length+n.length>t.length?t:i+n}),words:function(t,e){return String(t).split(e||" ")},pad:i(function(t,e,i,r){var o="",o=0,e=1*e||0;switch(i?i.length>1&&(i=i.charAt(0)):i=" ",r){case"right":o=e-t.length,o=n(i,o),t+=o;break;case"both":o=e-t.length,o={left:n(i,Math.ceil(o/2)),right:n(i,Math.floor(o/2))},t=o.left+t+o.right;break;default:o=e-t.length,o=n(i,o),t=o+t}return t}),lpad:function(t,e,n){return o.pad(t,e,n)},rpad:function(t,e,n){return o.pad(t,e,n,"right")},lrpad:function(t,e,n){return o.pad(t,e,n,"both")},sprintf:r,vsprintf:function(t,e){return e.unshift(t),r.apply(null,e)},toNumber:function(t,e){var n;return n=1*(1*t||0).toFixed(1*e||0)||0,0!==n||"0"===t||0===t?n:Number.NaN},strRight:i(function(t,e){var n=e?t.indexOf(e):-1;return-1!=n?t.slice(n+e.length,t.length):t}),strRightBack:i(function(t,e){var n=e?t.lastIndexOf(e):-1;return-1!=n?t.slice(n+e.length,t.length):t}),strLeft:i(function(t,e){var n=e?t.indexOf(e):-1;return-1!=n?t.slice(0,n):t}),strLeftBack:i(function(t,e){var n=t.lastIndexOf(e);return-1!=n?t.slice(0,n):t}),exports:function(){var t,e={};for(t in this)this.hasOwnProperty(t)&&"include"!=t&&"contains"!=t&&"reverse"!=t&&(e[t]=this[t]);return e}};o.strip=o.trim,o.lstrip=o.ltrim,o.rstrip=o.rtrim,o.center=o.lrpad,o.ljust=o.lpad,o.rjust=o.rpad,o.contains=o.include,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=o),exports._s=o):"undefined"!=typeof t._?(t._.string=o,t._.str=t._.string):t._={string:o,str:o}}(this||window);var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(t,e,n){n&&(e.not=n),this.helpers[t]=e},Handlebars.registerPartial=function(t,e){this.partials[t]=e},Handlebars.registerHelper("helperMissing",function(t){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+t+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(t,e){var n=e.inverse||function(){},i=e.fn,r="",o=toString.call(t);if(o===functionType&&(t=t.call(this)),t===!0)return i(this);if(t===!1||null==t)return n(this);if("[object Array]"===o){if(t.length>0)for(var a=0,s=t.length;s>a;a++)r+=i(t[a]);else r=n(this);return r}return i(t)}),Handlebars.registerHelper("each",function(t,e){var n=e.fn,i=e.inverse,r="";if(t&&t.length>0)for(var o=0,a=t.length;a>o;o++)r+=n(t[o]);else r=i(this);return r}),Handlebars.registerHelper("if",function(t,e){var n=toString.call(t);return n===functionType&&(t=t.call(this)),!t||Handlebars.Utils.isEmpty(t)?e.inverse(this):e.fn(this)}),Handlebars.registerHelper("unless",function(t,e){var n=e.fn,i=e.inverse;return e.fn=i,e.inverse=n,Handlebars.helpers["if"].call(this,t,e)}),Handlebars.registerHelper("with",function(t,e){return e.fn(t)}),Handlebars.registerHelper("log",function(t){Handlebars.log(t)});var handlebars=function(){var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function(t,e,n,i,r,o){var a=o.length-1;switch(r){case 1:return o[a-1];case 2:this.$=new i.ProgramNode(o[a-2],o[a]);break;case 3:this.$=new i.ProgramNode(o[a]);break;case 4:this.$=new i.ProgramNode([]);break;case 5:this.$=[o[a]];break;case 6:o[a-1].push(o[a]),this.$=o[a-1];break;case 7:this.$=new i.InverseNode(o[a-2],o[a-1],o[a]);break;case 8:this.$=new i.BlockNode(o[a-2],o[a-1],o[a]);break;case 9:this.$=o[a];break;case 10:this.$=o[a];break;case 11:this.$=new i.ContentNode(o[a]);break;case 12:this.$=new i.CommentNode(o[a]);break;case 13:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 14:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 15:this.$=o[a-1];break;case 16:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 17:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],!0);break;case 18:this.$=new i.PartialNode(o[a-1]);break;case 19:this.$=new i.PartialNode(o[a-2],o[a-1]);break;case 20:break;case 21:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 22:this.$=[[o[a-1]].concat(o[a]),null];break;case 23:this.$=[[o[a-1]],o[a]];break;case 24:this.$=[[o[a]],null];break;case 25:o[a-1].push(o[a]),this.$=o[a-1];break;case 26:this.$=[o[a]];break;case 27:this.$=o[a];break;case 28:this.$=new i.StringNode(o[a]);break;case 29:this.$=new i.IntegerNode(o[a]);break;case 30:this.$=new i.BooleanNode(o[a]);break;case 31:this.$=new i.HashNode(o[a]);break;case 32:o[a-1].push(o[a]),this.$=o[a-1];break;case 33:this.$=[o[a]];break;case 34:this.$=[o[a-2],o[a]];break;case 35:this.$=[o[a-2],new i.StringNode(o[a])];break;case 36:this.$=[o[a-2],new i.IntegerNode(o[a])];break;case 37:this.$=[o[a-2],new i.BooleanNode(o[a])];break;case 38:this.$=new i.IdNode(o[a]);break;case 39:o[a-2].push(o[a]),this.$=o[a-2];break;case 40:this.$=[o[a]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(t){throw new Error(t)},parse:function(t){function e(){var t;return t=n.lexer.lex()||1,"number"!=typeof t&&(t=n.symbols_[t]||t),t}var n=this,i=[0],r=[null],o=[],a=this.table,s="",l=0,u=0,c=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;o.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,_,f,m,g,v,b,y,w={};;){if(_=i[i.length-1],this.defaultActions[_]?f=this.defaultActions[_]:(null==h&&(h=e()),f=a[_]&&a[_][h]),!("undefined"!=typeof f&&f.length&&f[0]||c)){y=[];for(g in a[_])this.terminals_[g]&&g>2&&y.push("'"+this.terminals_[g]+"'");var k="";k=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:y})}if(f[0]instanceof Array&&f.length>1)throw new Error("Parse Error: multiple actions possible at state: "+_+", token: "+h);switch(f[0]){case 1:i.push(h),r.push(this.lexer.yytext),o.push(this.lexer.yylloc),i.push(f[1]),h=null,p?(h=p,p=null):(u=this.lexer.yyleng,s=this.lexer.yytext,l=this.lexer.yylineno,d=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[f[1]][1],w.$=r[r.length-v],w._$={first_line:o[o.length-(v||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(v||1)].first_column,last_column:o[o.length-1].last_column},m=this.performAction.call(w,s,u,l,this.yy,f[1],r,o),"undefined"!=typeof m)return m;v&&(i=i.slice(0,2*-1*v),r=r.slice(0,-1*v),o=o.slice(0,-1*v)),i.push(this.productions_[f[1]][0]),r.push(w.$),o.push(w._$),b=a[i[i.length-2]][i[i.length-1]],i.push(b);break;case 3:return!0}}return!0}},e=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t;var e=t.match(/\n/);return e&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");
return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),r=0;r<i.length;r++)if(e=this._input.match(this.rules[i[r]]))return n=e[0].match(/\n.*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,i[r],this.conditionStack[this.conditionStack.length-1]),t?t:void 0;return""===this._input?this.EOF:(this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno}),void 0)},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.performAction=function(t,e,n,i){switch(n){case 0:if("\\"!==e.yytext.slice(-1)&&this.begin("mu"),"\\"===e.yytext.slice(-1)&&(e.yytext=e.yytext.substr(0,e.yyleng-1),this.begin("emu")),e.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return e.yytext=e.yytext.substr(3,e.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return e.yytext=e.yytext.substr(1,e.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return e.yytext=e.yytext.substr(1,e.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},t.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],t.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},t}();return t.lexer=e,t}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");if("undefined"!=typeof process)var e=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");else var n=require("file").path(require("file").cwd()),e=n.join(t[1]).read({charset:"utf-8"});return exports.parser.parse(e)},"undefined"!=typeof module&&require.main===module&&exports.main("undefined"!=typeof process?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(t){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(t)},Handlebars.print=function(t){return(new Handlebars.PrintVisitor).accept(t)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}},Handlebars.log=function(t,e){Handlebars.logger.log(t,e)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(t,e){this.type="program",this.statements=t,e&&(this.inverse=new Handlebars.AST.ProgramNode(e))},Handlebars.AST.MustacheNode=function(t,e,n){this.type="mustache",this.id=t[0],this.params=t.slice(1),this.hash=e,this.escaped=!n},Handlebars.AST.PartialNode=function(t,e){this.type="partial",this.id=t,this.context=e};var t=function(t,e){if(t.original!==e.original)throw new Handlebars.Exception(t.original+" doesn't match "+e.original)};Handlebars.AST.BlockNode=function(e,n,i){t(e.id,i),this.type="block",this.mustache=e,this.program=n},Handlebars.AST.InverseNode=function(e,n,i){t(e.id,i),this.type="inverse",this.mustache=e,this.program=n},Handlebars.AST.ContentNode=function(t){this.type="content",this.string=t},Handlebars.AST.HashNode=function(t){this.type="hash",this.pairs=t},Handlebars.AST.IdNode=function(t){this.type="ID",this.original=t.join(".");for(var e=[],n=0,i=0,r=t.length;r>i;i++){var o=t[i];".."===o?n++:"."===o||"this"===o?this.isScoped=!0:e.push(o)}this.parts=e,this.string=e.join("."),this.depth=n,this.isSimple=1===e.length&&0===n},Handlebars.AST.StringNode=function(t){this.type="STRING",this.string=t},Handlebars.AST.IntegerNode=function(t){this.type="INTEGER",this.integer=t},Handlebars.AST.BooleanNode=function(t){this.type="BOOLEAN",this.bool=t},Handlebars.AST.CommentNode=function(t){this.type="comment",this.comment=t}}(),Handlebars.Exception=function(){var t=Error.prototype.constructor.apply(this,arguments);for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);this.message=t.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(t){this.string=t},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,i=function(e){return t[e]||"&amp;"};Handlebars.Utils={escapeExpression:function(t){return t instanceof Handlebars.SafeString?t.toString():null==t||t===!1?"":n.test(t)?t.replace(e,i):t},isEmpty:function(t){return"undefined"==typeof t?!0:null===t?!0:t===!1?!0:"[object Array]"===Object.prototype.toString.call(t)&&0===t.length?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(t,e){t.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16},t.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1},t.DISASSEMBLE_MAP={};for(var n in t.OPCODE_MAP){var i=t.OPCODE_MAP[n];t.DISASSEMBLE_MAP[i]=n}t.multiParamSize=function(e){return t.MULTI_PARAM_OPCODES[t.DISASSEMBLE_MAP[e]]},t.prototype={compiler:t,disassemble:function(){for(var e,n,i,r,o,a=this.opcodes,s=[],l=0,u=a.length;u>l;l++)if(e=a[l],"DECLARE"===e)r=a[++l],o=a[++l],s.push("DECLARE "+r+" = "+o);else{i=t.DISASSEMBLE_MAP[e];for(var c=t.multiParamSize(e),d=[],h=0;c>h;h++)n=a[++l],"string"==typeof n&&(n='"'+n.replace("\n","\\n")+'"'),d.push(n);i=i+" "+d.join(" "),s.push(i)}return s.join("\n")},guid:0,compile:function(t,e){this.children=[],this.depths={list:[]},this.options=e;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.program(t)},accept:function(t){return this[t.type](t)},program:function(t){var e,n=t.statements;this.opcodes=[];for(var i=0,r=n.length;r>i;i++)e=n[i],this[e.type](e);return this.isSimple=1===r,this.depths.list=this.depths.list.sort(function(t,e){return t-e}),this},compileProgram:function(t){var e=(new this.compiler).compile(t,this.options),n=this.guid++;this.usePartial=this.usePartial||e.usePartial,this.children[n]=e;for(var i=0,r=e.depths.list.length;r>i;i++)depth=e.depths.list[i],2>depth||this.addDepth(depth-1);return n},block:function(t){var e,n=t.mustache,i=this.setupStackForMustache(n),r=this.compileProgram(t.program);t.program.inverse&&(e=this.compileProgram(t.program.inverse),this.declare("inverse",e)),this.opcode("invokeProgram",r,i.length,!!n.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(t){var e=this.setupStackForMustache(t.mustache),n=this.compileProgram(t.program);this.declare("inverse",n),this.opcode("invokeProgram",null,e.length,!!t.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(t){var e,n,i=t.pairs;this.opcode("push","{}");for(var r=0,o=i.length;o>r;r++)e=i[r],n=e[1],this.accept(n),this.opcode("assignToHash",e[0])},partial:function(t){var e=t.id;this.usePartial=!0,t.context?this.ID(t.context):this.opcode("push","depth0"),this.opcode("invokePartial",e.original),this.opcode("append")},content:function(t){this.opcode("appendContent",t.string)},mustache:function(t){var e=this.setupStackForMustache(t);this.opcode("invokeMustache",e.length,t.id.original,!!t.hash),t.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("lookupWithHelpers",t.parts[0]||null,t.isScoped||!1);for(var e=1,n=t.parts.length;n>e;e++)this.opcode("lookup",t.parts[e])},STRING:function(t){this.opcode("pushString",t.string)},INTEGER:function(t){this.opcode("push",t.integer)},BOOLEAN:function(t){this.opcode("push",t.bool)},comment:function(){},pushParams:function(t){for(var e,n=t.length;n--;)e=t[n],this.options.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.string)):this[e.type](e)},opcode:function(e,n,i,r){this.opcodes.push(t.OPCODE_MAP[e]),void 0!==n&&this.opcodes.push(n),void 0!==i&&this.opcodes.push(i),void 0!==r&&this.opcodes.push(r)},declare:function(t,e){this.opcodes.push("DECLARE"),this.opcodes.push(t),this.opcodes.push(e)},addDepth:function(t){0!==t&&(this.depths[t]||(this.depths[t]=!0,this.depths.list.push(t)))},setupStackForMustache:function(t){var e=t.params;return this.pushParams(e),t.hash&&this.hash(t.hash),this.ID(t.id),e}},e.prototype={nameLookup:function(t,n){return/^[0-9]+$/.test(n)?t+"["+n+"]":e.isValidJavaScriptVariableName(n)?t+"."+n:t+"['"+n+"']"},appendToBuffer:function(t){return this.environment.isSimple?"return "+t+";":"buffer += "+t+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,e,n,i){this.environment=t,this.options=e||{},this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(t,e);var r,o=t.opcodes;for(this.i=0,s=o.length;this.i<s;this.i++)r=this.nextOpcode(0),"DECLARE"===r[0]?(this.i=this.i+2,this[r[1]]=r[2]):(this.i=this.i+r[1].length,this[r[0]].apply(this,r[1]));return this.createFunctionContext(i)},nextOpcode:function(e){var n,i,r,o,a=this.environment.opcodes,s=a[this.i+e];if("DECLARE"===s)return n=a[this.i+1],i=a[this.i+2],["DECLARE",n,i];n=t.DISASSEMBLE_MAP[s],r=t.multiParamSize(s),o=[];for(var l=0;r>l;l++)o.push(a[this.i+l+1+e]);return[n,o]},eat:function(t){this.i=this.i+t.length},preamble:function(){var t=[];if(this.useRegister("foundHelper"),this.isChild)t.push("");else{var e=this.namespace,n="helpers = helpers || "+e+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+e+".partials;"),t.push(n)}this.environment.isSimple?t.push(""):t.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=t},createFunctionContext:function(t){var e=this.stackVars;if(this.isChild||(e=e.concat(this.context.registers.list)),e.length>0&&(this.source[1]=this.source[1]+", "+e.join(", ")),!this.isChild)for(var n in this.context.aliases)this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],r=0,o=this.environment.depths.list.length;o>r;r++)i.push("depth"+this.environment.depths.list[r]);if(t)return i.push(this.source.join("\n  ")),Function.apply(this,i);var a="function "+(this.name||"")+"("+i.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,a+"\n\n"),a},appendContent:function(t){this.source.push(this.appendToBuffer(this.quotedString(t)))},append:function(){var t=this.popStack();this.source.push("if("+t+" || "+t+" === 0) { "+this.appendToBuffer(t)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var t=this.nextOpcode(1),e="";this.context.aliases.escapeExpression="this.escapeExpression","appendContent"===t[0]&&(e=" + "+this.quotedString(t[1][0]),this.eat(t)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+e))},getContext:function(t){this.lastContext!==t&&(this.lastContext=t)},lookupWithHelpers:function(t,e){if(t){var n=this.nextStack();this.usingKnownHelper=!1;var i;!e&&this.options.knownHelpers[t]?(i=n+" = "+this.nameLookup("helpers",t,"helper"),this.usingKnownHelper=!0):e||this.options.knownHelpersOnly?i=n+" = "+this.nameLookup("depth"+this.lastContext,t,"context"):(this.register("foundHelper",this.nameLookup("helpers",t,"helper")),i=n+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,t,"context")),i+=";",this.source.push(i)}else this.pushStack("depth"+this.lastContext)},lookup:function(t){var e=this.topStack();this.source.push(e+" = ("+e+" === null || "+e+" === undefined || "+e+" === false ? "+e+" : "+this.nameLookup(e,t,"context")+");")},pushStringParam:function(t){this.pushStack("depth"+this.lastContext),this.pushString(t)},pushString:function(t){this.pushStack(this.quotedString(t))},push:function(t){this.pushStack(t)},invokeMustache:function(t,e,n){this.populateParams(t,this.quotedString(e),"{}",null,n,function(t,e,n){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+n+"=== undef) { "+t+" = helperMissing.call("+e+"); }"),t!==n&&this.source.push("else { "+t+" = "+n+"; }"))})},invokeProgram:function(t,e,n){var i=this.programExpression(this.inverse),r=this.programExpression(t);this.populateParams(e,null,r,i,n,function(t,e){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+t+" = blockHelperMissing.call("+e+"); }"))})},populateParams:function(t,e,n,i,r,o){var a,s,l=r||this.options.stringParams||i||this.options.data,u=this.popStack(),c=[];if(l?(this.register("tmp1",n),s="tmp1"):s="{ hash: {} }",l){var d=r?this.popStack():"{}";this.source.push("tmp1.hash = "+d+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var h=0;t>h;h++)a=this.popStack(),c.push(a),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");i&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+i+";")),this.options.data&&this.source.push("tmp1.data = data;"),c.push(s),this.populateCall(c,u,e||u,o,"{}"!==n)},populateCall:function(t,e,n,i,r){var o=["depth0"].concat(t).join(", "),a=["depth0"].concat(n).concat(t).join(", "),s=this.nextStack();if(this.usingKnownHelper)this.source.push(s+" = "+e+".call("+o+");");else{this.context.aliases.functionType='"function"';var l=r?"foundHelper && ":"";this.source.push("if("+l+"typeof "+e+" === functionType) { "+s+" = "+e+".call("+o+"); }")}i.call(this,s,a,e),this.usingKnownHelper=!1},invokePartial:function(t){params=[this.nameLookup("partials",t,"partial"),"'"+t+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(t){var e=this.popStack(),n=this.topStack();this.source.push(n+"['"+t+"'] = "+e+";")},compiler:e,compileChildren:function(t,e){for(var n,i,r=t.children,o=0,a=r.length;a>o;o++){n=r[o],i=new this.compiler,this.context.programs.push("");var s=this.context.programs.length;n.index=s,n.name="program"+s,this.context.programs[s]=i.compile(n,e,this.context)}},programExpression:function(t){if(null==t)return"self.noop";for(var e=this.environment.children[t],n=e.depths.list,i=[e.index,e.name,"data"],r=0,o=n.length;o>r;r++)depth=n[r],1===depth?i.push("depth0"):i.push("depth"+(depth-1));return 0===n.length?"self.program("+i.join(", ")+")":(i.shift(),"self.programWithDepth("+i.join(", ")+")")},register:function(t,e){this.useRegister(t),this.source.push(t+" = "+e+";")},useRegister:function(t){this.context.registers[t]||(this.context.registers[t]=!0,this.context.registers.list.push(t))},pushStack:function(t){return this.source.push(this.nextStack()+" = "+t+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};for(var r="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),o=e.RESERVED_WORDS={},a=0,s=r.length;s>a;a++)o[r[a]]=!0;e.isValidJavaScriptVariableName=function(t){return!e.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(t)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(t,e){e=e||{};var n=Handlebars.parse(t),i=(new Handlebars.Compiler).compile(n,e);return(new Handlebars.JavaScriptCompiler).compile(i,e)},Handlebars.compile=function(t,e){function n(){var n=Handlebars.parse(t),i=(new Handlebars.Compiler).compile(n,e),r=(new Handlebars.JavaScriptCompiler).compile(i,e,void 0,!0);return Handlebars.template(r)}e=e||{};var i;return function(t,e){return i||(i=n()),i.call(this,t,e)}},Handlebars.VM={template:function(t){var e={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(t,e,n){var i=this.programs[t];return n?Handlebars.VM.program(e,n):i?i:i=this.programs[t]=Handlebars.VM.program(e)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(n,i){return i=i||{},t.call(e,Handlebars,n,i.helpers,i.partials,i.data)}},programWithDepth:function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(i,r){return r=r||{},t.apply(this,[i,r.data||e].concat(n))}},program:function(t,e){return function(n,i){return i=i||{},t(n,i.data||e)}},noop:function(){return""},invokePartial:function(t,e,n,i,r,o){if(options={helpers:i,partials:r,data:o},void 0===t)throw new Handlebars.Exception("The partial "+e+" could not be found");if(t instanceof Function)return t(n,options);if(Handlebars.compile)return r[e]=Handlebars.compile(t),r[e](n,options);throw new Handlebars.Exception("The partial "+e+" could not be compiled when running in runtime-only mode")}},Handlebars.template=Handlebars.VM.template,function(t,e){"use strict";var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.fn.imagesLoaded=function(i){function r(){var e=t(d),n=t(h);s&&(h.length?s.reject(u,e,n):s.resolve(u)),t.isFunction(i)&&i.call(a,u,e,n)}function o(e,i){e.src!==n&&-1===t.inArray(e,c)&&(c.push(e),i?h.push(e):d.push(e),t.data(e,"imagesLoaded",{isBroken:i,src:e.src}),l&&s.notifyWith(t(e),[i,u,t(d),t(h)]),u.length===c.length&&(setTimeout(r),u.unbind(".imagesLoaded")))}var a=this,s=t.isFunction(t.Deferred)?t.Deferred():0,l=t.isFunction(s.notify),u=a.find("img").add(a.filter("img")),c=[],d=[],h=[];return u.length?u.bind("load.imagesLoaded error.imagesLoaded",function(t){o(t.target,"error"===t.type)}).each(function(i,r){var a=r.src,s=t.data(r,"imagesLoaded");return s&&s.src===a?(o(r,s.isBroken),void 0):r.complete&&r.naturalWidth!==e?(o(r,0===r.naturalWidth||0===r.naturalHeight),void 0):((r.readyState||r.complete)&&(r.src=n,r.src=a),void 0)}):r(),s?s.promise(a):a}}(jQuery),/*! jQuery Validation Plugin - v1.10.0 - 9/7/2012
* https://github.com/jzaefferer/jquery-validation
* Copyright (c) 2012 Jörn Zaefferer; Licensed MIT, GPL */
function(t){t.extend(t.fn,{validate:function(e){if(!this.length)return e&&e.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing"),void 0;var n=t.data(this[0],"validator");return n?n:(this.attr("novalidate","novalidate"),n=new t.validator(e,this[0]),t.data(this[0],"validator",n),n.settings.onsubmit&&(this.validateDelegate(":submit","click",function(e){n.settings.submitHandler&&(n.submitButton=e.target),t(e.target).hasClass("cancel")&&(n.cancelSubmit=!0)}),this.submit(function(e){function i(){var i;return n.settings.submitHandler?(n.submitButton&&(i=t("<input type='hidden'/>").attr("name",n.submitButton.name).val(n.submitButton.value).appendTo(n.currentForm)),n.settings.submitHandler.call(n,n.currentForm,e),n.submitButton&&i.remove(),!1):!0}return n.settings.debug&&e.preventDefault(),n.cancelSubmit?(n.cancelSubmit=!1,i()):n.form()?n.pendingRequest?(n.formSubmitted=!0,!1):i():(n.focusInvalid(),!1)})),n)},valid:function(){if(t(this[0]).is("form"))return this.validate().form();var e=!0,n=t(this[0].form).validate();return this.each(function(){e&=n.element(this)}),e},removeAttrs:function(e){var n={},i=this;return t.each(e.split(/\s/),function(t,e){n[e]=i.attr(e),i.removeAttr(e)}),n},rules:function(e,n){var i=this[0];if(e){var r=t.data(i.form,"validator").settings,o=r.rules,a=t.validator.staticRules(i);switch(e){case"add":t.extend(a,t.validator.normalizeRule(n)),o[i.name]=a,n.messages&&(r.messages[i.name]=t.extend(r.messages[i.name],n.messages));break;case"remove":if(!n)return delete o[i.name],a;var s={};return t.each(n.split(/\s/),function(t,e){s[e]=a[e],delete a[e]}),s}}var l=t.validator.normalizeRules(t.extend({},t.validator.metadataRules(i),t.validator.classRules(i),t.validator.attributeRules(i),t.validator.staticRules(i)),i);if(l.required){var u=l.required;delete l.required,l=t.extend({required:u},l)}return l}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+e.value)},filled:function(e){return!!t.trim(""+e.value)},unchecked:function(t){return!t.checked}}),t.validator=function(e,n){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=n,this.init()},t.validator.format=function(e,n){return 1===arguments.length?function(){var n=t.makeArray(arguments);return n.unshift(e),t.validator.format.apply(this,n)}:(arguments.length>2&&n.constructor!==Array&&(n=t.makeArray(arguments).slice(1)),n.constructor!==Array&&(n=[n]),t.each(n,function(t,n){e=e.replace(new RegExp("\\{"+t+"\\}","g"),n)}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(t){this.lastActive=t,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,t,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(t)).hide())},onfocusout:function(t){this.checkable(t)||!(t.name in this.submitted)&&this.optional(t)||this.element(t)},onkeyup:function(t,e){(9!==e.which||""!==this.elementValue(t))&&(t.name in this.submitted||t===this.lastActive)&&this.element(t)},onclick:function(t){t.name in this.submitted?this.element(t):t.parentNode.name in this.submitted&&this.element(t.parentNode)},highlight:function(e,n,i){"radio"===e.type?this.findByName(e.name).addClass(n).removeClass(i):t(e).addClass(n).removeClass(i)},unhighlight:function(e,n,i){"radio"===e.type?this.findByName(e.name).removeClass(n).addClass(i):t(e).removeClass(n).addClass(i)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var n=t.data(this[0].form,"validator"),i="on"+e.type.replace(/^validate/,"");n.settings[i]&&n.settings[i].call(n,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var n=this.groups={};t.each(this.settings.groups,function(e,i){t.each(i.split(/\s/),function(t,i){n[i]=e})});var i=this.settings.rules;t.each(i,function(e,n){i[e]=t.validator.normalizeRule(n)}),t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",e).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",e),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var t=0,e=this.currentElements=this.elements();e[t];t++)this.check(e[t]);return this.valid()},element:function(e){e=this.validationTargetFor(this.clean(e)),this.lastElement=e,this.prepareElement(e),this.currentElements=t(e);var n=this.check(e)!==!1;return n?delete this.invalid[e.name]:this.invalid[e.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),n},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var n in e)this.errorList.push({message:e[n],element:this.findByName(n)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(t){var e=0;for(var n in t)e++;return e},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&1===t.grep(this.errorList,function(t){return t.element.name===e.name}).length&&e},elements:function(){var e=this,n={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in n||!e.objectLength(t(this).rules())?!1:(n[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.replace(" ",".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(t){this.reset(),this.toHide=this.errorsFor(t)},elementValue:function(e){var n=t(e).attr("type"),i=t(e).val();return"radio"===n||"checkbox"===n?t('input[name="'+t(e).attr("name")+'"]:checked').val():"string"==typeof i?i.replace(/\r/g,""):i},check:function(e){e=this.validationTargetFor(this.clean(e));var n,i=t(e).rules(),r=!1,o=this.elementValue(e);for(var a in i){var s={method:a,parameters:i[a]};try{if(n=t.validator.methods[a].call(this,o,e,s.parameters),"dependency-mismatch"===n){r=!0;continue}if(r=!1,"pending"===n)return this.toHide=this.toHide.not(this.errorsFor(e)),void 0;if(!n)return this.formatAndAdd(e,s),!1}catch(l){throw this.settings.debug&&window.console&&console.log("exception occured when checking element "+e.id+", check the '"+s.method+"' method",l),l}}return r?void 0:(this.objectLength(i)&&this.successList.push(e),!0)},customMetaMessage:function(e,n){if(t.metadata){var i=this.settings.meta?t(e).metadata()[this.settings.meta]:t(e).metadata();return i&&i.messages&&i.messages[n]}},customDataMessage:function(e,n){return t(e).data("msg-"+n.toLowerCase())||e.attributes&&t(e).attr("data-msg-"+n.toLowerCase())},customMessage:function(t,e){var n=this.settings.messages[t];return n&&(n.constructor===String?n:n[e])},findDefined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t];return void 0},defaultMessage:function(e,n){return this.findDefined(this.customMessage(e.name,n),this.customDataMessage(e,n),this.customMetaMessage(e,n),!this.settings.ignoreTitle&&e.title||void 0,t.validator.messages[n],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,n){var i=this.defaultMessage(e,n.method),r=/\$?\{(\d+)\}/g;"function"==typeof i?i=i.call(this,n.parameters,e):r.test(i)&&(i=t.validator.format(i.replace(r,"{$1}"),n.parameters)),this.errorList.push({message:i,element:e}),this.errorMap[e.name]=i,this.submitted[e.name]=i},addWrapper:function(t){return this.settings.wrapper&&(t=t.add(t.parent(this.settings.wrapper))),t},defaultShowErrors:function(){var t,e;for(t=0;this.errorList[t];t++){var n=this.errorList[t];this.settings.highlight&&this.settings.highlight.call(this,n.element,this.settings.errorClass,this.settings.validClass),this.showLabel(n.element,n.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(t=0;this.successList[t];t++)this.showLabel(this.successList[t]);if(this.settings.unhighlight)for(t=0,e=this.validElements();e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,n){var i=this.errorsFor(e);i.length?(i.removeClass(this.settings.validClass).addClass(this.settings.errorClass),i.attr("generated")&&i.html(n)):(i=t("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(e),generated:!0}).addClass(this.settings.errorClass).html(n||""),this.settings.wrapper&&(i=i.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(i).length||(this.settings.errorPlacement?this.settings.errorPlacement(i,t(e)):i.insertAfter(e))),!n&&this.settings.success&&(i.text(""),"string"==typeof this.settings.success?i.addClass(this.settings.success):this.settings.success(i,e)),this.toShow=this.toShow.add(i)},errorsFor:function(e){var n=this.idOrName(e);return this.errors().filter(function(){return t(this).attr("for")===n})},idOrName:function(t){return this.groups[t.name]||(this.checkable(t)?t.name:t.id||t.name)},validationTargetFor:function(t){return this.checkable(t)&&(t=this.findByName(t.name).not(this.settings.ignore)[0]),t},checkable:function(t){return/radio|checkbox/i.test(t.type)},findByName:function(e){return t(this.currentForm).find('[name="'+e+'"]')},getLength:function(e,n){switch(n.nodeName.toLowerCase()){case"select":return t("option:selected",n).length;case"input":if(this.checkable(n))return this.findByName(n.name).filter(":checked").length}return e.length},depend:function(t,e){return this.dependTypes[typeof t]?this.dependTypes[typeof t](t,e):!0},dependTypes:{"boolean":function(t){return t},string:function(e,n){return!!t(e,n.form).length},"function":function(t,e){return t(e)}},optional:function(e){var n=this.elementValue(e);return!t.validator.methods.required.call(this,n,e)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,this.pending[t.name]=!0)},stopRequest:function(e,n){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],n&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!n&&0===this.pendingRequest&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,n){e.constructor===String?this.classRuleSettings[e]=n:t.extend(this.classRuleSettings,e)},classRules:function(e){var n={},i=t(e).attr("class");return i&&t.each(i.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(n,t.validator.classRuleSettings[this])}),n},attributeRules:function(e){var n={},i=t(e);for(var r in t.validator.methods){var o;"required"===r?(o=i.get(0).getAttribute(r),""===o&&(o=!0),o=!!o):o=i.attr(r),o?n[r]=o:i[0].getAttribute("type")===r&&(n[r]=!0)}return n.maxlength&&/-1|2147483647|524288/.test(n.maxlength)&&delete n.maxlength,n},metadataRules:function(e){if(!t.metadata)return{};var n=t.data(e.form,"validator").settings.meta;return n?t(e).metadata()[n]:t(e).metadata()},staticRules:function(e){var n={},i=t.data(e.form,"validator");return i.settings.rules&&(n=t.validator.normalizeRule(i.settings.rules[e.name])||{}),n},normalizeRules:function(e,n){return t.each(e,function(i,r){if(r===!1)return delete e[i],void 0;if(r.param||r.depends){var o=!0;switch(typeof r.depends){case"string":o=!!t(r.depends,n.form).length;break;case"function":o=r.depends.call(n,n)}o?e[i]=void 0!==r.param?r.param:!0:delete e[i]}}),t.each(e,function(i,r){e[i]=t.isFunction(r)?r(n):r}),t.each(["minlength","maxlength","min","max"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){e[this]&&(e[this]=[Number(e[this][0]),Number(e[this][1])])}),t.validator.autoCreateRanges&&(e.min&&e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),e.minlength&&e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e.messages&&delete e.messages,e},normalizeRule:function(e){if("string"==typeof e){var n={};t.each(e.split(/\s/),function(){n[this]=!0}),e=n}return e},addMethod:function(e,n,i){t.validator.methods[e]=n,t.validator.messages[e]=void 0!==i?i:t.validator.messages[e],n.length<3&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,n,i){if(!this.depend(i,n))return"dependency-mismatch";if("select"===n.nodeName.toLowerCase()){var r=t(n).val();return r&&r.length>0}return this.checkable(n)?this.getLength(e,n)>0:t.trim(e).length>0},remote:function(e,n,i){if(this.optional(n))return"dependency-mismatch";var r=this.previousValue(n);if(this.settings.messages[n.name]||(this.settings.messages[n.name]={}),r.originalMessage=this.settings.messages[n.name].remote,this.settings.messages[n.name].remote=r.message,i="string"==typeof i&&{url:i}||i,this.pending[n.name])return"pending";if(r.old===e)return r.valid;r.old=e;var o=this;this.startRequest(n);var a={};return a[n.name]=e,t.ajax(t.extend(!0,{url:i,mode:"abort",port:"validate"+n.name,dataType:"json",data:a,success:function(i){o.settings.messages[n.name].remote=r.originalMessage;var a=i===!0||"true"===i;if(a){var s=o.formSubmitted;o.prepareElement(n),o.formSubmitted=s,o.successList.push(n),delete o.invalid[n.name],o.showErrors()}else{var l={},u=i||o.defaultMessage(n,"remote");l[n.name]=r.message=t.isFunction(u)?u(e):u,o.invalid[n.name]=!0,o.showErrors(l)}r.valid=a,o.stopRequest(n,a)}},i)),"pending"},minlength:function(e,n,i){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||r>=i},maxlength:function(e,n,i){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||i>=r},rangelength:function(e,n,i){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),n);return this.optional(n)||r>=i[0]&&r<=i[1]},min:function(t,e,n){return this.optional(e)||t>=n},max:function(t,e,n){return this.optional(e)||n>=t},range:function(t,e,n){return this.optional(e)||t>=n[0]&&t<=n[1]},email:function(t,e){return this.optional(e)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t))},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},creditcard:function(t,e){if(this.optional(e))return"dependency-mismatch";if(/[^0-9 \-]+/.test(t))return!1;var n=0,i=0,r=!1;t=t.replace(/\D/g,"");for(var o=t.length-1;o>=0;o--){var a=t.charAt(o);i=parseInt(a,10),r&&(i*=2)>9&&(i-=9),n+=i,r=!r}return 0===n%10},equalTo:function(e,n,i){var r=t(i);return this.settings.onfocusout&&r.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(n).valid()}),e===r.val()}}}),t.format=t.validator.format}(jQuery),function(t){var e={};if(t.ajaxPrefilter)t.ajaxPrefilter(function(t,n,i){var r=t.port;"abort"===t.mode&&(e[r]&&e[r].abort(),e[r]=i)});else{var n=t.ajax;t.ajax=function(i){var r=("mode"in i?i:t.ajaxSettings).mode,o=("port"in i?i:t.ajaxSettings).port;return"abort"===r?(e[o]&&e[o].abort(),e[o]=n.apply(this,arguments)):n.apply(this,arguments)}}}(jQuery),function(t){jQuery.event.special.focusin||jQuery.event.special.focusout||!document.addEventListener||t.each({focus:"focusin",blur:"focusout"},function(e,n){function i(e){return e=t.event.fix(e),e.type=n,t.event.handle.call(this,e)}t.event.special[n]={setup:function(){this.addEventListener(e,i,!0)},teardown:function(){this.removeEventListener(e,i,!0)},handler:function(e){var i=arguments;return i[0]=t.event.fix(e),i[0].type=n,t.event.handle.apply(this,i)}}}),t.extend(t.fn,{validateDelegate:function(e,n,i){return this.bind(n,function(n){var r=t(n.target);return r.is(e)?i.apply(r,arguments):void 0})}})}(jQuery);var q=null;window.PR_SHOULD_USE_CONTINUATION=!0,function(){function t(t){function e(t){var e=t.charCodeAt(0);if(92!==e)return e;var n=t.charAt(1);return(e=d[n])?e:n>="0"&&"7">=n?parseInt(t.substring(1),8):"u"===n||"x"===n?parseInt(t.substring(2),16):t.charCodeAt(1)}function n(t){return 32>t?(16>t?"\\x0":"\\x")+t.toString(16):(t=String.fromCharCode(t),("\\"===t||"-"===t||"["===t||"]"===t)&&(t="\\"+t),t)}function i(t){for(var i=t.substring(1,t.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),t=[],r=[],o="^"===i[0],a=o?1:0,s=i.length;s>a;++a){var l=i[a];if(/\\[bdsw]/i.test(l))t.push(l);else{var u,l=e(l);s>a+2&&"-"===i[a+1]?(u=e(i[a+2]),a+=2):u=l,r.push([l,u]),65>u||l>122||(65>u||l>90||r.push([32|Math.max(65,l),32|Math.min(u,90)]),97>u||l>122||r.push([-33&Math.max(97,l),-33&Math.min(u,122)]))}}for(r.sort(function(t,e){return t[0]-e[0]||e[1]-t[1]}),i=[],l=[0/0,0/0],a=0;a<r.length;++a)s=r[a],s[0]<=l[1]+1?l[1]=Math.max(l[1],s[1]):i.push(l=s);for(r=["["],o&&r.push("^"),r.push.apply(r,t),a=0;a<i.length;++a)s=i[a],r.push(n(s[0])),s[1]>s[0]&&(s[1]+1>s[0]&&r.push("-"),r.push(n(s[1])));return r.push("]"),r.join("")}function r(t){for(var e=t.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),n=e.length,r=[],s=0,l=0;n>s;++s){var u=e[s];"("===u?++l:"\\"===u.charAt(0)&&(u=+u.substring(1))&&l>=u&&(r[u]=-1)}for(s=1;s<r.length;++s)-1===r[s]&&(r[s]=++o);for(l=s=0;n>s;++s)u=e[s],"("===u?(++l,void 0===r[l]&&(e[s]="(?:")):"\\"===u.charAt(0)&&(u=+u.substring(1))&&l>=u&&(e[s]="\\"+r[l]);for(l=s=0;n>s;++s)"^"===e[s]&&"^"!==e[s+1]&&(e[s]="");if(t.ignoreCase&&a)for(s=0;n>s;++s)u=e[s],t=u.charAt(0),u.length>=2&&"["===t?e[s]=i(u):"\\"!==t&&(e[s]=u.replace(/[A-Za-z]/g,function(t){return t=t.charCodeAt(0),"["+String.fromCharCode(-33&t,32|t)+"]"}));return e.join("")}for(var o=0,a=!1,s=!1,l=0,u=t.length;u>l;++l){var c=t[l];if(c.ignoreCase)s=!0;else if(/[a-z]/i.test(c.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){a=!0,s=!1;break}}for(var d={b:8,t:9,n:10,v:11,f:12,r:13},h=[],l=0,u=t.length;u>l;++l){if(c=t[l],c.global||c.multiline)throw Error(""+c);h.push("(?:"+r(c)+")")}return RegExp(h.join("|"),s?"gi":"g")}function e(t){function e(t){switch(t.nodeType){case 1:if(i.test(t.className))break;for(var n=t.firstChild;n;n=n.nextSibling)e(n);n=t.nodeName,("BR"===n||"LI"===n)&&(r[s]="\n",a[s<<1]=o++,a[1|s++<<1]=t);break;case 3:case 4:n=t.nodeValue,n.length&&(n=l?n.replace(/\r\n?/g,"\n"):n.replace(/[\t\n\r ]+/g," "),r[s]=n,a[s<<1]=o,o+=n.length,a[1|s++<<1]=t)}}var n,i=/(?:^|\s)nocode(?:\s|$)/,r=[],o=0,a=[],s=0;t.currentStyle?n=t.currentStyle.whiteSpace:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(t,q).getPropertyValue("white-space"));var l=n&&"pre"===n.substring(0,3);return e(t),{a:r.join("").replace(/\n$/,""),c:a}}function n(t,e,n,i){e&&(t={a:e,d:t},n(t),i.push.apply(i,t.e))}function i(e,i){function r(t){for(var e=t.d,u=[e,"pln"],c=0,d=t.a.match(o)||[],h={},p=0,_=d.length;_>p;++p){var f,m=d[p],g=h[m],v=void 0;if("string"==typeof g)f=!1;else{var b=a[m.charAt(0)];if(b)v=m.match(b[1]),g=b[0];else{for(f=0;l>f;++f)if(b=i[f],v=m.match(b[1])){g=b[0];break}v||(g="pln")}!(f=g.length>=5&&"lang-"===g.substring(0,5))||v&&"string"==typeof v[1]||(f=!1,g="src"),f||(h[m]=g)}if(b=c,c+=m.length,f){f=v[1];var y=m.indexOf(f),w=y+f.length;v[2]&&(w=m.length-v[2].length,y=w-f.length),g=g.substring(5),n(e+b,m.substring(0,y),r,u),n(e+b+y,f,s(g,f),u),n(e+b+w,m.substring(w),r,u)}else u.push(e+b,g)}t.e=u}var o,a={};!function(){for(var n=e.concat(i),r=[],s={},l=0,u=n.length;u>l;++l){var c=n[l],d=c[3];if(d)for(var h=d.length;--h>=0;)a[d.charAt(h)]=c;c=c[1],d=""+c,s.hasOwnProperty(d)||(r.push(c),s[d]=q)}r.push(/[\S\s]/),o=t(r)}();var l=i.length;return r}function r(t){var e=[],n=[];t.tripleQuotedStrings?e.push(["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,q,"'\""]):t.multiLineStrings?e.push(["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,q,"'\"`"]):e.push(["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,q,"\"'"]),t.verbatimStrings&&n.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,q]);var r=t.hashComments;return r&&(t.cStyleComments?(r>1?e.push(["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,q,"#"]):e.push(["com",/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\n\r]*)/,q,"#"]),n.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,q])):e.push(["com",/^#[^\n\r]*/,q,"#"])),t.cStyleComments&&(n.push(["com",/^\/\/[^\n\r]*/,q]),n.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,q])),t.regexLiterals&&n.push(["lang-regex",/^(?:^^\.?|[!+-]|!=|!==|#|%|%=|&|&&|&&=|&=|\(|\*|\*=|\+=|,|-=|->|\/|\/=|:|::|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|[?@[^]|\^=|\^\^|\^\^=|{|\||\|=|\|\||\|\|=|~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\s*(\/(?=[^*/])(?:[^/[\\]|\\[\S\s]|\[(?:[^\\\]]|\\[\S\s])*(?:]|$))+\/)/]),(r=t.types)&&n.push(["typ",r]),t=(""+t.keywords).replace(/^ | $/g,""),t.length&&n.push(["kwd",RegExp("^(?:"+t.replace(/[\s,]+/g,"|")+")\\b"),q]),e.push(["pln",/^\s+/,q," \r\n	 "]),n.push(["lit",/^@[$_a-z][\w$@]*/i,q],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,q],["pln",/^[$_a-z][\w$@]*/i,q],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,q,"0123456789"],["pln",/^\\[\S\s]?/,q],["pun",/^.[^\s\w"-$'./@\\`]*/,q]),i(e,n)}function o(t,e){function n(t){switch(t.nodeType){case 1:if(o.test(t.className))break;if("BR"===t.nodeName)i(t),t.parentNode&&t.parentNode.removeChild(t);else for(t=t.firstChild;t;t=t.nextSibling)n(t);break;case 3:case 4:if(l){var e=t.nodeValue,r=e.match(a);if(r){var u=e.substring(0,r.index);t.nodeValue=u,(e=e.substring(r.index+r[0].length))&&t.parentNode.insertBefore(s.createTextNode(e),t.nextSibling),i(t),u||t.parentNode.removeChild(t)}}}}function i(t){function e(t,n){var i=n?t.cloneNode(!1):t,r=t.parentNode;if(r){var r=e(r,1),o=t.nextSibling;r.appendChild(i);for(var a=o;a;a=o)o=a.nextSibling,r.appendChild(a)}return i}for(;!t.nextSibling;)if(t=t.parentNode,!t)return;for(var n,t=e(t.nextSibling,0);(n=t.parentNode)&&1===n.nodeType;)t=n;u.push(t)}var r,o=/(?:^|\s)nocode(?:\s|$)/,a=/\r\n?|\n/,s=t.ownerDocument;t.currentStyle?r=t.currentStyle.whiteSpace:window.getComputedStyle&&(r=s.defaultView.getComputedStyle(t,q).getPropertyValue("white-space"));var l=r&&"pre"===r.substring(0,3);for(r=s.createElement("LI");t.firstChild;)r.appendChild(t.firstChild);for(var u=[r],c=0;c<u.length;++c)n(u[c]);e===(0|e)&&u[0].setAttribute("value",e);var d=s.createElement("OL");d.className="linenums";for(var h=Math.max(0,0|e-1)||0,c=0,p=u.length;p>c;++c)r=u[c],r.className="L"+(c+h)%10,r.firstChild||r.appendChild(s.createTextNode(" ")),d.appendChild(r);t.appendChild(d)}function a(t,e){for(var n=e.length;--n>=0;){var i=e[n];b.hasOwnProperty(i)?window.console&&console.warn("cannot override language handler %s",i):b[i]=t}}function s(t,e){return t&&b.hasOwnProperty(t)||(t=/^\s*</.test(e)?"default-markup":"default-code"),b[t]}function l(t){var n=t.g;try{var i=e(t.h),r=i.a;t.a=r,t.c=i.c,t.d=0,s(n,r)(t);var o=/\bMSIE\b/.test(navigator.userAgent),n=/\n/g,a=t.a,l=a.length,i=0,u=t.c,c=u.length,r=0,d=t.e,h=d.length,t=0;d[h]=l;var p,_;for(_=p=0;h>_;)d[_]!==d[_+2]?(d[p++]=d[_++],d[p++]=d[_++]):_+=2;for(h=p,_=p=0;h>_;){for(var f=d[_],m=d[_+1],g=_+2;h>=g+2&&d[g+1]===m;)g+=2;d[p++]=f,d[p++]=m,_=g}for(d.length=p;c>r;){var v,b=u[r+2]||l,y=d[t+2]||l,g=Math.min(b,y),w=u[r+1];if(1!==w.nodeType&&(v=a.substring(i,g))){o&&(v=v.replace(n,"\r")),w.nodeValue=v;var k=w.ownerDocument,$=k.createElement("SPAN");$.className=d[t+1];var x=w.parentNode;x.replaceChild($,w),$.appendChild(w),b>i&&(u[r+1]=w=k.createTextNode(a.substring(g,b)),x.insertBefore(w,$.nextSibling))}i=g,i>=b&&(r+=2),i>=y&&(t+=2)}}catch(C){"console"in window&&console.log(C&&C.stack?C.stack:C)}}var u=["break,continue,do,else,for,if,return,while"],c=[[u,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],d=[c,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],h=[c,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"],p=[h,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"],c=[c,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],_=[u,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],f=[u,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],u=[u,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],m=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/,g=/\S/,v=r({keywords:[d,p,c,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END"+_,f,u],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),b={};a(v,["default-code"]),a(i([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),a(i([["pln",/^\s+/,q," 	\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,q,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'/>]|\/(?=\s)))/],["pun",/^[/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]),a(i([],[["atv",/^[\S\s]+/]]),["uq.val"]),a(r({keywords:d,hashComments:!0,cStyleComments:!0,types:m}),["c","cc","cpp","cxx","cyc","m"]),a(r({keywords:"null,true,false"}),["json"]),a(r({keywords:p,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:m}),["cs"]),a(r({keywords:h,cStyleComments:!0}),["java"]),a(r({keywords:u,hashComments:!0,multiLineStrings:!0}),["bsh","csh","sh"]),a(r({keywords:_,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py"]),a(r({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["perl","pl","pm"]),a(r({keywords:f,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb"]),a(r({keywords:c,cStyleComments:!0,regexLiterals:!0}),["js"]),a(r({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes",hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),a(i([],[["str",/^[\S\s]+/]]),["regex"]),window.prettyPrintOne=function(t,e,n){var i=document.createElement("PRE");
return i.innerHTML=t,n&&o(i,n),l({g:e,i:n,h:i}),i.innerHTML},window.prettyPrint=function(t){function e(){for(var n=window.PR_SHOULD_USE_CONTINUATION?u.now()+250:1/0;d<i.length&&u.now()<n;d++){var r=i[d],a=r.className;if(a.indexOf("prettyprint")>=0){var s,p,a=a.match(h);if(p=!a){p=r;for(var _=void 0,f=p.firstChild;f;f=f.nextSibling)var m=f.nodeType,_=1===m?_?p:f:3===m?g.test(f.nodeValue)?p:_:_;p=(s=_===p?void 0:_)&&"CODE"===s.tagName}for(p&&(a=s.className.match(h)),a&&(a=a[1]),p=!1,_=r.parentNode;_;_=_.parentNode)if(("pre"===_.tagName||"code"===_.tagName||"xmp"===_.tagName)&&_.className&&_.className.indexOf("prettyprint")>=0){p=!0;break}p||((p=(p=r.className.match(/\blinenums\b(?::(\d+))?/))?p[1]&&p[1].length?+p[1]:!0:!1)&&o(r,p),c={g:a,h:r,i:p},l(c))}}d<i.length?setTimeout(e,250):t&&t()}for(var n=[document.getElementsByTagName("pre"),document.getElementsByTagName("code"),document.getElementsByTagName("xmp")],i=[],r=0;r<n.length;++r)for(var a=0,s=n[r].length;s>a;++a)i.push(n[r][a]);var n=q,u=Date;u.now||(u={now:function(){return+new Date}});var c,d=0,h=/\blang(?:uage)?-([\w.]+)(?!\S)/;e()},window.PR={createSimpleLexer:i,registerLangHandler:a,sourceDecorator:r,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ"}}(),function(e){function n(t){return t}function i(t,e){for(var n=0,i=e.length,r=new Array(i);i>n;++n)r[n]=t[e[n]];return r}function r(t){function e(e,n,i,r){for(;r>i;){var o=i+r>>1;t(e[o])<n?i=o+1:r=o}return i}function n(e,n,i,r){for(;r>i;){var o=i+r>>1;n<t(e[o])?r=o:i=o+1}return i}return n.right=n,n.left=e,n}function o(t){function e(t,e,n){for(var r=n-e,o=(r>>>1)+1;--o>0;)i(t,o,r,e);return t}function n(t,e,n){for(var r,o=n-e;--o>0;)r=t[e],t[e]=t[e+o],t[e+o]=r,i(t,1,o,e);return t}function i(e,n,i,r){for(var o,a=e[--r+n],s=t(a);(o=n<<1)<=i&&(i>o&&t(e[r+o])>t(e[r+o+1])&&o++,!(s<=t(e[r+o])));)e[r+n]=e[r+o],n=o;e[r+n]=a}return e.sort=n,e}function a(t){function e(e,i,r,o){var a,s,l,u,c=new Array(o=Math.min(r-i,o));for(s=0;o>s;++s)c[s]=e[i++];if(n(c,0,o),r>i){a=t(c[0]);do(l=t(u=e[i])>a)&&(c[0]=u,a=t(n(c,0,o)[0]));while(++i<r)}return c}var n=o(t);return e}function s(t){function e(e,n,i){for(var r=n+1;i>r;++r){for(var o=r,a=e[r],s=t(a);o>n&&t(e[o-1])>s;--o)e[o]=e[o-1];e[o]=a}return e}return e}function l(e){function n(t,e,n){return(E>n-e?r:i)(t,e,n)}function i(i,r,o){var a=0|(o-r)/6,s=r+a,l=o-1-a,u=r+o-1>>1,c=u-a,d=u+a,h=i[s],p=e(h),_=i[c],f=e(_),m=i[u],g=e(m),v=i[d],b=e(v),y=i[l],w=e(y);p>f&&(t=h,h=_,_=t,t=p,p=f,f=t),b>w&&(t=v,v=y,y=t,t=b,b=w,w=t),p>g&&(t=h,h=m,m=t,t=p,p=g,g=t),f>g&&(t=_,_=m,m=t,t=f,f=g,g=t),p>b&&(t=h,h=v,v=t,t=p,p=b,b=t),g>b&&(t=m,m=v,v=t,t=g,g=b,b=t),f>w&&(t=_,_=y,y=t,t=f,f=w,w=t),f>g&&(t=_,_=m,m=t,t=f,f=g,g=t),b>w&&(t=v,v=y,y=t,t=b,b=w,w=t);var k=_,$=f,x=v,C=b;i[s]=h,i[c]=i[r],i[u]=m,i[d]=i[o-1],i[l]=y;var q=r+1,T=o-2,S=C>=$&&$>=C;if(S)for(var E=q;T>=E;++E){var D=i[E],M=e(D);if($>M)E!==q&&(i[E]=i[q],i[q]=D),++q;else if(M>$)for(;;){var A=e(i[T]);{if(!(A>$)){if($>A){i[E]=i[q],i[q++]=i[T],i[T--]=D;break}i[E]=i[T],i[T--]=D;break}T--}}}else for(var E=q;T>=E;E++){var D=i[E],M=e(D);if($>M)E!==q&&(i[E]=i[q],i[q]=D),++q;else if(M>C)for(;;){var A=e(i[T]);{if(!(A>C)){$>A?(i[E]=i[q],i[q++]=i[T],i[T--]=D):(i[E]=i[T],i[T--]=D);break}if(T--,E>T)break}}}if(i[r]=i[q-1],i[q-1]=k,i[o-1]=i[T+1],i[T+1]=x,n(i,r,q-1),n(i,T+2,o),S)return i;if(s>q&&T>l){for(var N,A;(N=e(i[q]))<=$&&N>=$;)++q;for(;(A=e(i[T]))<=C&&A>=C;)--T;for(var E=q;T>=E;E++){var D=i[E],M=e(D);if($>=M&&M>=$)E!==q&&(i[E]=i[q],i[q]=D),q++;else if(C>=M&&M>=C)for(;;){var A=e(i[T]);{if(!(C>=A&&A>=C)){$>A?(i[E]=i[q],i[q++]=i[T],i[T--]=D):(i[E]=i[T],i[T--]=D);break}if(T--,E>T)break}}}}return n(i,q,T+1)}var r=s(e);return n}function u(t){return new Array(t)}function c(t,e){return function(n){var i=n.length;return[t.left(n,e,0,i),t.right(n,e,0,i)]}}function d(t,e){var n=e[0],i=e[1];return function(e){var r=e.length;return[t.left(e,n,0,r),t.left(e,i,0,r)]}}function h(t){return[0,t.length]}function p(){return null}function _(){return 0}function f(t){return t+1}function m(t){return t-1}function v(t){return function(e,n){return e+ +t(n)}}function b(t){return function(e,n){return e-t(n)}}function y(){function t(t){var e=C,n=t.length;return n&&(y=y.concat(t),S=N(S,C+=n),M.forEach(function(i){i(t,e,n)})),u}function e(t){function e(e,n,r){I=e.map(t),H=J(k(r),0,r),I=i(I,H);var o,a=G(I),s=a[0],l=a[1];for(o=0;s>o;++o)S[H[o]+n]|=W;for(o=l;r>o;++o)S[H[o]+n]|=W;if(!n)return R=I,O=H,V=s,Q=l,void 0;var u=R,c=O,d=0,h=0;for(R=new Array(C),O=w(C,C),o=0;n>d&&r>h;++o)u[d]<I[h]?(R[o]=u[d],O[o]=c[d++]):(R[o]=I[h],O[o]=H[h++]+n);for(;n>d;++d,++o)R[o]=u[d],O[o]=c[d];for(;r>h;++h,++o)R[o]=I[h],O[o]=H[h]+n;a=G(R),V=a[0],Q=a[1]}function r(t,e,n){Y.forEach(function(t){t(I,H,e,n)}),I=H=null}function s(t){var e,n,i,r=t[0],o=t[1],a=[],s=[];if(V>r)for(e=r,n=Math.min(V,o);n>e;++e)S[i=O[e]]^=W,a.push(i);else if(r>V)for(e=V,n=Math.min(r,Q);n>e;++e)S[i=O[e]]^=W,s.push(i);if(o>Q)for(e=Math.max(r,Q),n=o;n>e;++e)S[i=O[e]]^=W,a.push(i);else if(Q>o)for(e=Math.max(V,o),n=Q;n>e;++e)S[i=O[e]]^=W,s.push(i);return V=r,Q=o,E.forEach(function(t){t(W,a,s)}),B}function u(t){return null==t?z():Array.isArray(t)?A(t):D(t)}function D(t){return s((G=c(x,t))(R))}function A(t){return s((G=d(x,t))(R))}function z(){return s((G=h)(R))}function P(t){for(var e,n=[],i=Q;--i>=V&&t>0;)S[e=O[i]]||(n.push(y[e]),--t);return n}function L(t){function e(e,n,o,a){function u(){++J===B&&(v=F(v,H<<=1),M=F(M,H),B=$(H))}var c,d,h,_,f,m,g=D,v=w(J,B),b=P,k=j,x=J,q=0,T=0;for(Q&&(b=k=p),D=new Array(J),J=0,M=x>1?N(M,C):w(C,B),x&&(h=(d=g[0]).key);a>T&&!((_=t(e[T]))>=_);)++T;for(;a>T;){for(d&&_>=h?(f=d,m=h,v[q]=J,(d=g[++q])&&(h=d.key)):(f={key:_,value:k()},m=_),D[J]=f;!(_>m||(M[c=n[T]+o]=J,S[c]&U||(f.value=b(f.value,y[c])),++T>=a));)_=t(e[T]);u()}for(;x>q;)D[v[q]=J]=g[q++],u();if(J>q)for(q=0;o>q;++q)M[q]=v[M[q]];c=E.indexOf(G),J>1?(G=i,V=s):(1===J?(G=r,V=l):(G=p,V=p),M=null),E[c]=G}function i(t,e,n){if(t!==W&&!Q){var i,r,o;for(i=0,o=e.length;o>i;++i)S[r=e[i]]&U||(g=D[M[r]],g.value=P(g.value,y[r]));for(i=0,o=n.length;o>i;++i)(S[r=n[i]]&U)===t&&(g=D[M[r]],g.value=L(g.value,y[r]))}}function r(t,e,n){if(t!==W&&!Q){var i,r,o,a=D[0];for(i=0,o=e.length;o>i;++i)S[r=e[i]]&U||(a.value=P(a.value,y[r]));for(i=0,o=n.length;o>i;++i)(S[r=n[i]]&U)===t&&(a.value=L(a.value,y[r]))}}function s(){var t,e;for(t=0;J>t;++t)D[t].value=j();for(t=0;C>t;++t)S[t]&U||(e=D[M[t]],e.value=P(e.value,y[t]))}function l(){var t,e=D[0];for(e.value=j(),t=0;C>t;++t)S[t]&U||(e.value=P(e.value,y[t]))}function u(){return Q&&(V(),Q=!1),D}function c(t){var e=A(u(),0,D.length,t);return z.sort(e,0,e.length)}function d(t,e,n){return P=t,L=e,j=n,Q=!0,I}function h(){return d(f,m,_)}function k(t){return d(v(t),b(t),_)}function x(t){function e(e){return t(e.value)}return A=a(e),z=o(e),I}function q(){return x(n)}function T(){return J}var D,M,A,z,P,L,j,I={top:c,all:u,reduce:d,reduceCount:h,reduceSum:k,order:x,orderNatural:q,size:T},H=8,B=$(H),J=0,G=p,V=p,Q=!0;return arguments.length<1&&(t=n),E.push(G),Y.push(e),e(R,O,0,C),h().orderNatural()}function j(){var t=L(p),e=t.all;return delete t.all,delete t.top,delete t.order,delete t.orderNatural,delete t.size,t.value=function(){return e()[0].value},t}var R,O,I,H,B={filter:u,filterExact:D,filterRange:A,filterAll:z,top:P,group:L,groupAll:j},W=1<<q++,U=~W,J=l(function(t){return I[t]}),G=h,Y=[],V=0,Q=0;return M.unshift(e),M.push(r),q>T&&(S=F(S,T<<=1)),e(y,0,C),r(y,0,C),B}function r(){function t(t,e){var n;if(!h)for(n=e;C>n;++n)S[n]||(s=l(s,y[n]))}function e(t,e,n){var i,r,o;if(!h){for(i=0,o=e.length;o>i;++i)S[r=e[i]]||(s=l(s,y[r]));for(i=0,o=n.length;o>i;++i)S[r=n[i]]===t&&(s=u(s,y[r]))}}function n(){var t;for(s=c(),t=0;C>t;++t)S[t]||(s=l(s,y[t]))}function i(t,e,n){return l=t,u=e,c=n,h=!0,d}function r(){return i(f,m,_)}function o(t){return i(v(t),b(t),_)}function a(){return h&&(n(),h=!1),s}var s,l,u,c,d={reduce:i,reduceCount:r,reduceSum:o,value:a},h=!0;return E.push(e),M.push(t),t(y,0,C),r()}function s(){return C}var u={add:t,dimension:e,groupAll:r,size:s},y=[],C=0,q=0,T=8,S=D(0),E=[],M=[];return arguments.length?t(arguments[0]):u}function w(t,e){return(257>e?D:65537>e?M:A)(t)}function k(t){for(var e=w(t,t),n=-1;++n<t;)e[n]=n;return e}function $(t){return 8===t?256:16===t?65536:4294967296}y.version="1.0.2",y.permute=i;var x=y.bisect=r(n);x.by=r;var C=y.heap=o(n);C.by=o;var q=y.heapselect=a(n);q.by=a;var T=y.insertionsort=s(n);T.by=s;var S=y.quicksort=l(n);S.by=l;var E=32,D=u,M=u,A=u,N=n,F=n;"undefined"!=typeof Uint8Array&&(D=function(t){return new Uint8Array(t)},M=function(t){return new Uint16Array(t)},A=function(t){return new Uint32Array(t)},N=function(t,e){var n=new t.constructor(e);return n.set(t),n},F=function(t,e){var n;switch(e){case 16:n=M(t.length);break;case 32:n=A(t.length);break;default:throw new Error("invalid array width!")}return n.set(t),n}),e.crossfilter=y}(this),/*
 * jQuery Hotkeys Plugin
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Based upon the plugin by Tzury Bar Yochay:
 * http://github.com/tzuryby/hotkeys
 *
 * Original idea by:
 * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/
*/
function(t){function e(e){if("string"==typeof e.data){var n=e.handler,i=e.data.toLowerCase().split(" ");e.handler=function(e){if(this===e.target||!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type){var r="keypress"!==e.type&&t.hotkeys.specialKeys[e.which],o=String.fromCharCode(e.which).toLowerCase(),a="",s={};e.altKey&&"alt"!==r&&(a+="alt+"),e.ctrlKey&&"ctrl"!==r&&(a+="ctrl+"),e.metaKey&&!e.ctrlKey&&"meta"!==r&&(a+="meta+"),e.shiftKey&&"shift"!==r&&(a+="shift+"),r?s[a+r]=!0:(s[a+o]=!0,s[a+t.hotkeys.shiftNums[o]]=!0,"shift+"===a&&(s[t.hotkeys.shiftNums[o]]=!0));for(var l=0,u=i.length;u>l;l++)if(s[i[l]])return n.apply(this,arguments)}}}}t.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},t.each(["keydown","keyup","keypress"],function(){t.event.special[this]={add:e}})}(jQuery),/*
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
function(t){var e={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},n={duration:"fast",direction:"both"},i=/^(?:html)$/i,r=function(e,n){n=n||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle);var i=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,r={top:parseFloat(i?n.borderTopWidth:t.css(e,"borderTopWidth"))||0,left:parseFloat(i?n.borderLeftWidth:t.css(e,"borderLeftWidth"))||0,bottom:parseFloat(i?n.borderBottomWidth:t.css(e,"borderBottomWidth"))||0,right:parseFloat(i?n.borderRightWidth:t.css(e,"borderRightWidth"))||0};return{top:r.top,left:r.left,bottom:r.bottom,right:r.right,vertical:r.top+r.bottom,horizontal:r.left+r.right}},o=function(e){var n=t(window),o=i.test(e[0].nodeName);return{border:o?{top:0,left:0,bottom:0,right:0}:r(e[0]),scroll:{top:(o?n:e).scrollTop(),left:(o?n:e).scrollLeft()},scrollbar:{right:o?0:e.innerWidth()-e[0].clientWidth,bottom:o?0:e.innerHeight()-e[0].clientHeight},rect:function(){var t=e[0].getBoundingClientRect();return{top:o?0:t.top,left:o?0:t.left,bottom:o?e[0].clientHeight:t.bottom,right:o?e[0].clientWidth:t.right}}()}};t.fn.extend({scrollintoview:function(r){r=t.extend({},n,r),r.direction=e["string"==typeof r.direction&&r.direction.toLowerCase()]||e.both;var a="";r.direction.x===!0&&(a="horizontal"),r.direction.y===!0&&(a=a?"both":"vertical");var s=this.eq(0),l=s.closest(":scrollable("+a+")");if(l.length>0){l=l.eq(0);var u={e:o(s),s:o(l)},c={top:u.e.rect.top-(u.s.rect.top+u.s.border.top),bottom:u.s.rect.bottom-u.s.border.bottom-u.s.scrollbar.bottom-u.e.rect.bottom,left:u.e.rect.left-(u.s.rect.left+u.s.border.left),right:u.s.rect.right-u.s.border.right-u.s.scrollbar.right-u.e.rect.right},d={};r.direction.y===!0&&(c.top<0?d.scrollTop=u.s.scroll.top+c.top:c.top>0&&c.bottom<0&&(d.scrollTop=u.s.scroll.top+Math.min(c.top,-c.bottom))),r.direction.x===!0&&(c.left<0?d.scrollLeft=u.s.scroll.left+c.left:c.left>0&&c.right<0&&(d.scrollLeft=u.s.scroll.left+Math.min(c.left,-c.right))),t.isEmptyObject(d)?t.isFunction(r.complete)&&r.complete.call(l[0]):(i.test(l[0].nodeName)&&(l=t("html,body")),l.animate(d,r.duration).eq(0).queue(function(e){t.isFunction(r.complete)&&r.complete.call(l[0]),e()}))}return this}});var a={auto:!0,scroll:!0,visible:!1,hidden:!1};t.extend(t.expr[":"],{scrollable:function(t,n,r){var o=e["string"==typeof r[3]&&r[3].toLowerCase()]||e.both,s=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle,l={x:a[s.overflowX.toLowerCase()]||!1,y:a[s.overflowY.toLowerCase()]||!1,isRoot:i.test(t.nodeName)};if(!l.x&&!l.y&&!l.isRoot)return!1;var u={height:{scroll:t.scrollHeight,client:t.clientHeight},width:{scroll:t.scrollWidth,client:t.clientWidth},scrollableX:function(){return(l.x||l.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(l.y||l.isRoot)&&this.height.scroll>this.height.client}};return o.y&&u.scrollableY()||o.x&&u.scrollableX()}})}(jQuery),/*!
 * jQuery Cookie Plugin v1.2
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
function(t,e,n){function i(t){return t}function r(t){return decodeURIComponent(t.replace(o," "))}var o=/\+/g;t.cookie=function(o,a,s){if(a!==n&&!/Object/.test(Object.prototype.toString.call(a))){if(s=t.extend({},t.cookie.defaults,s),null===a&&(s.expires=-1),"number"==typeof s.expires){var l=s.expires,u=s.expires=new Date;u.setDate(u.getDate()+l)}return a=String(a),e.cookie=[encodeURIComponent(o),"=",s.raw?a:encodeURIComponent(a),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}s=a||t.cookie.defaults||{};for(var c,d=s.raw?i:r,h=e.cookie.split("; "),p=0;c=h[p]&&h[p].split("=");p++)if(d(c.shift())===o)return d(c.join("="));return null},t.cookie.defaults={},t.removeCookie=function(e,n){return null!==t.cookie(e,n)?(t.cookie(e,null,n),!0):!1}}(jQuery,document);var session_fetch=function(t,e,n){var i=.4,r={use_html5_location:!1,ipinfodb_key:!1,gapi_location:!0,location_cookie:"location",location_cookie_timeout:5,session_timeout:32,session_cookie:"first_session"},o=function(){if(t.session=t.session||{},t.session.contains=function(t){if("string"==typeof t)return-1!==this.indexOf(t);for(var e=0;e<t.length;e++)if(-1!==this.indexOf(t[e]))return!0;return!1},t.session&&t.session.options)for(option in t.session.options)r[option]=t.session.options[option];var e={api_version:i,locale:s.locale(),current_session:s.session(),original_session:s.session(r.session_cookie,1e3*60*60*24*r.session_timeout),browser:s.browser(),plugins:s.plugins(),time:s.time(),device:s.device()};if(r.use_html5_location?e.location=s.html5_location():r.ipinfodb_key?e.location=s.ipinfodb_location(r.ipinfodb_key):r.gapi_location&&(e.location=s.gapi_location()),t.session&&t.session.start)var n=t.session.start;var o,a=0,l=function(e){e&&a--,0===a&&n&&n(t.session)};t.session={};for(var u in e)if(o=e[u],"function"==typeof o)try{o(function(e){t.session[u]=e,l(!0)}),a++}catch(c){t.console&&"function"==typeof console.log&&l(!0)}else t.session[u]=o;l()},a={detect:function(){return{browser:this.search(this.data.browser),version:this.search(n.userAgent)||this.search(n.appVersion),os:this.search(this.data.os)}},search:function(t){if("object"!=typeof t){var e=t.indexOf(this.version_string);if(-1==e)return;return parseFloat(t.substr(e+this.version_string.length+1))}for(var n=0;n<t.length;n++){var i=t[n].string,r=t[n].prop;if(this.version_string=t[n].versionSearch||t[n].identity,i){if(-1!=i.indexOf(t[n].subString))return t[n].identity}else if(r)return t[n].identity}},data:{browser:[{string:n.userAgent,subString:"Chrome",identity:"Chrome"},{string:n.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:n.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:t.opera,identity:"Opera",versionSearch:"Version"},{string:n.vendor,subString:"iCab",identity:"iCab"},{string:n.vendor,subString:"KDE",identity:"Konqueror"},{string:n.userAgent,subString:"Firefox",identity:"Firefox"},{string:n.vendor,subString:"Camino",identity:"Camino"},{string:n.userAgent,subString:"Netscape",identity:"Netscape"},{string:n.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:n.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:n.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:n.platform,subString:"Win",identity:"Windows"},{string:n.platform,subString:"Mac",identity:"Mac"},{string:n.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:n.userAgent,subString:"iPad",identity:"iPad"},{string:n.userAgent,subString:"Android",identity:"Android"},{string:n.platform,subString:"Linux",identity:"Linux"}]}},s={browser:function(){return a.detect()},time:function(){var t=new Date,e=new Date;return t.setMonth(0),t.setDate(1),e.setMonth(6),e.setDate(1),{tz_offset:-(new Date).getTimezoneOffset()/60,observes_dst:t.getTimezoneOffset()!==e.getTimezoneOffset()}},locale:function(){var t=(n.language||n.browserLanguage||n.systemLanguage||n.userLanguage||"").split("-");return 2==t.length?{country:t[1].toLowerCase(),lang:t[0].toLowerCase()}:t?{lang:t[0].toLowerCase(),country:null}:{lang:null,country:null}},device:function(){var i={screen:{width:t.screen.width,height:t.screen.height}};return i.viewport={width:t.innerWidth||e.documentElement.clientWidth||e.body.clientWidth,height:t.innerHeight||e.documentElement.clientHeight||e.body.clientHeight},i.is_tablet=!!n.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),i.is_phone=!i.is_tablet&&!!n.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),i.is_mobile=i.is_tablet||i.is_phone,i},plugins:function(){var t=function(t){if(n.plugins){for(var e,i=0,r=n.plugins.length;r>i;i++)if(e=n.plugins[i],e&&e.name&&-1!==e.name.toLowerCase().indexOf(t))return!0;return!1}return!1};return{flash:t("flash"),silverlight:t("silverlight"),java:t("java"),quicktime:t("quicktime")}},session:function(n,i){var r=l.get_obj(n);if(null==r){r={visits:1,start:(new Date).getTime(),last_visit:(new Date).getTime(),url:t.location.href,path:t.location.pathname,referrer:e.referrer,referrer_info:l.parse_url(e.referrer),search:{engine:null,query:null}};var o,a=[{name:"Google",host:"google",query:"q"},{name:"Bing",host:"bing.com",query:"q"},{name:"Yahoo",host:"search.yahoo",query:"p"},{name:"AOL",host:"search.aol",query:"q"},{name:"Ask",host:"ask.com",query:"q"},{name:"Baidu",host:"baidu.com",query:"wd"}],s=a.length,u=0,c="q query term p wd query text".split(" ");for(u=0;s>u;u++)if(o=a[u],-1!==r.referrer_info.host.indexOf(o.host)){r.search.engine=o.name,r.search.query=r.referrer_info.query[o.query],r.search.terms=r.search.query?r.search.query.split(" "):null;break}if(null===r.search.engine&&r.referrer_info.search.length>1)for(u=0;u<c.length;u++){var d=r.referrer_info.query[c[u]];if(d){r.search.engine="Unknown",r.search.query=d,r.search.terms=d.split(" ");break}}}else r.prev_visit=r.last_visit,r.last_visit=(new Date).getTime(),r.visits++,r.time_since_last_visit=r.last_visit-r.prev_visit;return l.set_cookie(n,l.package_obj(r),i),r},html5_location:function(){return function(t){n.geolocation.getCurrentPosition(function(e){e.source="html5",t(e)},function(){r.gapi_location?s.gapi_location()(t):t({error:!0,source:"html5"})})}},gapi_location:function(){return function(e){var n=l.get_obj(r.location_cookie);n&&"google"===n.source?e(n):(t.gloader_ready=function(){"google"in t&&(t.google.loader.ClientLocation?(t.google.loader.ClientLocation.source="google",e(t.google.loader.ClientLocation)):e({error:!0,source:"google"}),l.set_cookie(r.location_cookie,l.package_obj(t.google.loader.ClientLocation),1e3*60*60*r.location_cookie_timeout))},l.embed_script("https://www.google.com/jsapi?callback=gloader_ready"))}},ipinfodb_location:function(e){return function(n){var i=l.get_obj(r.location_cookie);i&&"ipinfodb"===i.source&&n(i),t.ipinfocb=function(t){if("OK"===t.statusCode)t.source="ipinfodb",l.set_cookie(r.location_cookie,l.package_obj(t),1e3*60*60*r.location_cookie),n(t);else{if(r.gapi_location)return s.gapi_location()(n);n({error:!0,source:"ipinfodb",message:t.statusMessage})}},l.embed_script("http://api.ipinfodb.com/v3/ip-city/?key="+e+"&format=json&callback=ipinfocb")}}},l={parse_url:function(t){var n=e.createElement("a"),i={};if(n.href=t,query_str=n.search.substr(1),""!=query_str)for(var r,o=query_str.split("&"),a=0,s=o.length;s>a;a++)r=o[a].split("="),2===r.length&&(i[r[0]]=decodeURI(r[1]));return{host:n.host,path:n.pathname,protocol:n.protocol,port:""===n.port?80:n.port,search:n.search,query:i}},set_cookie:function(n,i,r,o){if(!n)return null;if(!o)var o={};return(null===i||void 0===i)&&(r=-1),r&&(o.expires=(new Date).getTime()+r),e.cookie=[encodeURIComponent(n),"=",encodeURIComponent(String(i)),o.expires?"; expires="+new Date(o.expires).toUTCString():"","; path="+(o.path?o.path:"/"),o.domain?"; domain="+o.domain:"",t.location&&"https:"===t.location.protocol?"; secure":""].join("")},get_cookie:function(t,n){return(n=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(e.cookie))?decodeURIComponent(n[1]):null},embed_script:function(t){var n=e.createElement("script");n.type="text/javascript",n.src=t,e.getElementsByTagName("body")[0].appendChild(n)},package_obj:function(t){if(t){t.version=i;var e=u.stringify(t);return delete t.version,e}},get_obj:function(t){var e;try{e=u.parse(l.get_cookie(t))}catch(n){}return e&&e.version==i?(delete e.version,e):void 0}},u={parse:t.JSON&&t.JSON.parse||function(t){return"string"==typeof t&&t?new Function("return "+t)():null},stringify:t.JSON&&t.JSON.stringify||function(t){var e=typeof t;if("object"===e&&null!==t){var n,i,r=[],o=t&&t.constructor===Array;for(n in t)i=t[n],e=typeof i,"string"===e?i='"'+i+'"':"object"===e&&null!==i&&(i=this.stringify(i)),r.push((o?"":'"'+n+'":')+i);return(o?"[":"{")+r.join(",")+(o?"]":"}")}return"string"===e?'"'+t+'"':void 0}};o()};"undefined"==typeof window.exports?session_fetch(window,document,navigator):window.exports.session=session_fetch,function(t){var e=0;t.fn.splitter=function(n){return n=n||{},this.each(function(){function i(){return t.browser.msie&&parseInt(t.browser.version)<9}function r(e){1!=e.which||b._docked||(f.css("-webkit-user-select","none").find("iframe").addClass(p.iframeClass),m._posSplit=m[0][p.pxSplit]-e[p.eventPos],t(document).bind("mousemove"+p.eventNamespace,o).bind("mouseup"+p.eventNamespace,a))}function o(t){var e=m._posSplit+t[p.eventPos],n=Math.max(0,Math.min(e,_._DA-b._DA)),i=Math.max(m._min,_._DA-g._max,Math.min(e,m._max,_._DA-b._DA-g._min));p.outline?(p.dockPane==m&&e<Math.max(m._min,b._DA)||p.dockPane==g&&e>Math.min(e,m._max,_._DA-b._DA-g._min)?b.css(p.origin,n):b.css(p.origin,i),b._DA=b[0][p.pxSplit]):s(Math.min(e,i))}function a(e){var n=m._posSplit+e[p.eventPos];p.outline&&(d&&d.remove(),d=null,s(n)),f.css("-webkit-user-select","text").find("iframe").removeClass(p.iframeClass),t(document).unbind("mousemove"+p.eventNamespace+" mouseup"+p.eventNamespace)}function s(t){b._DA=b[0][p.pxSplit],p.dockPane==m&&t<Math.max(m._min,b._DA)||p.dockPane==g&&t>Math.min(t,m._max,_._DA-b._DA-g._min)?(b._DA=b[0][p.pxSplit],null==b._pos&&(b._pos=m[0][p.pxSplit])):(b._DA=b[0][p.pxSplit],b._pos=null,t=Math.max(m._min,_._DA-g._max,Math.min(t,m._max,_._DA-b._DA-g._min))),b.css(p.origin,t).css(p.fixed,_._DF),m.css(p.origin,0).css(p.split,t).css(p.fixed,_._DF),g.css(p.origin,t+b._DA).css(p.split,_._DA-b._DA-t).css(p.fixed,_._DF),i()||f.trigger("resize")}function l(t){for(var e=0,n=1;n<arguments.length;n++)e+=Math.max(parseInt(t.css(arguments[n]),10)||0,0);return e}function u(t){_._DF=_[0][p.pxFixed]-_._PBF,_._DA=_[0][p.pxSplit]-_._PBA,_._DF<=0||_._DA<=0||(_._oldW!=_.width()||_._oldH!=_.height())&&(_._oldW=_.width(),_._oldH=_.height(),s(isNaN(t)?p.sizeRight||p.sizeBottom?_._DA-g[0][p.pxSplit]-b._DA:m[0][p.pxSplit]:t))}function c(){return p.dockPane==m?0:_[0][p.pxSplit]-_._PBA-b[0][p.pxSplit]}if(!t(this).attr("data-splitter-initialized")){var d,h=(n.splitHorizontal?"h":n.splitVertical?"v":n.type)||"v",p=t.extend({splitterClass:"splitter ui-widget ui-widget-content",paneClass:"splitter-pane",barClass:"splitter-bar",barNormalClass:"ui-state-default",barHoverClass:"ui-state-hover",barActiveClass:"ui-state-highlight",barLimitClass:"ui-state-error",iframeClass:"splitter-iframe-hide",eventNamespace:".splitter"+ ++e,pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,cursor:"e-resize",barStateClass:"splitter-bar-vertical",barDockedClass:"splitter-bar-vertical-docked"},h:{keyTop:40,keyBottom:38,cursor:"auto",barStateClass:"splitter-bar-horizontal",barDockedClass:"splitter-bar-horizontal-docked"}}[h],n,{v:{type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[h]);p.barStateClasses=[p.barNormalClass,p.barHoverClass,p.barActiveClass,p.barLimitClass].join(" ");var _=t(this).css({position:"relative"}).addClass(p.splitterClass).attr("data-splitter-initialized",!0),f=t(">*",_[0]).addClass(p.paneClass).css({position:"absolute","z-index":"1","-moz-outline-style":"none"}),m=t(f[0]),g=t(f[1]);p.dockPane=p.dock&&(/right|bottom/.test(p.dock)?g:m);var v=t('<a href="javascript:void(0)"></a>').attr({accessKey:p.accessKey,tabIndex:p.tabIndex,title:p.splitbarClass}).bind((t.browser.opera?"click":"focus")+p.eventNamespace,function(){this.focus(),b.addClass(p.barActiveClass)}).bind("keydown"+p.eventNamespace,function(t){var e=t.which||t.keyCode,n=e==p["key"+p.side1]?1:e==p["key"+p.side2]?-1:0;n&&s(m[0][p.pxSplit]+n*p.pxPerKey,!1)}).bind("blur"+p.eventNamespace,function(){b.removeClass(p.barActiveClass)}),b=t("<div></div>").insertAfter(m).addClass(p.barClass).addClass(p.barStateClass).append(v).attr({unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","z-index":"100"}).bind("mousedown"+p.eventNamespace,r);/^(auto|default|)$/.test(b.css("cursor"))&&b.css("cursor",p.cursor),b._DA=b[0][p.pxSplit],_._PBF=l(_,"border"+p.side3+"Width","border"+p.side4+"Width"),_._PBA=l(_,"border"+p.side1+"Width","border"+p.side2+"Width"),m._pane=p.side1,g._pane=p.side2,t.each([m,g],function(){this._splitter_style=this.style,this._min=p["min"+this._pane]||l(this,"min-"+p.split),this._max=p["max"+this._pane]||l(this,"max-"+p.split)||9999,this._init=p["size"+this._pane]===!0?parseInt(t.css(this[0],p.split),10):p["size"+this._pane]});var y=m._init;isNaN(g._init)||(y=_[0][p.pxSplit]-_._PBA-g._init-b._DA),p.cookie&&(t.cookie||alert("jQuery.splitter(): jQuery cookie plugin required"),null!=t.cookie(p.cookie)&&(y=parseInt(t.cookie(p.cookie),10)),t(window).bind("unload"+p.eventNamespace,function(){var e=String(b.css(p.origin));t.cookie(p.cookie,e,{expires:p.cookieExpires||365,path:p.cookiePath||document.location.pathname})})),isNaN(y)&&(y=Math.round((_[0][p.pxSplit]-_._PBA-b._DA)/2)),p.startDocked&&(b._pos=y,y=c(),b._docked=!0),p.anchorToWindow&&(p.resizeTo=window),p.resizeTo?(_._hadjust=l(_,"borderTopWidth","borderBottomWidth","marginBottom"),_._hmin=Math.max(l(_,"minHeight"),20),t(window).bind("resize"+p.eventNamespace,function(){var e=_.offset().top,n=t(p.resizeTo).height();_.css("height",Math.max(n-e-_._hadjust,_._hmin)+"px"),i()||_.triggerHandler("resize")}).triggerHandler("resize"+p.eventNamespace)):p.resizeToWidth&&!i()&&t(window).bind("resize"+p.eventNamespace,function(){u()}),p.dock&&(_.bind("toggleDock"+p.eventNamespace,function(){var t=p.dockPane[0][p.pxSplit];_.triggerHandler(t?"dock":"undock")}).bind("dock"+p.eventNamespace,function(){var t=m[0][p.pxSplit];if(t){b._pos=t,b._docked=!0;var e={};e[p.origin]=c(),b.animate(e,p.dockSpeed||1,p.dockEasing,function(){b.addClass(p.barDockedClass),s(e[p.origin])})}}).bind("undock"+p.eventNamespace,function(){if(b._docked){var t={};t[p.origin]=b._pos+"px",b._docked=!1,b.removeClass(p.barDockedClass).animate(t,p.undockSpeed||p.dockSpeed||1,p.undockEasing||p.dockEasing,function(){s(b._pos),b._pos=null})}}),p.dockKey&&t('<a title="'+p.splitbarClass+' toggle dock" href="javascript:void(0)"></a>').attr({accessKey:p.dockKey,tabIndex:-1}).appendTo(b).bind(t.browser.opera?"click":"focus",function(){_.triggerHandler("toggleDock"),this.blur()})),_.bind("destroy"+p.eventNamespace,function(){t([window,document]).unbind(p.eventNamespace),b.unbind().remove(),f.removeClass(p.paneClass),_.removeClass(p.splitterClass).add(f).unbind(p.eventNamespace).attr("style",function(){return this._splitter_style||""}),_=b=v=f=m=g=p=n=null}).bind("resize"+p.eventNamespace,function(t,e){u(e)}).bind("start_resize",function(t,e){r(e)}).bind("end_resize",function(t,e){a(e)}).trigger("resize",[y])}})}}(jQuery),function(t){t.fn.customSplitter=function(e){return e=e||{},this.each(function(){function n(){return t.browser.msie&&parseInt(t.browser.version)<9}function i(t){y.removeClass(p.barStateClasses).addClass(t)}function r(e){1==e.which&&(y.removeClass(p.barHoverClass),p.outline&&(d=d||y.clone(!1).insertAfter(m),y.removeClass(p.barDockedClass)),i(p.barActiveClass),f.css("-webkit-user-select","none").find("iframe").addClass(p.iframeClass),m._posSplit=m[0][p.pxSplit]-e[p.eventPos],t(document).bind("mousemove"+p.eventNamespace,o).bind("mouseup"+p.eventNamespace,a))}function o(t){var e=m._posSplit+t[p.eventPos],n=(Math.max(0,Math.min(e,_._DA-y._DA)),Math.max(m._min,_._DA-g._max,Math.min(e,m._max,_._DA-y._DA-g._min)));p.outline?(p.dockPane==m&&e<Math.max(m._min,y._DA)||p.dockPane==g&&e>Math.min(e,m._max,_._DA-y._DA-g._min)?(v.removeClass("hidden"),e>_._DA-50?v.addClass("hover"):v.removeClass("hover")):(v.addClass("hidden"),y.removeClass(p.barDockedClass).css(p.origin,n)),y._DA=y[0][p.pxSplit]):s(e),i(e==n?p.barActiveClass:p.barLimitClass)}function a(e){i(p.barNormalClass),y.addClass(p.barHoverClass);var n=m._posSplit+e[p.eventPos];p.outline&&(d&&d.remove(),d=null),n>_._DA-50?(_.trigger("dock"),t("#rightdock").removeClass("hidden")):s(n),f.css("-webkit-user-select","text").find("iframe").removeClass(p.iframeClass),v.addClass("hidden"),t(document).unbind("mousemove"+p.eventNamespace+" mouseup"+p.eventNamespace)}function s(e,i){"undefined"==typeof i&&(i=!1),y._DA=y[0][p.pxSplit],p.dockPane==g&&e>Math.min(e,m._max,_._DA-y._DA-g._min)&&null==y._pos&&(y._pos=m[0][p.pxSplit]),(i||_.hasClass("docked"))&&(p.dockPane==m&&e<Math.max(m._min,y._DA)||p.dockPane==g&&e>Math.min(e,m._max,_._DA-y._DA-g._min))?(y.addClass(p.barDockedClass),y._DA=y[0][p.pxSplit],e=p.dockPane==m?0:_._DA-y._DA,null==y._pos&&(y._pos=m[0][p.pxSplit])):(y.removeClass(p.barDockedClass),y._DA=y[0][p.pxSplit],y._pos=null,e=Math.max(m._min,_._DA-g._max,Math.min(e,m._max,_._DA-y._DA-g._min))),y.css(p.origin,e).css(p.fixed,_._DF),m.css(p.origin,0).css(p.split,e).css(p.fixed,_._DF),g.css(p.origin,e+y._DA).css(p.split,_._DA-y._DA-e).css(p.fixed,_._DF),n()||f.triggerHandler("resize"),p.resize_event&&t(document).trigger(p.resize_event);var r=String(y.css(p.origin));t.cookie(p.cookie,r,{expires:p.cookieExpires||365,path:"/"})}function l(t){for(var e=0,n=1;n<arguments.length;n++)e+=Math.max(parseInt(t.css(arguments[n]),10)||0,0);return e}function u(){_._DF=_[0][p.pxFixed]-_._PBF,_._DA=_[0][p.pxSplit]-_._PBA}function c(t){if(_._DF=_[0][p.pxFixed]-_._PBF,_._DA=_[0][p.pxSplit]-_._PBA,!(_._DF<=0||_._DA<=0||_._oldW==_.width()&&_._oldH==_.height()-5)){_._oldW=_.width(),_._oldH=_.height()-5;var e=0;e=isNaN(t)?p.sizeRight||p.sizeBottom?_._DA-g[0][p.pxSplit]-y._DA+1:m[0][p.pxSplit]:t,s(e),i(p.barNormalClass)}}if(!t(this).attr("data-splitter-initialized")){var d,h=(e.splitHorizontal?"h":e.splitVertical?"v":e.type)||"v",p=t.extend({splitterClass:"splitter ui-widget ui-widget-content",paneClass:"splitter-pane",barClass:"splitter-bar",barNormalClass:"ui-state-default",barHoverClass:"ui-state-hover",barActiveClass:"ui-state-highlight",barLimitClass:"ui-state-error",iframeClass:"splitter-iframe-hide",eventNamespace:".customsplitter",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,barStateClass:"splitter-bar-vertical",barDockedClass:"splitter-bar-vertical-docked"},h:{keyTop:40,keyBottom:38,cursor:"ns-resize",barStateClass:"splitter-bar-horizontal",barDockedClass:"splitter-bar-horizontal-docked"}}[h],e,{v:{type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[h]);p.barStateClasses=[p.barNormalClass,p.barHoverClass,p.barActiveClass,p.barLimitClass].join(" ");var _=t(this).addClass(p.splitterClass).attr("data-splitter-initialized",!0),f=t(">*",_[0]).addClass(p.paneClass).css({position:"absolute","-moz-outline-style":"none"}),m=t(f[0]),g=t(f[1]),v=t(e.dockzone_selector);p.dockPane=p.dock&&(/right|bottom/.test(p.dock)?g:m);var b=t('<a href="javascript:void(0)"></a>').attr({accessKey:p.accessKey,tabIndex:p.tabIndex,title:p.splitbarClass}).bind((t.browser.opera?"click":"focus")+p.eventNamespace,function(){this.focus(),y.addClass(p.barActiveClass)}).bind("keydown"+p.eventNamespace,function(t){var e=t.which||t.keyCode,n=e==p["key"+p.side1]?1:e==p["key"+p.side2]?-1:0;n&&s(m[0][p.pxSplit]+n*p.pxPerKey,!1)}).bind("blur"+p.eventNamespace,function(){y.removeClass(p.barActiveClass)}),y=t("<div></div>").insertAfter(m).addClass(p.barClass).addClass(p.barStateClass).append(b).attr({unselectable:"on"}).css({position:"absolute","user-select":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","z-index":"100"}).bind("mousedown"+p.eventNamespace,r).bind("mouseover"+p.eventNamespace,function(){t(this).addClass(p.barHoverClass)}).bind("mouseout"+p.eventNamespace,function(){t(this).removeClass(p.barHoverClass)});/^(auto|default|)$/.test(y.css("cursor"))&&y.css("cursor",p.cursor),y._DA=y[0][p.pxSplit],_._PBF=l(_,"border"+p.side3+"Width","border"+p.side4+"Width"),_._PBA=l(_,"border"+p.side1+"Width","border"+p.side2+"Width"),m._pane=p.side1,g._pane=p.side2,t.each([m,g],function(){this._splitter_style=this.style,this._min=p["min"+this._pane]||l(this,"min-"+p.split),this._max=p["max"+this._pane]||l(this,"max-"+p.split)||9999,this._init=p["size"+this._pane]===!0?parseInt(t.css(this[0],p.split),10):p["size"+this._pane]});var w=m._init;isNaN(g._init)||(w=_[0][p.pxSplit]-_._PBA-g._init-y._DA),p.cookie&&(t.cookie||alert("jQuery.splitter(): jQuery cookie plugin required"),w=parseInt(t.cookie(p.cookie),10)),isNaN(w)&&(w=Math.round((_[0][p.pxSplit]-_._PBA-y._DA)/2)),p.anchorToWindow&&(p.resizeTo=window),p.resizeTo?(_._hadjust=l(_,"borderTopWidth","borderBottomWidth","marginBottom"),_._hmin=Math.max(l(_,"minHeight"),20),t(window).bind("resize"+p.eventNamespace,function(){var e=_.offset().top,i=t(p.resizeTo).height();_.css("height",Math.max(i-e-_._hadjust,_._hmin)+"px"),n()||_.triggerHandler("resize")}).triggerHandler("resize"+p.eventNamespace)):p.resizeToWidth&&!n()&&t(window).bind("resize"+p.eventNamespace,function(){c()}),p.dock&&(_.bind("toggleDock"+p.eventNamespace,function(){var t=p.dockPane[0][p.pxSplit];_.triggerHandler(t?"dock":"undock")}).bind("dock"+p.eventNamespace,function(){var e=m[0][p.pxSplit];if(e){y._pos=e;var n={};n[p.origin]=p.dockPane==m?0:_[0][p.pxSplit]-_._PBA-y[0][p.pxSplit],_.addClass("docked"),u(),y.animate(n,p.dockSpeed||1,p.dockEasing,function(){y.addClass(p.barDockedClass),s(n[p.origin],!0),t(p.dockPane).addClass("dockedHidden")})}}).bind("undock"+p.eventNamespace,function(){p.dockPane[0][p.pxSplit];var e={};e[p.origin]=y._pos+"px",_.removeClass("docked"),u(),y.removeClass(p.barDockedClass).animate(e,p.undockSpeed||p.dockSpeed||1,p.undockEasing||p.dockEasing,function(){s(y._pos,!0),t(p.dockPane).removeClass("dockedHidden"),t("#rightdock").addClass("hidden"),y._pos=null,t(document).trigger("main_splitter_resized"),t(document).trigger("main_splitter_resized")})}),p.dockKey&&t('<a title="'+p.splitbarClass+' toggle dock" href="javascript:void(0)"></a>').attr({accessKey:p.dockKey,tabIndex:-1}).appendTo(y).bind(t.browser.opera?"click":"focus",function(){_.triggerHandler("toggleDock"),this.blur()})),_.bind("destroy"+p.eventNamespace,function(){t([window,document]).unbind(p.eventNamespace),y.unbind().remove(),f.removeClass(p.paneClass),_.removeClass(p.splitterClass).add(f).unbind(p.eventNamespace).attr("style",function(){return this._splitter_style||""}),_=y=b=f=m=g=p=e=null}).bind("resize"+p.eventNamespace,function(t,e){c(e)}).trigger("resize",[w])}})}}(jQuery),function(t){t.fn.iframeAutoHeight=function(e){function n(t){window.console&&e.debug&&1==e.debug&&console.log(t)}var e=t.extend({heightOffset:0,callback:function(){},debug:!1},e);n(e),t(this).each(function(){function i(t){return t.contentWindow.document.compatMode&&"ActiveXObject"in window&&"function"==typeof window.ActiveXObject?(n("IE Quirks mode"),!0):!1}function r(t){var r;r=i(t)?t.contentWindow.document.body.scrollHeight+e.heightOffset:t.contentWindow.document.body.offsetHeight+e.heightOffset,n("New Height: "+r),t.style.height=r+"px",e.callback({newFrameHeight:r})}if(n(this),t.browser.safari||t.browser.opera){n("browser is webkit or opera"),t(this).load(function(){var t=this;t.style.height="0px";var e=function(){r(t)};setTimeout(e,0)});var o=t(this).attr("src");t(this).attr("src",""),t(this).attr("src",o)}else t(this).load(function(){r(this)})})}}(jQuery),window.Modernizr=function(t,e,n){function i(t){_.cssText=t}function r(t,e){return typeof t===e}var o,a,s,l="2.8.3",u={},c=!0,d=e.documentElement,h="modernizr",p=e.createElement(h),_=p.style,f=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),m={},g=[],v=g.slice,b={}.hasOwnProperty;s=r(b,"undefined")||r(b.call,"undefined")?function(t,e){return e in t&&r(t.constructor.prototype[e],"undefined")}:function(t,e){return b.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var n=v.call(arguments,1),i=function(){if(this instanceof i){var r=function(){};r.prototype=e.prototype;var o=new r,a=e.apply(o,n.concat(v.call(arguments)));return Object(a)===a?a:o}return e.apply(t,n.concat(v.call(arguments)))};return i});for(var y in m)s(m,y)&&(a=y.toLowerCase(),u[a]=m[y](),g.push((u[a]?"":"no-")+a));return u.addTest=function(t,e){if("object"==typeof t)for(var i in t)s(t,i)&&u.addTest(i,t[i]);else{if(t=t.toLowerCase(),u[t]!==n)return u;e="function"==typeof e?e():e,"undefined"!=typeof c&&c&&(d.className+=" "+(e?"":"no-")+t),u[t]=e}return u},i(""),p=o=null,function(t,e){function n(t,e){var n=t.createElement("p"),i=t.getElementsByTagName("head")[0]||t.documentElement;return n.innerHTML="x<style>"+e+"</style>",i.insertBefore(n.lastChild,i.firstChild)}function i(){var t=v.elements;return"string"==typeof t?t.split(" "):t}function r(t){var e=g[t[f]];return e||(e={},m++,t[f]=m,g[m]=e),e}function o(t,n,i){if(n||(n=e),c)return n.createElement(t);i||(i=r(n));var o;return o=i.cache[t]?i.cache[t].cloneNode():_.test(t)?(i.cache[t]=i.createElem(t)).cloneNode():i.createElem(t),!o.canHaveChildren||p.test(t)||o.tagUrn?o:i.frag.appendChild(o)}function a(t,n){if(t||(t=e),c)return t.createDocumentFragment();n=n||r(t);for(var o=n.frag.cloneNode(),a=0,s=i(),l=s.length;l>a;a++)o.createElement(s[a]);return o}function s(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(n){return v.shivMethods?o(n,t,e):e.createElem(n)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+i().join().replace(/[\w\-]+/g,function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'})+");return n}")(v,e.frag)}function l(t){t||(t=e);var i=r(t);return v.shivCSS&&!u&&!i.hasCSS&&(i.hasCSS=!!n(t,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),c||s(t,i),t}var u,c,d="3.7.0",h=t.html5||{},p=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,_=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f="_html5shiv",m=0,g={};!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",u="hidden"in t,c=1==t.childNodes.length||function(){e.createElement("a");var t=e.createDocumentFragment();return"undefined"==typeof t.cloneNode||"undefined"==typeof t.createDocumentFragment||"undefined"==typeof t.createElement}()}catch(n){u=!0,c=!0}}();var v={elements:h.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:d,shivCSS:h.shivCSS!==!1,supportsUnknownElements:c,shivMethods:h.shivMethods!==!1,type:"default",shivDocument:l,createElement:o,createDocumentFragment:a};t.html5=v,l(e)}(this,e),u._version=l,u._prefixes=f,d.className=d.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(c?" js "+g.join(" "):""),u}(this,this.document),function(t,e,n){function i(t){return"[object Function]"==m.call(t)}function r(t){return"string"==typeof t}function o(){}function a(t){return!t||"loaded"==t||"complete"==t||"uninitialized"==t}function s(){var t=g.shift();v=1,t?t.t?_(function(){("c"==t.t?h.injectCss:h.injectJs)(t.s,0,t.a,t.x,t.e,1)},0):(t(),s()):v=0}function l(t,n,i,r,o,l,u){function c(e){if(!p&&a(d.readyState)&&(b.r=p=1,!v&&s(),d.onload=d.onreadystatechange=null,e)){"img"!=t&&_(function(){w.removeChild(d)},50);for(var i in q[n])q[n].hasOwnProperty(i)&&q[n][i].onload()}}var u=u||h.errorTimeout,d=e.createElement(t),p=0,m=0,b={t:i,s:n,e:o,a:l,x:u};1===q[n]&&(m=1,q[n]=[]),"object"==t?d.data=n:(d.src=n,d.type=t),d.width=d.height="0",d.onerror=d.onload=d.onreadystatechange=function(){c.call(this,m)},g.splice(r,0,b),"img"!=t&&(m||2===q[n]?(w.insertBefore(d,y?null:f),_(c,u)):q[n].push(d))}function u(t,e,n,i,o){return v=0,e=e||"j",r(t)?l("c"==e?$:k,t,e,this.i++,n,i,o):(g.splice(this.i++,0,t),1==g.length&&s()),this}function c(){var t=h;return t.loader={load:u,i:0},t}var d,h,p=e.documentElement,_=t.setTimeout,f=e.getElementsByTagName("script")[0],m={}.toString,g=[],v=0,b="MozAppearance"in p.style,y=b&&!!e.createRange().compareNode,w=y?p:f.parentNode,p=t.opera&&"[object Opera]"==m.call(t.opera),p=!!e.attachEvent&&!p,k=b?"object":p?"script":"img",$=p?"script":k,x=Array.isArray||function(t){return"[object Array]"==m.call(t)},C=[],q={},T={timeout:function(t,e){return e.length&&(t.timeout=e[0]),t}};h=function(t){function e(t){var e,n,i,t=t.split("!"),r=C.length,o=t.pop(),a=t.length,o={url:o,origUrl:o,prefixes:t};for(n=0;a>n;n++)i=t[n].split("="),(e=T[i.shift()])&&(o=e(o,i));for(n=0;r>n;n++)o=C[n](o);return o}function a(t,r,o,a,s){var l=e(t),u=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(r&&(r=i(r)?r:r[t]||r[a]||r[t.split("/").pop().split("?")[0]]),l.instead?l.instead(t,r,o,a,s):(q[l.url]?l.noexec=!0:q[l.url]=1,o.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":n,l.noexec,l.attrs,l.timeout),(i(r)||i(u))&&o.load(function(){c(),r&&r(l.origUrl,s,a),u&&u(l.origUrl,s,a),q[l.url]=2})))}function s(t,e){function n(t,n){if(t){if(r(t))n||(d=function(){var t=[].slice.call(arguments);h.apply(this,t),p()}),a(t,d,e,0,u);else if(Object(t)===t)for(l in s=function(){var e,n=0;for(e in t)t.hasOwnProperty(e)&&n++;return n}(),t)t.hasOwnProperty(l)&&(!n&&!--s&&(i(d)?d=function(){var t=[].slice.call(arguments);h.apply(this,t),p()}:d[l]=function(t){return function(){var e=[].slice.call(arguments);t&&t.apply(this,e),p()}}(h[l])),a(t[l],d,e,l,u))}else!n&&p()}var s,l,u=!!t.test,c=t.load||t.both,d=t.callback||o,h=d,p=t.complete||o;n(u?t.yep:t.nope,!!c),c&&n(c)}var l,u,d=this.yepnope.loader;if(r(t))a(t,0,d,0);else if(x(t))for(l=0;l<t.length;l++)u=t[l],r(u)?a(u,0,d,0):x(u)?h(u):Object(u)===u&&s(u,d);else Object(t)===t&&s(t,d)},h.addPrefix=function(t,e){T[t]=e},h.addFilter=function(t){C.push(t)},h.errorTimeout=1e4,null==e.readyState&&e.addEventListener&&(e.readyState="loading",e.addEventListener("DOMContentLoaded",d=function(){e.removeEventListener("DOMContentLoaded",d,0),e.readyState="complete"},0)),t.yepnope=c(),t.yepnope.executeStack=s,t.yepnope.injectJs=function(t,n,i,r,l,u){var c,d,p=e.createElement("script"),r=r||h.errorTimeout;p.src=t;for(d in i)p.setAttribute(d,i[d]);n=u?s:n||o,p.onreadystatechange=p.onload=function(){!c&&a(p.readyState)&&(c=1,n(),p.onload=p.onreadystatechange=null)},_(function(){c||(c=1,n(1))},r),l?p.onload():f.parentNode.insertBefore(p,f)},t.yepnope.injectCss=function(t,n,i,r,a,l){var u,r=e.createElement("link"),n=l?s:n||o;r.href=t,r.rel="stylesheet",r.type="text/css";for(u in i)r.setAttribute(u,i[u]);a||(f.parentNode.insertBefore(r,f),_(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cssfilters",function(){var t=document.createElement("div");return t.style.cssText=Modernizr._prefixes.join("filter:blur(2px); "),!!t.style.length&&(void 0===document.documentMode||document.documentMode>9)}),function(){var t,e,n,i,r,o,a,s,l,u,c,d,h,p,_,f,m,g,v,b,y,w=[].slice,k=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};$.payment={},$.payment.fn={},$.fn.payment=function(){var t,e;return e=arguments[0],t=2<=arguments.length?w.call(arguments,1):[],$.payment.fn[e].apply(this,t)
},i=/(\d{1,4})/g,$.payment.cards=n=[{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5(018|0[23]|[68])|6(39|7))/,format:i,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:i,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[0-5]/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",pattern:/^3[0689]/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^6([045]|22)/,format:i,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^(62|88)/,format:i,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:i,length:[16],cvcLength:[3],luhn:!0}],t=function(t){var e,i,r;for(t=(t+"").replace(/\D/g,""),i=0,r=n.length;r>i;i++)if(e=n[i],e.pattern.test(t))return e},e=function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e.type===t)return e},d=function(t){var e,n,i,r,o,a;for(i=!0,r=0,n=(t+"").split("").reverse(),o=0,a=n.length;a>o;o++)e=n[o],e=parseInt(e,10),(i=!i)&&(e*=2),e>9&&(e-=9),r+=e;return 0===r%10},c=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")?!0:null!=("undefined"!=typeof document&&null!==document?null!=(e=document.selection)?e.createRange:void 0:void 0)&&document.selection.createRange().text?!0:!1},f=function(t){return setTimeout(function(){var e,n;return e=$(t.currentTarget),n=e.val(),n=n.replace(/\D/g,""),e.val(n)})},p=function(t){return setTimeout(function(){var e,n;return e=$(t.currentTarget),n=e.val(),n=$.payment.formatCardNumber(n),e.val(n)})},a=function(e){var n,i,r,o,a,s,l;return r=String.fromCharCode(e.which),!/^\d+$/.test(r)||(n=$(e.currentTarget),l=n.val(),i=t(l+r),o=(l.replace(/\D/g,"")+r).length,s=16,i&&(s=i.length[i.length.length-1]),o>=s||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==l.length)?void 0:(a=i&&"amex"===i.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,a.test(l)?(e.preventDefault(),setTimeout(function(){return n.val(l+" "+r)})):a.test(l+r)?(e.preventDefault(),setTimeout(function(){return n.val(l+r+" ")})):void 0)},r=function(t){var e,n;return e=$(t.currentTarget),n=e.val(),8!==t.which||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==n.length?void 0:/\d\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d\s$/,""))})):/\s\d?$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d$/,""))})):void 0},_=function(t){return setTimeout(function(){var e,n;return e=$(t.currentTarget),n=e.val(),n=$.payment.formatExpiry(n),e.val(n)})},s=function(t){var e,n,i;return n=String.fromCharCode(t.which),/^\d+$/.test(n)?(e=$(t.currentTarget),i=e.val()+n,/^\d$/.test(i)&&"0"!==i&&"1"!==i?(t.preventDefault(),setTimeout(function(){return e.val("0"+i+" / ")})):/^\d\d$/.test(i)?(t.preventDefault(),setTimeout(function(){return e.val(""+i+" / ")})):void 0):void 0},l=function(t){var e,n,i;return n=String.fromCharCode(t.which),/^\d+$/.test(n)?(e=$(t.currentTarget),i=e.val(),/^\d\d$/.test(i)?e.val(""+i+" / "):void 0):void 0},u=function(t){var e,n,i;return i=String.fromCharCode(t.which),"/"===i||" "===i?(e=$(t.currentTarget),n=e.val(),/^\d$/.test(n)&&"0"!==n?e.val("0"+n+" / "):void 0):void 0},o=function(t){var e,n;return e=$(t.currentTarget),n=e.val(),8!==t.which||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==n.length?void 0:/\d\s\/\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d\s\/\s$/,""))})):void 0},h=function(t){return setTimeout(function(){var e,n;return e=$(t.currentTarget),n=e.val(),n=n.replace(/\D/g,"").slice(0,4),e.val(n)})},b=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},g=function(e){var n,i,r,o;return n=$(e.currentTarget),r=String.fromCharCode(e.which),/^\d+$/.test(r)&&!c(n)?(o=(n.val()+r).replace(/\D/g,""),i=t(o),i?o.length<=i.length[i.length.length-1]:o.length<=16):void 0},v=function(t){var e,n,i;return e=$(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(e)?(i=e.val()+n,i=i.replace(/\D/g,""),i.length>6?!1:void 0):void 0},m=function(t){var e,n,i;return e=$(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(e)?(i=e.val()+n,i.length<=4):void 0},y=function(t){var e,i,r,o,a;return e=$(t.currentTarget),a=e.val(),o=$.payment.cardType(a)||"unknown",e.hasClass(o)?void 0:(i=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)r=n[t],i.push(r.type);return i}(),e.removeClass("unknown"),e.removeClass(i.join(" ")),e.addClass(o),e.toggleClass("identified","unknown"!==o),e.trigger("payment.cardType",o))},$.payment.fn.formatCardCVC=function(){return this.on("keypress",b),this.on("keypress",m),this.on("paste",h),this.on("change",h),this.on("input",h),this},$.payment.fn.formatCardExpiry=function(){return this.on("keypress",b),this.on("keypress",v),this.on("keypress",s),this.on("keypress",u),this.on("keypress",l),this.on("keydown",o),this.on("change",_),this.on("input",_),this},$.payment.fn.formatCardNumber=function(){return this.on("keypress",b),this.on("keypress",g),this.on("keypress",a),this.on("keydown",r),this.on("keyup",y),this.on("paste",p),this.on("change",p),this.on("input",p),this.on("input",y),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",b),this.on("paste",f),this.on("change",f),this.on("input",f),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(t){var e,n,i,r;return t=t.replace(/\s/g,""),r=t.split("/",2),e=r[0],i=r[1],2===(null!=i?i.length:void 0)&&/^\d+$/.test(i)&&(n=(new Date).getFullYear(),n=n.toString().slice(0,2),i=n+i),e=parseInt(e,10),i=parseInt(i,10),{month:e,year:i}},$.payment.validateCardNumber=function(e){var n,i;return e=(e+"").replace(/\s+|-/g,""),/^\d+$/.test(e)?(n=t(e),n?(i=e.length,k.call(n.length,i)>=0&&(n.luhn===!1||d(e))):!1):!1},$.payment.validateCardExpiry=function(t,e){var n,i,r;return"object"==typeof t&&"month"in t&&(r=t,t=r.month,e=r.year),t&&e?(t=$.trim(t),e=$.trim(e),/^\d+$/.test(t)?/^\d+$/.test(e)?t>=1&&12>=t?(2===e.length&&(e=70>e?"20"+e:"19"+e),4!==e.length?!1:(i=new Date(e,t),n=new Date,i.setMonth(i.getMonth()-1),i.setMonth(i.getMonth()+1,1),i>n)):!1:!1:!1):!1},$.payment.validateCardCVC=function(t,n){var i,r;return t=$.trim(t),/^\d+$/.test(t)?(i=e(n),null!=i?(r=t.length,k.call(i.cvcLength,r)>=0):t.length>=3&&t.length<=4):!1},$.payment.cardType=function(e){var n;return e?(null!=(n=t(e))?n.type:void 0)||null:null},$.payment.formatCardNumber=function(e){var n,i,r,o;return e=e.replace(/\D/g,""),(n=t(e))?(r=n.length[n.length.length-1],e=e.slice(0,r),n.format.global?null!=(o=e.match(n.format))?o.join(" "):void 0:(i=n.format.exec(e),null!=i?(i.shift(),i=$.grep(i,function(t){return t}),i.join(" ")):void 0)):e},$.payment.formatExpiry=function(t){var e,n,i,r;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",i=n[2]||"",r=n[3]||"",r.length>0?i=" / ":" /"===i?(e=e.substring(0,1),i=""):2===e.length||i.length>0?i=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,i=" / "),e+i+r):""}}.call(this),/*!
 * bootstrap-select v1.5.1
 * http://silviomoreto.github.io/bootstrap-select/
 *
 * Copyright 2013 bootstrap-select
 * Licensed under the MIT license
 */
!function(t){"use strict";t.expr[":"].icontains=function(e,n,i){return t(e).text().toUpperCase().indexOf(i[3].toUpperCase())>=0};var e=function(n,i,r){r&&(r.stopPropagation(),r.preventDefault()),this.$element=t(n),this.$newElement=null,this.$button=null,this.$menu=null,this.$lis=null,this.options=t.extend({},t.fn.selectpicker.defaults,this.$element.data(),"object"==typeof i&&i),null===this.options.title&&(this.options.title=this.$element.attr("title")),this.val=e.prototype.val,this.render=e.prototype.render,this.refresh=e.prototype.refresh,this.setStyle=e.prototype.setStyle,this.selectAll=e.prototype.selectAll,this.deselectAll=e.prototype.deselectAll,this.init()};e.prototype={constructor:e,init:function(){var e=this,n=this.$element.attr("id");this.$element.hide(),this.multiple=this.$element.prop("multiple"),this.autofocus=this.$element.prop("autofocus"),this.$newElement=this.createView(),this.$element.after(this.$newElement),this.$menu=this.$newElement.find("> .dropdown-menu"),this.$button=this.$newElement.find("> button"),this.$searchbox=this.$newElement.find("input"),void 0!==n&&(this.$button.attr("data-id",n),t('label[for="'+n+'"]').click(function(t){t.preventDefault(),e.$button.focus()})),this.checkDisabled(),this.clickListener(),this.options.liveSearch&&this.liveSearchListener(),this.render(),this.liHeight(),this.setStyle(),this.setWidth(),this.options.container&&this.selectPosition(),this.$menu.data("this",this),this.$newElement.data("this",this)},createDropdown:function(){var e=this.multiple?" show-tick":"",n=this.$element.parent().hasClass("input-group")?" input-group-btn":"",i=this.autofocus?" autofocus":"",r=this.options.header?'<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>'+this.options.header+"</div>":"",o=this.options.liveSearch?'<div class="bootstrap-select-searchbox"><input type="text" class="input-block-level form-control" /></div>':"",a=this.options.actionsBox?'<div class="bs-actionsbox"><div class="btn-group btn-block"><button class="actions-btn bs-select-all btn btn-sm btn-default">Select All</button><button class="actions-btn bs-deselect-all btn btn-sm btn-default">Deselect All</button></div></div>':"",s='<div class="btn-group bootstrap-select'+e+n+'">'+'<button type="button" class="btn dropdown-toggle selectpicker" data-toggle="dropdown"'+i+">"+'<span class="filter-option pull-left"></span>&nbsp;'+'<span class="caret"></span>'+"</button>"+'<div class="dropdown-menu open">'+r+o+a+'<ul class="dropdown-menu inner selectpicker" role="menu">'+"</ul>"+"</div>"+"</div>";return t(s)},createView:function(){var t=this.createDropdown(),e=this.createLi();return t.find("ul").append(e),t},reloadLi:function(){this.destroyLi();var t=this.createLi();this.$menu.find("ul").append(t)},destroyLi:function(){this.$menu.find("li").remove()},createLi:function(){var e=this,n=[],i="";return this.$element.find("option").each(function(){var i=t(this),r=i.attr("class")||"",o=i.attr("style")||"",a=i.data("content")?i.data("content"):i.html(),s=void 0!==i.data("subtext")?'<small class="muted text-muted">'+i.data("subtext")+"</small>":"",l=void 0!==i.data("icon")?'<i class="'+e.options.iconBase+" "+i.data("icon")+'"></i> ':"";if(""!==l&&(i.is(":disabled")||i.parent().is(":disabled"))&&(l="<span>"+l+"</span>"),i.data("content")||(a=l+'<span class="text">'+a+s+"</span>"),e.options.hideDisabled&&(i.is(":disabled")||i.parent().is(":disabled")))n.push('<a style="min-height: 0; padding: 0"></a>');else if(i.parent().is("optgroup")&&i.data("divider")!==!0)if(0===i.index()){var u=i.parent().attr("label"),c=void 0!==i.parent().data("subtext")?'<small class="muted text-muted">'+i.parent().data("subtext")+"</small>":"",d=i.parent().data("icon")?'<i class="'+i.parent().data("icon")+'"></i> ':"";u=d+'<span class="text">'+u+c+"</span>",0!==i[0].index?n.push('<div class="div-contain"><div class="divider"></div></div><dt>'+u+"</dt>"+e.createA(a,"opt "+r,o)):n.push("<dt>"+u+"</dt>"+e.createA(a,"opt "+r,o))}else n.push(e.createA(a,"opt "+r,o));else i.data("divider")===!0?n.push('<div class="div-contain"><div class="divider"></div></div>'):t(this).data("hidden")===!0?n.push(""):n.push(e.createA(a,r,o))}),t.each(n,function(t,e){i+="<li rel="+t+">"+e+"</li>"}),this.multiple||0!==this.$element.find("option:selected").length||this.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),t(i)},createA:function(t,e,n){return'<a tabindex="0" class="'+e+'" style="'+n+'">'+'<i class="'+this.options.iconBase+" "+this.options.tickIcon+' icon-ok check-mark"></i>'+t+"</a>"},render:function(e){var n=this;e!==!1&&this.$element.find("option").each(function(e){n.setDisabled(e,t(this).is(":disabled")||t(this).parent().is(":disabled")),n.setSelected(e,t(this).is(":selected"))}),this.tabIndex();var i=this.$element.find("option:selected").map(function(){var e,i=t(this),r=i.data("icon")&&n.options.showIcon?'<i class="'+n.options.iconBase+" "+i.data("icon")+'"></i> ':"";return e=n.options.showSubtext&&i.attr("data-subtext")&&!n.multiple?' <small class="muted text-muted">'+i.data("subtext")+"</small>":"",i.data("content")&&n.options.showContent?i.data("content"):void 0!==i.attr("title")?i.attr("title"):r+i.html()+e}).toArray(),r=this.multiple?i.join(this.options.multipleSeparator):i[0];if(this.multiple&&this.options.selectedTextFormat.indexOf("count")>-1){var o=this.options.selectedTextFormat.split(">"),a=this.options.hideDisabled?":not([disabled])":"";(o.length>1&&i.length>o[1]||1==o.length&&i.length>=2)&&(r=this.options.countSelectedText.replace("{0}",i.length).replace("{1}",this.$element.find('option:not([data-divider="true"]):not([data-hidden="true"])'+a).length))}this.options.title=this.$element.attr("title"),r||(r=void 0!==this.options.title?this.options.title:this.options.noneSelectedText),this.$button.attr("title",t.trim(r)),this.$newElement.find(".filter-option").html(r)},setStyle:function(t,e){this.$element.attr("class")&&this.$newElement.addClass(this.$element.attr("class").replace(/selectpicker|mobile-device/gi,""));var n=t?t:this.options.style;"add"==e?this.$button.addClass(n):"remove"==e?this.$button.removeClass(n):(this.$button.removeClass(this.options.style),this.$button.addClass(n))},liHeight:function(){if(this.options.size!==!1){var t=this.$menu.parent().clone().find("> .dropdown-toggle").prop("autofocus",!1).end().appendTo("body"),e=t.addClass("open").find("> .dropdown-menu"),n=e.find("li > a").outerHeight(),i=this.options.header?e.find(".popover-title").outerHeight():0,r=this.options.liveSearch?e.find(".bootstrap-select-searchbox").outerHeight():0,o=this.options.actionsBox?e.find(".bs-actionsbox").outerHeight():0;t.remove(),this.$newElement.data("liHeight",n).data("headerHeight",i).data("searchHeight",r).data("actionsHeight",o)}},setSize:function(){var e,n,i,r=this,o=this.$menu,a=o.find(".inner"),s=this.$newElement.outerHeight(),l=this.$newElement.data("liHeight"),u=this.$newElement.data("headerHeight"),c=this.$newElement.data("searchHeight"),d=this.$newElement.data("actionsHeight"),h=o.find("li .divider").outerHeight(!0),p=parseInt(o.css("padding-top"))+parseInt(o.css("padding-bottom"))+parseInt(o.css("border-top-width"))+parseInt(o.css("border-bottom-width")),_=this.options.hideDisabled?":not(.disabled)":"",f=t(window),m=p+parseInt(o.css("margin-top"))+parseInt(o.css("margin-bottom"))+2,g=function(){n=r.$newElement.offset().top-f.scrollTop(),i=f.height()-n-s};if(g(),this.options.header&&o.css("padding-top",0),"auto"==this.options.size){var v=function(){var t,s=r.$lis.not(".hide");g(),e=i-m,r.options.dropupAuto&&r.$newElement.toggleClass("dropup",n>i&&e-m<o.height()),r.$newElement.hasClass("dropup")&&(e=n-m),t=s.length+s.find("dt").length>3?3*l+m-2:0,o.css({"max-height":e+"px",overflow:"hidden","min-height":t+u+c+d+"px"}),a.css({"max-height":e-u-c-d-p+"px","overflow-y":"auto","min-height":Math.max(t-p,0)+"px"})};v(),this.$searchbox.off("input.getSize propertychange.getSize").on("input.getSize propertychange.getSize",v),t(window).off("resize.getSize").on("resize.getSize",v),t(window).off("scroll.getSize").on("scroll.getSize",v)}else if(this.options.size&&"auto"!=this.options.size&&o.find("li"+_).length>this.options.size){var b=o.find("li"+_+" > *").filter(":not(.div-contain)").slice(0,this.options.size).last().parent().index(),y=o.find("li").slice(0,b+1).find(".div-contain").length;e=l*this.options.size+y*h+p,r.options.dropupAuto&&this.$newElement.toggleClass("dropup",n>i&&e<o.height()),o.css({"max-height":e+u+c+d+"px",overflow:"hidden"}),a.css({"max-height":e-p+"px","overflow-y":"auto"})}},setWidth:function(){if("auto"==this.options.width){this.$menu.css("min-width","0");var t=this.$newElement.clone().appendTo("body"),e=t.find("> .dropdown-menu").css("width");t.remove(),this.$newElement.css("width",e)}else"fit"==this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width","").addClass("fit-width")):this.options.width?(this.$menu.css("min-width",""),this.$newElement.css("width",this.options.width)):(this.$menu.css("min-width",""),this.$newElement.css("width",""));this.$newElement.hasClass("fit-width")&&"fit"!==this.options.width&&this.$newElement.removeClass("fit-width")},selectPosition:function(){var e,n,i=this,r="<div />",o=t(r),a=function(t){o.addClass(t.attr("class").replace(/form-control/gi,"")).toggleClass("dropup",t.hasClass("dropup")),e=t.offset(),n=t.hasClass("dropup")?0:t[0].offsetHeight,o.css({top:e.top+n,left:e.left,width:t[0].offsetWidth,position:"absolute"})};this.$newElement.on("click",function(){i.isDisabled()||(a(t(this)),o.appendTo(i.options.container),o.toggleClass("open",!t(this).hasClass("open")),o.append(i.$menu))}),t(window).resize(function(){a(i.$newElement)}),t(window).on("scroll",function(){a(i.$newElement)}),t("html").on("click",function(e){t(e.target).closest(i.$newElement).length<1&&o.removeClass("open")})},mobile:function(){this.$element.addClass("mobile-device").appendTo(this.$newElement),this.options.container&&this.$menu.hide()},refresh:function(){this.$lis=null,this.reloadLi(),this.render(),this.setWidth(),this.setStyle(),this.checkDisabled(),this.liHeight()},update:function(){this.reloadLi(),this.setWidth(),this.setStyle(),this.checkDisabled(),this.liHeight()},setSelected:function(e,n){null==this.$lis&&(this.$lis=this.$menu.find("li")),t(this.$lis[e]).toggleClass("selected",n)},setDisabled:function(e,n){null==this.$lis&&(this.$lis=this.$menu.find("li")),n?t(this.$lis[e]).addClass("disabled").find("a").attr("href","#").attr("tabindex",-1):t(this.$lis[e]).removeClass("disabled").find("a").removeAttr("href").attr("tabindex",0)},isDisabled:function(){return this.$element.is(":disabled")},checkDisabled:function(){var t=this;this.isDisabled()?this.$button.addClass("disabled").attr("tabindex",-1):(this.$button.hasClass("disabled")&&this.$button.removeClass("disabled"),-1==this.$button.attr("tabindex")&&(this.$element.data("tabindex")||this.$button.removeAttr("tabindex"))),this.$button.click(function(){return!t.isDisabled()})},tabIndex:function(){this.$element.is("[tabindex]")&&(this.$element.data("tabindex",this.$element.attr("tabindex")),this.$button.attr("tabindex",this.$element.data("tabindex")))},clickListener:function(){var e=this;t("body").on("touchstart.dropdown",".dropdown-menu",function(t){t.stopPropagation()}),this.$newElement.on("click",function(){e.setSize(),e.options.liveSearch||e.multiple||setTimeout(function(){e.$menu.find(".selected a").focus()},10)}),this.$menu.on("click","li a",function(n){var i=t(this).parent().index(),r=e.$element.val(),o=e.$element.prop("selectedIndex");if(e.multiple&&n.stopPropagation(),n.preventDefault(),!e.isDisabled()&&!t(this).parent().hasClass("disabled")){var a=e.$element.find("option"),s=a.eq(i),l=s.prop("selected"),u=s.parent("optgroup"),c=e.options.maxOptions,d=u.data("maxOptions")||!1;if(e.multiple){if(s.prop("selected",!l),e.setSelected(i,!l),c!==!1||d!==!1){var h=c<a.filter(":selected").length,p=d<u.find("option:selected").length,_=e.options.maxOptionsText,f=_[0].replace("{n}",c),m=_[1].replace("{n}",d),g=t('<div class="notify"></div>');(c&&h||d&&p)&&(_[2]&&(f=f.replace("{var}",_[2][c>1?0:1]),m=m.replace("{var}",_[2][d>1?0:1])),s.prop("selected",!1),e.$menu.append(g),c&&h&&(g.append(t("<div>"+f+"</div>")),e.$element.trigger("maxReached.bs.select")),d&&p&&(g.append(t("<div>"+m+"</div>")),e.$element.trigger("maxReachedGrp.bs.select")),setTimeout(function(){e.setSelected(i,!1)},10),g.delay(750).fadeOut(300,function(){t(this).remove()}))}}else a.prop("selected",!1),s.prop("selected",!0),e.$menu.find(".selected").removeClass("selected"),e.setSelected(i,!0);e.multiple?e.options.liveSearch&&e.$searchbox.focus():e.$button.focus(),(r!=e.$element.val()&&e.multiple||o!=e.$element.prop("selectedIndex")&&!e.multiple)&&e.$element.change()}}),this.$menu.on("click","li.disabled a, li dt, li .div-contain, .popover-title, .popover-title :not(.close)",function(t){t.target==this&&(t.preventDefault(),t.stopPropagation(),e.options.liveSearch?e.$searchbox.focus():e.$button.focus())}),this.$menu.on("click",".popover-title .close",function(){e.$button.focus()}),this.$searchbox.on("click",function(t){t.stopPropagation()}),this.$menu.on("click",".actions-btn",function(n){e.options.liveSearch?e.$searchbox.focus():e.$button.focus(),n.preventDefault(),n.stopPropagation(),t(this).is(".bs-select-all")?e.selectAll():e.deselectAll(),e.$element.change()}),this.$element.change(function(){e.render(!1)})},liveSearchListener:function(){var e=this,n=t('<li class="no-results"></li>');this.$newElement.on("click.dropdown.data-api",function(){e.$menu.find(".active").removeClass("active"),e.$searchbox.val()&&(e.$searchbox.val(""),e.$menu.find("li").show(),n.parent().length&&n.remove()),e.multiple||e.$menu.find(".selected").addClass("active"),setTimeout(function(){e.$searchbox.focus()},10)}),this.$searchbox.on("input propertychange",function(){e.$searchbox.val()?(e.$lis.removeClass("hide").find("a").not(":icontains("+e.$searchbox.val()+")").parent().addClass("hide"),e.$menu.find("li").filter(":visible:not(.no-results)").length?n.parent().length&&n.remove():(n.parent().length&&n.remove(),n.html(e.options.noneResultsText+' "'+e.$searchbox.val()+'"').show(),e.$menu.find("li").last().after(n))):(e.$menu.find("li").removeClass("hide"),n.parent().length&&n.remove()),e.$menu.find("li.active").removeClass("active"),e.$menu.find("li").filter(":visible:not(.divider)").eq(0).addClass("active").find("a").focus(),t(this).focus()}),this.$menu.on("mouseenter","a",function(n){e.$menu.find(".active").removeClass("active"),t(n.currentTarget).parent().not(".disabled").addClass("active")}),this.$menu.on("mouseleave","a",function(){e.$menu.find(".active").removeClass("active")})},val:function(t){return void 0!==t?(this.$element.val(t),this.$element.change(),this.$element):this.$element.val()},selectAll:function(){null==this.$lis&&(this.$lis=this.$menu.find("li")),this.$element.find("option:enabled").prop("selected",!0),t(this.$lis).filter(":not(.disabled)").addClass("selected"),this.render(!1)},deselectAll:function(){null==this.$lis&&(this.$lis=this.$menu.find("li")),this.$element.find("option:enabled").prop("selected",!1),t(this.$lis).filter(":not(.disabled)").removeClass("selected"),this.render(!1)},keydown:function(e){var n,i,r,o,a,s,l,u,c,d,h,p,_={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"};if(n=t(this),r=n.parent(),n.is("input")&&(r=n.parent().parent()),d=r.data("this"),d.options.liveSearch&&(r=n.parent().parent()),d.options.container&&(r=d.$menu),i=t("[role=menu] li:not(.divider) a",r),p=d.$menu.parent().hasClass("open"),!p&&/([0-9]|[A-z])/.test(String.fromCharCode(e.keyCode))&&(d.setSize(),d.$menu.parent().addClass("open"),p=d.$menu.parent().hasClass("open"),d.$searchbox.focus()),d.options.liveSearch&&(/(^9$|27)/.test(e.keyCode)&&p&&0===d.$menu.find(".active").length&&(e.preventDefault(),d.$menu.parent().removeClass("open"),d.$button.focus()),i=t("[role=menu] li:not(.divider):visible",r),n.val()||/(38|40)/.test(e.keyCode)||0===i.filter(".active").length&&(i=d.$newElement.find("li").filter(":icontains("+_[e.keyCode]+")"))),i.length){if(/(38|40)/.test(e.keyCode))o=i.index(i.filter(":focus")),s=i.parent(":not(.disabled):visible").first().index(),l=i.parent(":not(.disabled):visible").last().index(),a=i.eq(o).parent().nextAll(":not(.disabled):visible").eq(0).index(),u=i.eq(o).parent().prevAll(":not(.disabled):visible").eq(0).index(),c=i.eq(a).parent().prevAll(":not(.disabled):visible").eq(0).index(),d.options.liveSearch&&(i.each(function(e){t(this).is(":not(.disabled)")&&t(this).data("index",e)}),o=i.index(i.filter(".active")),s=i.filter(":not(.disabled):visible").first().data("index"),l=i.filter(":not(.disabled):visible").last().data("index"),a=i.eq(o).nextAll(":not(.disabled):visible").eq(0).data("index"),u=i.eq(o).prevAll(":not(.disabled):visible").eq(0).data("index"),c=i.eq(a).prevAll(":not(.disabled):visible").eq(0).data("index")),h=n.data("prevIndex"),38==e.keyCode&&(d.options.liveSearch&&(o-=1),o!=c&&o>u&&(o=u),s>o&&(o=s),o==h&&(o=l)),40==e.keyCode&&(d.options.liveSearch&&(o+=1),-1==o&&(o=0),o!=c&&a>o&&(o=a),o>l&&(o=l),o==h&&(o=s)),n.data("prevIndex",o),d.options.liveSearch?(e.preventDefault(),n.is(".dropdown-toggle")||(i.removeClass("active"),i.eq(o).addClass("active").find("a").focus(),n.focus())):i.eq(o).focus();else if(!n.is("input")){var f,m,g=[];i.each(function(){t(this).parent().is(":not(.disabled)")&&t.trim(t(this).text().toLowerCase()).substring(0,1)==_[e.keyCode]&&g.push(t(this).parent().index())}),f=t(document).data("keycount"),f++,t(document).data("keycount",f),m=t.trim(t(":focus").text().toLowerCase()).substring(0,1),m!=_[e.keyCode]?(f=1,t(document).data("keycount",f)):f>=g.length&&(t(document).data("keycount",0),f>g.length&&(f=1)),i.eq(g[f-1]).focus()}/(13|32|^9$)/.test(e.keyCode)&&p&&(/(32)/.test(e.keyCode)||e.preventDefault(),d.options.liveSearch?/(32)/.test(e.keyCode)||(d.$menu.find(".active a").click(),n.focus()):t(":focus").click(),t(document).data("keycount",0)),(/(^9$|27)/.test(e.keyCode)&&p&&(d.multiple||d.options.liveSearch)||/(27)/.test(e.keyCode)&&!p)&&(d.$menu.parent().removeClass("open"),d.$button.focus())}},hide:function(){this.$newElement.hide()},show:function(){this.$newElement.show()},destroy:function(){this.$newElement.remove(),this.$element.remove()}},t.fn.selectpicker=function(n,i){var r,o=arguments,a=this.each(function(){if(t(this).is("select")){var a=t(this),s=a.data("selectpicker"),l="object"==typeof n&&n;if(s){if(l)for(var u in l)s.options[u]=l[u]}else a.data("selectpicker",s=new e(this,l,i));if("string"==typeof n){var c=n;s[c]instanceof Function?([].shift.apply(o),r=s[c].apply(s,o)):r=s.options[c]}}});return void 0!==r?r:a},t.fn.selectpicker.defaults={style:"btn-default",size:"auto",title:null,selectedTextFormat:"values",noneSelectedText:"Nothing selected",noneResultsText:"No results match",countSelectedText:"{0} of {1} selected",maxOptionsText:["Limit reached ({n} {var} max)","Group limit reached ({n} {var} max)",["items","item"]],width:!1,container:!1,hideDisabled:!1,showSubtext:!1,showIcon:!0,showContent:!0,dropupAuto:!0,header:!1,liveSearch:!1,actionsBox:!1,multipleSeparator:", ",iconBase:"icon",tickIcon:"icon-ok",maxOptions:!1},t(document).data("keycount",0).on("keydown",".bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bootstrap-select-searchbox input",e.prototype.keydown).on("focusin.modal",".bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bootstrap-select-searchbox input",function(t){t.stopPropagation()})}(window.jQuery),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}};window.quanto={instances:{},log_levels:{1:"DEBUG",2:"INFO",4:"WARN",5:"ERROR",10:"DEBUG",11:"INFO",13:"WARN",14:"ERROR"},is_real_user:function(){return function(){return null!=quanto.user_id&&!quanto.is_anonymous()}}(this),is_mac:function(){return function(){return"true"===$("#is_mac").val()}}(this),set_csrf_token:function(){return function(t,e){return null!=t&&$('meta[name="csrf-param"]').attr("content",t),null!=e?$('meta[name="csrf-token"]').attr("content",e):void 0}}(this),is_anonymous:function(){return function(){return $("#current_user_type").length>0&&"1"===$("#current_user_type").val()}}(this),is_employee_or_admin:function(t){return function(){return $("#employee_status").length>0?"true"===$("#employee_status").val():null!=t.is_employee?t.is_employee:!1}}(this),linkify:function(t){var e,n,i,r;return e=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,r=t.replace(e,'<a href="$1" target="_blank">$1</a>'),n=/(^|[^\/])(www\.[\S]+(\b|$))/gim,r=r.replace(n,'$1<a href="http://$2" target="_blank">$2</a>'),i=/(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim,r=r.replace(i,'<a href="mailto:$1">$1</a>')},is_mobile_screen:function(){return function(){var t;try{return window.matchMedia("(max-width: 767px)").matches}catch(e){return t=e,!1}}}(this),set_benchmark:function(){return function(t,e){var n,i;return i=$(".legend-item[data-key=Benchmark]").find(""+e).not(".square"),n=[t],8554===t?i.html("Benchmark (SPY)"):$.post("/securities/find_by_sid_post",{sids:n},function(t){var e,n,r,o,a;if(n=new quanto.JsonResponse(t),n.ok()&&null!=n.data()&&!_.isEmpty(n.data())){e=n.data(),a=[];for(r in e)o=e[r],a.push(i.html("Benchmark ("+o[0]+") "));return a}})}}(this),validate_ib_account:function(){return function(t,e){var n,i;return i=/^(D|U|F)/,!i.test(t)||t.length<6||t.length>8?(n=e?"This does not appear to be a valid IB account. Quantopian expects IB account numbers to start with U and to be between 6 and 8 characters long. If you believe you have a valid account, contact feedback.":"<b>"+t+"</b> does not appear to be a valid IB account. <br><br>Quantopian expects IB account numbers to start with D or U and to be between 6 and 8 characters long. If you believe you have a valid account, contact <a class='open-feedback-link'>feedback.</a>",{is_valid:!1,msg:n}):0===t.indexOf("DF")?(n=e?"This appears to be a Demo Financial Advisory account (prefix DF), which aren't supported at this time. Instead, you should enter a real money account (prefix U).":"<b>"+t+"</b> appears to be a Demo Financial Advisory account (prefix DF). <br><br>DF accounts aren't supported at this time. Instead, you should enter one of your sub-accounts (prefix DU).",{is_valid:!1,msg:n}):0===t.indexOf("F")?(n=e?"This appears to be a Financial Advisory account (prefix F), which aren't supported at this time. Instead, you should enter a real money account (prefix U).":"<b>"+t+"</b> appears to be a Financial Advisory account (prefix F). <br><br>F accounts aren't supported at this time. Instead, you should enter one of your sub-accounts (prefix U).",{is_valid:!1,msg:n}):0===t.indexOf("D")?e?(n="This appears to be a Demo account (prefix D). Instead, you should enter a real money account (prefix U).",{is_valid:!1,msg:n}):{is_valid:!0}:{is_valid:!0}}}(this),set_is_employee:function(t){return function(e){return t.is_employee=null!=e&&"true"===e.toString()}}(this),is_not_logged_in_error:function(){return function(t){var e;return null==t?!1:(e=new quanto.JsonResponse(t),e.error()&&null!=e.data()&&null!=e.data().error&&"not_logged_in"===e.data().error?!0:!1)}}(this),is_ie:function(){return function(){var t,e,n;try{return"undefined"!=typeof navigator&&null!==navigator&&(-1!==(null!=(e=navigator.userAgent)?e.indexOf("MSIE"):void 0)||(null!=(n=navigator.appVersion)?n.indexOf("Trident/"):void 0)>0)}catch(i){return t=i,!1}}}(this),hide_footer:function(){return function(){return $(".footer").hide(),$(".content").addClass("padding_b0")}}(this),show_footer:function(){return function(){return $(".footer").show(),$(".content").removeClass("padding_b0")}}(this),on_click:function(){return function(t,e){var n;return t instanceof jQuery&&(t=t.selector),n=navigator.userAgent.toLowerCase(),n.match(/(iPhone|iPod|iPad)/i)?$(t).bind("tapone",e):$(document).on("click",t,e)}}(this),get_query_variable:function(){return function(t){var e,n,i,r,o,a;for(n=window.location.search.substring(1),r=n.split("&"),o=0,a=r.length;a>o;o++)if(i=r[o],e=i.split("="),decodeURIComponent(e[0])===t)return decodeURIComponent(e[1]);return null}}(this),debug_on:function(){return function(){return"1"===quanto.get_query_variable("debug")}}(this),safeParseInt:function(){return function(t){var e;try{return parseInt(t)}catch(n){return e=n,0/0}}}(this),escapeHTML:function(){return function(t){var e;return e=document.createElement("div"),e.appendChild(document.createTextNode(t)),e.innerHTML}}(this),get_safe_window_hash:function(){return function(){return quanto.escapeHTML(window.location.hash)}}(this),get_server:function(){return function(t){var n,i,r,o;return o=t.success_callback,r=t.failure_callback,i={task_id:t.task_id,is_public:t.anonymous},n=(new Date).getTime(),$.post("/get_server?t="+n,i,function(t){var n,i,a,s;if(n=new e(t),n.ok())if(i=n.data().server_ip,a=n.data().server_port,s=n.data().ws_open_msg,null!=i&&null!=o){if(null!=o)return o(i,a,s)}else if(null!=r)return r()})}}(this),show_error_popup:function(){return function(t,e){return t||(t="Error"),e||(e="Sorry, something went wrong.  Try again or contact us by <a class='open-feedback-link'>sending feedback</a>."),$("#error-modal").find(".modal-title").html(t),$("#error-modal").find(".body-content").html(e),$("#error-modal").modal("show")}}(this),show_confirmation_popup:function(){return function(t,e,n,i){return $("#confirmation-modal").find(".modal-title").html(t),$("#confirmation-modal").find(".body-content").html(e),$("#confirmation-modal").off("click",".action-button"),$("#confirmation-modal").find(".action-button").html(n),$("#confirmation-modal").on("click",".action-button",function(){return i()}),$("#confirmation-modal").modal("show")}}(this),show_join_popup:function(){return function(){return $("#join-modal").modal("show")}}(this),get_src_element:function(){return function(t){return t.srcElement||t.target}}(this),turn_on_busy:function(t){var e;return t.addClass("disabled").attr("disabled","disabled"),t.find("img.loading").show(),e=t.data("busytext"),null!=e?t.find("span.button-label").html(e):(t.find(".active-text").hide(),t.find(".busy-text").show())},turn_off_busy:function(t){var e;return t.removeClass("disabled").attr("disabled",!1),t.find("img.loading").hide(),e=t.data("normaltext"),null!=e?t.find("span.button-label").html(e):(t.find(".busy-text").hide(),t.find(".active-text").show())},show_message_popup:function(t,e){var n;return n=$("#message-modal"),n.find(".modal-title").html(t),n.find(".modal-body").html(e),n.modal("show")},show_scrollable_modal:function(){return function(t){var e,n;return n=function(e){return e.target===t[0]?$("body").addClass("prevent-background-scroll"):void 0},e=function(i){return i.target===t[0]?($("body").removeClass("prevent-background-scroll"),t.off("shown",n),t.off("hidden",e)):void 0},t.on("shown",n),t.on("hidden",e),t.modal({backdrop:"static"})}}(this),show_validation_tooltip:function(t){return function(e,n,i){var r;return null==i&&(i="keydown"),quanto.clear_validation_tooltip(),t.$tooltip_change_event=i,t.$tooltip_target_elem=e,t.$tooltip_target_elem.focus(),r="left",$(window).width()<990&&(r="top"),t.$tooltip=t.$tooltip_target_elem.tooltip({placement:r,title:n,trigger:"manual"}).tooltip("show"),e[i](quanto.clear_validation_tooltip)}}(this),clear_validation_tooltip:function(t){return function(){return null!=t.$tooltip?(t.$tooltip.tooltip("destroy"),t.$tooltip_target_elem.off(t.$tooltip_change_event,quanto.clear_validation_tooltip),t.$tooltip=null):void 0}}(this),show_unknown_error_popup:function(){return this.show_message_popup("Something went wrong","Sorry, something went wrong.  Try again or contact us at feedback@quantopian.com.")},safe_to_number:function(){return function(t,e){return null==t?"":new Number(t).toMoney(e,".",",",!0)}}(this),safe_to_money:function(t){return null==t?"":new Number(t).toMoney()},safe_to_money_ui:function(t){var e;return e=quanto.safe_to_money(t),t>0?"<span class='money-green'>"+e+"</span>":0>t?"<span class='money-red'>"+e+"</span>":e},set_community_home_page_cookie:function(){return function(t){return"interesting"===t?$.cookie("community_home","/posts",{path:"/"}):"newest"===t?$.cookie("community_home","/posts/newest",{path:"/"}):void 0}}(this),go_to_community_home:function(){return function(){var t;return t=$.cookie("community_home"),null===t?(location.href="/posts",void 0):location.href=t}}(this),register_remote_event:function(t,e){return"undefined"!=typeof TogetherJS&&null!==TogetherJS&&null!=TogetherJS.hub?TogetherJS.hub.on(t,function(){return function(t){return e(t)}}(this)):void 0},trigger_remote_event:function(t){return"string"==typeof t&&(t={type:t}),"undefined"!=typeof TogetherJS&&null!==TogetherJS&&TogetherJS.running?TogetherJS.send(t):void 0},show_tooltip:function(t){return function(e,n,i,r){var o;return null==i&&(i="keydown"),null==r&&(r={}),e.focus(),null==r.placement&&(r.placement=$(window).width()<767?"top":"left"),t.$tooltip=e.tooltip({placement:r.placement,title:n,trigger:"manual"}).tooltip("show"),null!=i?(o=function(){return t.$tooltip.tooltip("destroy"),e.off(i,o)},e[i](o)):void 0}}(this),generate_UUID:function(){return function(){var t,e;return t=("undefined"!=typeof performance&&null!==performance?performance.now():void 0)||(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n;return n=0|(t+16*Math.random())%16,t=Math.floor(t/16),"x"===e?n.toString(16):(8|7&n).toString(16)})}}(this),track_mixpanel:function(t,e){return quanto.is_employee_or_admin()?void 0:"undefined"!=typeof mixpanel&&null!==mixpanel?null!=e?mixpanel.track(t,e):mixpanel.track(t):void 0},Environment:t=function(){function t(){this.test=n(this.test,this),this.production=n(this.production,this),this.staging=n(this.staging,this),this.development=n(this.development,this),this.env=$("#quanto-env").val().toLowerCase()}return t.prototype.development=function(){return"development"===this.env},t.prototype.staging=function(){return"staging"===this.env},t.prototype.production=function(){return"production"===this.env},t.prototype.test=function(){return"test"===this.env},t}(),JsonResponse:e=function(){function t(t){var e,i,r;if(this.server_response=t,this.html=n(this.html,this),this.data=n(this.data,this),this.error=n(this.error,this),this.ok=n(this.ok,this),this.redirect=n(this.redirect,this),r="quantopian_streaming_response_header","string"==typeof this.server_response)try{this.server_response=$.trim(this.server_response),0===this.server_response.indexOf(r)&&(this.server_response=this.server_response.substr(r.length)),this.server_response=JSON.parse($.trim(this.server_response))}catch(o){e=o}this.redirect()&&null!=this.server_response.to&&(i=this.server_response.to,_.str.endsWith(window.location,i)?window.location.reload(!0):window.location=i)}return t.prototype.redirect=function(){return"redirect"===this.server_response.status},t.prototype.ok=function(){return"ok"===this.server_response.status},t.prototype.error=function(){return"error"===this.server_response.status||400===this.server_response.status},t.prototype.data=function(){var t;if(this.error())try{return $.parseJSON(this.server_response.responseText).data}catch(e){t=e}return this.server_response.data},t.prototype.html=function(){return this.error()?$.parseJSON(this.server_response.responseText).html:this.server_response.html},t}(),custom_chart_colors:["#89A54E","#80699B","#18a5ca","#DB843D","#A47D7C"],global_plotOptions:{series:{marker:{states:{hover:{enabled:!0,radius:4}},symbol:"circle"},animation:!1}},global_grouping_options:{enabled:!0,approximation:"average",units:[["week",[1]],["month",[1,2,3,4,6]]],groupPixelWidth:1},global_grouping_column_options:{enabled:!0,approximation:"sum",units:[["week",[1]],["month",[1,2,3,4,6]]],groupPixelWidth:1},risk_window_sizes:{m1:"one_month",m3:"three_month",m6:"six_month",m12:"twelve_month"},pick_property:function(t,e,n){return t.hasOwnProperty(e)?t[e]:t[n]},get_selected_rows:function(){return function(t){return $.map(t.find(".quanto-checkbox.icon-check"),function(t){return $(t).closest("tr")})}}(this),enable_checkbox_tables:function(){return function(){var t,e,n,i,r,o,a;if(null!=quanto.TableCheckboxManager){for((n=quanto.instances).tcms||(n.tcms=[]),o=$("table.checkbox-table").not(".checkbox-done"),a=[],i=0,r=o.length;r>i;i++)e=o[i],t=$(e),quanto.instances.tcms.push(new quanto.TableCheckboxManager(t)),a.push(t.addClass("checkbox-done"));
return a}}}(this),translate_order_status:function(){return function(t){var e;try{e=parseInt(t)}catch(n){return"Unknown"}if(isNaN(e))return"Unknown";switch(e){case 0:return"Open";case 1:return"Filled";case 2:return"Cancelled";case 3:return"Rejected";case 4:return"Held";default:return"Unknown"}}}(this)},Number.prototype.toMoney=function(t,e,n,i){var r,o,a,s,l,u,c,d,h,p;return null==i&&(i=!1),l=this,r=isNaN(t)?2:Math.abs(t),o=e||".",d=n||",",u=0>l,a=parseInt(l=Math.abs(l).toFixed(r))+"",s=(s=a.length)>3?s%3:0,h=s?a.substr(0,s)+d:"",p=r?o+Math.abs(l-a).toFixed(r).slice(2):"",c=h+a.substr(s).replace(/(\d{3})(?=\d)/g,"$1"+d)+p,i?u?"-"+c:c:u?"($"+c+")":"$"+c},Handlebars.registerHelper("capitalize",function(t){return _.str.capitalize(t)}),$(document).ready(function(t){return function(){return quanto.env=new quanto.Environment,quanto.user_id=$("#current_user_id").val(),quanto.enable_checkbox_tables(),quanto.instances||(quanto.instances={}),Stripe.setPublishableKey($('meta[name="stripe-key"]').attr("content")),quanto.on_click(".modal-x-out",function(t){return $(quanto.get_src_element(t)).closest(".modal").modal("hide")}),$(document).ajaxError(function(t,e,n){return null==n.error?quanto.is_not_logged_in_error(e)?alert("You must be logged in."):void 0:void 0}),$(".date-field").each(function(t,e){var n;return n=$(e),n.html(quanto.date.format_date(n.data("format"),new Date(n.data("value"))))}),$("[data-toggle='tooltip']").tooltip({delay:{show:200,hide:100}}),$("*[rel='tooltip']").tooltip(),$("*[rel='popover']").popover(),$(".modal a[rel='tooltip']").length>0&&$('.modal a[rel="tooltip"]').tooltip().data("tooltip").tip().css("z-index",2080),$("#error_explanation li").addClass("alert alert-error"),$("a.dropdown-checked").next(".dropdown-menu").find("li").bind("click",function(){var t;if(!$(this).hasClass("nocheck"))return t=$(this).closest(".check-group"),t.find(".checked").removeClass("checked"),$(this).addClass("checked")}),quanto.on_click(".reload-link",function(){return window.location.reload(!0)}),quanto.on_click(".toggle_error",function(t){var e;return e=$(quanto.get_src_element(t)),e.closest(".error-details").find(".toggle_payload").toggle()}),quanto.on_click(".mixpanel-button",function(t){var e,n,i,r,o;return e=$(quanto.get_src_element(t)),i=null!=(r=e.data("event"))?r:e.html(),n=null!=(o=e.data("mixpanel"))?o:e.html(),mixpanel.track(i,{link:n})}),$(".auth-required").tooltip({placement:"left",title:"Log in to use this feature."}).addClass("disabled with-events"),quanto.on_click(".open-feedback-link",function(){return quanto.instances.fm.show(),!1}),$('*[data-toggle="modal"]').on("click",function(){var e,n;return n=$(t).data("href"),e=$(n),e.modal("show")}),$(".disabled").on("click",function(t){var e;return $(t).hasClass("disabled")?(e=$(t.target).attr("login-redirect"),null!=e&&e.length>0&&(window.location=e),t.stopImmediatePropagation(),!1):!0}),$(".dropdown-menu.no-close-on-click").click(function(){return event.stopPropagation()}),$("#join-modal").on("show",function(){return mixpanel.track("Join modal shown")}),quanto.on_click(".clone-sample-algo-link",function(t){var e,n;return quanto.is_mobile_screen()?quanto.is_real_user()?quanto.show_error_popup("Sorry","Writing algorithms in the IDE is only supported on desktop and laptop computers. Please try again from one of these devices."):window.location.href="/users/sign_up":(e=$(quanto.get_src_element(t)),n=e.data("sampletype")||"default_samples",e.addClass("disabled"),$.post("/algorithms/clone_sample",{sample_algo_type:n},function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:alert("There was a problem cloning the sample algorithm.")}))}),quanto.on_click(".notif-clone-algo-link",function(t){var e,n,i;return e=$(quanto.get_src_element(t)),n={id:e.data("algo-id")},i=function(){return alert("There was an error cloning this algorithm.")},$.post("/algorithms/collab_clone",n,function(t){var e;return mixpanel.track("new algo",{type:"collab clone"}),e=new quanto.JsonResponse(t),e.redirect()||e.ok()?void 0:i()}).fail(function(){return i()})}),$("iframe.fullheight").iframeAutoHeight({heightOffset:100}),$(window).resize(function(){return $("iframe.fullheight").iframeAutoHeight({heightOffset:100})}),quanto.on_click(".mobile-nav-category-title",function(t){var e;return e=$(quanto.get_src_element(t)).closest(".mobile-nav-category"),e.hasClass("open")?e.find(".mobile-nav-rows").slideUp(200,function(){return e.removeClass("open")}):(e.find(".mobile-nav-rows").slideDown(200),e.addClass("open"))}),quanto.on_click("#navbar-menu-anchor",function(){var t;return t=$("#mobile-navbar-menu"),t.hasClass("open")?($("#navbar-menu-anchor").removeClass("open"),t.slideUp(200,function(){return t.removeClass("open")})):($("#navbar-menu-anchor").addClass("open"),t.slideDown(200),t.addClass("open"))})}}(this)),jQuery.browser.msie&&window.XDomainRequest&&(jQuery.support.cors=!0,$.ajaxTransport("+*",function(){return function(t){var e;return t.crossDomain?(e=null,{send:function(n,i){return e=new XDomainRequest,e.onload=function(){var t;return e.contentType.match(/\/xml/)?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e.responseText),i(200,"success",[t])):i(200,"success",[e.responseText])},e.open(t.type,t.url),e.onprogress=function(){},e.ontimeout=function(){},e.onerror=function(){},setTimeout(function(){return e.send()},500)},abort:function(){return null!=e?e.abort():void 0}}):void 0}}(this))),$.fn.hide=function(){return $(this).addClass("hidden")},$.fn.show=function(){return $(this).removeClass("hidden").removeClass("hide")},$.fn.textWidth=function(t,e){return null==$.fn.textWidth.fakeEl&&($.fn.textWidth.fakeEl=$("<span>").hide().appendTo(document.body)),$.fn.textWidth.fakeEl.text(t),null!=e&&$.fn.textWidth.fakeEl.css("font",e.css("font")),$.fn.textWidth.fakeEl.width()},String.prototype.escapeHTML=function(){var t;return t={"&":"&amp;","<":"&lt;",">":"&gt;"},this.replace(/[&<>]/g,function(e){return t[e]||e})},"undefined"!=typeof Handlebars&&null!==Handlebars&&Handlebars.registerHelper("escapeHTML",function(t){return t.escapeHTML()}),jQuery.Event.prototype.consume=function(){return this.stopImmediatePropagation(),this.preventDefault(),this.handled=!0}}.call(this),function(){quanto.date={is_date:function(t){return"[object Date]"!==Object.prototype.toString.call(t)||isNaN(t.getTime())?!1:!0},is_weekend:function(){return function(t){var e;return e=t.getDay(),0===e||6===e}}(this),get_diff_info:function(){return function(t,e){var n,i,r;return null==e&&(e=new Date),r=(e.getTime()-t.getTime())/1e3,i=Math.floor(r/86400),n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()),n.getTime()>e.getTime()&&(i+=1),{seconds_diff:r,day_diff:i}}}(this),pretty_date:function(t,e){var n,i,r;if(null==e&&(e=!1),i=this.get_diff_info(t),n=i.day_diff,r=i.seconds_diff,!(isNaN(n)||0>n)){if(n>=31)return this.format_date("%b %e, %Y",t);if(0===n){if(60>r)return"just now";if(120>r)return"1 minute ago";if(3600>r)return""+Math.floor(r/60)+" minutes ago";if(7200>r)return"1 hour ago";if(86400>r)return""+Math.floor(r/3600)+" hours ago"}return 1===n?e?"yesterday":"Yesterday":7>n?""+n+" days ago":14>n?"1 week ago":31>n?""+Math.ceil(n/7)+" weeks ago":void 0}},weekday_list:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months_list:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr_list:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chat_date:function(t){var e,n;return n=this.get_diff_info(t),e=n.day_diff,0===e?this.format_date("%l:%M %p",t):this.format_date("%b %e %l:%M %p",t)},format_date:function(t,e){var n,i,r,o,a,s,l,u,c;if(l=function(t,e){return t=t.toString().replace(/^([0-9])$/,"0$1"),3===e&&(t=t.toString().replace(/^([0-9]{2})$/,"0$1")),t},!e)return"invalid date";null!==e.toFixed&&(e=new Date(e)),t||(t="%Y-%m-%d %H:%M:%S"),o=e.getHours(),n=e.getDay(),i=e.getDate(),s=e.getMonth(),r=e.getFullYear(),u={a:quanto.date.weekday_list[n].substr(0,3),A:quanto.date.weekday_list[n],d:l(i),e:i,b:quanto.date.month_abbr_list[s],B:quanto.date.months_list[s],m:l(s+1),y:r.toString().substr(2,2),Y:r,H:l(o),I:l(o%12||12),l:o%12||12,M:l(e.getMinutes()),p:12>o?"AM":"PM",P:12>o?"am":"pm",S:l(e.getSeconds()),L:l(e.getTime()%1e3,3)};for(a in u)c=u[a],t=t.replace("%"+a,c);return t},adjust_date_for_UTC:function(t){var e;return e=t.getTimezoneOffset(),new Date(t.getTime()+60*1e3*e)},adjust_date_for_UTC_reverse:function(t){var e;return e=t.getTimezoneOffset(),new Date(t.getTime()-60*1e3*e)},render_date_value:function(t){var e,n,i,r,o,a,s,l,u,c;for(c=[],l=0,u=t.length;u>l;l++)o=t[l],e=$(o),r=parseInt(e.attr("utcms")),s="1"===e.data("lowercase"),a=e.data("format")||e.attr("format"),null!=r&&!isNaN(r)&&r>0?("locale_string"===a?i=new Date(r).toLocaleString():"fixed"===a?i=this.format_date("%Y-%m-%d %H:%M:%S",new Date(r)):"fixedshort"===a?i=this.format_date("%Y-%m-%d",new Date(r)):"minute"===a?i=this.format_date("%Y-%m-%d %H:%M",new Date(r)):"noyear"===a?i=this.format_date("%m-%d %H:%M",new Date(r)):"contest"===a?i=this.format_date("%B %e, %Y %l:%M %p",new Date(r)):"chat"===a?i=this.chat_date(new Date(r)):(n=new Date(r),i=this.pretty_date(n,s),e.tooltip({animation:!1,title:this.format_date("%b %e %l:%M %p",n),trigger:"hover",delay:{show:500,hide:100},placement:"bottom"})),c.push(e.html(i))):c.push(void 0);return c},get_backtest_min_date:function(){return new Date(2002,0,3)},get_backtest_max_date:function(){var t,e,n;return t=parseInt($("#last_end_day").val()),e=parseInt($("#last_end_month").val()),n=parseInt($("#last_end_year").val()),new Date(n,e-1,t)},get_datepicker_daynames:function(){return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},render_all_date_values:function(){return $(".quanto-date").each(function(t){return function(e,n){return t.render_date_value($(n))}}(this))},are_same_date:function(t,e){return t.getYear()===e.getYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}},$(document).ready(function(){return function(){return quanto.date.render_all_date_values()}}(this))}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.headerManager=t=function(){function t(){this.handle_resend_confirmation_message=e(this.handle_resend_confirmation_message,this),$("#resend-confirmation-email-button").click(this.handle_resend_confirmation_message),$(document).bind("username_changed",function(){return function(t,e){var n,i,r;return n=e.firstname,i=e.lastname,r=n,null!=i&&(r+=" "+i),$(".username-display").html(r)}}(this)),$(".start_guided_tour").bind("click",function(t){return quanto.tour.start_current_tour(),t.stopImmediatePropagation(),!1})}return t.prototype.handle_resend_confirmation_message=function(){var t;return t=quanto.user_id,null!=t?($("#resend-confirmation-email-button").addClass("disabled").html("Sending email..."),$.post("/users/resend_confirmation",{},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?$("#resend-confirmation-email-button").parent().html("<span class='sent'><i class='icon icon-ok'></i>Successfully sent email.</span>"):void 0}}(this))):void 0},t}()}.call(this),function(){var t;t=function(){function t(){this.cache={},this.loading_list={},this.updating=!1,setInterval(function(t){return function(){return t.update_if_needed()}}(this),1e3)}return t.prototype.update_if_needed=function(){var t;if(!this.updating)return t=_.keys(this.loading_list),0===t.length?(this.updating=!1,void 0):t.length>0?(this.updating=!0,0===t.length?(this.updating=!1,void 0):this.fetch_full_info(t,function(e){return function(){var n,i,r;for(i=0,r=t.length;r>i;i++)n=t[i],e.populate_sid_ui_internal(n),delete e.loading_list[n];return $(document).trigger("sids_loaded",[t]),e.updating=!1}}(this))):void 0},t.prototype.get_info_from_sid=function(t){var e;if(null!=t){if(e=this.cache[t.toString()],null!=e)return e;null==this.loading_list[t]&&(this.loading_list[t]=!0)}return{sid:"Unknown",ticker:"Unknown",name:"Unknown"}},t.prototype.populate_sid_list_in_ui=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],this.has_sid(e)?r.push(this.populate_sid_ui_internal(e)):null==this.loading_list[e]?r.push(this.loading_list[e]=!0):r.push(void 0);return r},t.prototype.populate_sid_ui_internal=function(t){var e;return e=this.get_info_from_sid(t),$(".quanto-sid-"+t).html(e.ticker),$(".quanto-sid-"+t+"-full").html(e.name)},t.prototype.get_ticker=function(t){return this.get_info_from_sid(t).ticker},t.prototype.get_name=function(t){return this.get_info_from_sid(t).name},t.prototype.has_sid=function(t){return null!=(this.cache||{})[t]},t.prototype.empty=function(){return this.cache={}},t.prototype.add_sid_info=function(t,e,n,i,r){return this.cache[t.toString()]={sid:t,ticker:e,name:n,start_date:i,end_date:r}},t.prototype.get_all_sids=function(){return _.values(this.cache)},t.prototype.fetch_full_info=function(t,e,n){return $.post("/securities/find_by_sid_post",{sids:t},function(t){return function(i){var r,o,a,s;if(o=new quanto.JsonResponse(i),o.ok()&&null!=o.data()){r=o.data();for(a in r)s=r[a],t.add_sid_info(a,s[0],s[1],s[2],s[3]);if(null!=e)return e()}else if(null!=n)return n()}}(this))},t.prototype.get_latest_start_date=function(){return _.max(_.map(_.values(this.cache),function(){return function(t){return t.start_date}}(this)))},t.prototype.get_earliest_end_date=function(){return _.min(_.map(_.values(this.cache),function(){return function(t){return t.end_date}}(this)))},t}(),quanto.sid_cache=new t}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.FeedbackManager=t=function(){function t(){this.show_modal=e(this.show_modal,this),this.$popup=$("#feedback-modal"),this.$email_box=$("#feedback-email-box"),this.$send_button=$("#send-feedback-button"),this.initialize_events()}return t.prototype.show=function(){var t;return t=$(".modal.in"),t.length>0?(t.on("hidden.bs.modal",function(e){return function(){return setTimeout(e.show_modal,10),t.off("hidden.bs.modal")}}(this)),t.modal("hide")):this.show_modal()},t.prototype.show_modal=function(){return $("#feedback-modal").modal({show:!0,backdrop:"static"})},t.prototype.initialize_events=function(){return this.$popup.on("show show.bs.modal",function(t){return function(){return t.show_popup(),t.update_send_button()}}(this)),this.$popup.on("click","#anonymous-feedback-checkbox",function(t){return function(){return t.update_send_button()}}(this)),this.$popup.on("change","#feedback-email-box",function(t){return function(){return t.update_send_button()}}(this)),this.$popup.on("click","#send-feedback-button",function(t){return function(){return t.send_feedback()}}(this))},t.prototype.show_popup=function(){return this.$popup.find(".controls").show(),this.$popup.find(".success").hide(),$("#feedback-box").val(""),$("#feedback-name-box").val(""),this.$email_box.val(""),$("#approve-support-checkbox").prop("checked",!1),$("#anonymous-feedback-checkbox").prop("checked",!1),this.$send_button.addClass("disabled")},t.prototype.update_send_button=function(){var t;return t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,!this.$popup.find(".feedback-inputs").length>0?this.$send_button.removeClass("disabled"):$("#anonymous-feedback-checkbox").attr("checked")?this.$send_button.removeClass("disabled"):this.$email_box.val().length>0&&t.test(this.$email_box.val())?this.$send_button.removeClass("disabled"):this.$send_button.addClass("disabled")},t.prototype.send_feedback=function(){var t,e;return t={os:session.browser.os,browser:session.browser.browser,version:session.browser.version,viewport_width:session.device.viewport.width,viewport_height:session.device.viewport.height,screen_width:session.device.screen.width,screen_height:session.device.screen.height,locale_country:session.locale.country,locale_lang:session.locale.lang},e={url:window.location.href,tour_id:quanto.current_tour_id,feedback_text:$("#feedback-box").val(),info:t,pre_approved:"checked"===this.$popup.find("#approve-support-checkbox").attr("checked")},!(this.$popup.find(".feedback-inputs").length>0)||(e.user_email=this.$email_box.val(),e.user_name=$("#feedback-name-box").val(),null==e.user_email.blank&&0!==e.user_email.length||confirm("No email address provided! We won't be able to respond to you unless you provide an email address. Send anonymously?"))?$.post("/feedback/submit",e,function(t){return function(){return t.$popup.find(".controls").slideUp(),t.$popup.find(".success").fadeIn()}}(this)):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DropdownManagerBase=t=function(){function t(t){this.custom_token=e(this.custom_token,this),this.previous_token=e(this.previous_token,this),this.show_tooltip=e(this.show_tooltip,this),this.show_tooltip_after_select=e(this.show_tooltip_after_select,this),this.select=e(this.select,this),this.get_selected_item_text=e(this.get_selected_item_text,this),this.handle_text_changed=e(this.handle_text_changed,this),this.check_regex_match=e(this.check_regex_match,this),this.check_text_match=e(this.check_text_match,this),this.filter=e(this.filter,this),this.click=e(this.click,this),this.mouseenter=e(this.mouseenter,this),this.show=e(this.show,this),this.handle_cursor_activity=e(this.handle_cursor_activity,this),this.$dropdown=t,this.$listbox=this.$dropdown.find(".matchlist"),this.$listbox.on("mouseenter",".match",$.proxy(this.mouseenter,this)),this.$listbox.on("click",$.proxy(this.click,this)),this.shown=!1,this.add_left_paren=!1,this.trigger=".",$(document).bind("click",function(t){return function(){return t.shown?t.hide():void 0}}(this)),null!=this.tooltip_mgr&&$(quanto.editor.getScrollerElement()).on("mouseover",function(t){return function(e){return t.tooltip_mgr.handle_mouseover(e)}}(this))}return t.prototype.handle_key_event=function(t,e){if(this.shown){if("keydown"===e.type)switch(e.keyCode){case 38:return e.preventDefault(),e.stopPropagation(),this.select_previous(),!0;case 40:return e.preventDefault(),e.stopPropagation(),this.select_next(),!0;case 9:case 13:return e.preventDefault(),e.stopPropagation(),this.select_item(),!0;case 27:return e.preventDefault(),e.stopPropagation(),this.hide(),!0}return-1===[9,13,27,38,40].indexOf(e.keyCode)||"keydown"===e.type&&8===e.keyCode?(setTimeout(function(t){return function(){return t.filter()}}(this),50),!1):!1}},t.prototype.handle_cursor_activity=function(){var t;return this.shown&&(t=quanto.editor.getCursor(),t.line!==this.trigger_pos.line||t.ch<this.trigger_pos.ch)?this.hide():void 0},t.prototype.show=function(t,e){return $(".toplevel-tooltip").hide(),$(".order-tooltip").hide(),this.$listbox.find(".match").removeClass("active").removeClass("hidden"),this.highlight_first(),this.last_x=t,this.last_y=e,this.$dropdown.css("left",t+"px").css("top",e+8-90+"px").show(),this.shown=!0,this.trigger_pos=quanto.editor.getCursor()},t.prototype.highlight_first=function(){return this.$listbox.find(".match").removeClass("active"),this.$listbox.find(".match").not(".hidden").first().addClass("active")},t.prototype.mouseenter=function(t){return this.$listbox.find(".active").removeClass("active"),$(t.currentTarget).addClass("active")},t.prototype.click=function(t){return t.stopPropagation(),t.preventDefault(),this.select_item()},t.prototype.select_item=function(){return this.select(),this.hide(),quanto.editor.focus()},t.prototype.select_next=function(){var t,e;return t=this.$listbox.find(".active").removeClass("active"),e=t.next(":not('.hidden')"),e.length||(e=this.$listbox.find(".match").not(".hidden").last()),e.addClass("active"),e.scrollintoview({direction:"vertical",duration:10})},t.prototype.select_previous=function(){var t,e;return t=this.$listbox.find(".active").removeClass("active"),e=t.prev(":not('.hidden')"),e.length||(e=this.$listbox.find(".match").not(".hidden").first()),e.addClass("active"),e.scrollintoview({direction:"vertical",duration:10})},t.prototype.hide=function(){return this.$dropdown.hide(),this.shown=!1},t.prototype.filter=function(){var t,e,n,i,r,o,a,s,l,u;for(e=quanto.editor.getCursor(),t=quanto.editor.getTokenAt(e),o=t.string;"."===o.charAt(0);)o=o.substr(1);for(r=0,u=this.$dropdown.find(".match"),s=0,l=u.length;l>s;s++)n=u[s],a=$(n).data("match"),i=0===a.lastIndexOf(o,0),i?(r++,$(n).removeClass("hidden")):$(n).addClass("hidden");return 0===r?this.hide():1===r&&o===this.$dropdown.find(".match.active").first().data("match")?this.hide():this.highlight_first()},t.prototype.check_text_match=function(t,e,n){return null==n&&(n=!1),null!=this.target_string&&t.cm.getTokenAt(e.from).string===this.target_string},t.prototype.check_regex_match=function(t,e,n){var i,r;if(null==n&&(n=!1),null!=this.target_regex&&null!=e.text&&e.text.length>0)for(r=t.cm.getSearchCursor(this.target_regex,{line:e.from.line,ch:e.from.ch+1});(i=r.findPrevious())&&r.from().line===e.from.line;)if(n){if(r.to().ch===e.from.ch)return!0}else if(r.to().ch===e.from.ch+1)return!0;return!1},t.prototype.handle_text_changed=function(t,e){var n,i,r,o;if(n=!1,1===e.text.length&&e.text[0]===this.trigger&&(this.check_text_match(t,e)||this.check_regex_match(t,e)))n=!0;else if(1===e.text.length&&"+delete"===e.origin)if(null==this.target_string)n=this.check_regex_match(t,e,!0);else{if(e.from.ch<this.target_string.length)return!1;if(i=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch}),"."!==i.string)return!1;if(o=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch-1}),o.string!==this.target_string)return!1;n=!0}return n?(r=t.cm.cursorCoords(),this.show(r.left,r.top),null!=this.$tooltip&&this.$tooltip.hide(),!0):!1},t.prototype.get_selected_item_text=function(){var t;return t=this.$dropdown.find(".match.active"),t.data("match")},t.prototype.select=function(t){var e,n,i,r;return null==t&&(t=this.get_selected_item_text()),this.add_left_paren&&(t+="("),e=this.custom_token(),r=e.start,n=e.end,i=quanto.editor.getCursor().line,(_.str.endsWith(e.string,".")||_.str.endsWith(e.string,"(")||_.str.endsWith(e.string,"="))&&(r=e.start+1),quanto.editor.replaceRange(t,{line:i,ch:r},{line:i,ch:n}),this.show_tooltip_after_select(),0},t.prototype.show_tooltip_after_select=function(){return null!=this.tooltip_mgr?setTimeout(function(t){return function(){return t.show_tooltip()}}(this),1):void 0},t.prototype.show_tooltip=function(){var t;return t=this.add_left_paren?this.previous_token():this.custom_token(),this.tooltip_mgr.force_show(t)},t.prototype.previous_token=function(){var t,e,n;return t=quanto.editor.getCursor(),e=t.line,n=quanto.editor.getTokenAt({line:t.line,ch:t.ch-1})},t.prototype.custom_token=function(){var t,e,n,i,r,o;return e=quanto.editor.getCursor(),i=e.line,t=quanto.editor.getTokenAt(e),r=t.start,n=e.ch,o=quanto.editor.getSelection(quanto.editor.setSelection({line:i,ch:r},{line:i,ch:n})),t.string=o,t.end=n,quanto.editor.setSelection({line:i,ch:n}),t},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.FilterBase=t=function(){function t(t,n){this.initialize_min_max=e(this.initialize_min_max,this),this.handle_row_data=e(this.handle_row_data,this),this.update_has_multiple_values=e(this.update_has_multiple_values,this),this.include_item=e(this.include_item,this),this.filter_done=e(this.filter_done,this),this.reset_filter=e(this.reset_filter,this),this.handle_filter_button_clicked=e(this.handle_filter_button_clicked,this),this.handle_reset_filter_clicked=e(this.handle_reset_filter_clicked,this),this.initialize_controls=e(this.initialize_controls,this),this.update_filter_button_disabled=e(this.update_filter_button_disabled,this),this.render_filter_button=e(this.render_filter_button,this),this.handle_body_mouse_down=e(this.handle_body_mouse_down,this),this.handle_body_key_up=e(this.handle_body_key_up,this),this.hide_filter=e(this.hide_filter,this),this.field=n,this.has_multiple_values=!1,this.$context_elem=t,this.$filter_elem=this.$context_elem.find("."+this.field+"-filter"),this.$filter_elem.data("filter",this)}return t.prototype.hide_filter=function(){return this.$filter_elem.hasClass("hidden")?this.disabled_tooltip_showing?(this.$filter_btn.tooltip("destroy"),this.disabled_tooltip_showing=!1):void 0:(this.$filter_elem.hide(),this.$filter_elem.appendTo($(".filter-dropdowns")),this.$filter_btn.removeClass("active"),this.$column_header_elem.removeClass("active"),this.$prev_column_separator.removeClass("active"))},t.prototype.handle_body_key_up=function(t){return 27===t.keyCode?this.hide_filter():void 0},t.prototype.handle_body_mouse_down=function(t){return this.$filter_elem[0]===t.target||$.contains(this.$filter_elem[0],t.target)||0!==$(t.target).closest(".filter-child-elem").length||this.hide_filter(),!0},t.prototype.render_filter_button=function(t,e){return null!=this.$filter_btn&&this.$filter_btn.off(),this.$column_header_elem=t,this.slick_grid=e,this.$filter_btn=$("<div class='icon icon-filter filter-button'>"),this.$filter_btn.appendTo(this.$column_header_elem),this.$filter_btn.click(this.handle_filter_button_clicked),this.update_filter_button_disabled()},t.prototype.update_filter_button_disabled=function(){var t,e;return this.has_multiple_values||this.is_active()?null!=(t=this.$column_header_elem)?t.removeClass("filter-button-disabled"):void 0:null!=(e=this.$column_header_elem)?e.addClass("filter-button-disabled"):void 0},t.prototype.initialize_controls=function(){return this.$filter_elem.find("a.reset-link").click(this.handle_reset_filter_clicked),this.$filter_elem.find("i.icon-remove").click(function(t){return function(){return t.hide_filter(),!1}}(this)),$(document.body).bind("mousedown",this.handle_body_mouse_down),$(document.body).bind("keyup",this.handle_body_key_up)},t.prototype.handle_reset_filter_clicked=function(){return this.reset_filter(),$(this).trigger("filter_changed",!1),!1},t.prototype.handle_filter_button_clicked=function(){var t,e,n;return t=this.$column_header_elem.data("column"),this.has_multiple_values||this.is_active()?(this.$column_header_elem.addClass("active"),this.$prev_column_separator=this.$column_header_elem.prev(".slick-header-column").find(".slick-resizable-handle"),this.$prev_column_separator.addClass("active"),this.$filter_btn.addClass("active"),this.$filter_elem.appendTo(this.slick_grid.getContainerNode()).show(),n=this.$filter_btn.offset().top+this.$filter_btn.height(),e=t.rightAlignFilter?this.$filter_btn.offset().left+this.$filter_btn.width()-this.$filter_elem.width():this.$filter_btn.offset().left,this.$filter_elem.offset({top:n,left:e})):(this.$filter_btn.tooltip({placement:"bottom",title:"This filter is disabled because all of the values in this column are the same.",trigger:"manual",container:"#"+this.$context_elem.attr("id")}),this.$filter_btn.tooltip("show"),this.disabled_tooltip_showing=!0),!1},t.prototype.reset_filter=function(){throw new Error("not implemented!")},t.prototype.filter_done=function(){throw new Error("not implemented!")},t.prototype.include_item=function(){throw new Error("not implemented!")},t.prototype.update_has_multiple_values=function(t){return null==this.first_value&&(this.first_value=t[this.field]),this.has_multiple_values||this.first_value===t[this.field]?void 0:this.has_multiple_values=!0},t.prototype.handle_row_data=function(t){return this.update_has_multiple_values(t),this.initialize_min_max(t)},t.prototype.initialize_min_max=function(t){return(null==this.max_value||t[this.field]>this.max_value)&&(this.max_value=t[this.field]),null==this.min_value||t[this.field]<this.min_value?this.min_value=t[this.field]:void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LookupManagerBase=t=function(){function t(){this.dispose=e(this.dispose,this),this.blur=e(this.blur,this),this.mouseenter=e(this.mouseenter,this),this.click=e(this.click,this),this.populate_matches=e(this.populate_matches,this),this.perform_search=e(this.perform_search,this),this.keypress=e(this.keypress,this),this.keyup=e(this.keyup,this),this.keydown=e(this.keydown,this)}return t.prototype.keydown=function(t){var e,n,i;return e=t.keyCode,n=function(){return function(e){return e>=48&&57>=e&&!t.shiftKey}}(this),i=function(){return function(t){return t>=65&&90>=t}}(this),(n(e)||i(e)||8===e)&&setTimeout(function(t){return function(){return t.perform_search()}}(this),1),8===e?""!==this.$input.val()||this.ignore_backspace?!0:(this.hide(),"undefined"!=typeof CodeMirror&&null!==CodeMirror&&null!=quanto.editor&&CodeMirror.commands.delCharBefore(quanto.editor),!1):e>=37&&40>=e?!0:n(e)?!0:i(e)?!0:32===e?!0:189===e||173===e&&t.shiftKey?!0:(48===e&&t.shiftKey&&this.$listbox.find(".match").length>0&&(this.select(),this.hide()),t.stopPropagation(),t.preventDefault(),!1)},t.prototype.keyup=function(t){switch(t.stopPropagation(),t.preventDefault(),t.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;if(this.$listbox.find(".active").length>0){if(null!=this.validate_callback&&!this.validate_callback(this.get_sid_data()))return;this.select(),this.hide()}break;case 27:this.hide(!0)}},t.prototype.keypress=function(t){if(t.stopPropagation(),this.shown)switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.select_previous();break;case 40:t.preventDefault(),this.select_next()}},t.prototype.perform_search=function(){throw new Error("to be implemented")},t.prototype.populate_matches=function(t,e){var n,i,r,o;if(null==e&&(e=null),(null==e||e===this.$input.val())&&!this.disposed){if(this.$listbox.html(""),null!=t&&t.length>0){for(r=0,o=t.length;o>r;r++)n=t[r],i=this.$match_template(n),this.$listbox.append(i);this.$listbox.find(".match").first().addClass("active")}else this.$listbox.append("<div class='nomatch'>No matches</div>");return this.$listbox.show()}},t.prototype.select_next=function(){var t,e;return t=this.$listbox.find(".active").removeClass("active"),e=t.next(),e.length||(e=$(this.$listbox.find(".match")[0])),e.addClass("active")},t.prototype.select_previous=function(){var t,e;return t=this.$listbox.find(".active").removeClass("active"),e=t.prev(),e.length||(e=this.$listbox.find(".match").last()),e.addClass("active")},t.prototype.reset=function(){return this.$input.val(""),this.$listbox.html(""),this.$listbox.hide(),this.shown=!0},t.prototype.click=function(t){return t.stopPropagation(),t.preventDefault(),null==this.validate_callback||this.validate_callback(this.get_fd_data())?this.select():void 0},t.prototype.mouseenter=function(t){return this.$listbox.find(".active").removeClass("active"),$(t.currentTarget).addClass("active")},t.prototype.hide=function(t){var e;return null!=t&&t&&$(this).trigger("reverted"),this.$dropdown.hide(),this.$listbox.hide(),this.shown=!1,null!=(e=quanto.editor)?e.focus():void 0},t.prototype.blur=function(t){return t.stopPropagation(),t.preventDefault(),setTimeout(function(t){return function(){return t.hide()}}(this),150)},t.prototype.handle_cursor_activity=function(){},t.prototype.dispose=function(){return this.reset(),null!=this.validate_callback&&(this.validate_callback=null),this.disposed=!0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SIDLookupManager=t=function(t){function n(t,i){this.handle_text_changed=e(this.handle_text_changed,this),this.perform_search=e(this.perform_search,this),this.select=e(this.select,this),this.get_sid_data=e(this.get_sid_data,this),this.get_text_to_replace=e(this.get_text_to_replace,this),n.__super__.constructor.apply(this,arguments),null==t&&(t=$("#sid-intellisense-box")),this.$dropdown=t,this.$input=this.$dropdown.find("input"),this.last_query="",this.$input.on("keydown",this.keydown),this.$input.on("keypress",this.keypress),this.$input.on("keyup",this.keyup),null!=i&&i.noblur||this.$input.on("blur",this.blur),this.ignore_backspace=(null!=i?i.ignore_backspace:void 0)?!0:!1,this.$listbox=null!=(null!=i?i.matchlist:void 0)?i.matchlist:this.$dropdown.find(".matchlist"),this.validate_callback=null!=i?i.validate_callback:void 0,this.$listbox.on("mouseenter",".match",$.proxy(this.mouseenter,this)),this.$listbox.on("click",$.proxy(this.click,this)),($.browser.webkit||$.browser.msie)&&this.$input.on("keydown",$.proxy(this.keypress,this)),this.$match_template=Handlebars.compile("<div class='match' data-sid='{{sid}}' data-symbol='{{symbol}}' data-name='{{name}}'><span class='sid'>{{sid}}</span><span class='ticker'>{{symbol}}</span><span class='name'>{{name}}</span></div>"),this.mark_sids(),"undefined"!=typeof CodeMirror&&null!==CodeMirror&&null!=quanto.editor&&(this.tooltip_mgr=new quanto.SidTooltipManager,$(quanto.editor.getScrollerElement()).on("mouseover",function(t){return function(e){return t.tooltip_mgr.handle_mouseover(e)
}}(this))),this.TEXT_TO_MATCH="sid"}return i(n,t),n.prototype.find_sids=function(){var t;return t=$(".cm-sid-value").map(function(){return $(this).html()}).get(),_.unique(t)},n.prototype.mark_sids=function(){var t;return t=this.find_sids(),this.get_tickers(t)},n.prototype.get_tickers=function(t){return t=_.uniq(t),quanto.sid_cache.fetch_full_info(t)},n.prototype.get_text_to_replace=function(t){return t.toString()},n.prototype.get_sid_data=function(){var t,e,n,i;return t=this.$listbox.find(".active"),0!==t.length?(n=t.data("sid"),i=t.data("symbol"),e=t.data("name"),{sid:n,symbol:i,name:e}):void 0},n.prototype.select=function(){var t,e,n,i;return n=this.get_sid_data(),null!=n?(e=n.sid,i=n.symbol,t=n.name,null!=quanto.editor?(quanto.editor.replaceRange(this.get_text_to_replace(e,i,t),quanto.editor.getCursor()),quanto.sid_cache.add_sid_info(e,i,t),quanto.sid_cache.fetch_full_info([e]),quanto.lock_editor=!0,quanto.editor.replaceRange(")",quanto.editor.getCursor()),setTimeout(function(){return function(){return quanto.lock_editor=!1}}(this),100)):$(this).trigger("sid_selected",[n])):void 0},n.prototype.perform_search=function(){var t;return t=this.$input.val(),null!=t&&t.length>0&&t!==this.last_query?(this.last_query=t,null!=this.query_timer&&clearTimeout(this.query_timer),this.query_timer=setTimeout(function(e){return function(){return $.get("/securities/",{q:t},function(t){var n;return n=new quanto.JsonResponse(t),n.ok()&&null!=n.data()&&null!=n.data().matches?e.populate_matches(n.data().matches,n.data().query):void 0})}}(this),75)):this.last_query=""},n.prototype.handle_text_changed=function(t,e){var n,i,r,o;if(n=!1,1===e.text.length&&"("===e.text[0]&&t.cm.getTokenAt(e.to).string===this.TEXT_TO_MATCH)n=!0;else if(1===e.text.length&&"+delete"===e.origin){if(e.from.ch<4)return!1;if(i=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch}),"("!==i.string)return!1;if(o=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch-1}),o.string!==this.TEXT_TO_MATCH)return!1;n=!0}return n?(r=t.cm.cursorCoords(),this.$dropdown.css("left",r.left+"px").css("top",r.top-102+"px"),this.reset(),this.$dropdown.show(),this.$dropdown.find("input").focus(),!0):!1},n}(quanto.LookupManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.TooltipManagerBase=t=function(){function t(t){this.hide=e(this.hide,this),this.force_show=e(this.force_show,this),this.build_and_show_tooltip=e(this.build_and_show_tooltip,this),this.handle_cursor_activity=e(this.handle_cursor_activity,this),this.is_match=e(this.is_match,this),this.handle_mouseover=e(this.handle_mouseover,this),this.handle_editor_change=e(this.handle_editor_change,this),this.$tooltip=t,$(".CodeMirror-scroll").bind("scroll",function(t){return function(){return t.$tooltip.hide()}}(this)),this.force=!1,this.shown=!1,$(document).bind("editor_cursor_activity",this.handle_cursor_activity),$(document).bind("editor_change",this.handle_editor_change)}return t.prototype.handle_editor_change=function(t){var e;if(this.force&&this.shown&&(e=t.q_data,null!=e&&1===e.text.length&&null!=this.forced_token))if(-1!==this.property_list.indexOf(this.forced_token)){if(null==this.token_info[e.text])return this.hide()}else if(")"===e.text[0])return this.hide()},t.prototype.handle_mouseover=function(t){var e,n;if(!this.force)return e=quanto.editor.coordsChar({left:t.pageX,top:t.pageY}),n=quanto.editor.getTokenAt(e),-1===this.token_types.indexOf(n.type)?(null!=this.show&&window.clearTimeout(this.show),this.hide(),void 0):(null!=this.show&&window.clearTimeout(this.show),this.show=setTimeout(function(t){return function(){return t.is_match(n)?t.build_and_show_tooltip(n,e.line,n.start,!1):t.hide()}}(this),300))},t.prototype.is_match=function(t){return null!=t&&this.token_types.indexOf(t.type)>=0&&null!=t.string&&null!=this.token_info[t.string]},t.prototype.handle_cursor_activity=function(){var t;if(this.force&&this.trigger_pos)return t=quanto.editor.getCursor(),t.line!==this.trigger_pos.line||t.ch<this.trigger_pos.ch?this.hide():void 0},t.prototype.build_and_show_tooltip=function(t,e,n,i){var r,o,a,s,l,u,c,d;if((null!=(c=this.has_no_params)?c.indexOf(t.string):void 0)>=0&&i)return quanto.editor.replaceSelection(")"),a=quanto.editor.getCursor(),e=a.line,r=a.ch,quanto.editor.setSelection({line:e,ch:r}),void 0;if(o=quanto.editor.charCoords({line:e,ch:n}),this.$tooltip.find(".method-sig").html(""),this.$tooltip.find(".params").html(""),"object"==typeof this.token_info[t.string][1])for(d=this.token_info[t.string][1],l=0,u=d.length;u>l;l++)s=d[l],this.$tooltip.find(".method-sig").append(""+this.token_info[t.string][0]+"<br>"),this.$tooltip.find(".params").append("("+s+")<br>");else this.$tooltip.find(".method-sig").html(this.token_info[t.string][0]),this.$tooltip.find(".params").html("("+this.token_info[t.string][1]+")");return this.$tooltip.find(".info").html(this.token_info[t.string][2]),this.property_list.indexOf(t.string)>=0?(this.$tooltip.find(".params").css("display","none"),this.$tooltip.find(".params").addClass("hidden")):(this.$tooltip.find(".params").css("display","inline-block"),this.$tooltip.find(".params").removeClass("hidden")),this.$tooltip.css("left",o.left-1+"px").css("top",o.top+8-88+"px").show(),this.shown=!0},t.prototype.force_show=function(t){var e,n;if(null!=t&&null!=t.string)return this.forced_token=t.string,this.force=!0,n=quanto.editor.getCursor(),e=quanto.editor.charCoords({line:n.line,ch:t.start}),this.trigger_pos={line:n.line,ch:n.ch},this.build_and_show_tooltip(t,n.line,t.start,!0)},t.prototype.hide=function(){return this.shown?(this.force=!1,this.shown=!1,this.forced_token=null,this.$tooltip.hide()):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.AcademiaManager=t=function(){function t(){this.send_email=e(this.send_email,this),$("#academia-submit-button").on("click",function(t){return function(){return t.send_email()}}(this))}return t.prototype.send_email=function(){var t,e;return t=$("#academia-email-box").val(),e=$("#academia-name-box").val(),$.post("/academia/send_email",{user_email:t,user_name:e},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?quanto.show_message_popup("Thank you!","We will be in touch with you shortly."):void 0}}(this)).error(function(){return function(){return quanto.show_error_popup("We couldn't submit your request.")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.AlgorithmAtomicManager=t=function(){function t(){this.set_collab_alert_visible=e(this.set_collab_alert_visible,this);var t,n;quanto.instances.lm=new quanto.LayoutManager,quanto.instances.sm=new quanto.SaveManager,quanto.instances.ide_mgr=new quanto.IdeManager,quanto.instances.km=new quanto.KeyboardManager,quanto.instances.bm=new quanto.BacktestPaneManager,quanto.instances.dm=new quanto.DailyBarsManager,quanto.instances.diff_manager=new quanto.DiffManager,quanto.instances.dap=new quanto.DeployAlgoPopupManager,quanto.instances.srm=new quanto.SubmitRevisionPopupManager,quanto.instances.fund_diff_manager=new quanto.FundDiffManager,quanto.hide_footer(),$(".toggle-buttons .btn").live("click",function(){return $(this).closest(".toggle-buttons").find(".btn-primary").removeClass("btn-primary"),$(this).addClass("btn-primary")}),this.key_hints_on=!1,$(document).on("keydown",function(t){return function(e){return t.key_hints_on||!e.ctrlKey&&!e.metaKey?void 0:($(".underlined_char").addClass("on"),t.key_hints_on=!0)}}(this)),$(document).on("keyup",function(t){return function(e){return!t.key_hints_on||e.ctrlKey||e.metaKey?void 0:($(".underlined_char").removeClass("on"),t.key_hints_on=!1)}}(this)),$(document).on("shown",'a[data-toggle="tab"]',function(){return function(t){return"#tab-logs"===$(t.target).attr("href")?($("#tab-logs").css("display","block"),quanto.showing_logs=!0,$(document).trigger("logs-tab-shown")):($("#tab-logs").css("display","none"),quanto.showing_logs=!1)}}(this)),quanto.showing_logs=!1,"1"===quanto.get_query_variable("d")&&$("#deploy-algo-button").hasClass("can-deploy")&&$("#deploy-algo-button").removeClass("disabled").attr("href","#deploy-code-modal").trigger("click"),$(document).bind("show_reconnecting_collab",function(t){return function(){return t.set_collab_alert_visible(!0,$("#reconnecting-collab-notif"),!0),$("#connecting-collab-notif").addClass("hidden")}}(this)),$(document).bind("hide_reconnecting_collab",function(t){return function(){return t.set_collab_alert_visible(!1,$("#reconnecting-collab-notif"))}}(this)),$(document).bind("hide_connecting_collab",function(t){return function(){return t.set_collab_alert_visible(!1,$("#connecting-collab-notif"))}}(this)),$(document).bind("hide_collab_clone_algo",function(){return function(){return $("#reconnecting-collab-notif #notif-clone-algo").addClass("hidden"),$("#reconnecting-collab-notif .notif-button-row").addClass("hidden")}}(this)),$(document).bind("show_collab_clone_algo",function(){return function(){return $("#reconnecting-collab-notif #notif-clone-algo").removeClass("hidden"),$("#reconnecting-collab-notif .notif-button-row").removeClass("hidden")}}(this)),$(document).bind("collab_connection_attempt_failed",function(){return function(){return $(".notifications-area .alert").addClass("hidden"),$("#collab-connection-failed").removeClass("hidden")}}(this)),(null!=(n=quanto.instances.cuim)?n.collaboration_started:void 0)&&this.set_collab_alert_visible(!0,$("#connecting-collab-notif"),"nocursor"),t=function(){return function(){return"#backtest"===window.location.hash?quanto.instances.lm.toggle_panes("backtest"):"#algorithm"===window.location.hash?quanto.instances.lm.toggle_panes("algo"):"backtest-atomic"===$("#page-id").val()?quanto.instances.lm.toggle_panes("backtest"):quanto.instances.lm.toggle_panes("algo")}}(this),t(),window.onpopstate=t}return t.prototype.set_collab_alert_visible=function(t,e,n){var i,r;return i=!e.hasClass("hidden"),t!==i?(r=t?"turn_off_autosave":"turn_on_autosave",$(document).trigger(r,[!1]),quanto.instances.chatmanager.set_chat_enabled(!t),quanto.editor.setOption("readOnly",t?n:!1),quanto.editor.setOption("cursorBlinkRate",t?0:530),t?e.removeClass("hidden"):e.addClass("hidden")):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LayoutManager=t=function(){function t(){this.resize_editor=e(this.resize_editor,this),this.toggle_panes=e(this.toggle_panes,this),this.exit_fullscreen=e(this.exit_fullscreen,this),this.enter_fullscreen=e(this.enter_fullscreen,this),this.initialize_events=e(this.initialize_events,this),this.initialize_debug_pane=e(this.initialize_debug_pane,this),this.visible_pane="",this.fullscreen=!1,this.$fullscreen_button=$("#fullscreen-button"),this.$fullscreen_link=$("#fullscreen-menu-link"),this.$fullscreen_link.click(this.enter_fullscreen),this.$fullscreen_button.click(this.exit_fullscreen),$("#algo-button").click(function(t){return function(){return t.toggle_panes("algo")}}(this)),$("#backtest-button").click(function(t){return function(){return t.toggle_panes("backtest")}}(this)),this.$idebox=$("#ide-box"),this.$backtestarea=$("#backtest-area"),this.$idecontainer=$("#ide-container"),this.$dailybars=$("#output-pane"),this.debug_window_visible=!1,this.big_logs=!1,this.initialize_events(),$(window).resize(this.resize_editor),this.resize_editor(),this.debug_window_initialized=!1,$(".debug-toolbar").mousedown(function(){return function(t){return 1===t.which?$("#code-area").trigger("start_resize",[t]):void 0}}(this)),$(".debug-toolbar").mouseup(function(){return function(t){return $("#code-area").trigger("end_resize",[t])}}(this))}var n;return n=!1,t.prototype.initialize_debug_pane=function(){return $("#code-area").splitter({splitHorizontal:!0,dock:"bottom",sizeBottom:200,startDocked:!0}),$("#output-pane").css("top",0),setTimeout(function(){return function(){return $("#debug-mainpane").splitter({splitVertical:!0,dock:"right",sizeRight:250,startDocked:!1})}}(this),50)},t.prototype.initialize_events=function(){return $(document).bind("build_failure",function(){return function(){return mixpanel.track("code build failed")}}(this)),$(document).bind("exit_fullscreen",function(t){return function(){return t.exit_fullscreen()}}(this)),$(document).bind("change_pane",function(){return function(t,e){return"backtest"===e?$("#backtest-button").click():"algorithm"===e?$("#algo-button").click():void 0}}(this)),quanto.on_click("#undock-ide-link",function(){return function(){return $("#splitter-container").trigger("undock")}}(this)),$(document).bind("color_theme_changed",function(){return function(t,e){return"dark"===e?$("#rightdock").addClass("dark"):$("#rightdock").removeClass("dark")}}(this)),$(document).bind("validation_triggered",function(){return function(){return $("#rightdock .build-status").removeClass("error success").addClass("building")}}(this)),$(document).bind("build_success",function(){return function(){return $("#rightdock .build-status").removeClass("error building").addClass("success")}}(this)),$(document).bind("build_failure",function(){return function(){return $("#rightdock .build-status").removeClass("building success").addClass("error")}}(this)),$("#title-box").keydown(function(){return function(){return quanto.instances.sm.update_button_save()}}(this)),$(document).bind("show_debug_window",function(t){return function(e,n){return t.debug_window_initialized||(t.initialize_debug_pane(),t.debug_window_initialized=!0),t.debug_window_visible?setTimeout(function(){return $(document).trigger("set_active_line",[n])},10):($("#debug-area").removeClass("hidden"),$("#code-area").trigger("undock.splitter1"),t.resize_editor(),t.debug_window_visible=!0,setTimeout(function(){return $(document).trigger("set_active_line",[n])},100))}}(this)),$(document).bind("hide_debug_window",function(t){return function(){return t.debug_window_visible?setTimeout(function(){return $("#code-area").trigger("dock.splitter1"),$("#debug-area").addClass("hidden"),setTimeout(function(){return t.resize_editor(),quanto.editor.refresh()},100),t.debug_window_visible=!1},10):void 0}}(this))},t.prototype.enter_fullscreen=function(){return $("#ide-box").addClass("fullscreen"),this.fullscreen=!0,this.resize_editor(),this.$fullscreen_button.removeClass("hidden")},t.prototype.exit_fullscreen=function(){return $("#ide-box").removeClass("fullscreen"),this.fullscreen=!1,this.$fullscreen_button.addClass("hidden"),this.resize_editor()},t.prototype.toggle_panes=function(t){var e;return t!==this.visible_pane&&("algo"===t?(quanto.hide_footer(),$("#backtest-area").addClass("hidden"),$("#algo-area").removeClass("hidden"),$(document).trigger("turn_on_autosave"),$(".state-triangle").removeClass("backtest"),$("#title-box").removeClass("disabled").prop("disabled",!1),$("#manage-backtests-button").addClass("hidden"),$("#algo-button").addClass("btn-primary").addClass("active"),$("#backtest-button").removeClass("btn-primary").removeClass("active"),$("body").addClass("no-scroll"),$("#daily-new-backtest-button").data("fund-algo")&&$("#daily-new-backtest-button").popover({content:"When you're happy with your changes, you can submit your latest revision to Quantopian from the full backtest page.",placement:"left",trigger:"hover"}),setTimeout(function(t){return function(){var e;return t.resize_editor,null!=(e=quanto.editor)&&e.refresh(),$.cookie("seen_submit_prompt_ide")?void 0:($("#daily-new-backtest-button").popover("show"),$.cookie("seen_submit_prompt_ide","true"))}}(this),10)):"backtest"===t&&(quanto.show_footer(),$("#algo-area").addClass("hidden"),$("#backtest-area").removeClass("hidden"),$(document).trigger("turn_off_autosave",[!0]),$(".state-triangle").addClass("backtest"),$("#algo-button").removeClass("btn-primary").removeClass("active"),$("#backtest-button").addClass("btn-primary").addClass("active"),$("#title-box").addClass("disabled").prop("disabled",!0),$("#backtest-atomic-container").is(":visible")?$("#manage-backtests-button").removeClass("hidden"):$("#manage-backtests-button").addClass("hidden"),$("body").removeClass("no-scroll"),$("#show-revision-modal-button").is(":visible")&&!$.cookie("seen_submit_prompt_full_backtest")&&($("#show-revision-modal-button").popover("show"),$.cookie("seen_submit_prompt_full_backtest","true")),null!=(e=quanto.instances.backtest_mgr)&&e.resize_chart())),this.visible_pane=t,this.resize_editor(),"algo"===t?($("#splitter-container").customSplitter({outline:!0,minRight:515,minLeft:300,sizeRight:515,resizeToWidth:!0,resize_event:"main_splitter_resized",cookie:"quanto_ide_main_splitter",dock:"right",dockSpeed:100,dockzone_selector:"#dockzone"}),setTimeout(function(){return function(){return $("#splitter-container").trigger("resize")}}(this),300)):void 0},t.prototype.resize_editor=function(){var t,e;return this.fullscreen?(this.$idebox.width($(window).width()-2),this.$idebox.height($(window).height()-this.$idebox.position().top-1)):(this.$idebox.css("width","auto"),this.$idebox.height($(window).height()-$(".ide").position().top-2)),e=Math.max(this.$idebox.height(),501),$("#code-area").height(e-40),this.$dailybars.height(e-40),this.$dailybars.find(".tabbable").hasClass("tall")?this.$dailybars.find(".tabbable").height(e-40-68):(t=337,$(".dailybars-results").hasClass("doubleheight")&&(t=482),this.$dailybars.find(".tabbable").height(e-40-t))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.AlgorithmFeedManager=t=function(){function t(){this.handle_algo_table_delete_clicked=e(this.handle_algo_table_delete_clicked,this),this.handle_live_algo_table_delete_clicked=e(this.handle_live_algo_table_delete_clicked,this),this.show_running=e(this.show_running,this),this.show_stopped=e(this.show_stopped,this),this.show_all=e(this.show_all,this),this.initialize_paper_trading_filter=e(this.initialize_paper_trading_filter,this),this.set_live_algo_cookie=e(this.set_live_algo_cookie,this),this.initialize_deploy_link=e(this.initialize_deploy_link,this),this.initialize_new_algo_modal=e(this.initialize_new_algo_modal,this),this.initialize_live_trading_algo_table=e(this.initialize_live_trading_algo_table,this),this.initialize_submit_contest_algo_button=e(this.initialize_submit_contest_algo_button,this),this.validate_contest_algo=e(this.validate_contest_algo,this),this.initialize_contest_entry_buttons=e(this.initialize_contest_entry_buttons,this);var t,n;this.csm=new quanto.ContestSubmissionManager,this.initialize_new_algo_modal(),this.initialize_live_trading_algo_table(),$("#newalgo-modal").on("show",function(){return function(){return setTimeout(function(){return $("#new-algo-title").focus()},50)}}(this)),$("#algo-delete-button").bind("click",this.handle_algo_table_delete_clicked),$("#live-algo-delete-button").bind("click",this.handle_live_algo_table_delete_clicked),quanto.on_click(".getstarted-link",function(){return function(){return $("#getstarted-modal").modal("show"),quanto.is_employee_or_admin()?void 0:mixpanel.track("get started trading button")}}(this)),quanto.on_click(".clickable-row",function(t){return t.target.className.indexOf("checkbox")<0?window.document.location="/live_algorithms/"+$(this).data("live-algo-id"):void 0}),t=$.cookie("show_algo_intro"),n=$("#current_user_id").val(),t&&t===n?(quanto.is_mobile_screen()||$("#sample-algo-intro-modal").modal("show"),$("#close-algo-intro").click(function(){return $.removeCookie("show_algo_intro")})):"1"===quanto.get_query_variable("d")&&$("#getstarted-modal").modal("show"),this.initialize_paper_trading_filter(),this.initialize_deploy_link(),this.initialize_contest_entry_buttons(),$(".contest-submit-button-disabled").tooltip(),$(".contest-submit-button").tooltip(),quanto.on_click(".getstarted-link",function(){return function(){return $("#getstarted-modal").modal("show")}}(this))}return t.prototype.initialize_contest_entry_buttons=function(){return quanto.on_click(".enter-contest-button",function(t){return function(e){var n,i,r;return mixpanel.track("contest validate click /algorithms"),i=$(quanto.get_src_element(e)),n=i.closest("tr"),r=n.data("algo-id"),t.validate_contest_algo(r)}}(this))},t.prototype.validate_contest_algo=function(t){var e;return $("#contest-modal .terms").addClass("hidden"),$("#contest-modal .validating").removeClass("hidden"),$("#contest-agree-button").removeClass("disabled").html("Submit"),$("#contest-modal").modal("show"),e={algo_id:t},$.post("/contest_submissions/is_valid",e,function(e){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()?($("#contest-modal .validating").addClass("hidden"),$("#contest-modal .terms").removeClass("hidden"),e.initialize_submit_contest_algo_button(t)):($("#contest-modal").modal("hide"),e.csm.contest_submission_error())}}(this)).error(function(t){return function(e,n,i){return t.csm.contest_submission_error_handler(e,n,i)}}(this))},t.prototype.initialize_submit_contest_algo_button=function(t){return quanto.on_click("#contest-agree-button",function(e){return function(){var n;return mixpanel.track("contest submit click /algorithms"),$("#contest-agree-button").addClass("disabled").html("Submitting..."),$("#backtest-error-message-container").html("").hide(),n={algo_id:t},$.post("/contest_submissions/submit",n,function(t){var n;return n=new quanto.JsonResponse(t),n.redirect()?void 0:($("#contest-modal").modal("hide"),e.csm.contest_submission_error())}).error(function(t,n,i){return e.csm.contest_submission_error_handler(t,n,i)})}}(this))},t.prototype.initialize_live_trading_algo_table=function(){var t,e,n;return n=quanto.is_mobile_screen()?1:4,t=quanto.is_mobile_screen()?[0,4,5]:[],e=$("#live-trading-algo-table").dataTable({bPaginate:!1,sDom:'<"top"><"bottom"><"clear">',aaSorting:[[n,"desc"]],aoColumnDefs:[{bSortable:!1,aTargets:["_all"]},{bVisible:!1,aTargets:t}],initComplete:function(t){return function(){return quanto.is_mobile_screen()||"running"===$.cookie("live_algo_filter")?t.show_running():"stopped"===$.cookie("live_algo_filter")&&t.show_stopped(),$("#live-trading-algo-table").css("visibility","visible")}}(this)})},t.prototype.initialize_new_algo_modal=function(){return this.$create_new_algo_button=$("#create-new-algo-button"),$("#new-algo-title").on("keydown",function(){return function(t){return 13===t.keyCode?$("#create-new-algo-button").trigger("click"):void 0}}(this)),quanto.on_click("#create-new-algo-button",function(t){return function(){var e;return e={title:$("#new-algo-title").val()},t.$create_new_algo_button.addClass("disabled").html("Creating..."),$.post("/algorithms",e,function(t){var e;return quanto.track_mixpanel("new algo",{type:"new"}),e=new quanto.JsonResponse(t)}).error(function(){return t.$create_new_algo_button.removeClass("disabled").html("Create Algorithm"),$("#create-new-algo-error").html("There was a problem creating your algorithm").removeClass("hidden")})}}(this))},t.prototype.initialize_deploy_link=function(){return quanto.on_click(".deploy-link",function(){return function(t){var e,n,i;return e=$(quanto.get_src_element(t)),n=e.closest("tr"),i=n.data("algo-id"),$.post("/algorithms/"+i+"/redirect_to_paper_trade",{id:i},function(t){var e;return e=new quanto.JsonResponse(t)}).error(function(){return quanto.show_unknown_error_popup()})}}(this))},t.prototype.set_live_algo_cookie=function(t){return $.cookie("live_algo_filter",t)},t.prototype.initialize_paper_trading_filter=function(){return quanto.on_click("#all-paper-algos",function(t){return function(){return t.show_all()}}(this)),quanto.on_click("#running-paper-algos-only",function(t){return function(){return t.show_running()}}(this)),quanto.on_click("#stopped-paper-algos-only",function(t){return function(){return t.show_stopped()}}(this))},t.prototype.show_all=function(){var t,e;return this.set_live_algo_cookie("all"),e=$("#live-trading-algo-table").dataTable(),e.fnFilter("",3),t=quanto.is_mobile_screen()?1:4,e.dataTable().fnSort([t,"desc"]),e.dataTable().fnDraw()},t.prototype.show_stopped=function(){var t,e;return this.set_live_algo_cookie("stopped"),e=$("#live-trading-algo-table").dataTable(),e.fnFilter("Stopped|Withdrawn|Error|Disqualified",3,!0),t=quanto.is_mobile_screen()?1:5,e.fnSort([[t,"desc"]]),e.fnDraw()},t.prototype.show_running=function(){var t,e;return this.set_live_algo_cookie("running"),e=$("#live-trading-algo-table").dataTable(),e.fnFilter("Trading",3,!0),t=quanto.is_mobile_screen()?1:4,e.fnSort([t,"desc"]),e.fnDraw()},t.prototype.handle_live_algo_table_delete_clicked=function(){var t,e,n;if(t=quanto.get_selected_rows($("#live-trading-algo-table")),e=$.map(t,function(){return function(t){return $(t).data("live-algo-id")}}(this)),e.length>0){if(n="live algorithm",e.length>1&&(n="live algorithms"),!confirm("Delete "+e.length+" "+n+"?"))return;return $.post("/live_algorithms/delete",{ids:e},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:alert("There was a problem deleting the live algorithms.")}}(this)).error(function(){return function(){return alert("There was a problem deleting the live algorithms.")}}(this))}},t.prototype.handle_algo_table_delete_clicked=function(){var t,e,n;if(t=quanto.get_selected_rows($("#algo_table")),e=$.map(t,function(){return function(t){return $(t).data("algo-id")}}(this)),e.length>0){if(n="algorithm",e.length>1&&(n="algorithms"),!confirm("Delete "+e.length+" "+n+"?"))return;return $.post("/algorithms/delete",{ids:e},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:alert("There was a problem deleting the algorithms.")}}(this))}},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BacktestManager=t=function(){function t(){this.display_custom_chart_values=e(this.display_custom_chart_values,this),this.display_perf_chart_values=e(this.display_perf_chart_values,this),this.finish_up=e(this.finish_up,this),this.add_custom_series=e(this.add_custom_series,this),this.find_series_by_name=e(this.find_series_by_name,this),this.add_chart_data=e(this.add_chart_data,this),this.get_timestamp_from_daily_perf=e(this.get_timestamp_from_daily_perf,this),this.close_connection=e(this.close_connection,this),this.close_txn_ws=e(this.close_txn_ws,this),this.close_main_ws=e(this.close_main_ws,this),this.reinitialize_chart_with_custom_chart=e(this.reinitialize_chart_with_custom_chart,this),this.populate_done_ui=e(this.populate_done_ui,this),this.show_loading_error=e(this.show_loading_error,this),this.initialize_sockets=e(this.initialize_sockets,this),this.get_server=e(this.get_server,this),this.handle_share_backtest_clicked=e(this.handle_share_backtest_clicked,this),this.init_ui_eventhandlers=e(this.init_ui_eventhandlers,this),this.init_state=e(this.init_state,this),this.initial_state=parseInt($("#initial_backtest_state").val())||0,this.include_txn=!0,this.$transaction_chart_loading_msg=$(".results-wrapper .loading-transactions"),this.initial_state>1&&(this.disable_settings(),this.init_helpers(),2===this.initial_state?(this.data_ws_url=$("#ws-url-field").val(),this.txn_ws_url=$("#ws-transaction-url-field").val(),quanto.get_server({success_callback:function(t){return function(e,n,i){return t.bind_websocket(t.data_ws_url,i)}}(this),task_id:$("#data_backtest_id").val()})):this.initial_state>2&&(this.include_txn=!1,this.get_server())),this.initial_state>0?(this.populate_backtest_display_fields(),this.display_fields_initialized=!0):this.display_fields_initialized=!1,$(window).bind("beforeunload",function(t){return function(){return t.close_connection(!0)}}(this)),this.init_ui_eventhandlers(),this.init_state(),"1"===quanto.get_query_variable("s")&&this.start_backtest(),$(".selectpicker").selectpicker(),this.check_fundamentals_disclaimer()}return t.prototype.percentage_fields={total_returns:"tr",benchmark_returns:"br",max_drawdown:"md"},t.prototype.cumulative_fields={alpha:"al",volatility:"vo",beta:"be",benchmark_volatility:"bv",sharpe:"sh",sortino:"so",benchmark_returns:"br",total_returns:"tr",max_drawdown:"md",information:"in"},t.prototype.custom_series_template=Handlebars.compile("<div class='payload' custom-chart-label legend-item inline-block payload' data-key='{{key}}'><span class='square' style='background-color: {{color}}'></span><span class='series-label' style='color: {{color}}'>{{key}}</span><span class='chart-value' style='color: {{color}}' data-key='{{key}}'></span></div>"),t.prototype.init_state=function(){return this.startdate_initialized=!1,this.backtest_error=!1,quanto.close_ws=!1,this.artifacts_cleaned=!1},t.prototype.init_ui_eventhandlers=function(){return $("#start-backtest-button").bind("click",function(t){return function(){return t.start_backtest()}}(this)),$("#cancel-backtest-button").bind("click",function(t){return function(){return t.maybe_cancel_backtest()}}(this)),$("#backtest-atomic-container .cancel-backtest-popup .confirm-cancel-backtest-button").bind("click",function(t){return function(){return t.cancel_backtest()}}(this)),$("#code-snapshot-modal").on("show",function(t){return function(){return setTimeout(function(){var e;return t.initialize_codemirror(),null!=(e=quanto.editor_snapshot)?e.refresh():void 0},10)}}(this)),$("#backtest-settings-modal").on("show",function(t){return function(){return t.populate_backtest_display_fields()}}(this)),quanto.on_click("#code-link",function(){return function(){return $(document).trigger("change_pane",["algorithm"])}}(this)),quanto.on_click("#share-backtest-button",function(t){return function(e){return t.handle_share_backtest_clicked(e)}}(this)),quanto.on_click("#backtest-results .chart-label",function(t){return function(e){var n,i,r;return n=$(quanto.get_src_element(e)).closest(".payload"),i=n.data("key"),r=t.find_series_by_name(i),null!=r?n.hasClass("unselected")?(n.removeClass("unselected"),r.show()):(n.addClass("unselected"),r.hide()):void 0}}(this)),quanto.on_click("#backtest-results .legend-item",function(t){return function(e){var n,i,r;return n=$(quanto.get_src_element(e)).closest(".legend-item"),i=n.data("key"),r=t.find_series_by_name(i),null!=r?n.hasClass("unselected")?(n.removeClass("unselected"),r.show()):(n.addClass("unselected"),r.hide()):void 0}}(this))},t.prototype.handle_share_backtest_clicked=function(){var t;return t=$("#data_backtest_id").val(),$.post("/backtests/"+t+"/clone_requested",{backtest_id:t},function(){return function(t){var e,n;return n=new quanto.JsonResponse(t),n.ok()?(e=n.data(),null!=e.cloned&&e.cloned?($("#share-post-name").attr("href",e.post_path).html(e.subject),$("#share-post-author").attr("href",e.author_path).html(quanto.escapeHTML(e.author)),$("#share-modal-create-new-button").attr("href",e.share_url),$("#share-modal-reply-button").attr("href",e.share_reply_url),$("#share-modal").modal("show")):window.location=e.share_url,0):void 0}}(this))},t.prototype.get_server=function(){var t;return t=function(t){return function(e,n,i){return t.initialize_sockets(e,n,i),console.log("found server: "+e+":"+n)}}(this),quanto.get_server({success_callback:t,failure_callback:this.show_loading_error,task_id:$("#data_backtest_id").val()})},t.prototype.initialize_sockets=function(t,e,n){var i;return i=$("#data_backtest_id").val(),this.data_ws_url="wss://"+t+":"+e+"/backtests/"+i,this.txn_ws_url="wss://"+t+":"+e+"/transactions/"+i,this.bind_websocket(this.data_ws_url,n)},t.prototype.show_loading_error=function(){return $("#backtest-loading-message").html("<span class='error-load'><i class='icon icon-exclamation-sign'></i>There was a problem loading your backtest.  Try again or contact <a class='open-feedback-link'>feedback.</a>.</span>")},t.prototype.init_helpers=function(){return this.position_viz_mgr=new quanto.PositionVizManager,this.transactions_viz_mgr=new quanto.TransactionsVizManager,this.log_mgr=new quanto.BacktestLogManager({container_selector:"#logs-output",backtest_id:$("#data_backtest_id").val(),backtest_q1_deprecated:$("#data_backtest_q1_deprecated").val(),backtest_state:parseInt($("#initial_backtest_state").val()),backtest_log_count:parseInt($("#backtest_log_count").val())})},t.prototype.initialize_codemirror=function(){var t;return t=$("#code-snapshot-textbox"),t.length>0&&!t.hasClass("codemirror-done")?(quanto.editor_snapshot=CodeMirror.fromTextArea(t[0],{lineNumbers:!0,mode:"python",indentUnit:4,readOnly:!0}),t.addClass("codemirror-done")):void 0},t.prototype.check_fundamentals_disclaimer=function(){return $("#code-snapshot-textbox").val().indexOf("get_fundamentals(")>=0?$(".fundamentals-disclaimer").removeClass("hidden"):void 0},t.prototype.shutdown=function(){return this.close_connection(!0),null!=quanto.chart&&(quanto.chart.destroy(),quanto.chart=null),null!=this.transactions_viz_mgr&&(this.transactions_viz_mgr.destroy(),this.transactions_viz_mgr=null),null!=this.log_mgr?(this.log_mgr.destroy(),this.log_mgr=null):void 0
},t.prototype.maybe_cancel_backtest=function(){return $("#cancel-backtest-button").hasClass("disabled")?void 0:$("#backtest-atomic-container .cancel-backtest-popup").modal("show")},t.prototype.cancel_backtest=function(){var t,e;return mixpanel.track("full backtest cancelled"),$("#cancel-backtest-button").html("Cancelling...").addClass("disabled"),t=$("#data_backtest_id").val(),e={algo_id:$("#algo-id").val(),backtest_id:t},null==t?(quanto.show_error_popup("Error cancelling backtest.","Sorry, there was a problem cancelling the backtest."),$("#cancel-backtest-button").html("Cancel").removeClass("disabled"),void 0):$.post("/backtests/"+t+"/cancel_backtest",e,function(){return function(){}}(this)).error(function(){return function(){return alert("Sorry, there was a problem cancelling the backtest."),$("#cancel-backtest-button").html("Cancel").removeClass("disabled")}}(this))},t.prototype.start_backtest=function(){var t,e;return mixpanel.track("full backtest started"),quanto.turn_on_busy($("#start-backtest-button")),$("#backtest-error-message-container").html("").hide(),t=$("#codebox").val(),e={algo_id:$("#algo-id").val(),backtest_start_date_day:$("#backtest_start_date_day").val(),backtest_start_date_month:$("#backtest_start_date_month").val(),backtest_start_date_year:$("#backtest_start_date_year").val(),backtest_end_date_day:$("#backtest_end_date_day").val(),backtest_end_date_month:$("#backtest_end_date_month").val(),backtest_end_date_year:$("#backtest_end_date_year").val(),backtest_capital_base:$("#backtest_capital_base_field").val(),backtest_data_frequency_value:"minute",code:t},$.post("/backtests/start_backtest",e,function(t){return function(n){var i,r,o,a,s;return quanto.turn_off_busy($("#start-backtest-button")),a=new quanto.JsonResponse(n),a.ok()&&(r=a.data().id,null!=r)?(quanto.trigger_remote_event({type:"fullBacktestsChanged"}),i=$("#algo-id").val(),s="/algorithms/"+i+"/"+r,o="algo"===quanto.instances.lm.visible_pane,s+=o?"#algorithm":"#backtest",window.history.replaceState({},$("#title-box").val(),s),$("#share-backtest-button-group a").attr("href","/posts/new?b="+r),t.disable_settings(),t.reset_progress_pane(),t.show_progress_pane(),t.bind_websocket(a.data().ws_url,a.data().ws_open_msg),$("#code-snapshot-textbox").val(e.code),t.check_fundamentals_disclaimer(),$("#data_backtest_index").val(a.data().backtest_index),$("#data_algo_title").val(a.data().algo_title),$("#data_backtest_capital_base").val(a.data().capital_base),$("#data_backtest_id").val(r),$("#data_backtest_start_date_ms").val(a.data().start_date),$("#data_backtest_end_date_ms").val(a.data().end_date),$("#data_backtest_data_frequency").val(a.data().data_frequency),t.populate_backtest_display_fields(),$("#backtest-settings-table").addClass("hidden"),$(".backtest-settings-details-payload").addClass("hidden"),$(".backtest-toolbar-container").removeClass("hidden"),$("#backtest-settings-container tr.results").removeClass("hidden"),$("#backtest-settings-summary-payload").removeClass("hidden"),t.init_helpers()):void 0}}(this)).error(function(t){var e,n;if(quanto.turn_off_busy($("#start-backtest-button")),null!=t.responseText){if(t.responseText.indexOf("No qexec servers")>=0)return quanto.show_error_popup("Error","Quantopian is experiencing system problems, please try again later."),void 0;try{if(n=JSON.parse(t.responseText),null!=n&&"error"===n.status&&null!=n.data){if(null!=n.data.missing_field)return $("#backtest-error-message-container").html("Missing field: "+n.data.missing_field).show(),void 0;if(null!=n.data.test_failure)return $("#algo-problem-modal").modal("show"),void 0;if(null!=n.data.qexec_failure)return quanto.show_error_popup("Error","There was a problem trying to validate your algorithm. Try again or contact us by <a class='open-feedback-link'>sending feedback</a>."),void 0}}catch(i){return e=i,quanto.show_error_popup("Error","There was an unexpected error.  Please try again later."),void 0}}return quanto.show_error_popup("Error","There was a problem starting your backtest.  Please try again.")})},t.prototype.consume_transactions=function(t){var e,n,i,r,o,a,s,l,u,c,d;if(null==t&&(t=!1),null==quanto.close_ws||!quanto.close_ws){if(n=this.transaction_data_buffer,this.transaction_data_buffer=[],i=!1,n.length>0){if(e=_.groupBy(n,function(t){return t.e}),s=e.transaction,null!=s&&s.length>0){for(u=0,c=s.length;c>u;u++)a=s[u],this.transactions_viz_mgr.save_transaction_data((null!=(d=a.p)?d.transactions:void 0)||[]);o=_.last(s),l=Math.round(1e4*o.p.percent_complete)/100,$(".loading-transactions .bar").css("width",""+l+"%")}r=e.done,null!=r&&r.length>0&&(this.transactions_viz_mgr.populate_transaction_chart_total(),this.transactions_viz_mgr.handle_all_rows_received(),this.close_txn_ws(),this.$transaction_chart_loading_msg.hide(),i=!0)}return t?(setTimeout(function(){return function(){return quanto.chart.setSize(quanto.chart.chartWidth,quanto.chart.chartHeight)}}(this),10),void 0):this.txn_timer=setTimeout(function(t){return function(){return t.consume_transactions(i)}}(this),1e3)}},t.prototype.consume=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b,y,w,k,x,C,q,T,S,E,D;if(null==t&&(t=!1),null==quanto.close_ws||!quanto.close_ws){if(i=this.data_buffer,this.data_buffer=[],i.length>0){if(v=!1,s=!1,c=null,n=_.groupBy(i,function(t){return t.e}),m=n.log,null!=m&&m.length>0&&(f=_.last(m),null!=f.p&&null!=f.p.count&&this.log_mgr.update_max_count(f.p.count)),a=n.performance,null!=a&&a.length>0){for(o=[],q=0,S=a.length;S>q;q++)if(h=a[q],b=h.p,null!=b)for(D=b.daily,T=0,E=D.length;E>T;T++)r=D[T],o.push(r);d=_.first(a).p,e=d.daily[0].bm,null!=e&&-1!==e&&quanto.set_benchmark(e,".red.full_backtest_benchmark"),p=_.last(a).p,C=p.started_at||p.sa,this.startdate_initialized||null==C||(x=parseInt(C),isNaN(x)||($("#data_backtest_started_at_ms").val(x),this.populate_backtest_display_fields(),this.startdate_initialized=!0)),this.add_data(o),$("#backtest-state-label").html("Backtesting").addClass("bold"),y=quanto.pick_property(p,"percent_complete","pc"),this.progress=Math.floor(1e3*y)/10,null!=this.progress&&!isNaN(this.progress)&&this.progress>=0&&this.progress<=100&&($("#backtest-progress-bar").css("width",""+this.progress+"%"),$("#backtest-progress-label").html(""+this.progress+"%")),this.showing_custom_series||(g=_.filter(o,function(){return function(t){var e;return e=quanto.pick_property(t,"recorded_vars","rv"),null!=e&&_.keys(e).length>0}}(this)),g.length>0&&(v=!0,this.reinitialize_chart_with_custom_chart()))}w=n.risk_report||[],w.length>0&&(k=w[0],null!=k&&null!=k.p&&null!=k.p.metrics&&(this.received_risk_data=k.p.metrics,this.populate_risk_metrics(this.received_risk_data))),u=n.exception,null!=u&&u.length>0&&(this.backtest_error=!0,this.received_error_data=u[0].p,this.handle_error(this.received_error_data),s=!0),l=n.done,null!=l&&l.length>0&&(this.received_done_data=n.done[0].p,this.populate_done_ui(this.received_done_data),s=!0),s||(null!=this.received_risk_data||this.received_error_data||null!=this.received_done_data)&&(s=!0,null!=this.received_error_data&&this.handle_error(this.received_error_data),null!=this.received_risk_data&&this.populate_risk_metrics(this.received_risk_data),null!=this.received_done_data&&this.populate_done_ui(this.received_done_data)),s&&(this.finish_up(c),this.close_main_ws())}if(!t)return v?void 0:this.perf_timer=setTimeout(function(t){return function(){return t.consume(t.data_done)}}(this),1e3)}},t.prototype.populate_done_ui=function(t){if(null!=t.reason){if("error"===t.reason)return this.show_error_label("ERROR");if("cancel"===t.reason)return this.show_error_label("CANCELLED");if("drawdown"===t.reason)return this.show_error_label("MAXIMUM DAILY LOSS EXCEEDED");if("success"===t.reason&&$("#deploy-algo-button").hasClass("can-deploy"))return"true"===$("#deploy-algo-button").data("q2-era-backtest")||$("#deploy-algo-button").data("q2-era-backtest")===!0?$("#deploy-algo-button").removeClass("disabled").attr("href","#deploy-code-modal").popover({content:"Live trade with your broker or paper trade on Quantopian.",placement:"bottom",trigger:"hover"}):$("#deploy-algo-button").popover({content:"This backtest was run using an old version of the API. Try running a new backtest to see if the code needs updating.",placement:"bottom",trigger:"hover"})}},t.prototype.reinitialize_chart_with_custom_chart=function(){return $(".results-wrapper").addClass("showing-custom-chart"),this.transactions_viz_mgr=new quanto.TransactionsVizManager,this.initialize_chart(!0),this.showing_custom_series=!0,this.add_chart_data(this.processed_perf_data,!0),quanto.chart.redraw(!0),this.consume()},t.prototype.bind_websocket=function(t,e){return null!=t?(this.ws=new WebSocket(t),this.data_buffer=[],this.data_done=!1,this.received_custom_series={},this.showing_custom_series=!1,this.processed_perf_data=[],this.consume(),this.ws.onopen=function(t){return function(){return console.log("websocket opened, "+new Date),t.ws.send(JSON.stringify({e:"open",p:{cursor:0,include_txn:t.include_txn,a:e}}))}}(this),this.ws.onmessage=function(t){return function(e){return t.data_buffer.push(JSON.parse(e.data))}}(this),this.ws.onerror=function(){return function(){}}(this),this.ws.onclose=function(){return function(){return console.log("websocket closed, "+new Date)}}(this),this.show_results_frame(),this.initialize_chart(!1)):void 0},t.prototype.close_main_ws=function(){return null!=this.ws?(this.ws.send("ACK"),this.ws.onclose=function(){return console.log("websocket closed in close_connection, "+new Date)},this.ws.close(),this.ws=null):void 0},t.prototype.close_txn_ws=function(){return null!=this.transaction_ws?(this.transaction_ws.send("ACK"),this.transaction_ws.onclose=function(){return console.log("txn log ws closed in close_connection")},this.transaction_ws.close(),this.transaction_ws=null):void 0},t.prototype.close_connection=function(t){null==t&&(t=!1),null!=this.closed&&this.closed||(t&&(quanto.close_ws=!0),null!=this.perf_timer&&clearTimeout(this.perf_timer),null!=this.txn_timer&&clearTimeout(this.txn_timer),this.close_main_ws(),this.close_txn_ws())},t.prototype.show_results_frame=function(){return $("#algo-form").addClass("backtest-results"),$("#backtest-results-box").show(),$("#backtest-loading-message").hide(),$("#backtest-results").show(),$("#result-tabs").removeClass("disabled")},t.prototype.add_data=function(t){var e,n,i,r,o,a,s,l,u,c,d;if(a=_.last(t),null!=a){n=quanto.pick_property(a,"cumulative","c"),d=this.cumulative_fields;for(o in d)e=d[o],l=quanto.pick_property(n,e,o),null==l||isNaN(l)||(this.is_percentage_field(o)?(r=Math.floor(1e4*l)/100,$("#headline-results .stat-value[datafield='"+o+"']").html(""+r+"%")):(r=l.toFixed(2),$("#headline-results .stat-value[datafield='"+o+"']").html(""+r)))}for(u=0,c=t.length;c>u;u++)i=t[u],null!=i&&(this.processed_perf_data.push(i),s=this.get_timestamp_from_daily_perf(i),this.position_viz_mgr.save_position_data(i));return this.add_chart_data(t),quanto.chart.redraw(!0),this.update_perf_chart_labels()},t.prototype.get_timestamp_from_daily_perf=function(t){var e,n,i,r;return r=quanto.pick_property(t,"date","d"),n=new Date(r),i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),e=quanto.date.adjust_date_for_UTC_reverse(i).getTime()},t.prototype.add_chart_data=function(t,e){var n,i,r,o,a,s,l,u,c,d,h,p,_,f,m,g;for(null==e&&(e=!1),g=[],f=0,m=t.length;m>f;f++)o=t[f],null!=o?(h=this.get_timestamp_from_daily_perf(o),a=o.pnl,r=quanto.pick_property(o,"cumulative","c"),n=quanto.pick_property(r,"benchmark_returns","br"),quanto.chart.series[2].addPoint([h,a],!1),l=quanto.pick_property(r,"total_returns","tr"),quanto.chart.series[0].addPoint([h,l],!1),quanto.chart.series[1].addPoint([h,n],!1),p=quanto.pick_property(o,"transactions","t"),this.include_txn&&null!=p&&(this.transactions_viz_mgr.save_transaction_data(p),this.transactions_viz_mgr.populate_transaction_chart_incremental(h,p)),u=quanto.pick_property(o,"recorded_vars","rv"),this.showing_custom_series&&null!=u?g.push(function(){var t;t=[];for(s in u)_=u[s],null==this.received_custom_series[s]&&(i=quanto.custom_chart_colors[(quanto.chart.series.length-5)%quanto.custom_chart_colors.length],c={type:"line",name:s,data:[],dataGrouping:quanto.global_grouping_options,yAxis:1,lineWidth:1,color:i},quanto.chart.addSeries(c,!1),this.received_custom_series[s]={color:i},this.add_custom_series(s,i)),d=this.find_series_by_name(s),null!=d?t.push(d.addPoint([h,_],!1)):t.push(void 0);return t}.call(this)):g.push(void 0)):g.push(void 0);return g},t.prototype.find_series_by_name=function(t){return _.find(quanto.chart.series,function(){return function(e){return e.name===t}}(this))},t.prototype.add_custom_series=function(t,e){var n;return n=this.custom_series_template({key:t,color:e}),$("#custom-series-legend").append(n)},t.prototype.handle_error=function(t){return this.show_error_label("ERROR"),quanto.instances.error_renderer=new quanto.ErrorRenderer($("#backtest-errors"),t,!0,null,$("#data_backtest_id").val()),$("#error-header").show().removeClass("hidden"),$("#tab-error").removeClass("hidden"),$("#tab-link").trigger("click")},t.prototype.show_error_label=function(t){return $("#status-label").html(t),$("#status-label").closest(".status-container").show(),$("#backtest-complete").addClass("hidden"),$("#extra-status-info").html("<span class='bold margin_0'>"+(this.progress||0)+"%</span><span> complete</span>").show()},t.prototype.finish_up=function(t){var e;return $(".optional-data-field").tooltip(),this.data_done=!0,this.backtest_error||$("#error-header").remove(),this.show_done_pane(),t||(t={}),null!=t.completed_at&&(e=t.completed_at,isNaN(e)||($("#data_backtest_finished_at_ms").val(e),this.populate_backtest_display_fields())),$(".enable-when-done").removeClass("disabled"),$("table.backtest-settings-details-payload").hide(),$(".backtest-settings-summary-payload").show(),this.position_viz_mgr.handle_all_rows_received(),this.include_txn?this.transactions_viz_mgr.handle_all_rows_received():this.load_transactions(),$("#share-backtest-button").removeClass("disabled"),this.log_mgr.backtest_finished()},t.prototype.load_transactions=function(){var t;return this.$transaction_chart_loading_msg.show(),null!=this.txn_ws_url?(t=function(t){return function(e,n,i){return t.transaction_ws=new WebSocket(t.txn_ws_url),t.transaction_data_buffer=[],t.consume_transactions(),t.transaction_ws.onopen=function(){return console.log("transaction websocket opened"),t.transaction_ws.send(JSON.stringify({e:"open",p:{cursor:0,a:i}}))},t.transaction_ws.onmessage=function(e){var n;return n=JSON.parse(e.data),t.transaction_data_buffer.push(n)},t.transaction_ws.onerror=function(){},t.transaction_ws.onclose=function(){return console.log("transaction websocket closed")}}}(this),quanto.get_server({success_callback:t,failure_callback:this.show_loading_error,task_id:$("#data_backtest_id").val()})):void 0},t.prototype.populate_risk_metrics=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g;quanto.received_metrics=t,$("#risk-metrics-container table tbody tr").remove(),l=Handlebars.compile("<tr><td class='date'>{{date}}</td><td class='text-right'>{{{one_month}}}</td><td class='text-right'>{{{three_month}}}</td><td class='text-right'>{{{six_month}}}</td><td class='text-right'>{{{twelve_month}}}</td></tr>");for(s in t)if(d=t[s],n=$("#risk-metrics-container table[data-riskmetric='"+s+"']"),null!=n)for(u=_.keys(d).sort(),h=0,p=u.length;p>h;h++){if(r=u[h],i=d[r],this.is_percentage_field(s)){f=quanto.risk_window_sizes;for(a in f)o=f[a],c=quanto.pick_property(i,a,o),null!=c&&(i[o]=Math.floor(1e4*c)/100+"%")}else{m=quanto.risk_window_sizes;for(a in m)o=m[a],c=quanto.pick_property(i,a,o),null!=c&&(i[o]=Math.floor(1e4*c)/1e4)}g=quanto.risk_window_sizes;for(a in g)o=g[a],c=quanto.pick_property(i,a,o),null==c&&(i[o]="<span class='gray small'>N/A</span>");i.date=this.translate_date_string(r),e=l(i),n.find("tbody").append(e)}return $("#risk-metrics-container").show()},t.prototype.translate_date_string=function(t){var e,n,i;return n=t.split("-"),i=parseInt(n[0],10),e=parseInt(n[1],10),""+quanto.date.months_list[e-1]+" "+n[0]},t.prototype.update_grouping_label=function(){var t,e,n,i;if(null!=quanto.chart){if(n=quanto.chart.series[0].currentDataGrouping,null!=n){if(quanto.chart.series.length>=2&&"PL"===quanto.chart.series[2].name&&!this.artifacts_cleaned&&(i=$($("g.highcharts-series")[2]).find("rect").length,t=quanto.chart.series[2].groupedData.length,e=i-t,e>0&&(console.log("deleting "+e+" artifacts"),$($("g.highcharts-series")[2]).find("rect:lt("+e+")").remove(),this.artifacts_cleaned=!0)),"week"===n.unitName)return $("#daily-returns-label").html("Weekly returns"),void 0;if("month"===n.unitName)return $("#daily-returns-label").html("Monthly returns"),void 0}return $("#daily-returns-label").html("Daily returns"),0}},t.prototype.update_perf_chart_labels=function(){var t,e,n,i,r,o,a,s;if(null!=quanto.chart&&null!=quanto.chart.series&&quanto.chart.series.length>2){if(a=quanto.chart.series[0].points,null==a||a.length<=2||!a[0])return;if(s=a[0].y,o=_.last(a).y,n=quanto.chart.series[1].points,null==n||n.length<2)return;return i=n[0].y,e=_.last(n).y,r=o-s,t=e-i,quanto.instances.backtest_mgr.display_perf_chart_values(r,t)}},t.prototype.display_perf_chart_values=function(t,e){var n,i;return null==t?$("#performance-value").html(""):(i=Math.floor(1e4*t)/100,$("#performance-value").html(""+i+"%"),0>i?$("#performance-value").addClass("negative"):$("#performance-value").removeClass("negative")),null==e?$("#benchmark-value").html(""):(n=Math.floor(1e4*e)/100,$("#benchmark-value").html(""+n+"%"),0>n?$("#benchmark-value").addClass("negative"):$("#benchmark-value").removeClass("negative"))},t.prototype.display_custom_chart_values=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push($("#custom-series-legend .payload .chart-value[data-key='"+e.series.name+"']").html(Math.round(100*e.y)/100));return r},t.prototype.initialize_chart=function(t){var e,n,i;return null==t&&(t=!1),i={global:{useUTC:!0},chart:{renderTo:"chart-container",alignTicks:!0},credits:{enabled:!1},scrollbar:{liveRedraw:!1},navigator:{series:{color:"transparent",lineWidth:0},height:20,maskFill:"rgba(180, 198, 220, 0.75)",xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"}}},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{type:"area",name:"Returns",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,color:"#4572A7",fillOpacity:.2},{type:"line",name:"Benchmark",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,lineWidth:1,color:"#aa4643"},{type:"column",name:"PL",data:[],dataGrouping:quanto.global_grouping_column_options,color:"#4572A7",yAxis:1},{type:"column",name:"positive_transactions",data:[],dataGrouping:quanto.global_grouping_column_options,color:"#4572A7",fillOpacity:.2,yAxis:2},{type:"column",name:"negative_transactions",data:[],dataGrouping:quanto.global_grouping_column_options,color:"#9f5049",fillOpacity:.2,yAxis:2}],yAxis:[{title:{text:null},height:150,offset:0,labels:{formatter:function(){return 100*this.value+"%"}},minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}]},{title:{text:null},height:100,top:210,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}]},{title:{text:null},height:100,top:335,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}]}],xAxis:{ordinal:!1,dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray",events:{setExtremes:function(){return function(){return null!=quanto.instances.backtest_mgr?(setTimeout(quanto.instances.backtest_mgr.update_grouping_label,100),setTimeout(quanto.instances.backtest_mgr.update_perf_chart_labels,100)):void 0}}(this)}},plotOptions:quanto.global_plotOptions,tooltip:{hideCallback:function(){var t,e,n;return null!=(null!=(t=quanto.chart)?t.hoverPoints:void 0)&&$.each(quanto.chart.hoverPoints,function(t,e){return e.setState("")}),(null!=(e=quanto.instances.backtest_mgr)?e.tooltips_dirty:void 0)&&($("#date-chart-label").html("").hide(),$("#daily-returns-value").html(""),$("#transactions-value").html(""),quanto.instances.backtest_mgr.update_perf_chart_labels(),quanto.instances.backtest_mgr.tooltips_dirty=!1),(null!=(n=quanto.instances.backtest_mgr)?n.showing_custom_series:void 0)?$("#custom-series-legend .payload .chart-value").html(""):void 0},formatter:function(){var t,e,n,i,r,o,a,s,l,u,c,d,h,p,_,f,m;for(quanto.instances.backtest_mgr.tooltips_dirty=!0,a=null,t=null,s=null,e=null,u=null,i=[],_=this.points,h=0,p=_.length;p>h;h++)l=_[h],d=l.series.name,"End"!==d&&("Returns"===d?a=l.y:"Benchmark"===d?t=l.y:"PL"===d?s=new Number(l.y):"positive_transactions"===d?e=new Number(l.y):"negative_transactions"===d?u=new Number(l.y):i.push(l));return null!=(f=quanto.instances.backtest_mgr)&&f.display_perf_chart_values(a,t),null!=s?0>s?$("#daily-returns-value").html("("+(-1*s).toMoney(0)+")").addClass("negative"):$("#daily-returns-value").html(""+s.toMoney(0)).removeClass("negative"):$("#daily-returns-value").html("$0").removeClass("negative"),null==e||null==u||0===e&&0===u?$("#transactions-value").html("(none)"):(n=e>0?""+e.toMoney(0)+" bought":"",0>u?(c=""+u.toMoney(0)+" sold",e>0&&(n+=", ")):c="",$("#transactions-value").html(""+n+c)),i.length>0&&null!=(m=quanto.instances.backtest_mgr)&&m.display_custom_chart_values(i),o=this.points[0].series.currentDataGrouping,r=null!=o&&"week"===(null!=o?o.unitName:void 0)?"Week of "+quanto.date.format_date("%b %e, %Y",new Date(this.x)):null!=o&&"month"===(null!=o?o.unitName:void 0)?quanto.date.format_date("%B %Y",new Date(this.x)):quanto.date.format_date("%b %e, %Y",new Date(this.x)),$("#date-chart-label").html(r).show(),!1}}},t&&(n={title:{text:null},height:100,top:210,opposite:!0,lineWidth:2,startOnTick:!0,endOnTick:!0,minPadding:.05,maxPadding:.05,forceTickRecalculate:!0,plotLines:[{value:0,color:"black",width:2}]},i.yAxis=[i.yAxis[0],n,i.yAxis[1],i.yAxis[2]],i.yAxis[2].top+=125,i.yAxis[3].top+=125,i.series[2].yAxis=2,i.series[3].yAxis=3,i.series[4].yAxis=3),quanto.chart=new Highcharts.StockChart(i),e=parseInt($("#data_backtest_end_date_ms").val()),isNaN(e)||quanto.chart.addSeries({name:"End",data:[[e,0]]}),this.zoom_data=[{type:"week",count:1,text:"Week"},{type:"month",count:1,text:"Month"},{type:"all",count:1,text:"All"}],$(".chart-buttons .btn").bind("click",function(t){return function(e){var n,i;return n=$(e.currentTarget),i=parseInt(n.data("zoom")),null==i||isNaN(i)?void 0:quanto.chart.rangeSelector.clickButton(i,t.zoom_data[i],!0)}}(this)),$(window).resize(this.resize_chart)},t.prototype.resize_chart=function(){var t,e,n,i;return $("#chart-container").is(":visible")&&(e=$("#chart-container").width(),t=$("#chart-container").height(),null==quanto.chart||quanto.chart.chartWidth===e&&quanto.chart.chartHeight===t||quanto.chart.setSize(e,t)),null!=(n=this.position_viz_mgr)&&n.resize_canvas(),null!=(i=this.transactions_viz_mgr)?i.resize_canvas():void 0},t.prototype.reset_progress_pane=function(){return $("#backtest-state-label").html("Initializing..."),$("#inprogress-backtest-pane").find(".start-time").hide(),this.update_progress_bar(0)},t.prototype.update_progress_bar=function(t){return $("#inprogress-backtest-pane").find(".bar").css("width",""+t+"%"),$("#inprogress-backtest-pane").find(".progress-label").html(""+t+"%")},t.prototype.disable_settings=function(){return $("#backtest-settings-container input").not("input[type=hidden]").not(".stay-enabled").attr("disabled","disabled"),$("#backtest-settings-outer-container .control-label").addClass("disabled")},t.prototype.show_done_pane=function(){return $(".backtest-status-pane").hide(),$("#done-backtest-pane").show()},t.prototype.show_progress_pane=function(){return $(".backtest-status-pane").hide(),$("#inprogress-backtest-pane").show()},t.prototype.is_percentage_field=function(t){return null!=this.percentage_fields[t]||_.keys(this.percentage_fields).indexOf(t)>=0},t.prototype.populate_backtest_display_fields=function(){var t,e,n,i,r,o,a,s,l,u,c,d;return $(".backtest-index-display").html($("#title-box").data("backtest-number")),$(".algo-title-display").html(quanto.escapeHTML($("#data_algo_title").val())),s=new Date(parseInt($("#data_backtest_start_date_ms").val())),s=quanto.date.adjust_date_for_UTC(s),l=quanto.date.format_date("%Y-%m-%d",s),n=new Date(parseInt($("#data_backtest_end_date_ms").val())),n=quanto.date.adjust_date_for_UTC(n),i=quanto.date.format_date("%Y-%m-%d",n),$(".backtest_start_date_display").html(l),$(".backtest_end_date_display").html(i),t=parseInt($("#data_backtest_capital_base").val()),e=new Number(t).toMoney(0),$(".backtest_capitalbase_display").html(""+e),d=$("#data_backtest_started_at_ms").val(),null!=d&&d.length>0?(u=new Date(parseInt($("#data_backtest_started_at_ms").val())),c=quanto.date.format_date("%Y-%m-%d %I:%M:%S %p",u)):c="N/A",a=$("#data_backtest_finished_at_ms").val(),null!=a&&a.length>0?(r=new Date(parseInt(a)),o=quanto.date.format_date("%Y-%m-%d %I:%M:%S %p",r)):o="N/A",$(".backtest_finished_at_display").html(o),$(".backtest_started_at_display").html(c)},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BacktestTableManager=t=function(){function t(t,n){this.create_text_filter=e(this.create_text_filter,this),this.create_ticker_filter=e(this.create_ticker_filter,this),this.create_money_filter=e(this.create_money_filter,this),this.create_number_filter=e(this.create_number_filter,this),this.create_date_filter=e(this.create_date_filter,this),this.format_total=e(this.format_total,this),this.format_money=e(this.format_money,this),this.format_number=e(this.format_number,this),this.format_ticker=e(this.format_ticker,this),this.update_sort_indicators=e(this.update_sort_indicators,this),this.get_sort_comparer=e(this.get_sort_comparer,this),this.compare_values=e(this.compare_values,this),this.remove_grouping=e(this.remove_grouping,this),this.group_by_day=e(this.group_by_day,this),this.get_group_comparer=e(this.get_group_comparer,this),this.get_row_metadata=e(this.get_row_metadata,this),this.include_row=e(this.include_row,this),this.handle_group_clicked=e(this.handle_group_clicked,this),this.handle_header_cell_rendered=e(this.handle_header_cell_rendered,this),this.handle_sort_changed=e(this.handle_sort_changed,this),this.handle_filter_changed=e(this.handle_filter_changed,this),this.apply_filters=e(this.apply_filters,this),this.handle_group_button_clicked=e(this.handle_group_button_clicked,this),this.render_slick_grid=e(this.render_slick_grid,this),this.handle_all_rows_received=e(this.handle_all_rows_received,this),this.resize_canvas=e(this.resize_canvas,this),this.handle_row_data=e(this.handle_row_data,this),this.group_by_day_internal=e(this.group_by_day_internal,this),this.get_columns=e(this.get_columns,this),this.format_date=e(this.format_date,this),this.format_group_row=e(this.format_group_row,this);var i,r,o,a,s,l,u,c;for(this.$tab_elem=t,this.tab_id=n,this.$slick_grid_elem=this.$tab_elem.find(".backtest-info-table"),this.$toggle_enabled_elems=this.$tab_elem.find(".show-when-grouped"),this.is_daily="daily"===$("#data_backtest_data_frequency").val(),this.columns=this.get_columns(),this.row_data=[],this.row_count=0,this.sid_info_list={},this.missing_sid_list={},this.filters=[],this.is_grouped=!0,this.sort_field="ticker",this.sort_ascending=!0,c=this.columns,s=l=0,u=c.length;u>l;s=++l)i=c[s],i.id=i.field,i.cssClass=""+i.field+"-column",i.headerCssClass=""+i.field+"-header",s===this.columns.length-1&&(i.headerCssClass+=" right-most-header"),i.sortable=!0,a=this["format_"+i.type],null!=a&&(i.formatter=a),o=this["create_"+i.type+"_filter"],null!=o&&(r=o(i.field),this.filters.push(r)),null!=i.showTotal&&i.showTotal&&(i.groupTotalsFormatter=this.format_total)}return t.prototype.destroy=function(){return this.row_data=[],this.filters=[]},t.prototype.format_group_row=function(){throw new Error("not implemented!")},t.prototype.format_date=function(){throw new Error("not implemented!")},t.prototype.get_columns=function(){throw new Error("not implemented!")},t.prototype.group_by_day_internal=function(){throw new Error("not implemented!")},t.prototype.handle_row_data=function(t){var e,n,i,r,o,a;for(a=this.filters,r=0,o=a.length;o>r;r++)e=a[r],e.handle_row_data(t);return t.id="row_"+this.row_count,this.row_data.push(t),this.row_count++,null!=t.sid&&"Cash"!==t.sid?(n=t.sid,i=this.sid_info_list[t.sid],null!=i?t.ticker=i.ticker:quanto.sid_cache.has_sid(n)?(i=quanto.sid_cache.get_info_from_sid(n),this.sid_info_list[n]=i,t.ticker=i.ticker):(null==this.missing_sid_list[n]&&(this.missing_sid_list[n]=[]),this.missing_sid_list[n].push(t))):void 0},t.prototype.resize_canvas=function(){var t;return null!=(t=this.slick_grid)?t.resizeCanvas():void 0},t.prototype.handle_all_rows_received=function(){var t,e,n;return null==this.row_data||0===this.row_data.length?(this.$tab_elem.find(".no-rows-msg").show(),this.$tab_elem.find(".loading-msg").hide(),void 0):(this.is_daily&&this.$slick_grid_elem.addClass("daily"),this.$tab_elem.find(".clear-filters").click(function(t){return function(){var e,n,i,r,o;for(o=t.filters,i=0,r=o.length;r>i;i++)n=o[i],n.is_active()&&n.reset_filter();return e=t.$tab_elem.find(".slick-header-column .filter-button"),e.removeClass("filter-active"),t.$tab_elem.find(".clear-filters").hide(),t.apply_filters()}}(this)),$('a[data-toggle="tab"]').on("shown",function(t){return function(e){var n;return t.tab_visible=e.target.id===""+t.tab_id+"-tab",t.tab_visible?null!=(n=t.slick_grid)?n.resizeCanvas():void 0:void 0}}(this)),this.$grouping_button=this.$tab_elem.find(".group-by-day"),this.$grouping_button.button(),this.$grouping_button.click(this.handle_group_button_clicked),e=_.keys(this.missing_sid_list),e.length>0?(n=function(t){return function(){var e,n,i,r,o,a,s;s=t.missing_sid_list;for(i in s)for(n=s[i],r=quanto.sid_cache.get_info_from_sid(i),t.sid_info_list[i]=r,o=0,a=n.length;a>o;o++)e=n[o],e.ticker=r.ticker;return t.render_slick_grid()}}(this),t=function(){return function(){return console.log("Error retrieving sids for positions grid")}}(this),quanto.sid_cache.fetch_full_info(e,n,t)):this.render_slick_grid())},t.prototype.render_slick_grid=function(){var t,e,n,i,r,o,a,s;for(this.$tab_elem.find(".table-container").show(),this.$tab_elem.find(".loading-msg").hide(),this.$tab_elem.find(".expand-all-link").click(function(t){return function(){return t.data_view.expandAllGroups(),!1}}(this)),this.$tab_elem.find(".collapse-all-link").click(function(t){return function(){return t.data_view.collapseAllGroups(),!1}}(this)),s=this.filters,o=0,a=s.length;a>o;o++)e=s[o],e.initialize_controls(this.sid_info_list),$(e).on("filter_changed",this.handle_filter_changed),this.filters.push(e);return n=new Slick.Data.GroupItemMetadataProvider({groupFormatter:this.format_group_row}),this.data_view=new Slick.Data.DataView({groupItemMetadataProvider:n,inlineFilters:!1,enableTextSelectionOnCells:!0}),this.old_metadata_provider=this.data_view.getItemMetadata,this.data_view.getItemMetadata=this.get_row_metadata,this.groups_ascending=!0,this.data_view.beginUpdate(),this.data_view.setItems(this.row_data),this.data_view.setFilter(this.include_row),this.group_by_day_internal(),r=this.get_sort_comparer(this.sort_field,this.sort_ascending),this.data_view.sort(r,!0),this.data_view.expandAllGroups(),this.data_view.endUpdate(),i={enableCellNavigation:!0,fullWidthRows:!0,syncColumnCellResize:!0,rowHeight:32,forceFitColumns:!0,enableColumnReorder:!1},this.slick_grid=new Slick.Grid(this.$slick_grid_elem,this.data_view,this.columns,i),this.slick_grid.registerPlugin(n),this.slick_grid.setSelectionModel(new Slick.RowSelectionModel),this.update_sort_indicators(),this.slick_grid.render(),t=this.$tab_elem.find(".grid-canvas"),t.click(this.handle_group_clicked),this.slick_grid.onSort.subscribe(this.handle_sort_changed),this.slick_grid.onHeaderCellRendered.subscribe(this.handle_header_cell_rendered),this.slick_grid.setColumns(this.slick_grid.getColumns()),this.data_view.onRowCountChanged.subscribe(function(t){return function(){return t.slick_grid.updateRowCount(),t.slick_grid.render()}}(this)),this.data_view.onRowsChanged.subscribe(function(t){return function(e,n){return t.slick_grid.invalidateRows(n.rows),t.slick_grid.render()}}(this)),$(window).resize(function(t){return function(){var e;return null!=(e=t.slick_grid)?e.resizeCanvas():void 0}}(this))},t.prototype.handle_group_button_clicked=function(){return this.is_grouped=!this.$grouping_button.hasClass("active"),this.is_grouped?this.group_by_day():this.remove_grouping()},t.prototype.apply_filters=function(t){var e,n,i,r,o,a,s,l;for(a=this.filters,n=0,r=a.length;r>n;n++)e=a[n],e instanceof quanto.SliderFilter&&e!==t&&e.reset_min_max();
for(this.data_view.refresh(),s=this.filters,l=[],i=0,o=s.length;o>i;i++)e=s[i],e instanceof quanto.SliderFilter&&e!==t?l.push(e.handle_filtering_done()):l.push(void 0);return l},t.prototype.handle_filter_changed=function(t,e){var n,i,r,o,a,s;for(null==e&&(e=!0),r=!1,s=this.filters,o=0,a=s.length;a>o;o++)i=s[o],n=this.$tab_elem.find(".slick-header-column."+i.field+"-header .filter-button"),i.is_active()?(r=!0,n.addClass("filter-active")):n.removeClass("filter-active");return r?this.$tab_elem.find(".clear-filters").show():this.$tab_elem.find(".clear-filters").hide(),this.apply_filters(e?t.target:null)},t.prototype.handle_sort_changed=function(t,e){var n,i;return this.is_grouped?("date"===e.sortCol.field?(this.groups_ascending=e.sortAsc,this.is_daily||(this.sort_field=e.sortCol.field,this.sort_ascending=e.sortAsc),n=this.data_view.getGrouping()[0],null!=n&&(n.comparer=this.get_group_comparer(),this.data_view.refresh())):(this.sort_field=e.sortCol.field,this.sort_ascending=e.sortAsc),this.update_sort_indicators()):(this.sort_field=e.sortCol.field,this.sort_ascending=e.sortAsc),i=this.get_sort_comparer(this.sort_field,this.sort_ascending),this.data_view.sort(i,this.sort_ascending)},t.prototype.handle_header_cell_rendered=function(t,e){var n,i;return n=this.$tab_elem.find("."+e.column.id+"-filter"),n.length>0?(i=n.data("filter"),i.render_filter_button($(e.node),this.slick_grid)):void 0},t.prototype.handle_group_clicked=function(t){var e,n,i,r;return n=$(t.target),i=n.closest(".slick-group"),i.length>0&&(e=i.find(".group-row-cell:first"),e.length>0)?(r=this.data_view.getItem(e.data("row")),0===(null!=r?r.collapsed:void 0)?this.data_view.collapseGroup(r.groupingKey):this.data_view.expandGroup(r.groupingKey),!1):void 0},t.prototype.include_row=function(t){var e,n,i,r,o,a,s;for(t.include=!0,t.excluded_by={},a=this.filters,n=0,r=a.length;r>n;n++)e=a[n],e.include_item(t)||(t.include=!1,t.excluded_by[e.field]=!0);for(s=this.filters,i=0,o=s.length;o>i;i++)e=s[i],e instanceof quanto.SliderFilter&&e.update_min_max(t);return t.include},t.prototype.get_row_metadata=function(t){var e,n;return e=this.data_view.getItem(t),n=this.old_metadata_provider(t),n=null!=n?n:{},n.cssClasses=null!=n.cssClasses?n.cssClasses:"",e.__group&&(e.collapsed||(n.cssClasses+=" expanded")),n},t.prototype.get_group_comparer=function(){return function(t){return function(e,n){var i,r;return i=new Date(e.value),r=new Date(n.value),quanto.date.are_same_date(i,r)?0:t.groups_ascending?i>r?1:-1:r>i?1:-1}}(this)},t.prototype.group_by_day=function(){var t;return this.is_grouped=!0,this.data_view.beginUpdate(),this.group_by_day_internal(),("ticker"===this.sort_field||"date"===this.sort_field)&&("date"===this.sort_field&&(this.sort_field="ticker",this.sort_ascending=!0,this.groups_ascending=this.sort_ascending),t=this.get_sort_comparer(this.sort_field,this.sort_ascending),this.data_view.sort(t,this.sort_ascending)),this.update_sort_indicators(),this.data_view.endUpdate(),this.slick_grid.invalidateAllRows(),this.slick_grid.render(),this.$toggle_enabled_elems.removeClass("disabled"),this.$slick_grid_elem.removeClass("ungrouped")},t.prototype.remove_grouping=function(){var t;return this.is_grouped=!1,this.data_view.beginUpdate(),this.data_view.setGrouping([]),"ticker"===this.sort_field?(t=this.get_sort_comparer("date",this.groups_ascending),this.data_view.sort(t,this.groups_ascending),this.slick_grid.setSortColumn("date",this.groups_ascending)):(t=this.get_sort_comparer(this.sort_field,this.sort_ascending),this.data_view.sort(t,this.sort_ascending),this.slick_grid.setSortColumn(this.sort_field,this.sort_ascending)),this.data_view.endUpdate(),this.slick_grid.invalidateAllRows(),this.slick_grid.render(),this.$toggle_enabled_elems.addClass("disabled"),this.$slick_grid_elem.addClass("ungrouped")},t.prototype.compare_values=function(t,e,n){var i;return i=n?1:-1,t===e?0:t>e?i:-i},t.prototype.get_sort_comparer=function(t,e){return function(n){return function(i,r){var o,a,s,l;if(s=i[t],l=r[t],"ticker"===t||"date"===t&&s===l){if("Cash"===i.sid)return e?1:-1;if("Cash"===r.sid)return e?-1:1}return s===l?(a="ticker",o=e,"ticker"===t||i[a]===r[a]?a="date":"ticker"===n.sort_field&&(o=e?n.sort_ascending:!n.sort_ascending),n.compare_values(i[a],r[a],o)):null==s?e?1:-1:null==l?e?-1:1:s>l?1:-1}}(this)},t.prototype.update_sort_indicators=function(){var t;return t=[{columnId:"date",sortAsc:this.groups_ascending}],"date"!==this.sort_field&&t.push({columnId:this.sort_field,sortAsc:this.sort_ascending}),this.slick_grid.setSortColumns(t)},t.prototype.format_ticker=function(t,e,n,i,r){return"Cash"===r.sid?"<span class='label label-cash'>Cash</span>":"<span class='ticker'>"+n+"</span>"},t.prototype.format_number=function(t,e,n){return null==n?"<span class='number no-value'>- -</span>":"<span class='number'>"+n+"</span>"},t.prototype.format_money=function(t,e,n){return null==n?"<span class='number no-value'>- -</span>":"<span class='number'>"+quanto.safe_to_money(n)+"</span>"},t.prototype.format_total=function(t,e){var n,i;return n=null!=(i=t.sum)?i[e.field]:void 0,null!==n?"<span class='number'><span class='total'>total:</span>"+quanto.safe_to_money(n)+"</span>":"<span class='number no-value'>- -</span>"},t.prototype.create_date_filter=function(t){return this.date_filter=new quanto.DateFilter(this.$tab_elem,t,quanto.safe_to_money),this.date_filter},t.prototype.create_number_filter=function(t){return new quanto.SliderFilter(this.$tab_elem,t)},t.prototype.create_money_filter=function(t){return new quanto.SliderFilter(this.$tab_elem,t,quanto.safe_to_money)},t.prototype.create_ticker_filter=function(t){return this.ticker_filter=new quanto.SecurityFilter(this.$tab_elem,t),this.ticker_filter},t.prototype.create_text_filter=function(t){return new quanto.TextFilter(this.$tab_elem,t)},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BacktestPaneManager=t=function(){function t(){this.handle_delete_clicked=e(this.handle_delete_clicked,this),quanto.on_click("#new-backtest-button",function(){return function(){var t;return t=$("#algo-id").val(),window.location="/algorithms/"+t+"/new_backtest"}}(this)),quanto.on_click("#manage-backtests-button",function(t){return function(){return t.manage_backtests_clicked()}}(this)),quanto.on_click("#backtest-feed-table td:not('.checkbox')",function(){return function(t){var e,n,i;return e=$(t.currentTarget),e.hasClass("empty")?void 0:(i=e.closest("tr").data("backtest-id"),n=$("#algo-id").val(),null!=i?window.location="/algorithms/"+n+"/"+i:void 0)}}(this)),$(document).bind("checkbox_count_changed",function(){return function(){var t;return t=quanto.get_selected_rows($("#backtest-feed-table")).length,2===t?$(".diff-button").removeClass("disabled"):$(".diff-button").addClass("disabled")}}(this)),quanto.register_remote_event("fullBacktestsChanged",function(t){return function(){return t.manage_backtests_clicked(!0)}}(this)),quanto.on_click("#backtest-delete-button",function(t){return function(e){return t.handle_delete_clicked(e)}}(this)),this.$feed_container=$("#backtest-feed-container"),this.$atomic_container=$("#backtest-atomic-container"),quanto.on_click("#view-algorithm-button",function(){return $("#algo-problem-modal").modal("hide"),$(document).trigger("change_pane",["algorithm"]),$(document).trigger("maybe_validate_algo")})}return t.prototype.handle_delete_clicked=function(){var t,e,n,i;if(t=quanto.get_selected_rows($("#backtest-feed-table")),e=$.map(t,function(){return function(t){return $(t).data("backtest-id")}}(this)),e.length>0){if(i="backtest",e.length>1&&(i="backtests"),!confirm("Delete "+e.length+" "+i+"?"))return;return n={algo_id:$("#algo-id").val(),backtest_ids:e},quanto.trigger_remote_event({type:"fullBacktestsChanged"}),$.post("/backtests/delete_backtests",n,function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:alert("There was a problem deleting the backtests.")}}(this))}},t.prototype.init_backtest_manager=function(){return this.initialize_ui(),quanto.instances.backtest_mgr=new quanto.BacktestManager,this.$feed_container.hide(),this.$atomic_container.show()},t.prototype.manage_backtests_clicked=function(t){var e;return null==t&&(t=!1),null!=quanto.instances.backtest_mgr&&(quanto.instances.backtest_mgr.shutdown(),quanto.instances.backtest_mgr=null),e={algo_id:$("#algo-id").val()},$.getJSON("/backtests/feed_ui",e,function(e){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()&&(e.$feed_container.html(i.html()),e.$feed_container.show(),e.$atomic_container.html(""),e.$atomic_container.hide(),$("#manage-backtests-button").addClass("hidden"),quanto.enable_checkbox_tables(),$(".date-field").each(function(t,e){var n;return n=$(e),n.html(quanto.date.format_date(n.data("format"),new Date(n.data("value"))))}),!t)?quanto.show_footer():void 0}}(this))},t.prototype.initialize_ui=function(){var t;return t={dayNamesMin:quanto.date.get_datepicker_daynames(),prevText:"",nextText:"",minDate:quanto.date.get_backtest_min_date(),maxDate:quanto.date.get_backtest_max_date(),onClose:function(t,e){var n,i,r,o,a;return n=new Date(t),r=n.getDate(),o=n.getMonth()+1,a=n.getFullYear(),i=$("#"+e.id).data("datetype"),null!=i?($("#"+i+"_day").val(r),$("#"+i+"_month").val(o),$("#"+i+"_year").val(a)):void 0}},$(".datepicker").not(".ignore").each(function(){return function(e,n){var i;return i=_.extend({},t),$(n).datepicker(i)}}(this)),$(".has-tooltip").attr("rel","tooltip").tooltip(),$("input[type='number']").blur(function(){var t,e,n,i;return t=$(this),i=t.val(),isNaN(i)?null!=t.attr("default")?t.val(t.attr("default")):void 0:(n=parseInt(t.attr("min")),e=parseInt(t.attr("max")),!isNaN(n)&&n>i?t.val(n):!isNaN(e)&&i>e?t.val(e):t.val(i))}),quanto.showing_logs=!1},t}()}.call(this),function(){var t,e,n,i=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BreakpointManager=n=function(){function n(){this.can_set_breakpoint=i(this.can_set_breakpoint,this),this.toggle_breakpoint=i(this.toggle_breakpoint,this),this.load_existing_breakpoints=i(this.load_existing_breakpoints,this),this.disable_breakpoints=i(this.disable_breakpoints,this),this.show_conditional_breakpoint_modal=i(this.show_conditional_breakpoint_modal,this),this.save_breakpoint_condition=i(this.save_breakpoint_condition,this),this.setup_modal=i(this.setup_modal,this),this.add_breakpoint=i(this.add_breakpoint,this),this.has_breakpoints=i(this.has_breakpoints,this),this.get_breakpoints_info=i(this.get_breakpoints_info,this),this.initialize_events=i(this.initialize_events,this),this.breakpoints=new e,this.clicked_breakpoint_id=null,this.load_existing_breakpoints(),this.setup_modal(),this.initialize_events(),document.oncontextmenu=function(t){return $(t.target)[0].className.indexOf("CodeMirror-linenumber")>=0?(t.stopPropagation(),!1):void 0}}return n.prototype.initialize_events=function(){var t;return null!=(t=quanto.editor)&&t.on("gutterClick",function(t){return function(e,n,i,r){var o,a;if(r.ctrlKey||3===r.which){if(a=quanto.editor.getLineHandle(n),o=$(quanto.get_src_element(r)),null!=o.data("breakpoint-id"))t.clicked_breakpoint_id=o.data("breakpoint-id");else{if(null==a.breakpoint_id)return;t.clicked_breakpoint_id=a.breakpoint_id,o.data("breakpoint-id",t.clicked_breakpoint_id)}return o=$(quanto.get_src_element(r)),o.contextmenu({target:"#breakpoint-context-menu",no_automatic:!0}),o.contextmenu("show",r),!1}return t.toggle_breakpoint(e,n,i,r)}}(this)),$(document).on("mouseover",".cm-breakpoint-conditional .CodeMirror-linenumber",function(t){return function(e){var n,i,r,o,a,s;return n=$(quanto.get_src_element(e)),a=parseInt(n.html()),isNaN(a)||(o=quanto.editor.getLineHandle(a-1),r=o.breakpoint_id,null==r)?void 0:(i=t.breakpoints.get_breakpoint(r),s=$.fn.textWidth(i.condition)+40,n.tooltip({title:i.condition,placement:"right",trigger:"hover",template:"<div class='tooltip' style='width:"+s+"px !important'><div class='tooltip-arrow'></div><div class='tooltip-inner'></div></div>"}),n.tooltip("show"))}}(this)),$(document).on("mouseout",".cm-breakpoint-conditional .CodeMirror-linenumber",function(){return function(t){var e;return e=$(quanto.get_src_element(t)),e.tooltip("destroy")}}(this)),$(document).bind("ide_backtest_done",function(){return function(){return $(".breakpoint-marker").removeClass("disabled")}}(this)),$(".edit-breakpoint-link").click(function(t){return function(){return t.show_conditional_breakpoint_modal()}}(this)),$(".remove-breakpoint-link").click(function(t){return function(){var e;return null!=t.clicked_breakpoint_id&&(e=t.breakpoints.get_breakpoint(t.clicked_breakpoint_id),null!=e)?t.breakpoints.remove_breakpoint(e):void 0}}(this)),quanto.register_remote_event("add_breakpoint_remote",function(t){return function(e){return t.add_breakpoint(e.data,!1)}}(this)),quanto.register_remote_event("remove_breakpoint_remote",function(t){return function(e){var n,i;return i=e.data.id,n=t.breakpoints.get_breakpoint(i),null!=n?t.breakpoints.remove_breakpoint(n,!1):void 0}}(this)),quanto.register_remote_event("modify_breakpoint_remote",function(t){return function(e){var n,i;return i=e.data.uuid,n=t.breakpoints.get_breakpoint(i),null!=n?n.set_condition(e.data.condition,!1):void 0}}(this))},n.prototype.get_breakpoints_info=function(){return this.breakpoints.get_all_breakpoints()},n.prototype.has_breakpoints=function(){return this.get_breakpoints_info().length>0},n.prototype.add_breakpoint=function(e,n){var i,r,o;return null==n&&(n=!0),o=e.line,r=e.condition,null!=o?(i=new t(e.line,e.condition,e.uuid,n),this.breakpoints.add_breakpoint(i),quanto.track_mixpanel("add_breakpoint")):void 0},n.prototype.setup_modal=function(){return this.$conditional_modal=$("#conditional-breakpoint-modal"),this.$conditional_input_box=this.$conditional_modal.find(".breakpoint-condition-box"),this.$conditional_input_box.keydown(function(t){return function(e){return 13===e.keyCode?t.save_breakpoint_condition():void 0}}(this)),this.$conditional_modal.find(".save-breakpoint").click(function(t){return function(){return t.save_breakpoint_condition()}}(this))},n.prototype.save_breakpoint_condition=function(){var t,e;return e=$.trim(this.$conditional_input_box.val()),t=this.breakpoints.get_breakpoint(this.clicked_breakpoint_id),null!=t?(t.set_condition(e),this.$conditional_modal.modal("hide"),quanto.track_mixpanel("set_breakpoint_condition")):void 0},n.prototype.show_conditional_breakpoint_modal=function(){var t,e;if(null!=this.clicked_breakpoint_id&&(t=this.breakpoints.get_breakpoint(this.clicked_breakpoint_id),null!=t))return e=t.condition||"",this.$conditional_input_box.val(e),this.$conditional_modal.modal("show"),setTimeout(function(t){return function(){return t.$conditional_input_box.focus()}}(this),20)},n.prototype.disable_breakpoints=function(){return $(".breakpoint-marker").addClass("disabled")},n.prototype.load_existing_breakpoints=function(t){var e,n,i,r;if(null==t&&(t=null),t||(t=quanto_data.breakpoints_info),null!=t){for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this.add_breakpoint(e,!1));return r}},n.prototype.toggle_breakpoint=function(t,e,n,i){var r,o,a,s,l,u,c;if(!(1!==i.which||1===i.which&&i.ctrlKey)&&(l=t.lineInfo(e),s=quanto.instances.dbm.ws_active()?quanto.instances.dbm.at_a_breakpoint():!0,s&&(r=$(quanto.get_src_element(i)).closest(".CodeMirror-gutter-elt"),c=parseInt(r.html(),10)-1,!isNaN(c))))if(u=quanto.editor.getLineHandle(c),null!=u.wrapClass&&u.wrapClass.indexOf("cm-breakpoint")>=0){if(a=u.breakpoint_id,null==a)return;if(o=this.breakpoints.get_breakpoint(a),null!=o)return this.breakpoints.remove_breakpoint(o)}else if(this.can_set_breakpoint(t,l.line))return this.add_breakpoint({line:c,condition:null})},n.prototype.can_set_breakpoint=function(t,e){var n,i,r;if(i=t.getLine(e),0===$.trim(i).length)return!1;for(n=0;n<i.length;)if(r=t.getTokenTypeAt({line:e,ch:n}),n++,null!=r)return"comment"!==r&&"defkeyword"!==r;return!0},n}(),t=function(){function t(t,e,n,r){var o;null==r&&(r=!0),this.to_json=i(this.to_json,this),this.remove=i(this.remove,this),this.set_condition=i(this.set_condition,this),this.get_current_line_number=i(this.get_current_line_number,this),quanto.editor.addLineClass(t,"wrap","cm-breakpoint"),this.condition=e,this.uuid=n||quanto.generate_UUID(),null!=e&&quanto.editor.addLineClass(t,"wrap","cm-breakpoint-conditional"),quanto.editor.setLineProperty(t,"breakpoint_id",this.uuid),r&&(o=this.to_json(),$(document).trigger("add_breakpoint",o),quanto.trigger_remote_event({type:"add_breakpoint_remote",data:o}))}return t.prototype.get_current_line_number=function(){var t;return t=-1,quanto.editor.eachLine(function(e){return function(n){return n.breakpoint_id===e.uuid?(t=quanto.editor.getLineNumber(n),!0):void 0}}(this)),t},t.prototype.set_condition=function(t,e){var n,i;return null==e&&(e=!0),this.condition=t,i=this.get_current_line_number(),0===t.length?quanto.editor.removeLineClass(i,"wrap","cm-breakpoint-conditional"):quanto.editor.addLineClass(i,"wrap","cm-breakpoint-conditional"),e?(n=this.to_json(),$(document).trigger("modify_breakpoint",[n]),quanto.trigger_remote_event({type:"modify_breakpoint_remote",data:n})):void 0},t.prototype.remove=function(t){var e;return null==t&&(t=!0),e=this.get_current_line_number(),-1!==e?(quanto.editor.removeLineClass(e,"wrap","cm-breakpoint"),quanto.editor.removeLineClass(e,"wrap","cm-breakpoint-conditional"),quanto.editor.setLineProperty(e,"breakpoint_id",null),t?($(document).trigger("remove_breakpoint",e),quanto.trigger_remote_event({type:"remove_breakpoint_remote",data:{id:this.uuid,line_number:e}}),quanto.track_mixpanel("remove_breakpoint")):void 0):void 0},t.prototype.to_json=function(){var t;return t={condition:this.condition,uuid:this.uuid},t.line=this.get_current_line_number(),t},t}(),e=function(){function t(){this.remove_breakpoint=i(this.remove_breakpoint,this),this.data={}}return t.prototype.add_breakpoint=function(t){return this.data[t.uuid]=t},t.prototype.get_breakpoint=function(t){return this.data[t]},t.prototype.get_all_breakpoints=function(){var t;return t=[],quanto.editor.eachLine(function(e){return function(n){var i,r;return null!=n.breakpoint_id?(i=e.get_breakpoint(n.breakpoint_id),r=i.to_json(),t.push(r),!1):void 0}}(this)),t},t.prototype.remove_breakpoint=function(t,e){return null==e&&(e=!0),null!=t&&t.remove(e),null!=t.uuid?delete this.data[t.uuid]:void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ChatManager=t=function(){function t(t){this.set_chat_enabled=e(this.set_chat_enabled,this),this.scroll_to_bottom=e(this.scroll_to_bottom,this),this.clear_chat_count=e(this.clear_chat_count,this),this.initialize_events=e(this.initialize_events,this),this.initialize_ui=e(this.initialize_ui,this),this.add_chat_messages=e(this.add_chat_messages,this),this.add_new_chat_message=e(this.add_new_chat_message,this),this.render_messages=e(this.render_messages,this),this.load_older_messages_clicked=e(this.load_older_messages_clicked,this),this.handle_load_messages_error=e(this.handle_load_messages_error,this),this.hide_spinner=e(this.hide_spinner,this),this.show_spinner=e(this.show_spinner,this),this.load_messages=e(this.load_messages,this),this.browser_tab_selected=!0,this.starting_title="",this.unread_messages_count=0,this.room_id=t,this.user_id=$("#current_user_id").val(),this.$ide_chat_tab=$("#ide-chat-tab"),this.initialize_ui(),this.initialize_events(),this.$chat_messages_container=$("#chat-messages-list"),this.chat_template=Handlebars.compile("<div class='chat-row' data-userid='{{user_id}}'><table><tbody><tr><td class='chat-name'><span class='chat-name-label'>{{name}}</span></td><td class='chat-content'><p class='chat-time quanto-date' UTCms='{{utcms}}' data-format='chat'></p><p class='chat-message'>{{text}}</p></td></tr></tbody></table></div>"),this.$load_more_messages=$("#load-older-messages"),this.first_load=!0}return t.prototype.load_messages=function(t,e){var n;return null==t&&(t=null),null==e&&(e=null),n={},null!=t&&!isNaN(t)&&t>0&&(n.end_date=t),this.show_spinner(),$.get("/algorithms/"+this.room_id+"/chat_messages",n,function(t){return function(n){var i;return t.hide_spinner(),i=new quanto.JsonResponse(n),i.ok()&&null!=i.data().messages?(t.add_chat_messages(i.data().messages),(i.data().more||"true"===i.data().more)&&($("#chat-messages-list").prepend(t.$load_more_messages),t.$load_more_messages.removeClass("hidden"),t.first_load&&(t.$load_more_messages.find("span").html("Load older messages"),t.first_load=!1)),null!=e?e():void 0):t.handle_load_messages_error()}}(this)).error(function(t){return function(){return t.handle_load_messages_error()}}(this))},t.prototype.show_spinner=function(){return this.$load_more_messages.find("i").removeClass("icon-chevron-up").addClass("icon-spin icon-spinner")},t.prototype.hide_spinner=function(){return this.$load_more_messages.find("i").removeClass("icon-spin icon-spinner").addClass("icon-chevron-up")},t.prototype.handle_load_messages_error=function(){return this.hide_spinner(),quanto.show_error_popup()},t.prototype.load_older_messages_clicked=function(){var t,e;return $(".load-anchor").removeClass("load-anchor"),t=$("#chat-messages-list .chat-row").first(),t.addClass("load-anchor"),e=t.find(".quanto-date").attr("utcms"),this.load_messages(e,function(e){return function(){return e.$chat_messages_container.scrollTop(e.$chat_messages_container.scrollTop()+t.offset().top-e.$chat_messages_container.offset().top-27)}}(this))},t.prototype.render_messages=function(t){var e,n,i,r,o,a;for(i="",o=0,a=t.length;a>o;o++)r=t[o],null!=r.is_self&&r.is_self&&(r.user_id=this.user_id),i+=this.chat_template(r);return e=$(i),n=$("<div></div>"),n.append(e),n.find(".chat-row[data-userid='"+this.user_id+"']").addClass("self"),$.fn&&$.fn.linkify&&n.find(".chat-message").linkify(),quanto.date.render_date_value(n.find(".quanto-date")),n.find(".chat-row").unwrap()},t.prototype.add_new_chat_message=function(t){var e,n,i;return e=this.render_messages([t]),n=$("#chat-messages-list")[0],i=Math.abs(n.scrollTop-(n.scrollHeight-n.offsetHeight))<5,$("#chat-messages-list").append(e),t.user_id===this.user_id||i?this.scroll_to_bottom():void 0},t.prototype.add_chat_messages=function(t,e){var n;return null==e&&(e=!1),this.$load_more_messages.detach(),n=this.render_messages(t),$("#chat-messages-list").prepend(n)},t.prototype.initialize_ui=function(){return this.$chatbox=$("#new-message-textarea"),this.$chatbox.on("keydown",function(t){return function(e){var n;return 13===e.keyCode&&(n=_.str.trim(t.$chatbox.val()),n.length>0)?(e.preventDefault(),TogetherJS.require("chat").submit(n),setTimeout(function(){return t.$chatbox.val("").focus()},50),!1):void 0}}(this))},t.prototype.initialize_events=function(){var t,e;return $(document).bind("sync-ready",function(t){return function(){return $("#chat-window-link").removeClass("hidden"),t.load_messages(null,function(){return t.scroll_to_bottom()})}}(this)),$(document).bind("new_chat_message",function(t){return function(e,n){var i;return t.add_new_chat_message(n),i="algo"===quanto.instances.lm.visible_pane,t.browser_tab_selected&&i&&t.$ide_chat_tab.hasClass("active")?void 0:(t.unread_messages_count+=1,""===t.starting_title&&(t.starting_title=document.title),document.title="("+t.unread_messages_count+") "+t.starting_title,$(".chat-count .comment-count").html(t.unread_messages_count),$(".chat-count").removeClass("hidden"))}}(this)),null!=document.hidden?(t="hidden",e="visibilitychange"):null!=document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):null!=document.msHidden?(t="msHidden",e="msvisibilitychange"):null!=document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),$(document).bind(e,function(e){return function(){return document[t]?e.browser_tab_selected=!1:(e.browser_tab_selected=!0,e.$ide_chat_tab.hasClass("active")&&"algo"===quanto.instances.lm.visible_pane?e.clear_chat_count():void 0)}}(this)),$("#algo-button").click(function(t){return function(){return t.$ide_chat_tab.hasClass("active")?t.clear_chat_count():void 0}}(this)),$("#ide-chat-link").on("shown",function(t){return function(){return t.clear_chat_count(),$("#ide-chat-link").hasClass("shown-once")||t.scroll_to_bottom(),$("#ide-chat-link").addClass("shown-once"),setTimeout(function(){return t.$chatbox.focus()},10)}}(this)),$(".load-older-messages-link").on("click",function(t){return function(){return t.load_older_messages_clicked()}}(this))},t.prototype.clear_chat_count=function(){return this.unread_messages_count=0,$(".chat-count .comment-count").html(""),$(".chat-count").addClass("hidden"),""!==this.starting_title?(document.title=this.starting_title,this.starting_title=""):void 0},t.prototype.scroll_to_bottom=function(){return $(".messages-list .chat-row").last().scrollintoview({duration:1})},t.prototype.set_chat_enabled=function(t){return t?this.$chatbox.attr("disabled",!1):this.$chatbox.attr("disabled","disabled")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.CollaborationModalManager=t=function(){function t(){this.toggle_adding_ui=e(this.toggle_adding_ui,this),this.toggle_remove_ui=e(this.toggle_remove_ui,this),this.remove_collaborator=e(this.remove_collaborator,this),this.show_invalid_email_ui=e(this.show_invalid_email_ui,this),this.add_collaborator=e(this.add_collaborator,this),this.populate_collaborators=e(this.populate_collaborators,this),this.load_collaborators=e(this.load_collaborators,this),this.clear_ui=e(this.clear_ui,this),this.algo_id=$("#algo-id").val(),this.$modal=$("#collaboration-modal"),this.$collaborator_list=this.$modal.find(".collaborator-list"),this.$no_collaborators_msg=this.$collaborator_list.find(".no-collaborators"),this.$loading_msg=this.$collaborator_list.find(".loading-msg"),this.$add_button=this.$modal.find(".add-collaborator-button"),this.$email_box=this.$modal.find(".new-collaborator-email"),this.$invite_new_user_button=this.$modal.find(".invite-new-user-button"),this.$cancel_invite_button=this.$modal.find(".cancel-invite-button"),this.$notify_user_checkbox=$("#notify-new-collab-checkbox"),this.is_owner=this.$modal.hasClass("owner"),this.collaborator_template=Handlebars.compile("<div class='collaborator-row' data-userid='{{user_id}}'> <div class='collaborator-avatar'> <img src='{{avatar_url}}'> </div> <div class='collaborator-name'> {{#if invited}} <span class='gray'>{{username}}</span> {{else}} <span>{{username}}</span> {{/if}} </div> {{#if remove}} <a class='remove-collaborator'>Remove</a> {{/if}} </div>"),this.clear_ui(),this.$modal.on("show",function(t){return function(){return t.clear_ui(),t.load_collaborators(),setTimeout(function(){return t.$email_box.focus()},100)}}(this)),this.$add_button.on("click",function(t){return function(){return t.add_collaborator()}}(this)),this.$invite_new_user_button.on("click",function(t){return function(){return t.add_collaborator(!0)}}(this)),this.$cancel_invite_button.on("click",function(t){return function(){return $(".no-such-user").addClass("hidden"),$(".add-collaborator").removeClass("hidden"),t.$add_button.removeClass("disabled"),t.$email_box.removeClass("disabled").focus()}}(this)),quanto.on_click(".collaborator-list .remove-collaborator",function(t){return function(e){var n;return n=$(quanto.get_src_element(e)),t.remove_collaborator(n)}}(this))}return t.prototype.clear_ui=function(){return this.$loading_msg.removeClass("hidden"),this.$no_collaborators_msg.addClass("hidden"),this.$collaborator_list.find(".collaborator-row").remove(),this.$notify_user_checkbox.attr("checked",!0),this.$email_box.val(""),$("#error-adding-collaborator").hide(),$(".no-such-user").addClass("hidden"),$(".add-collaborator").removeClass("hidden")},t.prototype.load_collaborators=function(){return $.get("/algorithms/"+this.algo_id+"/collaborators",{},function(t){return function(e){var n,i;return t.$loading_msg.addClass("hidden"),i=new quanto.JsonResponse(e),i.ok()?(n=i.data(),t.populate_collaborators(n)):void 0}}(this)).error(function(t){return function(){return t.$modal.modal("hide"),quanto.show_error_popup()}}(this))},t.prototype.populate_collaborators=function(t){var e,n,i,r;if(n="",0===t.length)return this.$no_collaborators_msg.removeClass("hidden"),void 0;for(this.$no_collaborators_msg.addClass("hidden"),i=0,r=t.length;r>i;i++)e=t[i],(e.user_id===$("#current_user_id").val()||this.is_owner)&&(e.remove=!0),n+=this.collaborator_template(e);return this.$collaborator_list.find(".collaborator-rows").html(n)},t.prototype.add_collaborator=function(t){var e,n,i;return null==t&&(t=!1),this.toggle_adding_ui(!0),n=this.$email_box.val(),_.isEmpty(n)?(this.toggle_adding_ui(!1),quanto.show_validation_tooltip($(".new-collaborator-email"),"Enter an email address"),void 0):(i=this.$notify_user_checkbox.is(":checked"),e={user_email:n,force:t,notify_by_email:i},$.post("/algorithms/"+this.algo_id+"/add_collaborator",e,function(t){return function(e){var i,r;return i=new quanto.JsonResponse(e),i.ok()?(t.$no_collaborators_msg.addClass("hidden"),"invalid_email"===i.data()?t.show_invalid_email_ui(n):(t.toggle_adding_ui(!1),$(".no-such-user").addClass("hidden"),$(".add-collaborator").removeClass("hidden"),r=i.data(),null!=r&&(r.remove=!0,t.$collaborator_list.find(".collaborator-rows").append(t.collaborator_template(r))),t.toggle_adding_ui(!1),"undefined"==typeof TogetherJS||null===TogetherJS||TogetherJS.running?void 0:TogetherJS())):(t.toggle_adding_ui(!1),$("#error-adding-collaborator").show())}}(this)).error(function(t){return function(){return t.toggle_adding_ui(!1),$("#error-adding-collaborator").show()}}(this)))},t.prototype.show_invalid_email_ui=function(t){return $(".invalid-email").html(quanto.escapeHTML(t)),$(".no-such-user").removeClass("hidden"),$(".add-collaborator").addClass("hidden")},t.prototype.remove_collaborator=function(t){var e,n;return e=t.closest(".collaborator-row"),0!==e.length?(n=e.data("userid"),this.toggle_remove_ui(t,!0),$.post("/algorithms/"+this.algo_id+"/remove_collaborator",{user_id_to_remove:n},function(t){return function(i){var r;return r=new quanto.JsonResponse(i),r.ok()&&(e.remove(),0===t.$collaborator_list.find(".collaborator-row").length&&t.$no_collaborators_msg.removeClass("hidden"),n===$("#current_user_id").val())?window.location="/algorithms":void 0}}(this)).error(function(e){return function(){return e.toggle_remove_ui(t,!1)}}(this))):void 0},t.prototype.toggle_remove_ui=function(t,e){return $("#error-adding-collaborator").hide(),e?t.html("Removing...").addClass("disabled"):t.html("Remove").removeClass("disabled")},t.prototype.toggle_adding_ui=function(t){return $("#error-adding-collaborator").hide(),t?(this.$add_button.addClass("disabled"),this.$email_box.addClass("disabled")):(this.$add_button.removeClass("disabled"),this.$email_box.removeClass("disabled").val("").focus())},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.CollaborationUIManager=t=function(){function t(){this.update_ui=e(this.update_ui,this),this.start_timer=e(this.start_timer,this),this.stop_timer=e(this.stop_timer,this);var t,n;this.$peer_container=$("#collaboration-outer-container"),this.peer_template=Handlebars.compile("<div class='peer-display' data-toggle='tooltip' data-title='{{name}}'><img src='{{avatar}}' width='20' height='20'><div class='collab-overlay' style='background-color:{{color}}'></div></div>"),this.last_peers_to_display=[],this.last_hash=null,$(document).bind("sync-ready",function(t){return function(){return t.start_timer()}}(this)),t=$("#initial_collab"),t.length>0&&(n=parseInt(t.val()),!isNaN(n)&&n>0&&(TogetherJS(),this.collaboration_started=!0))}return t.collaboration_started=!1,t.prototype.stop_timer=function(){return null!=this.timer?clearInterval(this.timer):void 0},t.prototype.start_timer=function(){return this.stop_timer(),this.timer=setInterval(function(t){return function(){return t.update_ui()}}(this),2e3)},t.prototype.update_ui=function(){var t,e,n,i,r,o,a;if(i=TogetherJS.require("peers").getAllPeers(),r=_.select(i,function(){return function(t){return"live"===t.status}}(this)),t=r.map(function(){return function(t){return t.id}}(this)).join("-"),this.last_hash!==t){for(e="",o=0,a=r.length;a>o;o++)n=r[o],e+=this.peer_template(n);return this.$peer_container.html(e),this.last_hash=t,$(".peer-display").tooltip()}},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ContestManager=t=function(){function t(){this.setup_nav=e(this.setup_nav,this),this.toggle_see_more_panel=e(this.toggle_see_more_panel,this);var t,n,i,r;i=40,t=1050,$(".quanto-scroll-nav").affix({offset:{top:$(".criteria-pane").offset().top+i,bottom:$(document).height()-$(".criteria-pane").offset().top+t}}),quanto.on_click(".evaluating-algo-more",function(t){return function(){return t.toggle_see_more_panel(),t.setup_nav()
}}(this)),r=window.location.href,n=r.split("#")[1],r.indexOf("#"+n)>-1&&(this.toggle_see_more_panel(),$("html,body").animate({scrollTop:$("#"+n).offset().top-55},"slow"),this.setup_nav())}return t.prototype.toggle_see_more_panel=function(){return $(".evaluating-algo-details-pane").toggleClass("hidden"),$(".evaluating-algo-details-toc").removeClass("freeze-bottom"),"More"===$(".eval-toggle").html()?$(".eval-toggle").html("Less"):$(".eval-toggle").html("More")},t.prototype.setup_nav=function(){return $("body").scrollspy({target:".quanto-scroll-nav",offset:63}),$(".algo-details-nav > li").click(function(){var t;return t=60,$("html, body").animate({scrollTop:$($(this).find("a").attr("href")).offset().top-t},"slow"),!1})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ContestSubmissionManager=t=function(){function t(){this.contest_submission_error=e(this.contest_submission_error,this),this.contest_submission_error_handler=e(this.contest_submission_error_handler,this)}return t.prototype.contest_submission_error_handler=function(t){var e,n;if($("#contest-modal").modal("hide"),null!=t.responseText){if(t.responseText.indexOf("No qexec servers")>=0)return quanto.show_error_popup("Error","Quantopian is experiencing system problems, please try again later."),void 0;try{if(n=JSON.parse(t.responseText),null!=n&&"error"===n.status&&null!=n.data)if(null!=n.data.submission_failure)switch(n.data.submission_failure){case 0:return quanto.show_message_popup("Collaboration Failure","Only the owner of the algorithm may submit it to the contest."),void 0;case 1:return quanto.show_message_popup("Invalid Algorithm Code","Your algorithm uses <a href='/help#ide-slippage' target='_blank'>set_slippage</a>. Your contest submission must use the default slippage settings. Once set_slippage is removed, please re-submit your entry to the contest. For more details, see the <a href='/open/rules' target='_blank'>contest rules</a>."),void 0;case 2:return quanto.show_message_popup("Invalid Algorithm Code","Your algorithm uses <a href='/help#ide-commission' target='_blank'>set_commission</a>. Your contest submission must use the default commission settings. Once set_commission is removed, please re-submit your entry to the contest. For more details, see the <a href='/open/rules' target='_blank'>contest rules</a>."),void 0;case 3:return quanto.show_message_popup("Maximum Algorithms Submitted","You already have the maximum of three algorithms submitted to the contest. To submit a new entry, stop a current submission."),void 0;case 4:return quanto.show_message_popup("Invalid Algorithm Code","Your algorithm uses <a href='/help#overview-fetcher' target='_blank'>fetch_csv</a>. Use of Fetcher is not permitted in the contest.  Once fetch_csv is removed, please re-submit your entry to the contest. For more details, see the <a href='/open/rules' target='_blank'>contest rules</a>."),void 0}else{if(null!=n.data.test_failure)return $("#submission-problem-modal").modal("show"),void 0;if(null!=n.data.qexec_failure)return quanto.show_error_popup("Error","There was a problem trying to validate your algorithm. Try again or contact us by <a class='open-feedback-link'>sending feedback</a>."),void 0}}catch(i){return e=i,this.contest_submission_error(),void 0}}return this.contest_submission_error()},t.prototype.contest_submission_error=function(){return quanto.show_message_popup("Submission Error","There was an unexpected error submitting this algorithm. Please try again later.")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DailyBarsManager=t=function(){function t(){this.reset_perf_chart_values=e(this.reset_perf_chart_values,this),this.display_perf_chart_values=e(this.display_perf_chart_values,this),this.display_custom_chart_values=e(this.display_custom_chart_values,this),this.close_perf_ws=e(this.close_perf_ws,this),this.add_custom_series=e(this.add_custom_series,this),this.find_series_by_name=e(this.find_series_by_name,this),this.add_data_from_buffer=e(this.add_data_from_buffer,this),this.add_data=e(this.add_data,this),this.populate_error_data=e(this.populate_error_data,this),this.restore_controls=e(this.restore_controls,this),this.reinitialize_chart_with_custom_chart=e(this.reinitialize_chart_with_custom_chart,this),this.consume=e(this.consume,this),this.bind_perf_websocket=e(this.bind_perf_websocket,this),this.cancel_daily_backtest=e(this.cancel_daily_backtest,this),this.clear_existing_backtest=e(this.clear_existing_backtest,this),this.start_backtest=e(this.start_backtest,this),this.trigger_backtest=e(this.trigger_backtest,this),this.get_backtest_data=e(this.get_backtest_data,this),this.show_date_error_modal=e(this.show_date_error_modal,this),this.calculate_date_range=e(this.calculate_date_range,this),this.trigger=e(this.trigger,this),this.show_progress=e(this.show_progress,this),this.shrink_log_window=e(this.shrink_log_window,this),this.expand_log_window=e(this.expand_log_window,this),this.clear_ui=e(this.clear_ui,this),this.insert_date_management_off_ui=e(this.insert_date_management_off_ui,this),this.verify_date=e(this.verify_date,this),this.initialize_date_pickers=e(this.initialize_date_pickers,this),this.initialize_logs=e(this.initialize_logs,this),this.initialize_date_popup=e(this.initialize_date_popup,this),this.populate_sid_table=e(this.populate_sid_table,this),this.initialize_full_backtest_link=e(this.initialize_full_backtest_link,this),this.initialize_contest_links=e(this.initialize_contest_links,this),this.load_remote_backtest=e(this.load_remote_backtest,this),this.initialize_events=e(this.initialize_events,this),this.initialize_collab=e(this.initialize_collab,this),this.$tab_pane=$(".dailybars-output .tabbable"),this.tab_pane_tall=!1,this.started_at=null,this.ended=!1,this.is_sample=0===$("#title-box").val().indexOf("Sample Mean Reversion Algorithm"),this.$start_date_picker=$("#daily_backtest_start_date_field"),this.$end_date_picker=$("#daily_backtest_end_date_field"),quanto.on_click("#daily-toggle-logs-button",function(t){return function(){return t.tab_pane_tall?t.shrink_log_window():t.expand_log_window()}}(this)),this.safe_start_date=10100772e5,this.safe_end_date=quanto.date.get_backtest_max_date().getTime(),this.use_automatic_date_mgmt="true"===$("#automatic-date-mgmt-setting").val(),this.initialize_date_pickers(),this.initialize_date_popup(),this.initialize_full_backtest_link(),this.initialize_contest_links(),$(".selectpicker").selectpicker(),this.modified_start_date=!1,this.modified_end_date=!1,this.initialize_events(),this.verify_date(this.$start_date_picker),this.verify_date(this.$end_date_picker),this.showing_custom_chart=!1,this.custom_series_template=Handlebars.compile("<div class='chart-label custom-chart-label legend-item inline-block payload' data-key='{{key}}'><span class='square' style='background-color: {{color}}'></span><span style='color: {{color}}'>{{key}}</span><span class='chart-value' style='color: {{color}}' data-key='{{key}}'></span></div>"),this.initialize_collab(),quanto.on_click("#contest-code-problem-button",function(){return $("#submission-problem-modal").modal("hide"),$(document).trigger("change_pane",["algorithm"]),$(document).trigger("validate_algo")}),this.waiting_on_pipeline=!1}return t.prototype.cumulative_fields={alpha:"al",beta:"be",sharpe:"sh",total_returns:"tr",max_drawdown:"md"},t.prototype.percentage_fields=["total_returns","max_drawdown"],t.prototype.metric_fields=["alpha","beta","sharpe"],t.prototype.initialize_collab=function(){return quanto.register_remote_event("ideBacktestStarted",function(t){return function(e){var n;return n=e.backtest_id,t.load_remote_backtest(n)}}(this)),quanto.register_remote_event("backtestGranularityChanged",function(t){return function(e){return t.use_data_granularity(e.granularity)}}(this)),"undefined"!=typeof TogetherJS&&null!==TogetherJS&&null!=TogetherJS.hub?quanto.instances.chatmanager=new quanto.ChatManager($("#algo-id").val()):void 0},t.prototype.initialize_events=function(){return $(document).bind("build_success",function(t){return function(){return $("#rightdock").hasClass("hidden")?t.trigger():void 0}}(this)),$(window).bind("beforeunload",function(t){return function(){return t.clear_existing_backtest()}}(this)),$(document).bind("maybe_validate_algo",function(t){return function(){return null==t.perf_ws||null==t.backtest_id||confirm("A backtest is already running.  Cancel that one?")?(t.started_at=Date.now(),t.ended=!1,t.saved_code_snapshot=quanto.editor.getValue(),$(document).trigger("validate_algo")):void 0}}(this)),$(document).bind("main_splitter_resized",function(){return function(){return null!=quanto.dailybar_chart?quanto.dailybar_chart.setSize($("#dailybar-chart-container").width(),$("#dailybar-chart-container").height()):void 0}}(this)),$(document).bind("at_breakpoint",function(){return function(){return $(".dailybars-output .progress").addClass("paused")}}(this)),$(document).bind("execution_resumed",function(){return function(){return $(".dailybars-output .progress").removeClass("paused")}}(this)),this.cancel_modal=$("#output-pane .cancel-backtest-popup"),quanto.on_click("#dailybar-chart-outer-container .legend-item",function(t){return function(e){var n,i,r;return n=$(quanto.get_src_element(e)).closest(".legend-item"),i=n.data("key"),r=t.find_series_by_name(i),null!=r?n.hasClass("unselected")?(n.removeClass("unselected"),r.show()):(n.addClass("unselected"),r.hide()):void 0}}(this)),quanto.on_click("#cancel-daily-backtest-button",function(t){return function(){return t.waiting_on_pipeline?(t.cancel_modal.find(".cancel-title").html("Cancel backtest - Pipeline still building"),t.cancel_modal.find(".cancel-body").html("Are you sure you want to cancel this backtest? The Pipeline API is still loading data.")):(t.cancel_modal.find(".cancel-title").html("Cancel backtest"),t.cancel_modal.find(".cancel-body").html("Are you sure you want to cancel this backtest?")),t.cancel_modal.modal("show")}}(this)),quanto.on_click("#output-pane .cancel-backtest-popup .confirm-cancel-backtest-button",function(t){return function(){return t.cancel_daily_backtest()}}(this))},t.prototype.load_remote_backtest=function(t){var e,n;return n={algorithm_id:$("#algo-id").val(),backtest_id:t},e=null!=quanto.instances.bpm&&quanto.instances.bpm.has_breakpoints(),$.post("/backtests/load_ide_backtest",n,function(n){return function(i){var r,o;return o=new quanto.JsonResponse(i),o.ok()&&(r=o.data(),n.start_backtest(r.ws_url,r.ws_open_msg,t),e)?$(document).trigger("connect_debug_websocket",[r.debug_ws_url,r.debug_open_msg]):void 0}}(this))},t.prototype.initialize_contest_links=function(){return this.csm=new quanto.ContestSubmissionManager,quanto.on_click("#contest-submit-button",function(t){return function(){var e;return mixpanel.track("contest validate click"),$("#contest-modal .terms").addClass("hidden"),$("#contest-modal .validating").removeClass("hidden"),$("#contest-agree-button").removeClass("disabled").html("Submit"),$("#contest-modal").modal("show"),e=function(){var e;return $("#backtest-error-message-container").html("").hide(),e={algo_id:$("#algo-id").val()},$.post("/contest_submissions/is_valid",e,function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?($("#contest-modal .validating").addClass("hidden"),$("#contest-modal .terms").removeClass("hidden")):($("#contest-modal").modal("hide"),t.csm.contest_submission_error())}).error(function(e,n,i){return t.csm.contest_submission_error_handler(e,n,i)})},$(document).trigger("manual_save",[{callback:e}])}}(this)),quanto.on_click("#contest-agree-button",function(t){return function(){var e;return mixpanel.track("contest submit click"),$("#contest-agree-button").addClass("disabled").html("Submitting..."),e=function(){var e;return $("#backtest-error-message-container").html("").hide(),e={algo_id:$("#algo-id").val()},$.post("/contest_submissions/submit",e,function(e){var n;return n=new quanto.JsonResponse(e),n.redirect()?void 0:($("#contest-modal").modal("hide"),t.csm.contest_submission_error())}).error(function(e,n,i){return t.csm.contest_submission_error_handler(e,n,i)})},$(document).trigger("manual_save",[{callback:e}])}}(this))},t.prototype.initialize_full_backtest_link=function(){return quanto.on_click("#daily-new-backtest-button",function(t){return function(){var e,n,i,r,o,a;return i=new Date(t.$start_date_picker.val()),n=new Date(t.$end_date_picker.val()),i>=n?(quanto.show_message_popup("Invalid Date Range","Backtest end date must be at least 1 market day after the start date."),void 0):(r=quanto.date.get_diff_info(i,n),a=quanto.date.is_weekend(i),o=quanto.date.is_weekend(n),r.day_diff<=1&&a&&o?(quanto.show_message_popup("Invalid Date Range","Backtest date range must include at least 2 trading days. Your date range starts and ends on a weekend."),void 0):(e=function(){var e,n,i;return e=$("#algo-id").val(),n=t.get_backtest_data(!1),n.id=e,i=function(){return quanto.show_message_popup("Backtest Error","Something went wrong starting a full backtest.")},$.post("/algorithms/"+e+"/start_full_backtest",n,function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:i()}).error(i)},$(document).trigger("manual_save",[{callback:e}])))}}(this))},t.prototype.populate_sid_table=function(t){var e,n,i,r,o,a,s,l;for(t.find("tbody").empty(),r=Handlebars.compile("<tr><td>{{sid}}</td><td>{{ticker}}</td><td>{{start_date_str}}</td><td>{{end_date_str}}</td></tr>"),s=quanto.sid_cache.get_all_sids(),l=[],o=0,a=s.length;a>o;o++)n=s[o],e=Math.min(n.end_date,this.safe_end_date),i={sid:n.sid,ticker:n.ticker,start_date_str:quanto.date.format_date("%Y-%m-%d",quanto.date.adjust_date_for_UTC(new Date(n.start_date))),end_date_str:quanto.date.format_date("%Y-%m-%d",quanto.date.adjust_date_for_UTC(new Date(e)))},l.push(t.find("tbody").append(r(i)));return l},t.prototype.initialize_date_popup=function(){return $("#date-adjustment-modal").on("show",function(t){return function(){return $(".datepicker").datepicker("hide"),t.populate_sid_table($("#date-adjustment-table"))}}(this)),quanto.on_click("#use-these-dates-button",function(t){return function(){var e,n;return n=parseInt($("#recommended-start-date-field").val()),e=parseInt($("#recommended-end-date-field").val()),t.$start_date_picker.val(quanto.date.format_date("%m/%d/%Y",n)),t.$end_date_picker.val(quanto.date.format_date("%m/%d/%Y",e)),t.trigger(),$(".date-error-modal").modal("hide")}}(this)),quanto.on_click(".turn-off-date-mgmt-link",function(t){return function(){var e;return e=$("#algo-id").val(),$.post("/algorithms/"+e+"/turn_off_date_mgmt",{},function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?(t.use_automatic_date_mgmt=!1,t.modified_start_date=!1,t.modified_end_date=!1,t.$start_date_picker.removeClass("highlighted"),t.$end_date_picker.removeClass("highlighted"),$(".explain-adjusted-date").remove(),$(".date-error-modal").modal("hide")):alert("There was a problem turning off automatic date management for your backtest.")})}}(this)),quanto.on_click(".turn-on-date-mgmt-link",function(t){return function(){var e;return e=$("#algo-id").val(),$.post("/algorithms/"+e+"/turn_on_date_mgmt",{},function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?(t.use_automatic_date_mgmt=!0,$(".date-mgmt-off").remove()):alert("There was a problem turning on automatic date management for your backtest.")})}}(this))},t.prototype.initialize_logs=function(t){return $("#daily-logs-container .logs-container").html(""),null!=this.log_mgr&&this.log_mgr.destroy(),this.log_mgr=new quanto.BacktestLogManager({container_selector:"#daily-logs-container",backtest_id:t,backtest_state:2,backtest_log_count:-1})},t.prototype.initialize_date_pickers=function(){var t;return t={dayNamesMin:quanto.date.get_datepicker_daynames(),prevText:"",nextText:"",minDate:quanto.date.get_backtest_min_date(),maxDate:quanto.date.get_backtest_max_date(),afterShow:function(t,e){if("daily_backtest_start_date_field"===e.id){if(quanto.instances.dm.modified_start_date)return $("#ui-datepicker-div").prepend("<div class='explain-adjusted-date quantopian-insert' data-position='top'>Start date was auto-adjusted to the first full trading day for your securities. <a data-toggle='modal' href='#date-adjustment-modal'>More info</a></div>");if(!quanto.instances.dm.use_automatic_date_mgmt)return quanto.instances.dm.insert_date_management_off_ui()}else if("daily_backtest_end_date_field"===e.id){if(quanto.instances.dm.modified_end_date)return $("#ui-datepicker-div").prepend("<div class='explain-adjusted-date quantopian-insert' data-position='top'>End date was auto-adjusted to the last full trading day for your securities. <a data-toggle='modal' href='#date-adjustment-modal'>More info</a></div>");if(!quanto.instances.dm.use_automatic_date_mgmt)return quanto.instances.dm.insert_date_management_off_ui()}},onClose:function(t,e){return quanto.instances.dm.verify_date($(e.input))}},$(".dailybars-nav .datepicker").each(function(){return function(e,n){var i;return i=_.extend({},t),$(n).datepicker(i)}}(this))},t.prototype.verify_date=function(t){var e,n;return e=new Date(t.val()),quanto.date.is_date(e)?e.getTime()>this.safe_end_date||e.getTime()<this.safe_start_date?(n=t.data("default"),t.val(n)):void 0:(n=t.data("default"),t.val(n))},t.prototype.insert_date_management_off_ui=function(){return $("#ui-datepicker-div").append("<div class='date-mgmt-off quantopian-insert' data-position='bottom'>Automatic date management is off.  <a class='turn-on-date-mgmt-link'>Turn on</a></div>")},t.prototype.clear_ui=function(){return $(".dailybar-stat .value").html("--"),$("#dailybars-progressbar").css("width","0%"),$("#dailybars-progresslabel").html("0%"),$(".dailybars-output .progress").removeClass("paused"),$(".chart-value").html(""),$("#custom-series-controls").html(""),$("#dailybars-errors").hide(),$(document).trigger("clear_active_line"),$(document).trigger("hide_debug_window")},t.prototype.expand_log_window=function(){return this.$tab_pane.addClass("tall"),$("#daily-toggle-logs-button")[0].innerHTML="Less <i class='icon icon-chevron-down'></i>",this.tab_pane_tall=!0,$(window).trigger("resize"),$(document).trigger("logs-container-height-changed")},t.prototype.shrink_log_window=function(){return this.$tab_pane.removeClass("tall"),$("#daily-toggle-logs-button")[0].innerHTML="More <i class='icon icon-chevron-up'></i>",this.tab_pane_tall=!1,$(window).trigger("resize"),$(document).trigger("logs-container-height-changed")},t.prototype.show_progress=function(t){var e,n;return null==t&&(t=!1),$(".control-group input").addClass("disabled").attr("disabled","disabled"),$(".dailybars-nav .btn").addClass("disabled").attr("disabled","disabled"),e=$("#dailybars-status"),e.show(),e.find(".progress-pane").hide(),e.find(".loading-text").show().html("Initializing backtest..."),t?(n=Date.now()-this.started_at,mixpanel.track("IDE build button initializing",{"Load Time (ms)":n,"Is Sample?":this.is_sample})):void 0},t.prototype.trigger=function(){var t,e;return this.clear_ui(),this.show_progress(!0),e=quanto.instances.ide_mgr.sid_lookup_manager.find_sids(),t=_.intersection(e,_.keys(quanto.sid_cache.cache)),t.length!==e.length||t.length!==_.keys(quanto.sid_cache.cache).length?(quanto.sid_cache.empty(),quanto.sid_cache.fetch_full_info(e,function(t){return function(){return t.calculate_date_range()?t.trigger_backtest():void 0}}(this),function(){return function(){return alert("There was an error getting the ticker information for your algorithm's securities.")}}(this))):this.calculate_date_range()?this.trigger_backtest():void 0},t.prototype.calculate_date_range=function(){var t,e,n,i,r,o,a,s,l,u;if(e=new Date(this.$start_date_picker.val()),t=new Date(this.$end_date_picker.val()),e>=t)return quanto.show_message_popup("Invalid Date Range","Backtest end date must be at least 1 market day after the start date."),this.restore_controls(),!1;if(this.use_automatic_date_mgmt){if(u=quanto.sid_cache.get_latest_start_date(),o=quanto.sid_cache.get_earliest_end_date(),o>this.safe_end_date?(o=this.safe_end_date,r=quanto.date.adjust_date_for_UTC(new Date(o)),a=new Date(r.getFullYear(),r.getMonth(),r.getDate())):(r=quanto.date.adjust_date_for_UTC(new Date(o)),n=quanto.date.adjust_date_for_UTC(new Date(o)),i=quanto.date.adjust_date_for_UTC(new Date(this.safe_end_date)),a=quanto.date.are_same_date(n,i)?r:new Date(r.getFullYear(),r.getMonth(),r.getDate())),u<this.safe_start_date?(u=this.safe_start_date,l=quanto.date.adjust_date_for_UTC(new Date(u)),s=new Date(l.getFullYear(),l.getMonth(),l.getDate())):(l=quanto.date.adjust_date_for_UTC(new Date(u)),s=new Date(l.getFullYear(),l.getMonth(),l.getDate()+1)),this.modified_start_date=!1,this.$start_date_picker.removeClass("highlight"),this.modified_end_date=!1,this.$end_date_picker.removeClass("highlight"),this.date_error=!1,s>a?this.date_error=!0:e>a||s>t?this.date_error=!0:e>=s&&a>=t||(s>e&&t>a?(this.modified_start_date=!0,this.modified_end_date=!0):e>=s&&t>a?this.modified_end_date=!0:s>e&&a>=t&&(this.modified_start_date=!0)),this.date_error)return this.show_date_error_modal(e,t,s,a),this.restore_controls(),!1;this.modified_start_date?(this.$start_date_picker.val(quanto.date.format_date("%m/%d/%Y",s)),this.$start_date_picker.addClass("highlighted"),this.backtest_start_date=s):this.backtest_start_date=e,this.modified_end_date?(this.$end_date_picker.val(quanto.date.format_date("%m/%d/%Y",a)),this.$end_date_picker.addClass("highlighted"),this.backtest_end_date=a):this.backtest_end_date=t}else this.backtest_start_date=e,this.backtest_end_date=t;return!0},t.prototype.show_date_error_modal=function(t,e,n,i){var r;return r=$("#date-error-modal"),n>i?(r.find(".dailybars-date-error-message").html("The trading histories of the selected securities don't overlap. There is no trading day where all of these securities traded. This might cause problem with the backtest."),r.find(".dates-overview").hide()):($("#recommended-start-date-field").val(n.getTime()),$("#recommended-end-date-field").val(i.getTime()),r.find(".date-error-backtest-start-date").html(quanto.date.format_date("%b %d %Y",t)),r.find(".date-error-backtest-end-date").html(quanto.date.format_date("%b %d %Y",e)),r.find(".date-error-trade-start-date").html(quanto.date.format_date("%b %d %Y",n)),r.find(".date-error-trade-end-date").html(quanto.date.format_date("%b %d %Y",i)),r.find(".dates-overview").show(),r.find(".dailybars-date-error-message").html("The backtest dates fall outside of the trading history window of the selected securities.  Your backtest won't receive any trading events.")),this.populate_sid_table(r.find(".table")),r.modal("show")},t.prototype.get_backtest_data=function(t){var e,n,i;return null==t&&(t=!0),i=new Date(this.$start_date_picker.val()),n=new Date(this.$end_date_picker.val()),e={algo_id:$("#algo-id").val(),backtest_start_date_year:i.getFullYear(),backtest_start_date_month:i.getMonth()+1,backtest_start_date_day:i.getDate(),backtest_end_date_year:n.getFullYear(),backtest_end_date_month:n.getMonth()+1,backtest_end_date_day:n.getDate(),backtest_capital_base:$(".dailybars-nav .capitalbase").val(),backtest_data_frequency_value:"minute",code:this.saved_code_snapshot},t&&null!=quanto.instances.bpm&&(e.breakpoints=quanto.instances.bpm.get_breakpoints_info()),e},t.prototype.trigger_backtest=function(){var t,e;return t=this.get_backtest_data(),this.clear_existing_backtest(),e=null!=t.breakpoints&&t.breakpoints.length>0,$.post("/backtests/start_ide_backtest",t,function(n){return function(i){var r,o;return o=new quanto.JsonResponse(i),o.ok()?(mixpanel.track("instant backtest finished"),r=function(){var i,r;return t=o.data(),r=t.ws_url,i=t.ws_open_msg,n.backtest_id=t.id,quanto.trigger_remote_event({type:"ideBacktestStarted",backtest_id:n.backtest_id}),n.start_backtest(r,i,t.id),e?$(document).trigger("connect_debug_websocket",[t.debug_ws_url,t.debug_open_msg]):void 0},quanto.instances.dbuim.reset_watch_list(r)):void 0}}(this)).error(function(){return function(t){var e;return quanto.instances.dm.restore_controls(),null!=t.responseText&&(e=new quanto.JsonResponse(t.responseText),"SyntaxError in algocode."===e.data())?(quanto.show_error_popup("Syntax error","Your algorithm has a syntax error.  Click the Build Algorithm button for more information."),void 0):quanto.show_error_popup()}}(this))},t.prototype.start_backtest=function(t,e,n){return this.clear_existing_backtest(),this.clear_ui(),this.show_progress(),this.backtest_id=n,this.initialize_chart(this.showing_custom_chart),this.initialize_logs(this.backtest_id),this.bind_perf_websocket(t,e)},t.prototype.clear_existing_backtest=function(){var t;null!=this.consume_timer&&clearInterval(this.consume_timer),null!=this.perf_ws&&null!=this.backtest_id&&(t={algo_id:$("#algo-id").val(),backtest_id:this.backtest_id},$.post("/backtests/"+this.backtest_id+"/cancel_backtest",t,function(){return function(){}}(this))),this.close_perf_ws(),this.clear_ui(),this.received_custom_series={},$(window).trigger("resize")},t.prototype.cancel_daily_backtest=function(){var t;return mixpanel.track("daily backtest cancelled"),$("#cancel-daily-backtest-button").html("Cancelling...").addClass("disabled"),t={algo_id:$("#algo-id").val(),backtest_id:this.backtest_id},$.post("/backtests/"+this.backtest_id+"/cancel_backtest",t,function(){return function(){return $("#cancel-daily-backtest-button").html("Cancel").removeClass("disabled"),$(document).trigger("backtest_cancelled")}}(this)).error(function(){return function(){return alert("Sorry, there was a problem cancelling the backtest."),$("#cancel-daily-backtest-button").html("Cancel").removeClass("disabled")}}(this))},t.prototype.bind_perf_websocket=function(t,e){var n,i;return null!=this.perf_ws&&this.close_perf_ws(),this.perf_ws=new WebSocket(t),this.data_buffer=[],this.received_perf_data=[],this.data_done=!1,this.received_error_data=null,this.received_done_data=null,this.received_risk_data=null,this.consume(),n=null,this.waiting_on_pipeline=-1!==this.saved_code_snapshot.indexOf("attach_pipeline"),this.waiting_on_pipeline&&(i=Math.floor(4e3*Math.random()+1e3),n=setTimeout(function(){return function(){return $("#dailybars-status .loading-text").html("Loading Pipeline data.  This might take a minute or two.")}}(this),i)),this.perf_ws.onopen=function(t){return function(){return console.log("websocket opened, "+new Date),t.perf_ws.send(JSON.stringify({e:"open",p:{cursor:0,include_txn:!1,a:e}}))}}(this),this.perf_ws.onmessage=function(t){return function(e){return t.data_buffer.push(JSON.parse(e.data))}}(this),this.perf_ws.onerror=function(){return function(t){return null!=n&&clearTimeout(n),console.log("websocket error! "+t)}}(this),this.perf_ws.onclose=function(){return function(){return null!=n&&clearTimeout(n),console.log("websocket closed, "+new Date)}}(this)},t.prototype.consume=function(){var t,e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b,y,w,k,x,C,q,T,S;if(n=this.data_buffer,this.data_buffer=[],a=!1,b=!1,n.length>0){if(e=_.groupBy(n,function(t){return t.e}),f=e.log,null!=f&&f.length>0&&(this.received_log_packets||(this.received_log_packets=[]),this.received_log_packets=this.received_log_packets.concat(f),p=_.last(f),null!=p.p&&null!=p.p.count&&this.log_mgr.update_max_count(p.p.count)),o=e.performance,null!=o&&o.length>0){for(r=[],x=0,q=o.length;q>x;x++)if(d=o[x],y=d.p,null!=y)for(S=y.daily,C=0,T=S.length;T>C;C++)i=S[C],r.push(i);this.add_data(r),c=_.first(o).p,t=c.daily[0].bm,null!=t&&-1!==t&&quanto.set_benchmark(t,".red.ide_benchmark"),h=_.last(o).p,w=quanto.pick_property(h,"percent_complete","pc"),this.progress=Math.floor(1e3*w)/10,null!=this.progress&&!isNaN(this.progress)&&this.progress>=0&&this.progress<=100&&($("#dailybars-progressbar").css("width",""+this.progress+"%"),$("#dailybars-progresslabel").html(""+this.progress+"%")),this.showing_custom_chart||(v=_.filter(r,function(){return function(t){var e;return e=quanto.pick_property(t,"recorded_vars","rv"),null!=e&&_.keys(e).length>0}}(this)),v.length>0&&(b=!0,this.reinitialize_chart_with_custom_chart()))}a=!1,u=!1,k=e.risk_report||[],k.length>0&&(this.received_risk_data=k[0]),s=e.done,null!=s&&s.length>0&&(this.received_done_data=s[0].p,a=!0),l=e.exception,null!=l&&l.length>0&&(this.received_error_data=l[0].p,this.populate_error_data(this.received_error_data),a=!0)}return b?void 0:(a||((null!=this.received_error_data||null!=this.received_done_data||null!=this.received_risk_data)&&(a=!0),null!=this.received_error_data&&this.populate_error_data(this.received_error_data)),a?(this.close_perf_ws(),console.log("DONE"),this.restore_controls(),this.log_mgr.backtest_finished(),g=quanto.dailybar_chart.series[0].xData[0],m=_.last(quanto.dailybar_chart.series[0].xData),quanto.dailybar_chart.xAxis[0].setExtremes(g,m),!this.showing_custom_chart||null!=this.received_custom_series&&0!==_.keys(this.received_custom_series).length||$(".dailybars-results").hasClass("doubleheight")&&(this.showing_custom_chart=!1,$(".dailybars-results").removeClass("doubleheight"),$(window).trigger("resize"),null!=quanto.dailybar_chart&&(quanto.dailybar_chart.destroy(),quanto.dailybar_chart=null),this.initialize_chart(this.showing_custom_chart),this.add_data_from_buffer(this.received_perf_data),quanto.dailybar_chart.redraw(),setTimeout(function(){return function(){var t;try{quanto.dailybar_chart.setSize($("#dailybar-chart-container").width(),220)}catch(e){t=e}return $(".custom-chart").addClass("hidden"),quanto.dailybar_chart.redraw()}}(this),10)),quanto.is_anonymous()?($("#join-modal").addClass("left").modal("show"),$(".modal-backdrop").addClass("light")):void 0):this.consume_timer=setTimeout(function(t){return function(){return t.consume(t.data_done)}}(this),1e3))},t.prototype.reinitialize_chart_with_custom_chart=function(){return $(".dailybars-results").addClass("doubleheight"),this.showing_custom_chart=!0,$(window).trigger("resize"),null!=quanto.dailybar_chart&&(quanto.dailybar_chart.destroy(),quanto.dailybar_chart=null),this.initialize_chart(this.showing_custom_chart),this.add_data_from_buffer(this.received_perf_data),setTimeout(function(){return function(){return quanto.dailybar_chart.setSize($("#dailybar-chart-container").width(),367),$(".custom-chart").removeClass("hidden"),quanto.dailybar_chart.redraw()}}(this),10),this.consume()},t.prototype.restore_controls=function(){return $("#dailybars-status").hide(),$(".control-group input").removeClass("disabled").attr("disabled",!1),$(".dailybars-nav .btn").removeClass("disabled").attr("disabled",!1),$(document).trigger("ide_backtest_done")},t.prototype.populate_error_data=function(t){return $("#dailybars-errors").show(),null==this.saved_code_snapshot&&(this.saved_code_snapshot=quanto.editor.getValue()),quanto.instances.error_renderer=new quanto.ErrorRenderer($("#dailybars-errors"),t,!1,this.saved_code_snapshot,this.backtest_id),$("#daily-error-tab-link").trigger("click"),this.expand_log_window()},t.prototype.add_data=function(t){var e,n,i,r,o,a,s,l,u,c,d;if($("#dailybars-status .progress-pane").show(),$("#dailybars-status .loading-text").hide(),s=_.last(t),null!=s){n=quanto.pick_property(s,"cumulative","c"),d=this.cumulative_fields;for(a in d)e=d[a],l=quanto.pick_property(n,e,a),null==l||isNaN(l)?$("#dailybar-stats .value[datafield='"+a+"']").html("--"):_.indexOf(this.percentage_fields,a)>=0?(o=Math.floor(1e4*l)/100,$("#dailybar-stats .value[datafield='"+a+"']").html(""+o+"%")):(o=l.toFixed(2),$("#dailybar-stats .value[datafield='"+a+"']").html(""+o))}for(u=0,c=t.length;c>u;u++)i=t[u],null!=i&&this.received_perf_data.push(i);return this.add_data_from_buffer(t),this.waiting_on_pipeline=!1,this.ended||(this.ended=!0,r=Date.now()-this.started_at,mixpanel.track("IDE build button chart",{"Load Time (ms)":r,"Is Sample?":this.is_sample})),quanto.dailybar_chart.redraw(),$("#dailybar-chart-outer-container .payload").show(),$(window).trigger("resize")},t.prototype.add_data_from_buffer=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,_,f,m,g;for(g=[],f=0,m=t.length;m>f;f++)o=t[f],null!=o?(p=quanto.pick_property(o,"date","d"),a=new Date(p),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=quanto.date.adjust_date_for_UTC_reverse(l).getTime(),r=quanto.pick_property(o,"cumulative","c"),n=quanto.pick_property(r,"benchmark_returns","br"),u=quanto.pick_property(r,"total_returns","tr"),quanto.dailybar_chart.series[0].addPoint([e,u],!1),quanto.dailybar_chart.series[1].addPoint([e,n],!1),c=quanto.pick_property(o,"recorded_vars","rv"),g.push(function(){var t;t=[];for(s in c)_=c[s],this.showing_custom_chart?((null==this.received_custom_series[s]||"uninitialized"===this.received_custom_series[s])&&(i=quanto.custom_chart_colors[(quanto.dailybar_chart.series.length-4)%quanto.custom_chart_colors.length],d={type:"line",name:s,data:[],dataGrouping:quanto.global_grouping_options,yAxis:1,lineWidth:1,color:i},quanto.dailybar_chart.addSeries(d,!1),this.received_custom_series[s]={color:i},this.add_custom_series(s,i)),h=this.find_series_by_name(s),null!=h?t.push(h.addPoint([e,_],!1)):t.push(void 0)):t.push(this.received_custom_series[s]="uninitialized");
return t}.call(this))):g.push(void 0);return g},t.prototype.find_series_by_name=function(t){return _.find(quanto.dailybar_chart.series,function(){return function(e){return e.name===t}}(this))},t.prototype.add_custom_series=function(t,e){var n;return n=this.custom_series_template({key:t,color:e}),$("#custom-series-controls").append(n),$(".dailybars-results").addClass("doubleheight"),$(window).trigger("resize")},t.prototype.close_perf_ws=function(){var t;if(null!=this.perf_ws){try{this.perf_ws.send("ACK"),this.perf_ws.onmessage=function(){},this.perf_ws.onclose=function(){},this.perf_ws.close()}catch(e){t=e}return this.perf_ws=null}},t.prototype.initialize_chart=function(t){var e;return null==t&&(t=!1),null!=quanto.dailybar_chart&&(quanto.dailybar_chart.destroy(),quanto.dailybar_chart=null),$("#dailybars-chart-border").removeClass("hidden"),null!=t&&t?($("#dailybars-custom-chart-border").removeClass("hidden"),$("#custom-series-controls").removeClass("hidden")):($("#dailybars-custom-chart-border").addClass("hidden"),$("#custom-series-controls").addClass("hidden")),e={global:{useUTC:!0},chart:{renderTo:"dailybar-chart-container",alignTicks:!0},credits:{enabled:!1},scrollbar:{liveRedraw:!1},navigator:{series:{color:"transparent",lineWidth:0},height:20,maskFill:"rgba(180, 198, 220, 0.75)",xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"}}},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{type:"area",name:"Returns",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,color:"#4572A7",fillOpacity:.2},{type:"line",name:"Benchmark",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,lineWidth:1,color:"#aa4643"}],yAxis:[{title:{text:null},height:115,offset:0,labels:{formatter:function(){return 100*this.value+"%"}},minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:2}]}],xAxis:{ordinal:!1,dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray",labels:{style:{fontSize:"9px"}}},plotOptions:quanto.global_plotOptions,tooltip:{hideCallback:function(){var t;return null!=quanto.dailybar_chart.hoverPoints&&$.each(quanto.dailybar_chart.hoverPoints,function(t,e){return e.setState("")}),quanto.instances.dm.tooltips_dirty?($("#dailybars-date-chart-label").html("").hide(),null!=(t=quanto.instances.dm)&&t.reset_perf_chart_values(),quanto.instances.dm.tooltips_dirty=!1):void 0},formatter:function(){var t,e,n,i,r,o,a,s,l,u;if(null==this.points||0===this.points.length)return!1;for(r=null,t=null,e=[],u=this.points,s=0,l=u.length;l>s;s++)o=u[s],a=o.series.name,"End"!==a&&("Returns"===a?r=o.y:"Benchmark"===a?t=o.y:e.push(o));return quanto.instances.dm.display_perf_chart_values(r,t),e.length>0&&quanto.instances.dm.display_custom_chart_values(e),i=this.points[0].series.currentDataGrouping,n=null!=i&&"week"===(null!=i?i.unitName:void 0)?"Week of "+Highcharts.dateFormat("%b %e, %Y",this.x,!1):Highcharts.dateFormat("%b %e, %Y",this.x,!1),$("#dailybars-date-chart-label").html(n).show(),quanto.instances.dm.tooltips_dirty=!0,!1}}},t&&e.yAxis.push({title:{text:null},height:115,top:180,minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,opposite:!0,lineWidth:1,startOnTick:!0,endOnTick:!0,minPadding:.05,maxPadding:.05,forceTickRecalculate:!0,showEmpty:!1}),quanto.dailybar_chart=new Highcharts.StockChart(e),quanto.dailybar_chart.animation=!1,null==this.backtest_end_date||isNaN(this.backtest_end_date.getTime())?void 0:quanto.dailybar_chart.addSeries({name:"End",data:[[this.backtest_end_date.getTime(),0]]})},t.prototype.display_custom_chart_values=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push($("#custom-series-controls .chart-value[data-key='"+e.series.name+"']").html(Math.round(100*e.y)/100));return r},t.prototype.display_perf_chart_values=function(t,e){var n,i;return i=Math.floor(1e4*t)/100,n=Math.floor(1e4*e)/100,$("#dailybars-performance-value").html(""+i+"%"),$("#dailybars-benchmark-value").html(""+n+"%"),0>i?$("#dailybars-performance-value").addClass("negative"):$("#dailybars-performance-value").removeClass("negative"),0>n?$("#dailybars-benchmark-value").addClass("negative"):$("#dailybars-benchmark-value").removeClass("negative")},t.prototype.reset_perf_chart_values=function(){var t,e,n,i,r,o,a,s;if(null!=quanto.dailybar_chart.series&&quanto.dailybar_chart.series.length>=3){if(r=quanto.dailybar_chart.series[0].points,null==r||r.length<=2||null==r[0])return;if(s=r[0].y,a=_.last(r).y,n=quanto.dailybar_chart.series[1].points,null==n||n.length<2)return;i=n[0].y,e=_.last(n).y,o=a-s,t=e-i,quanto.instances.dm.display_perf_chart_values(o,t)}return $("#custom-series-controls .chart-value").html("")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.DateFilter=t=function(t){function n(t,i){this.include_item=e(this.include_item,this),this.is_active=e(this.is_active,this),this.initialize_controls=e(this.initialize_controls,this),this.reset_filter=e(this.reset_filter,this),n.__super__.constructor.call(this,t,i)}return i(n,t),n.prototype.reset_filter=function(){return this.$start_date_control.datepicker("setDate",this.min_date),this.$end_date_control.datepicker("setDate",this.max_date),this.filter_start_date=null,this.filter_end_date=null},n.prototype.initialize_controls=function(t){var e;return n.__super__.initialize_controls.call(this,t),this.max_date=new Date(this.max_value),this.min_date=new Date(this.min_value),this.$start_date_control=this.$filter_elem.find(".start-date"),this.$end_date_control=this.$filter_elem.find(".end-date"),e={dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],prevText:"",nextText:"",minDate:this.min_date,maxDate:this.max_date,beforeShow:function(){return function(t,e){var n,i;return n=$(e),n.closest(".dropdown-menu").addClass("calendar-open"),i=n.datepicker("widget"),i.css("margin-left",$(t).outerWidth()-i.outerWidth()),i.addClass("stay-open-on-click filter-child-elem")}}(this),onSelect:function(t){return function(e,n){var i,r,o,a,s;return s=t.$start_date_control.val(),o=t.$end_date_control.val(),a=new Date(s),r=new Date(new Date(o).getTime()+86399999),t.filter_start_date=a.getTime(),t.filter_end_date=r.getTime(),$(t).trigger("filter_changed"),i=$(n.input),setTimeout(function(){return i.blur()},100),i.hasClass("start-date")&&t.$end_date_control.datepicker("option","minDate",a),i.hasClass("end-date")?t.$start_date_control.datepicker("option","maxDate",new Date(o)):void 0}}(this)},this.$filter_elem.find(".datepicker").datepicker(e),this.$start_date_control.datepicker("setDate",this.min_date),this.$end_date_control.datepicker("setDate",this.max_date)},n.prototype.is_active=function(){return null!=this.filter_start_date||null!=this.filter_end_date},n.prototype.include_item=function(t){return null!=this.filter_start_date&&t[this.field]<this.filter_start_date?!1:null!=this.filter_end_date&&t[this.field]>this.filter_end_date?!1:!0},n}(quanto.FilterBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DeployAlgoPopupManager=t=function(){function t(){this.deploy_algo=e(this.deploy_algo,this),this.user_already_agreed=e(this.user_already_agreed,this),this.is_money_deploy=e(this.is_money_deploy,this),this.is_broker_deploy=e(this.is_broker_deploy,this),this.show_area=e(this.show_area,this),this.maybe_show_code_warning=e(this.maybe_show_code_warning,this),this.initialize_events=e(this.initialize_events,this);var t;t={dayNamesMin:quanto.date.get_datepicker_daynames(),prevText:"",nextText:""},$("#deploy_algo_start_date").datepicker(t),this.initialize_events(),this.current_deploy_mode="paper",this.agreement_clicked=!1,this.$paper_trading_label=$(".algo-trading.paper-trading"),this.$money_trading_label=$(".algo-trading.money-trading"),this.show_area("intro")}return t.prototype.initialize_events=function(){return this.$popup=$("#deploy-code-modal"),this.$deploy_buttons_container=this.$popup.find(".modal-footer .algo-trading"),this.$agreement_area=this.$popup.find(".live-trading-agreement"),this.$agreement_area.length>0&&(this.$iframe=this.$agreement_area.find("iframe")),this.$popup.on("click",".next-paper",function(t){return function(){return t.next_area="paper",t.maybe_show_code_warning()}}(this)),this.$popup.on("click",".next-money",function(t){return function(){return t.next_area="broker",t.maybe_show_code_warning()}}(this)),this.$popup.on("click",".continue",function(t){return function(){return t.show_area(t.next_area)}}(this)),this.$popup.on("click",".go-back",function(t){return function(){return"version"===t.current_area?t.show_area("intro"):["broker","paper"].indexOf(t.current_area)>-1?t.backtest_algocode_matches_algorithm?t.show_area("intro"):t.show_area("version"):"agreement"===t.current_area?t.show_area(t.previous_area):void 0}}(this)),this.$popup.on("show",function(t){return function(){var e;if(!t.$popup.hasClass("in"))return quanto.is_employee_or_admin()?mixpanel.track("live algo deploy popup employee"):mixpanel.track("live algo deploy popup"),t.show_area("intro"),e=$("#data_backtest_id").val(),$.get("/backtests/"+e+"/backtest_algocode_matches_algorithm",function(e){var n;return n=new quanto.JsonResponse(e),t.backtest_algocode_matches_algorithm=n.ok()?n.data():!0}).error(function(){return t.backtest_algocode_matches_algorithm=!0})}}(this)),this.$deploy_button=this.$popup.find(".deploy-algorithm-button"),this.$deploy_button.on("click",this.deploy_algo)},t.prototype.maybe_show_code_warning=function(){return this.backtest_algocode_matches_algorithm?this.show_area(this.next_area):this.show_area("version")},t.prototype.show_area=function(t){var e,n,i,r,o;if(this.$popup.find(".area").addClass("hidden"),this.$deploy_buttons_container.addClass("hidden"),this.$popup.find(".backtest-version").addClass("hidden"),this.$deploy_button.html("Deploy"),this.$deploy_button.removeClass("disabled"),this.previous_area=this.current_area,this.current_area=t,"intro"===t)return this.$popup.find(".intro").removeClass("hidden"),this.$paper_trading_label.addClass("hidden"),this.$money_trading_label.addClass("hidden");if("version"===t)return r=$("#data_backtest_started_at_ms").val(),i=quanto.date.format_date("%B %e, %Y",+r),o=quanto.date.format_date("%l:%M %p",+r),$(".backtest-date").html("You're about to deploy an old version of this algorithm. Your algorithm's code has changed since this backtest was run on <b>"+i+"</b> at <b>"+o+"</b>."),this.$popup.find(".backtest-version").removeClass("hidden"),this.$paper_trading_label.addClass("hidden"),this.$money_trading_label.addClass("hidden");if("paper"===t)return this.current_deploy_mode="paper",this.$popup.find(".paper-trading").removeClass("hidden"),this.$deploy_buttons_container.removeClass("hidden"),this.$paper_trading_label.removeClass("hidden"),this.$money_trading_label.addClass("hidden");if("broker"===t){if(e=$("#trading-accounts-dropdown").children().first(),e.prop("disabled",!1),e.prop("selected",!0),e.prop("disabled",!0),$("#trading-accounts-dropdown").selectpicker("refresh"),this.current_deploy_mode="broker",this.$popup.find(".money-trading").removeClass("hidden"),this.$deploy_buttons_container.removeClass("hidden"),this.$paper_trading_label.addClass("hidden"),this.$money_trading_label.removeClass("hidden"),0===$("#trading-accounts-dropdown option").length)return this.$deploy_button.addClass("disabled")}else if("agreement"===t&&(this.$popup.find(".live-trading-agreement").removeClass("hidden"),this.$deploy_button.html("Agree to Terms"),this.$deploy_buttons_container.removeClass("hidden"),!this.$iframe.hasClass("loaded")))return n=$("#agreement_url").val(),this.$iframe.attr("src",n).addClass("loaded")},t.prototype.is_broker_deploy=function(){return"broker"===this.current_deploy_mode},t.prototype.is_money_deploy=function(){var t;return this.is_broker_deploy()?(t=$("#trading-accounts-dropdown").find(":selected"),t.data("account-number")&&"IB"===t.data("account-broker-name")?0!==t.data("account-number").toLowerCase().indexOf("d"):!0):!1},t.prototype.user_already_agreed=function(){var t;return t=$("#user_agreed"),t.length>0&&"true"===t.val()},t.prototype.deploy_algo=function(){var t,e,n,i,r,o,a,s,l,u;if("agreement"===this.current_area&&(this.agreement_clicked=!0),this.is_broker_deploy()){if(e=$("#trading-accounts-dropdown").find(":selected"),e.data("placeholder"))return alert("You must select a trading account."),void 0;r=$("#deploy_ib_algo_name_field").val()}else r=$("#deploy_paper_algo_name_field").val();if(0===$.trim(r).length)return alert("Title is required."),void 0;if(this.is_broker_deploy()&&(this.is_money_deploy()||!this.user_already_agreed())&&!this.agreement_clicked)return this.show_area("agreement"),void 0;if(i={id:$("#algo-id").val(),title:r,backtest_id:$("#data_backtest_id").val()},this.agreement_clicked&&(i.user_agreed=!0),this.is_broker_deploy()){if(t=$("#trading-accounts-dropdown").find(":selected"),a=t.data("id"),s=t.data("account-name"),l=t.data("account-number"),u=t.data("account-username"),o=t.data("broker-name"),null==a)return alert("Select a trading account."),void 0;i.trading_account_info_id=a,i.trading_account_info_broker_name=o}else{if(n=$("#deploy_algo_capital_base").val(),isNaN(n)||0>n)return alert("Valid capital base required."),void 0;i.capital_base=n}return $("#deploy_algo_start_date").length>0&&(i.start_date_string=$("#deploy_algo_start_date").val()),this.$deploy_button.addClass("disabled").html("Deploying..."),$.post("/live_algorithms/deploy_algorithm",i,function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.redirect()?void 0:(t.$deploy_button.removeClass("disabled").html("Deploy"),alert("There was a problem deploying your algorithm to live trading."))}}(this)).error(function(t){return function(){return t.$deploy_button.removeClass("disabled").html("Deploy"),alert("There was a problem deploying your algorithm to live trading.")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DiffManager=t=function(){function t(){this.render_diffs=e(this.render_diffs,this),this.split_diff_list=e(this.split_diff_list,this),this.get_diffs=e(this.get_diffs,this),this.render_metadata=e(this.render_metadata,this),this.trigger_diff=e(this.trigger_diff,this),$(document).on("click","#diff-button",function(t){return function(){return t.trigger_diff()}}(this))}return t.prototype.trigger_diff=function(){var t,e,n,i,r,o;return t=quanto.get_selected_rows($("#backtest-feed-table")),i=t[0].find("td.backtest-index").first().text().trim(),o=t[1].find("td.backtest-index").first().text().trim(),e=$.map(t,function(){return function(t){return $(t).data("backtest-id")}}(this)),n=e[0],r=e[1],mixpanel.track("backtest diff"),$.get("/backtests/get_source",{backtest_ids:[n,r]},function(t){return function(e){var a,s,l,u,c;return l=new quanto.JsonResponse(e),l.ok()?(c=l.data().sources,s=c[n],u=c[r],s.backtest_number=i,u.backtest_number=o,a=t.get_diffs(s.algocode,u.algocode),t.render_diffs(a),t.render_metadata(s,u)):void 0}}(this))},t.prototype.render_metadata=function(t,e){var n;return n=function(){return function(t,e,n){var i,r,o,a;return r="<td class='backtest-title'>",r+=e?"<div class='highlight diff-red'>Backtest "+t.backtest_number+"</div>":"<div class='highlight diff-green'>Backtest "+t.backtest_number+"</div>",r+="</td>",a=quanto.date.format_date("%Y-%m-%d",quanto.date.adjust_date_for_UTC(new Date(t.started_at))),r+="<td class='backtest-date'>"+a+"</td>",o=quanto.date.format_date("%Y-%m-%d",quanto.date.adjust_date_for_UTC(new Date(t.start_date))),i=quanto.date.format_date("%Y-%m-%d",quanto.date.adjust_date_for_UTC(new Date(t.end_date))),r+="<td class='backtest-daterange'>"+o+" to "+i+"</td>",r+="<td class='granularity'>"+_.str.capitalize(t.granularity)+"</td>",r+="<td class='capital-base'>"+new Number(t.capital_base).toMoney(0)+"</td>",r+="<td class='backtest-returns'>"+Math.floor(1e4*t.returns)/100+"%</td>",n.html(r)}}(this),n(t,!0,$("#first-backtest-metadata")),n(e,!1,$("#second-backtest-metadata"))},t.prototype.get_diffs=function(t,e){var n,i,r,o,a,s;return r=new diff_match_patch,n=r.diff_linesToChars_(t,e),a=n.chars1,s=n.chars2,o=n.lineArray,i=r.diff_main(a,s,!1),r.diff_charsToLines_(i,o),i},t.prototype.split_diff_list=function(t){var e;return e=t.split("\n"),""===_.last(e)&&e.pop(),e},t.prototype.render_diffs=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,_,f;for(e=$(".diff-result"),e.html(""),r=1,l=1,u=Handlebars.compile("<tr><td class='line'>{{left_index}}</td><td class='line'>{{right_index}}</td><td class='code {{row_class}}'><pre>{{code}}</pre></td></tr>"),i=!1;t.length>0;)if(s=t.splice(0,1)[0],n=s[0],0===n)for(a=this.split_diff_list(s[1]),c=0,p=a.length;p>c;c++)o=a[c],e.append(u({left_index:r,right_index:l,code:o})),r++,l++;else if(-1===n)for(i=!0,a=this.split_diff_list(s[1]),d=0,_=a.length;_>d;d++)o=a[d],e.append(u({left_index:r,row_class:"removed",code:o})),r++;else if(1===n)for(i=!0,a=this.split_diff_list(s[1]),h=0,f=a.length;f>h;h++)o=a[h],e.append(u({right_index:l,row_class:"added",code:o})),l++;return i?($(".diff-message").addClass("hidden"),$(".diff-table-container").removeClass("with-message")):($(".diff-message").html("The two backtests have identical code.").removeClass("hidden"),$(".diff-table-container").addClass("with-message")),$("#diff-modal").modal({show:!0}),$(".diff-table-container").scrollTop(0)},t}()}.call(this),function(){var t;quanto.fakebacktester=t=function(){function t(t){this.ws=t,this.sent=0}return t.prototype.backtest_cancelled=!1,t.prototype.max_daily=365,t.prototype.cancel=function(){return this.backtest_cancelled=!0,this.send_done_data()},t.prototype.fake_backtest=function(t){return this.started_at=(new Date).getTime(),this.date_index=0,this.initial_money=t,this.portfolio_value=this.initial_money,this.benchmark_returns=0,this.generate_fake_realtime_data(!1)},t.prototype.fake_cumulative_data=function(){var t;return t={},t.alpha=Math.floor(10*Math.random()),t.volatility=Math.floor(10*Math.random()),t.total_returns=Math.floor(10*Math.random()),t.beta=Math.floor(10*Math.random()),t.benchmark_volatility=Math.floor(10*Math.random()),t.benchmark_returns=Math.floor(10*Math.random()),t.sharpe=Math.floor(10*Math.random()),t.max_drawdown=Math.floor(10*Math.random()),t},t.prototype.generate_fake_realtime_half_year=function(t){var e,n,i,r,o,a;for(null==t&&(t=!1),o={},n=[],this.max_daily=365,r=a=0;180>=a;r=++a)e={},e.date=11991456e5+864e5*r,e.pnl=Math.floor(.05*(Math.random()-.5)*this.initial_money),e.cumulative=this.fake_cumulative_data(),this.portfolio_value=this.portfolio_value+e.pnl,e.portfolio_value=this.portfolio_value,this.benchmark_returns=this.benchmark_returns+.1*(Math.random()-.5),e.benchmark_cumulative_perf=this.benchmark_returns,n.push(e),o.started_at=this.started_at,180===r&&(o.cumulative=this.fake_cumulative_data());return o.progress=Math.floor(100*(r/364)),o.daily=n,i={},i.e="performance",i.p=o,this.ws.send(JSON.stringify(i)),this.date_index=181,this.generate_fake_realtime_data(t)},t.prototype.generate_fake_realtime_data_year=function(t){var e,n,i,r,o,a,s,l;for(null==t&&(t=!1),s={},n=[],o=364,r=0,t&&(o=11),r=l=0;o>=0?o>=l:l>=o;r=o>=0?++l:--l){if(this.backtest_cancelled)return;s.started_at=this.started_at,e={},e.date=11991456e5+864e5*r,e.pnl=Math.floor(.05*(Math.random()-.5)*this.initial_money),e.cumulative=this.fake_cumulative_data(),this.portfolio_value=this.portfolio_value+e.pnl,e.portfolio_value=this.portfolio_value,this.benchmark_returns=this.benchmark_returns+.1*(Math.random()-.5),e.benchmark_cumulative_perf=this.benchmark_returns,n.push(e),r===o&&(a={},a.alpha=Math.floor(10*Math.random()),a.volatility=Math.floor(10*Math.random()),a.total_returns=Math.floor(10*Math.random()),a.beta=Math.floor(10*Math.random()),a.benchmark_volatility=Math.floor(10*Math.random()),a.benchmark_returns=Math.floor(10*Math.random()),a.sharpe=Math.floor(10*Math.random()),a.max_drawdown=Math.floor(10*Math.random()),s.cumulative=a)}return s.progress=Math.floor(100*(r/o)),s.daily=n,i={},i.e="performance",i.p=s,this.ws.send(JSON.stringify(i)),t?(this.send_error(),void 0):this.send_done_data()},t.prototype.send_error=function(){var t,e;e={},e.e="error",t={},t.title="Line 11: Divide by Zero",t.details="stacktrace line 1\nstacktrace line 2\nstacktrace line 3\nstacktrace line 4\nstacktrace line 1\nstacktrace line 2\nstacktrace line 3\nstacktrace line 4\nstacktrace line 1\nstacktrace line 2\nstacktrace line 3\nstacktrace line 4\nstacktrace line 1\nstacktrace line 2\nstacktrace line 3\nstacktrace line 4\n",t.completed_at=(new Date).getTime(),e.p=t,this.ws.send(JSON.stringify(e))},t.prototype.generate_fake_realtime_data=function(t){var e,n,i,r,o,a,s;return null==t&&(t=!1),this.backtest_cancelled?void 0:this.date_index<this.max_daily?(o={},o.e="performance",r={},n={},n.date=11991456e5+864e5*this.date_index,n.pnl=Math.floor(.05*(Math.random()-.5)*this.initial_money),n.cumulative=this.fake_cumulative_data(),s=[],a={},a.cost_basis=50,a.amount=100,a.last_sale=55,a.sid=504,s.push(a),n.positions=s,n.ending_cash=85e4,this.portfolio_value=this.portfolio_value+n.pnl,n.portfolio_value=this.portfolio_value,this.benchmark_returns=this.benchmark_returns+.1*(Math.random()-.5),n.benchmark_cumulative_perf=this.benchmark_returns,i=[],i.push(n),r.daily=i,e={},e.alpha=Math.floor(10*Math.random()),e.volatility=Math.floor(10*Math.random()),e.total_returns=Math.floor(10*Math.random()),e.beta=Math.floor(10*Math.random()),e.benchmark_volatility=Math.floor(10*Math.random()),e.benchmark_returns=Math.floor(10*Math.random()),e.sharpe=Math.floor(10*Math.random()),e.max_drawdown=Math.floor(10*Math.random()),r.cumulative=e,r.percent_complete=this.date_index/365,r.started_at=this.started_at,o.p=r,t&&10===this.sent?(this.send_error(),void 0):(this.ws.send(JSON.stringify(o)),this.date_index++,this.sent++,setTimeout(function(e){return function(){return e.generate_fake_realtime_data(t)}}(this),10))):this.send_done_data()},t.prototype.send_done_data=function(){var t,e;return e={},e.e="risk_report",t={alpha:{"January 2008":{m:"1","3m":"2","6m":"3"},"February 2008":{m:"4","3m":"5","6m":"6"}},beta:{"January 2008":{m:"7","3m":"8","6m":"9"},"February 2008":{m:"10","3m":"11","6m":"12"}},total_returns:{"January 2008":{m:"13","3m":"14","6m":"15"},"February 2008":{m:"16","3m":"17","6m":"18"}},volatility:{"January 2008":{m:"19","3m":"20","6m":"21"},"February 2008":{m:"22","3m":"23","6m":"24"}},sharpe:{"January 2008":{m:"25","3m":"26","6m":"27"},"February 2008":{m:"28","3m":"29","6m":"30"}},maxdrawdown:{"January 2008":{m:"31","3m":"32","6m":"33"},"February 2008":{m:"34","3m":"35","6m":"36"}}},e.p={metrics:t,completed_at:(new Date).getTime()},this.backtest_cancelled&&(e.p.cancelled=!0),this.ws.send(JSON.stringify(e)),e.e="done",e.p="fake",this.ws.send(JSON.stringify(e))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.FrontpageConfigManager=t=function(){function t(){this.update_config=e(this.update_config,this),$("#update-frontpage-button").on("click",function(t){return function(){return t.update_config()}}(this))}return t.prototype.update_config=function(){var t,e,n;return e=$.trim($("#featuredId").val()),n=$.trim($("#featuredPostIds").val()),t={featured_id:e,featured_post_ids:n},$("#update-frontpage-button").addClass("disabled").html("Updating..."),$.post("/internal/update_frontpage_config",t,function(){return function(t){var e;return $("#update-frontpage-button").removeClass("disabled").html("Update"),e=new quanto.JsonResponse(t),e.ok()?$(".update-result").html("success!"):$(".update-result").html("failure, reload page and try again")}}(this)).error(function(){return function(){return $("#update-frontpage-button").removeClass("disabled").html("Update"),$(".update-result").html("failure, reload page and try again")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.FundDiffManager=t=function(){function t(){this.render_diffs=e(this.render_diffs,this),this.split_diff_list=e(this.split_diff_list,this),this.get_diffs=e(this.get_diffs,this),this.trigger_diff=e(this.trigger_diff,this),$("#diff-revision-dropdown").on("change",function(t){return function(e){return t.trigger_diff($(e.target).find(":selected").data("id"))}}(this))}return t.prototype.trigger_diff=function(t){var e;return e=$("#code-snapshot-textbox").val(),$.get("/fund/get_source",{revision_ids:[t]},function(n){return function(i){var r,o,a,s;return o=new quanto.JsonResponse(i),o.ok()?(s=o.data().sources,a=s[t],r=n.get_diffs(a.algocode,e),n.render_diffs(r)):void 0}}(this)).error(function(){return function(){return quanto.show_error_popup()}}(this))},t.prototype.get_diffs=function(t,e){var n,i,r,o,a,s;return r=new diff_match_patch,n=r.diff_linesToChars_(t,e),a=n.chars1,s=n.chars2,o=n.lineArray,i=r.diff_main(a,s,!1),r.diff_charsToLines_(i,o),i},t.prototype.split_diff_list=function(t){var e;return e=t.split("\n"),""===_.last(e)&&e.pop(),e},t.prototype.render_diffs=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,_,f,m,g,v,b,y,w,k,x;for(e=$(".diff-result"),e.html(""),_=Handlebars.compile("<tr><td class='line'>{{left_index}}</td><td class='line'>{{right_index}}</td><td class='code {{row_class}}'><pre>{{code}}</pre></td></tr>"),f=3,a=1,p=1,i=!1,o=m=0,y=t.length;y>m;o=++m)if(r=t[o],h=t[o-1],d=t[o+1],n=r[0],0===n)for(c=this.split_diff_list(r[1]),l=c.length-1,u=g=0,w=c.length;w>g;u=++g)s=c[u],null!=h&&f>u?e.append(_({left_index:a,right_index:p,code:s})):null!=d&&f>l-u&&e.append(_({left_index:a,right_index:p,code:s})),a++,p++;else if(-1===n)for(i=!0,c=this.split_diff_list(r[1]),v=0,k=c.length;k>v;v++)s=c[v],e.append(_({left_index:a,row_class:"removed",code:s})),a++;else if(1===n)for(i=!0,c=this.split_diff_list(r[1]),b=0,x=c.length;x>b;b++)s=c[b],e.append(_({right_index:p,row_class:"added",code:s})),p++;return i?($(".diff-message").addClass("hidden"),$(".diff-table-container").removeClass("with-message")):($(".diff-message").html("The two revisions have identical code.").removeClass("hidden"),$(".diff-table-container").addClass("with-message")),$("#diff-section").removeClass("hidden")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.FundamentalsAutocompleteManager=t=function(t){function n(){this.handle_text_changed=e(this.handle_text_changed,this),this.matches_text=e(this.matches_text,this),this.perform_search=e(this.perform_search,this),this.select=e(this.select,this),this.get_fd_data=e(this.get_fd_data,this);var t;n.__super__.constructor.call(this),t=$("#fd-intellisense-box"),this.$dropdown=t,this.$input=this.$dropdown.find("input"),this.last_query="",this.$input.on("keydown",this.keydown),this.$input.on("keypress",this.keypress),this.$input.on("keyup",this.keyup),this.$input.on("blur",this.blur),this.ignore_backspace=!1,this.$listbox=this.$dropdown.find(".matchlist"),this.$listbox.on("mouseenter",".match",$.proxy(this.mouseenter,this)),this.$listbox.on("click",$.proxy(this.click,this)),($.browser.webkit||$.browser.msie)&&this.$input.on("keydown",$.proxy(this.keypress,this)),this.$match_template=Handlebars.compile("<div class='match' data-tablename='{{tn}}' data-fieldname='{{f}}'><span class='fieldname'>{{fh}}</span><span class='tablename'>{{tnh}}</span></div>"),this.STRINGS_TO_MATCH=["fundamentals","morningstar"]}return i(n,t),n.prototype.get_fd_data=function(){var t,e,n;return t=this.$listbox.find(".active"),0!==t.length?(n=t.data("tablename"),e=t.data("fieldname"),{table:n,field:e}):void 0},n.prototype.select=function(){var t;return t=this.get_fd_data(),null!=t?quanto.editor.replaceRange(""+t.table+"."+t.field,quanto.editor.getCursor()):void 0},n.prototype.perform_search=function(){var t;return t=this.$input.val(),null!=t&&t.length>0&&t!==this.last_query?(this.last_query=t,null!=this.query_timer&&clearTimeout(this.query_timer),this.query_timer=setTimeout(function(e){return function(){return $.get("/fundamentals/autocomplete",{q:t},function(t){var n;return n=new quanto.JsonResponse(t),n.ok()&&null!=n.data()&&null!=n.data().matches?e.populate_matches(n.data().matches,n.data().query):void 0})}}(this),75)):this.last_query=""},n.prototype.matches_text=function(t){var e,n,i,r;for(r=this.STRINGS_TO_MATCH,n=0,i=r.length;i>n;n++)if(e=r[n],t===e)return!0;return!1},n.prototype.handle_text_changed=function(t,e){var n,i,r,o;if(i=!1,1===e.text.length&&"."===e.text[0]&&this.matches_text(t.cm.getTokenAt(e.to).string))i=!0;else if(1===e.text.length&&"+delete"===e.origin){if(e.from.ch<4)return!1;if(r=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch}),"."!==r.string)return!1;if(n=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch-1}),!this.matches_text(n.string))return!1;i=!0}return i?(o=t.cm.cursorCoords(),this.$dropdown.css("left",o.left+"px").css("top",o.top-102+"px"),this.reset(),this.$dropdown.show(),this.$dropdown.find("input").focus(),!0):!1},n}(quanto.LookupManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.IdeManager=t=function(){function t(){this.persist_prefs=e(this.persist_prefs,this),this.load_prefs=e(this.load_prefs,this),this.bind_toolbar_events=e(this.bind_toolbar_events,this),this.clear_active_line=e(this.clear_active_line,this),this.initialize_codemirror=e(this.initialize_codemirror,this),this.initialize_lookup_managers=e(this.initialize_lookup_managers,this),this.set_editor_readonly=e(this.set_editor_readonly,this),this.maybe_show_q2_message=e(this.maybe_show_q2_message,this),this.initializing=!0,this.initialize_codemirror(),this.initialize_lookup_managers(),this.$font_field=$("#font-pref-field"),this.$theme_field=$("#theme-pref-field"),this.bind_toolbar_events(),this.load_prefs(),quanto.instances.vm=new quanto.ValidationManager,(quanto_data.de||quanto.is_employee_or_admin())&&(quanto.instances.dbuim=new quanto.DebugUIManager,quanto.instances.dbm=new quanto.DebugManager,quanto.instances.bpm=new quanto.BreakpointManager),this.initializing=!1,this.maybe_show_q2_message(),quanto.instances.ism=new quanto.IDESearchManager,quanto.is_anonymous()&&($("#validate-button").popover({placement:"right",trigger:"manual",content:"Click this button to run a backtest.  Results will appear on the right.",template:'<div class="popover popover-large"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><p></p></div></div></div>'}).popover("show"),$(document).bind("validation_triggered",function(){return function(){return $("#validate-button").popover("hide")}}(this)))}return t.initializing=!1,t.prototype.maybe_show_q2_message=function(){var t,e,n,i;if(i=quanto_data.show_q2_welcome_message,n=quanto_data.from_q2_migration,i)e="Welcome to Quantopian 2!",t=n?"We've rebuilt the Quantopian platform to be faster, more powerful, and more accurate. Most of your existing algorithms will work fine - just faster! This algorithm has been migrated to work with the new Q2 API. Although the code will be different, the investment rationale has not changed. We've put everything you need to know <a href='/q2' target='_blank'>here</a> on one page.":"We've rebuilt the Quantopian platform to be faster, more powerful, and more accurate. Most of your existing algorithms will work fine - just faster! Some algorithms will need to be modified to work with the new Q2 API. We've put everything you need to know <a href='/q2' target='_blank'>here</a> on one page.";else{if(!n)return;e="Important Message",t="We have migrated this algorithm to work with a new version of the Quantopian API. The code will be different than the original that was shared, but the investment rationale of the algorithm has not changed. We've put everything you need to know <a href='/q2' target='_blank'>here</a> on one page."}return quanto.show_message_popup(e,t)},t.prototype.set_editor_readonly=function(t){return null!=quanto.editor?quanto.editor.setOption("readOnly",t):void 0},t.prototype.initialize_lookup_managers=function(){return this.sid_lookup_manager=new quanto.SIDLookupManager,this.symbol_lookup_manager=new quanto.SymbolLookupManager,this.fundamentals_lookup_manager=new quanto.FundamentalsAutocompleteManager,this.account_manager=new quanto.AccountDropdownManager,this.portfolio_manager=new quanto.PortfolioDropdownManager,this.position_manager=new quanto.PositionDropdownManager,this.context_manager=new quanto.ContextDropdownManager,this.data_manager=new quanto.DataDropdownManager,this.log_manager=new quanto.LogDropdownManager,this.slippage_manager=new quanto.SlippageDropdownManager,this.commission_manager=new quanto.CommissionDropdownManager,this.style_manager=new quanto.StyleDropdownManager,this.timerule_manager=new quanto.TimeRuleDropdownManager,this.timerules_manager=new quanto.TimeRulesDropdownManager,this.daterule_manager=new quanto.DateRuleDropdownManager,this.daterules_manager=new quanto.DateRulesDropdownManager,this.maxordercount_manager=new quanto.MaxOrderCountDropdownManager,this.order_manager=new quanto.OrderDropdownManager,this.get_manager=new quanto.GetDropdownManager,this.tradingcontrols_manager=new quanto.SetDropdownManager,this.talib_manager=new quanto.TALibDropdownManager,this.security_lists_manager=new quanto.SecurityListDropdownManager,this.dropdown_mgrs=[],this.dropdown_mgrs.push(this.sid_lookup_manager),this.dropdown_mgrs.push(this.symbol_lookup_manager),this.dropdown_mgrs.push(this.fundamentals_lookup_manager),this.dropdown_mgrs.push(this.log_manager),this.dropdown_mgrs.push(this.account_manager),this.dropdown_mgrs.push(this.portfolio_manager),this.dropdown_mgrs.push(this.position_manager),this.dropdown_mgrs.push(this.data_manager),this.dropdown_mgrs.push(this.context_manager),this.dropdown_mgrs.push(this.slippage_manager),this.dropdown_mgrs.push(this.commission_manager),this.dropdown_mgrs.push(this.style_manager),this.dropdown_mgrs.push(this.timerule_manager),this.dropdown_mgrs.push(this.timerules_manager),this.dropdown_mgrs.push(this.daterule_manager),this.dropdown_mgrs.push(this.daterules_manager),this.dropdown_mgrs.push(this.maxordercount_manager),this.dropdown_mgrs.push(this.order_manager),this.dropdown_mgrs.push(this.get_manager),this.dropdown_mgrs.push(this.tradingcontrols_manager),this.dropdown_mgrs.push(this.talib_manager),this.dropdown_mgrs.push(this.security_lists_manager),this.toplevel_tooltip_mgr=new quanto.TopLevelTooltipManager,this.fetchcsv_tooltip_mgr_watcher=new quanto.FetchCSVTooltipManager,this.toplevel_tooltip_watcher=new quanto.TopLevelTooltipWatcher
},t.prototype.initialize_codemirror=function(){var t;return t=document.getElementById("codebox"),null!=t?(quanto.editor=CodeMirror.fromTextArea(t,{lineNumbers:!0,mode:"python",matchBrackets:!0,indentUnit:4,tabSize:4,lineWrapping:!0,gutters:["CodeMirror-foldgutter","CodeMirror-linenumbers"],extraKeys:{Tab:function(){return function(t){return t.replaceSelection("    ","end")}}(this),"Cmd-/":function(){return function(t){return CodeMirror.commands.toggleComment(t)}}(this),"Ctrl-/":function(){return function(t){return CodeMirror.commands.toggleComment(t)}}(this)},foldGutter:{rangeFinder:new CodeMirror.fold.combine(CodeMirror.fold.indent,CodeMirror.fold.comment)}}),document.addEventListener("paste",function(){return function(t){var e;return $(t.target).closest(".CodeMirror").length>0&&(window.clipboardData&&window.clipboardData.getData?e=window.clipboardData.getData("Text"):t.clipboardData&&t.clipboardData.getData&&(e=t.clipboardData.getData("text/plain")),null!=e)?(quanto.editor.replaceSelection(e.replace(/\t/g,"    ")),t.preventDefault(),!1):void 0}}(this)),quanto.editor.on("keydown",function(t){return function(e,n){var i,r,o,a;for(a=t.dropdown_mgrs,r=0,o=a.length;o>r;r++)if(i=a[r],i.shown&&i.handle_key_event&&i.handle_key_event(e,n))return n.preventDefault(),!0;return quanto.instances.km.handle_key_event($.event.fix(n))}}(this)),quanto.editor.doc.on("change",function(t){return function(e,n){var i,r,o,a,s,l,u,c;if(!(null!=quanto.lock_editor&&quanto.lock_editor||(r="undefined"!=typeof TogetherJS&&null!==TogetherJS?TogetherJS.require("forms"):void 0,null!=r?r.inRemoteUpdate:0))){for("undefined"!=typeof quanto&&null!==quanto&&null!=(l=quanto.instances)&&null!=(u=l.sm)&&u.update_button_save(),c=t.dropdown_mgrs,a=0,s=c.length;s>a;a++)if(o=c[a],o.handle_text_changed(e,n))return;return t.toplevel_tooltip_watcher.handle_key_event(e,n),i=$.Event("editor_change"),i.editor=e.cm,i.q_data=n,$(document).trigger(i)}}}(this)),quanto.editor.doc.on("cursorActivity",function(t){return function(e){var n,i,r,o;for(o=t.dropdown_mgrs,i=0,r=o.length;r>i;i++)n=o[i],n.handle_cursor_activity(e);return $(document).trigger("editor_cursor_activity")}}(this)),$(document).bind("set_active_line",function(t){return function(e,n){var i,r,o,a,s,l;return t.clear_active_line(),null==n||(t.current_highlighted_line_info=quanto.editor.lineInfo(n),quanto.editor.addLineClass(t.current_highlighted_line_info.line,"background","breakpoint-activeline"),a=quanto.editor.getScrollInfo(),l=a.top,r=a.clientHeight,o=new CodeMirror.Pos(n,0),i=quanto.editor.charCoords(o,"local"),i.top>l&&i.top<l+r)?void 0:(s=i.top-r/2,0>s&&(s=0),quanto.editor.scrollTo(0,s))}}(this)),$(document).bind("execution_resumed backtest_cancelled clear_active_line",function(t){return function(){return t.clear_active_line()}}(this))):void 0},t.prototype.clear_active_line=function(){return null!=this.current_highlighted_line_info?(quanto.editor.removeLineClass(this.current_highlighted_line_info.line,"background","breakpoint-activeline"),this.current_highlighted_line_info=null):void 0},t.prototype.bind_toolbar_events=function(){return $("#fontsize-pref li").bind("click",function(t){return function(e){var n;return n=$(e.currentTarget).data("fontsize"),null!=quanto.editor?($(".CodeMirror").removeClass("font-small font-large"),("small"===n||"large"===n)&&$(".CodeMirror").addClass("font-"+n),t.$font_field.val(n),t.persist_prefs()):void 0}}(this)),$("#theme-pref li").bind("click",function(t){return function(e){var n,i;return n=$(e.currentTarget).data("theme"),null!=quanto.editor?(i="ambiance"===n?"dark":"light",$(document).trigger("color_theme_changed",i),quanto.editor.setOption("theme",n),t.$theme_field.val(n),t.persist_prefs()):void 0}}(this))},t.prototype.load_prefs=function(){var t,e;return t=$("input[type='hidden'][name='fontpref']").val(),null!=t&&t.length>0&&$("#fontsize-pref li[data-fontsize='"+t+"']").trigger("click"),e=$("input[type='hidden'][name='themepref']").val(),null!=e&&e.length>0?$("#theme-pref li[data-theme='"+e+"']").trigger("click"):void 0},t.prototype.persist_prefs=function(){var t;if(!this.initializing)return t={fontsize:this.$font_field.val(),theme:this.$theme_field.val()},$.post("/users/update_ide_preferences",t)},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.IDESearchManager=t=function(){function t(){this.clearSearch=e(this.clearSearch,this),this.findNext=e(this.findNext,this),this.parseQuery=e(this.parseQuery,this),this.getSearchCursor=e(this.getSearchCursor,this),this.getSearchState=e(this.getSearchState,this),this.doSearch=e(this.doSearch,this),this.hide_searchbox=e(this.hide_searchbox,this),$(document).bind("ide_search",function(t){return function(e,n){return t.clearSearch(quanto.editor),t.doSearch(n)}}(this)),$("#ide-searchbox").on("keydown",function(t){return function(e){var n;switch(e.keyCode){case 13:if(n=t.getSearchState(quanto.editor),null!=n.query&&n.query.length>0)return t.findNext(quanto.editor);break;case 27:return t.hide_searchbox();default:return setTimeout(function(){var e;return e=$("#ide-searchbox").val(),n=t.getSearchState(quanto.editor),e!==n.query?t.doSearch(e):void 0},10)}}}(this)),$(".hide-search").on("click",function(t){return function(){return t.hide_searchbox()}}(this)),CodeMirror.commands.find=function(){return function(){return $(".ide-search").removeClass("hidden"),setTimeout(function(){return $("#ide-searchbox").focus()},10)}}(this)}return t.prototype.hide_searchbox=function(){return this.clearSearch(quanto.editor),$("#ide-searchbox").val(""),$(".ide-search").addClass("hidden")},t.prototype.doSearch=function(t){var e;return null!=t&&t.length>0?(e=this.getSearchState(quanto.editor),e.query=this.parseQuery(t),this.findNext(quanto.editor)):this.clearSearch(quanto.editor)},t.prototype.getSearchState=function(t){return null==t._searchState&&(t._searchState={posFrom:null,posTo:null,query:null,marked:[]}),t._searchState},t.prototype.getSearchCursor=function(t,e,n){return t.getSearchCursor(e,n,"string"==typeof e&&(e=e.toLowerCase()))},t.prototype.parseQuery=function(t){var e;return e=t.match(/^\/(.*)\/([a-z]*)$/),e?-1===e[2].indexOf("i")?new RegExp(e[1],""):new RegExp(e[1],"i"):t},t.prototype.findNext=function(t){return t.operation(function(e){return function(){var n,i,r;return r=e.getSearchState(t),n=e.getSearchCursor(t,r.query,r.posTo),null!=r.marker&&r.marker.clear(),n.find(!1)||(i={line:0,ch:0},n=e.getSearchCursor(t,r.query,i),n.find(!1))?(t.setSelection(n.from(),n.to()),r.marker=t.markText(n.from(),n.to(),{className:"search-match",addToHistory:!1,clearOnEnter:!0}),r.posFrom=n.from(),r.posTo=n.to()):void 0}}(this))},t.prototype.clearSearch=function(t){return t.operation(function(e){return function(){var n,i,r,o,a;if(i=e.getSearchState(t),null!=i.marker&&i.marker.clear(),i.query){for(i.query=null,a=i.marked,r=0,o=a.length;o>r;r++)n=a[r],n.clear();return i.marked.length=0}}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.KeyboardManager=t=function(){function t(){this.handle_key_event=e(this.handle_key_event,this),$(document).bind("keydown",this.handle_key_event)}return t.prototype.handle_key_event=function(t){var e;if(t.ctrlKey||t.metaKey){switch(e=!0,t.keyCode){case 83:$(document).trigger("manual_save");break;case 66:$(document).trigger("maybe_validate_algo");break;default:e=!1}e&&this.stop(t)}return 27===t.keyCode?$(document).trigger("exit_fullscreen"):void 0},t.prototype.stop=function(t){return t.preventDefault(),t.stopPropagation()},t}()}.call(this),function(){var t;quanto.LeaderboardLandingManager=t=function(){function t(){quanto.on_click(".archives-link",function(){return function(){return $(".old-leaderboards").toggleClass("hidden"),"Show old leaderboards"===$(".archives-link").html()?$(".archives-link").html("Hide old leaderboards"):$(".archives-link").html("Show old leaderboards")}}(this))}return t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LeaderboardManager=t=function(){function t(t){this.initialize_leaderboard_table=e(this.initialize_leaderboard_table,this),this.initialize_user_table=e(this.initialize_user_table,this),this.initialize_user_table(t),this.initialize_leaderboard_table(t),$(".dropdown-menu-option").on("click",function(t){var e,n;return e=$(quanto.get_src_element(t)),n=e.data("toggleName"),$(".dropdown-button span").html(n)}),$("body").on("touchstart.dropdown",".dropdown-menu",function(t){t.stopPropagation()}),quanto.on_click(".close-button",function(){return function(){return $(".contest-information-banner").hide()}}(this))}return t.prototype.initialize_user_table=function(t){var e;return e=$("#user-table").DataTable({info:!1,iDisplayLength:50,bLengthChange:!1,filter:!1,bPaginate:!1,oLanguage:{sEmptyTable:"Loading..."},aoColumnDefs:[{bSortable:!1,aTargets:["_all"]}]}),$("#user-table").css("visibility","visible"),$(document).on("click","#user-table tbody tr",function(e){var n;return quanto.is_mobile_screen()&&$(quanto.get_src_element(e)).hasClass("beta-badge")||(n=$(this).data("submission_id"),null==n)?void 0:window.location="/leaderboard/"+t+"/"+n})},t.prototype.initialize_leaderboard_table=function(t){var e;return e=$("#leaderboard-table").DataTable({info:!1,iDisplayLength:50,bLengthChange:!1,filter:!1,oLanguage:{sEmptyTable:"Loading..."},aoColumnDefs:[{bSortable:!1,aTargets:["_all"]}],pagingType:"simple_numbers",fnDrawCallback:function(t){var e,n;return t._iDisplayStart!==e?(n=$("body").offset().top,$("html,body").animate({scrollTop:n},0),e=t._iDisplayStart):void 0}}),$("#leaderboard-table").css("visibility","visible"),$(document).on("click","#leaderboard-table tbody tr",function(e){var n;return quanto.is_mobile_screen()&&$(quanto.get_src_element(e)).hasClass("beta-badge")||(n=$(this).data("submission_id"),null==n)?void 0:window.location="/leaderboard/"+t+"/"+n})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.PositionVizManager=t=function(t){function n(){this.group_by_day_internal=e(this.group_by_day_internal,this),this.format_group_row=e(this.format_group_row,this),this.format_date=e(this.format_date,this),this.get_columns=e(this.get_columns,this),this.$positions_tab=$("#tab-positioninfo"),n.__super__.constructor.call(this,this.$positions_tab,"positions"),this.ticker_filter.append_cash_row=!0,this.position_data=[],this.sid_info_list={},this.missing_sid_list={},this.position_count=0,this.max_position=null,this.min_position=null,this.max_gains=null,this.min_gains=null,this.groups_ascending=!0,this.is_grouped=!0,this.$position_info_table=this.$positions_tab.find(".position-info-table"),Handlebars.registerHelper("position_date",function(){return function(t){return quanto.date.format_date("%Y-%m-%d",new Date(t))}}(this)),Handlebars.registerHelper("format_money",quanto.safe_to_money),this.group_row_template=Handlebars.compile('<span class="group-row-cell left-cell slick-cell l0 r3" data-row="{{row}}"> <a href="#" class="expand-row-link"> <i class="icon slick-group-toggle {{icon_class}}" style="margin-left: {{indentation}}"></i> <span class="group-date">{{position_date value}}</span> </a> {{#if description}} <span class="dash">-</span><span class="{{description_class}}">{{description}}</span> {{/if}} </span> <span class="group-row-cell slick-cell l4 r4 position-column"> <span class="number"> {{format_money position_total}} </span> </span> <span class="group-row-cell slick-cell l5 r5 gains-column"> {{#if gains_total}} <span class="number"> {{format_money gains_total}} </span> {{else}} <span class="number no-value">- -&nbsp</span> {{/if}} </span>'),this.$grouping_button=this.$positions_tab.find(".group-by-day"),this.$grouping_button.button(),this.$grouping_button.click(this.handle_group_button_clicked)}return i(n,t),n.prototype.save_position_data=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,_,f;if(d=t.positions||t.p,null!=d){for(r=t.date||t.d,a=_=0,f=d.length;f>_;a=++_)l=d[a],i=l.cost_basis||l.cb,s=l.last_sale_price||l.ls,h=l.amount||l.a,c=s*h,o=(s-i)*h,p=l.sid||l.s,u={quantity:h,price:s,position:c,gains:o,date:r,sid:p,ticker:p},this.handle_row_data(u);return e=t.ending_cash||t.ec,n={position:e,date:r,ticker:"Cash",sid:"Cash"},this.handle_row_data(n)}},n.prototype.get_columns=function(){return[{name:"Date",field:"date",type:"date",minWidth:130,resizable:!1},{name:"Security",field:"ticker",type:"ticker",minWidth:130,width:160},{name:"Last Sale Price",field:"price",type:"money",minWidth:160},{name:"Quantity",field:"quantity",type:"number",minWidth:126},{name:"Position",field:"position",type:"money",showTotal:!0,minWidth:160,rightAlignFilter:!0},{name:"Gains",field:"gains",type:"money",showTotal:!0,minWidth:160,rightAlignFilter:!0}]},n.prototype.format_date=function(t,e,n){var i;return i=new Date(n),this.is_grouped?"":quanto.date.format_date("%Y-%m-%d",i)},n.prototype.format_group_row=function(t,e,n,i,r){return r.indentation=15*r.level+"px",r.icon_class=0===r.collapsed?"icon-chevron-down":"icon-chevron-right",r.position_total=r.totals.sum.position,r.gains_total=r.totals.sum.gains,r.row=t,quanto.date.are_same_date(new Date(r.value),new Date(this.date_filter.min_value))?(r.description="Backtest starts",r.description_class="start-label",this.group_row_template(r)):quanto.date.are_same_date(new Date(r.value),new Date(this.date_filter.max_value))?(r.description="Backtest ends",r.description_class="end-label",this.group_row_template(r)):this.group_row_template(r)},n.prototype.group_by_day_internal=function(){return this.data_view.setGrouping({getter:function(){return function(t){return t.date}}(this),comparer:this.get_group_comparer(),aggregators:[new Slick.Data.Aggregators.Sum("position"),new Slick.Data.Aggregators.Sum("gains")],aggregateCollapsed:!1,lazyTotalsCalculation:!1,displayTotalsRow:!0})},n.prototype.get_position_values_for_day=function(t){return this.extract_position_data(t,function(t){return t.value})},n.prototype.get_position_gainloss_for_day=function(t){return this.extract_position_data(t,function(t){return t.gains},!1)},n.prototype.extract_position_data=function(t,e,n){var i,r,o,a,s,l;for(null==n&&(n=!0),i=[],r=n?this.position_sid_list:this.position_sid_list_no_cash,s=0,l=r.length;l>s;s++)a=r[s],o=this.position_data[t][a],null!=o?i.push(e(o)):i.push(0);return i},n.prototype.translate_sid=function(t){return"_quanto_cash"===t?"Cash":quanto.sid_cache.get_ticker(t)},n}(quanto.BacktestTableManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.RegisterLiveTradingManager=t=function(){function t(){this.handle_registration=e(this.handle_registration,this),quanto.on_click("#register-live-trading-button",function(t){return function(){return t.handle_registration()}}(this))}return t.prototype.handle_registration=function(){var t,e;return e={},e.currently_trading=$("input[name=traderadio]:checked").data("val"),e.trading_experience=$("#trade_experience").val(),e.account_size=$("input[name=accountsize]:checked").data("val"),e.ib_account=$("input[name=ib]:checked").data("val"),e.other_brokerage=$("#other_brokerage").val(),e.other_info=$("#other_info").val(),t={data:e},$("#register-live-trading-button").html("Submitting...").addClass("disabled"),$.post("/users/submit_livetrading_registration",t,function(){return function(t){var e;return e=new quanto.JsonResponse(t)}}(this)).error(function(){return function(){return alert("Sorry, there was a problem processing your information."),$("#register-live-trading-button").html("Register").removeClass("disabled")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.SaveManager=t=function(){function t(){this.warn_leaving=e(this.warn_leaving,this),this.autosave_needed=e(this.autosave_needed,this),this.get_data=e(this.get_data,this),this.trigger_save=e(this.trigger_save,this),this.$button=$("#algo-save-button"),this.button_ready=!0,this.$button.live("click",function(t){return function(){return t.trigger_save(!0)}}(this)),quanto.autosave_data=this.get_data(),this.schedule_autosave(),$(window).bind("beforeunload",this.warn_leaving),$(document).bind("collab_peer_changed_text",function(t){return function(){return t.collab_peer_changed_text=!0}}(this)),$(document).bind("editor_change",function(t){return function(){return t.current_user_changed_text=!0,t.update_button_save()}}(this)),$(document).bind("add_breakpoint remove_breakpoint modify_breakpoint",function(t){return function(){return t.breakpoints_changed=!0,t.update_button_save()}}(this)),$(document).bind("turn_on_autosave",function(t){return function(){return t.autosave_cancelled=!1,t.clear_timer(),t.schedule_autosave()}}(this)),$(document).bind("turn_off_autosave",function(t){return function(e,n){return t.autosave_cancelled=!0,null!=n&&n&&t.trigger_save(),t.clear_timer()}}(this)),$(document).bind("manual_save",function(t){return function(e,n){var i;return null==n&&(n={}),mixpanel.track("algorithm save clicked"),i={},null!=n.callback&&(i.callback=n.callback),t.trigger_save(i)}}(this))}return t.prototype.autosave_interval_ms=1e4,t.prototype.timer=null,t.prototype.autosave_cancelled=!1,t.prototype.collab_peer_changed_text=!1,t.prototype.current_user_changed_text=!1,t.prototype.breakpoints_changed=!1,t.prototype.trigger_save=function(t){var e,n,i,r,o;return null==t&&(t={}),i=t.callback,this.autosave_needed()?(quanto.autosave_data=this.get_data(),e=$("#algo-id").val(),r={id:e,title:$("#title-box").val(),code:$("#codebox").val()},n=null!=(o=quanto.instances.bpm)?o.get_breakpoints_info():void 0,null!=n&&(r.breakpoints=n),this.clear_timer(),this.update_button_saving(),$.post("/algorithms/"+e+"/autosave",r,function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()&&(t.autosave_cancelled||(t.update_button_saved(),t.schedule_autosave(),t.collab_peer_changed_text=!1,t.current_user_changed_text=!1,t.breakpoints_changed=!1)),null!=i?i():void 0}}(this)).error(function(t){return function(e){var n;return n=new quanto.JsonResponse(e),mixpanel.track("unauthorized autosave"),$("#unauth-modal").modal("show"),t.update_button_save()}}(this))):(null!=i&&i(),this.schedule_autosave())},t.prototype.get_data=function(){return null!=quanto.editor&&quanto.editor.save(),$("#title-box").val()+$("#codebox").val()},t.prototype.autosave_needed=function(){return this.breakpoints_changed?!0:this.collab_peer_changed_text&&!this.current_user_changed_text?!1:quanto.autosave_data!==this.get_data()},t.prototype.update_button_saving=function(){return this.button_ready=!1,this.$button.addClass("disabled busy").attr("disabled","disabled")},t.prototype.update_button_saved=function(){return this.button_ready?void 0:this.$button.removeClass("busy").addClass("done")},t.prototype.update_button_save=function(){return this.button_ready?void 0:(this.$button.removeClass("disabled busy done").attr("disabled",!1),this.button_ready=!0)},t.prototype.clear_timer=function(){return null!=this.timer?window.clearTimeout(this.timer):void 0},t.prototype.schedule_autosave=function(){return this.clear_timer(),this.timer=setTimeout(this.trigger_save,this.autosave_interval_ms)},t.prototype.warn_leaving=function(){return!this.autosave_cancelled&&this.autosave_needed()?"There are unsaved changes on this page.":void 0},t.prototype.bypass_leaving_warning=function(){return $(window).unbind("beforeunload",this.warn_leaving)},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SecurityFilter=t=function(t){function n(t,i){this.include_item=e(this.include_item,this),this.reset_filter=e(this.reset_filter,this),this.is_active=e(this.is_active,this),this.sort_comparer=e(this.sort_comparer,this),this.handle_filter_button_clicked=e(this.handle_filter_button_clicked,this),this.focus_on_search_box=e(this.focus_on_search_box,this),this.sort_if_needed=e(this.sort_if_needed,this),this.handle_selection_changed=e(this.handle_selection_changed,this),this.handle_grid_key_down=e(this.handle_grid_key_down,this),this.handle_grid_clicked=e(this.handle_grid_clicked,this),this.toggle_row_selected=e(this.toggle_row_selected,this),this.handle_text_input_key_up=e(this.handle_text_input_key_up,this),this.handle_text_input_click=e(this.handle_text_input_click,this),this.initialize_controls=e(this.initialize_controls,this),n.__super__.constructor.call(this,t,i),this.append_cash_row=!1}return i(n,t),n.prototype.initialize_controls=function(t){var e,i,r,o,a,s,l,u,c;for(n.__super__.initialize_controls.call(this,t),this.sid_infos=_.values(t),this.search_string="",this.append_cash_row&&this.sid_infos.push({name:"Cash",ticker:"Cash",sid:"Cash"}),c=this.sid_infos,l=0,u=c.length;u>l;l++)r=c[l],r.id=r.sid;return this.data_view=new Slick.Data.DataView({inlineFilters:!1,enableTextSelectionOnCells:!0}),s=function(t){return function(e){return null!=t.search_string&&-1===e.ticker.toLowerCase().indexOf(t.search_string.toLowerCase())&&-1===e.name.toLowerCase().indexOf(t.search_string.toLowerCase())&&-1===e.sid.indexOf(t.search_string)?!1:!0}}(this),this.data_view.beginUpdate(),this.data_view.setItems(this.sid_infos),this.data_view.setFilter(s),this.data_view.sort(this.sort_comparer,!0),this.data_view.endUpdate(),o=function(){return function(t,e,n,i,r){return"Cash"===r.sid?"<span class='label label-cash'>Cash</span>":"<span class='security-name'>"+_.str.titleize(r.name.toLowerCase())+"</span> <small class='security-ticker'>"+r.ticker.toLowerCase()+" ("+r.sid+")</small>"}}(this),e=new Slick.CheckboxSelectColumn({cssClass:"check-box-cell"}),i=[e.getColumnDefinition(),{id:"name",name:"Name",field:"name",formatter:o,sortable:!0,width:400}],a={enableCellNavigation:!0,fullWidthRows:!0,syncColumnCellResize:!0,rowHeight:32,forceFitColumns:!1,enableColumnReorder:!1},this.security_grid=new Slick.Grid(this.$filter_elem.find(".text-filter-grid"),this.data_view,i,a),this.security_grid.registerPlugin(e),this.security_grid.registerPlugin(new Slick.AutoTooltips),this.row_selection_model=new Slick.RowSelectionModel({selectActiveRow:!1}),this.row_selection_model.onSelectedRangesChanged.subscribe(this.handle_selection_changed),this.security_grid.setSelectionModel(this.row_selection_model),this.data_view.syncGridSelection(this.security_grid,!0,!0),this.security_grid.render(),this.data_view.onRowCountChanged.subscribe(function(t){return function(){return t.security_grid.updateRowCount(),t.security_grid.render()}}(this)),this.data_view.onRowsChanged.subscribe(function(t){return function(e,n){return t.security_grid.invalidateRows(n.rows),t.security_grid.render()}}(this)),this.$security_search=this.$filter_elem.find(".search-input"),this.$security_search.keyup(this.handle_text_input_key_up),this.$security_search.click(this.handle_text_input_click),this.security_grid.onClick.subscribe(this.handle_grid_clicked),this.security_grid.onKeyDown.subscribe(this.handle_grid_key_down),this.$filter_elem.find("a.select-all-link").click(function(t){return function(){var e,n,i,r,o,a;for(t.reset_filter(),e=[],n=t.data_view.getItems(),i=o=0,a=n.length;a>o;i=++o)r=n[i],e.push(i);return t.row_selection_model.setSelectedRows(e),$(t).trigger("filter_changed"),!1}}(this))},n.prototype.handle_text_input_click=function(){return this.security_grid.resetActiveCell()},n.prototype.handle_text_input_key_up=function(t){var e;return e=this.search_string,40===t.keyCode?(this.security_grid.focus(),this.security_grid.setActiveCell(0,0),void 0):(13===t.keyCode&&this.security_grid.getDataLength()>0&&(this.toggle_row_selected(0),this.$security_search.val("")),this.search_string=this.$security_search.val(),e!==this.search_string?(this.data_view.refresh(),this.sort_if_needed()):void 0)},n.prototype.toggle_row_selected=function(t){var e,n;return e=this.row_selection_model.getSelectedRows(),n=e.filter(function(e){return e!==t}),n.length===e.length&&n.push(t),this.row_selection_model.setSelectedRows(n)},n.prototype.handle_grid_clicked=function(t,e){var n;return this.toggle_row_selected(e.row),n=this.security_grid.getActiveCell(),null==n?t.stopImmediatePropagation():void 0},n.prototype.handle_grid_key_down=function(t){var e;if(e=this.security_grid.getActiveCell(),null!=e){if(13===t.keyCode)return this.toggle_row_selected(e.row),void 0;40!==t.keyCode&&38!==t.keyCode?this.focus_on_search_box():0===e.row&&38===t.keyCode&&(this.focus_on_search_box(),t.preventDefault())}},n.prototype.handle_selection_changed=function(){var t,e,n,i,r,o,a,s,l,u,c;for(t=this.data_view.getItems(),o=0,l=t.length;l>o;o++)e=t[o],null!=this.data_view.getRowById(e.id)&&(e.selected=!1);if(i=this.row_selection_model.getSelectedRows(),i.length>0)for(a=0,u=i.length;u>a;a++)n=i[a],e=this.data_view.getItem(n),e.selected=!0;for(this.filter_sid_list={},r=!1,s=0,c=t.length;c>s;s++)e=t[s],e.selected&&(r=!0,this.filter_sid_list[e.id]=e.id);return r||(this.filter_sid_list=null),this.sort_needed=!0,$(this).trigger("filter_changed")},n.prototype.sort_if_needed=function(t){return null==t&&(t=!1),t||this.sort_needed?(this.data_view.sort(this.sort_comparer,!0),this.sort_needed=!1):void 0},n.prototype.focus_on_search_box=function(){return this.$security_search.focus().val(this.search_string),this.security_grid.resetActiveCell()},n.prototype.handle_filter_button_clicked=function(t){return n.__super__.handle_filter_button_clicked.call(this,t),this.security_grid.setColumns(this.security_grid.getColumns()),this.security_grid.resizeCanvas(),this.sort_if_needed(),this.focus_on_search_box(),!1},n.prototype.sort_comparer=function(t,e){var n,i;return n=t.name,i=e.name,t.selected!==e.selected?t.selected?-1:1:"Cash"===t.sid?1:"Cash"===e.sid?-1:n>i?1:-1},n.prototype.is_active=function(){return null!=this.filter_sid_list},n.prototype.reset_filter=function(){return this.search_string="",this.$security_search.val(""),this.data_view.refresh(),this.row_selection_model.setSelectedRows([]),this.sort_if_needed(!0),this.filter_sid_list=null},n.prototype.include_item=function(t){return null!=this.filter_sid_list&&null==this.filter_sid_list[t.sid]?!1:!0},n}(quanto.FilterBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SliderFilter=t=function(t){function n(t,i,r){this.update_min_max=e(this.update_min_max,this),this.include_item=e(this.include_item,this),this.reset_min_max=e(this.reset_min_max,this),this.handle_filtering_done=e(this.handle_filtering_done,this),this.is_active=e(this.is_active,this),this.reset_filter=e(this.reset_filter,this),this.initialize_controls=e(this.initialize_controls,this),n.__super__.constructor.call(this,t,i),this.$slider_elem=this.$filter_elem.find(".slider-range"),this.formatter=null!=r?r:function(){return function(t){return t}}(this)}return i(n,t),n.prototype.initialize_controls=function(t){return n.__super__.initialize_controls.call(this,t),this.$filter_elem.find(".min-value").html(this.formatter(this.min_value)),this.$filter_elem.find(".max-value").html(this.formatter(this.max_value)),this.slider_min=this.min_value,this.slider_max=this.max_value,this.$slider_elem.slider({range:!0,min:this.slider_min,max:this.slider_max,values:[this.slider_min,this.slider_max],slide:function(t){return function(e,n){return t.filter_value_min=n.values[0],t.filter_value_max=n.values[1],t.$filter_elem.find(".min-value").html(t.formatter(t.filter_value_min)),t.$filter_elem.find(".max-value").html(t.formatter(t.filter_value_max)),t.filter_value_min===t.slider_min&&(t.filter_value_min=null),t.filter_value_max===t.slider_max&&(t.filter_value_max=null),$(t).trigger("filter_changed")}}(this)}),this.handle_filtering_done()},n.prototype.reset_filter=function(){return this.filter_value_min=null,this.filter_value_max=null},n.prototype.is_active=function(){return null!=this.filter_value_min||null!=this.filter_value_max},n.prototype.handle_filtering_done=function(){var t,e;return e=this.filter_value_min,t=this.filter_value_max,null==this.filter_value_min&&(e=this.min_value,null!=this.updated_min_value&&(this.slider_min=this.updated_min_value,e=this.updated_min_value)),null==this.filter_value_max&&(t=this.max_value,null!=this.updated_max_value&&(this.slider_max=this.updated_max_value,t=this.updated_max_value)),this.$slider_elem.slider({min:this.slider_min,max:this.slider_max},{values:[e,t]}),this.$filter_elem.find(".min-value").html(this.formatter(e)),this.$filter_elem.find(".max-value").html(this.formatter(t)),this.update_filter_button_disabled()},n.prototype.reset_min_max=function(){return this.updated_max_value=null,this.updated_min_value=null,this.first_value=null,this.has_multiple_values=!1},n.prototype.include_item=function(t){var e;return e=!0,null!=this.filter_value_min&&(null==t[this.field]||t[this.field]<this.filter_value_min)&&(e=!1),null!=this.filter_value_max&&(null==t[this.field]||t[this.field]>this.filter_value_max)&&(e=!1),e},n.prototype.update_min_max=function(t){return null==t.excluded_by||t.excluded_by[this.field]||t.include?((null==this.updated_min_value||t[this.field]<this.updated_min_value)&&(this.updated_min_value=t[this.field]),(null==this.updated_max_value||t[this.field]>this.updated_max_value)&&(this.updated_max_value=t[this.field]),this.update_has_multiple_values(t)):void 0},n}(quanto.FilterBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.StoreManager=t=function(){function t(){this.change_main_cta_button_text=e(this.change_main_cta_button_text,this),this.set_button_text_to_purchase_status=e(this.set_button_text_to_purchase_status,this),this.set_button_html=e(this.set_button_html,this),this.set_button_to_spinner=e(this.set_button_to_spinner,this),this.initialize_sample_cta_button=e(this.initialize_sample_cta_button,this),this.initialize_main_cta_button=e(this.initialize_main_cta_button,this),this.add_query_param_to_url=e(this.add_query_param_to_url,this),this.update_filter_links=e(this.update_filter_links,this);var t,n,i,r,o,a,s,l,u;$.support.pjax&&($.pjax.defaults.scrollTo=!1),$(document).pjax("[data-pjax] a, a[data-pjax]","#pjax-container"),$(document).on("pjax:send",function(){return function(){return $("#pjax-container-wrapper").height($("#pjax-container").height()),$("#pjax-container").fadeOut(100)}}(this)),$(document).on("pjax:complete",function(){return function(){return $("#pjax-container").fadeIn(100),$("#pjax-container-wrapper").height("100%")}}(this)),$(".store-clone-algo-btn").click(function(){return quanto.track_mixpanel("store home algorithm cloned",{feature:$(this).data("internal-name"),location:$(this).data("location")})}),s=this,a=function(){var t,e,n,i;return t=""+window.location.href.split("?")[0],i=$("#search-box").val(),e=s.add_query_param_to_url("searchq",i),n=""+t+e,null!=i&&quanto.track_mixpanel("store search",{query:i}),$.pjax({url:n,container:"#pjax-container"}),s.update_filter_links()},t=_.debounce(a,200),$("#data-filter-dropdown li > a").click(function(){return function(t){return $("#data-filter-dropdown .placeholder-text").html($(t.target).text())}}(this)),$("#search-section").addClass("active"),$("#search-section").click(function(){return function(){return $("#search-section").addClass("active")}}(this)),$(".content-area").click(function(t){var e,n;e=$("#search-section"),n=$("#search-box"),e.is(t.target)||0!==e.has(t.target).length||""!==n.val()||e.removeClass("active")}),$("#search-box").keydown(function(){return function(e){var n,i,r;return n=$(e.target).val(),13===e.keyCode?(a(),void 0):8===e.keyCode?($("#search-box").focus(),""!==n&&t(),void 0):(e.keyCode<48||90<(i=e.keyCode)&&106>i||111<(r=e.keyCode)&&145>r||t(),void 0)}}(this)),$(".feature-holder").hover(function(){quanto.track_mixpanel("store content box hovered",{feature:$(this).data("internal-name")})}),$(".preview-nb").click(function(){return quanto.track_mixpanel("store preview notebook clicked",{feature:$(".main-cta-button").data("internal-name")})}),quanto.is_employee_or_admin()||mixpanel.track_links(".feature-holder a","store detail page clicked",function(t){return{feature:$(t).data("internal-name")}}),$(".help-text").hover(function(){return quanto.track_mixpanel("store mailto hovered")}),$(".help-text").click(function(){return quanto.track_mixpanel("store mailto clicked")
}),$(".quantopian-features-container").on("click",".show-more",function(t){return function(e){return t.current_show_more=$(e.target),t.page_to_add=t.current_show_more.data("next-page"),t.current_show_more.addClass("hidden"),$.get(window.location.href,{page:t.page_to_add},function(e){var n,i;return i="new-content-"+t.page_to_add,n="<div id="+i+">"+e+"</div>",$(".quantopian-features-container").append($(n).hide()),$("#"+i).fadeIn(100)})}}(this)),$(".faq-section").length&&(n=.25*$(window).height(),i=($(".faq-section").offset().top-n).toFixed(),u=function(){return quanto.track_mixpanel("faq scrolled into rudimentary")},l=_.throttle(u,2e4),$(window).scroll(function(){var t,e;return e=$(window).scrollTop(),t=Math.abs(e-i),10>t?l():void 0})),quanto.is_mobile_screen()&&(o=$(".navbar-header").height(),r=$(".mobile-footer").offset().top,$(window).scroll(function(){var t;return t=$(window).scrollTop(),t>o&&r>t?$(".preview-and-buy.mobile").removeClass("hidden"):$(".preview-and-buy.mobile").addClass("hidden")}),$("#purchase-feature-modal").on("hidden.bs.modal",function(){return function(){return $(".preview-and-buy.mobile").removeClass("hidden")}}(this))),this.initialize_sample_cta_button(),this.update_filter_links(),this.initialize_main_cta_button(),$.cookie("seen_data_modal")||($("#data-intro-modal").modal("show"),$.cookie("seen_data_modal","true",{expires:365})),$(".data-modal-span").click(function(){return function(){return $("#data-intro-modal").modal("show")}}(this))}return t.prototype.update_filter_links=function(){return $("#select-all-link").attr("href",this.add_query_param_to_url("type","all")),$("#select-free-link").attr("href",this.add_query_param_to_url("type","free")),$("#select-premium-link").attr("href",this.add_query_param_to_url("type","premium")),$("#select-mine-link").attr("href",this.add_query_param_to_url("type","mine"))},t.prototype.add_query_param_to_url=function(t,e){var n,i,r,o,a;return r=window.location.href.split("?")[1],a={},a[t]=e,i=$.param(a),r?(o=!1,n=r.split("&"),n=n.map(function(e){var n;return n=e.split("="),n[0]===t?(o=!0,i):e}),o||n.push(i),"?"+n.join("&")):"?"+i},t.prototype.initialize_main_cta_button=function(){return $(".main-cta-button").click(function(t){return function(e){var n,i,r,o,a;if(!quanto.is_real_user())return quanto.show_join_popup(),void 0;switch(n=$(e.target).closest(".main-cta-button"),r=n.data("internal-name"),a=n.data("vendor-internal-name"),o=n.data("purchase-status"),i={feature_name:r},o){case"Cancel":return t.set_button_to_spinner(n),$.post("/users/remove_paid_feature",i,function(e){var i;return i=new quanto.JsonResponse(e),i.ok()?t.change_main_cta_button_text():(t.set_button_text_to_purchase_status(n),quanto.show_error_popup())}).error(function(){return t.set_button_text_to_purchase_status(n),quanto.show_error_popup()});case"Get":return quanto.track_mixpanel("store buy button clicked",{feature:$(".main-cta-button").data("internal-name")}),$(".preview-and-buy.mobile").addClass("hidden"),quanto.instances.billmodalmgr.handle_feature(i.feature_name,a);case"Restart":return t.set_button_to_spinner(n),$.post("/users/add_paid_feature",i,function(e){var i;return i=new quanto.JsonResponse(e),i.ok()?t.change_main_cta_button_text():(t.set_button_text_to_purchase_status(n),quanto.show_error_popup())}).error(function(){return t.set_button_text_to_purchase_status(n),quanto.show_error_popup()})}}}(this))},t.prototype.initialize_sample_cta_button=function(){return $(".sample-cta-button").click(function(t){return function(e){var n,i,r,o,a,s,l;return quanto.is_real_user()?(n=$(e.target).closest(".sample-cta-button"),i=n.html(),o=n.data("internal-name"),a=n.data("vendor-internal-name"),r={feature_name:o},quanto.track_mixpanel("store free dataset added",{feature:o}),l=o.split(".")[2],s="/data/confirmation/"+a+"/"+l,$(".main-cta-button").length&&(s=""+s+"?type=free_sample"),t.set_button_to_spinner(n),window.location=s,$.post("/users/add_free_feature",r,function(e){var r;return r=new quanto.JsonResponse(e),r.ok()?window.location=s:(t.set_button_html(n,i),quanto.show_error_popup())}).error(function(){return t.set_button_html(n,i),quanto.show_error_popup()})):(quanto.show_join_popup(),void 0)}}(this))},t.prototype.set_button_to_spinner=function(t){return t.addClass("disabled"),t.html('<i class="icon icon-refresh icon-spin icon-large blue-icon"></i>')},t.prototype.set_button_html=function(t,e){return t.removeClass("disabled"),t.html(e)},t.prototype.set_button_text_to_purchase_status=function(t){return t.removeClass("disabled"),t.text(t.data("purchase-status"))},t.prototype.change_main_cta_button_text=function(){var t;switch(t=$(".main-cta-button"),t.removeClass("disabled"),t.data("purchase-status")){case"Cancel":t.data("purchase-status","Restart"),t.text("Restart");break;case"Restart":t.data("purchase-status","Cancel"),t.text("Cancel");break;case"Get":t.data("purchase-status","Cancel"),t.text("Cancel")}},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.SubmitRevisionPopupManager=t=function(){function t(){this.new_revision=e(this.new_revision,this),this.submit_revision=e(this.submit_revision,this),this.handle_dropdown_click=e(this.handle_dropdown_click,this),this.show_popup=e(this.show_popup,this),this.$popup=$("#submit-revision-modal"),this.$show_modal_button=$("#show-revision-modal-button"),this.$submit_revision_button=$("#submit-revision-button"),this.$show_modal_button.on("click",function(t){return function(){return t.show_popup()}}(this)),this.$submit_revision_button.on("click",function(t){return function(){return t.submit_revision()}}(this)),$("#revision-dropdown").on("change",function(t){return function(){return t.handle_dropdown_click()}}(this))}return t.prototype.show_popup=function(){return this.$submit_revision_button.removeClass("disabled").html("Submit"),this.$popup.modal("show")},t.prototype.handle_dropdown_click=function(){var t;return t=this.$popup.find("#revision-dropdown").find(":selected"),"New Revision"===t.html()?$(".change-log").removeClass("hidden"):$(".change-log").addClass("hidden")},t.prototype.submit_revision=function(){var t,e,n,i,r,o;return r=this.$popup.find("#revision-dropdown").val(),"Select a revision"===r?(quanto.show_error_popup("Error","You must select a revision from the dropdown before submitting."),void 0):"New Revision"===r?(this.new_revision(),void 0):(t=this.$popup.find("#author-comment").val(),o=$("#revision-dropdown").find(":selected").data("id"),e=$("#data_backtest_id").val(),i=$("#permission-checkbox").is(":checked"),this.$submit_revision_button.addClass("disabled").html("Submitting..."),n={revision_id:o,backtest_id:e,author_comment:t,permission:i},$.post("/fund/submit_revision",n,function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.redirect()?void 0:(t.$submit_revision_button.removeClass("disabled").html("Submit"),quanto.show_error_popup("Error","There was a problem submitting your revision."))}}(this)).error(function(t){return function(){return t.$submit_revision_button.removeClass("disabled").html("Submit"),quanto.show_error_popup("Error","There was a problem submitting your revision.")}}(this)))},t.prototype.new_revision=function(){var t,e,n,i,r,o;return n=this.$popup.find("#change-log").val(),_.isEmpty(n)?(quanto.show_error_popup("Error","Please provide a description of the code change."),void 0):(t=this.$popup.find("#author-comment").val(),o=$("#submission-id").val(),e=$("#data_backtest_id").val(),r=$("#permission-checkbox").is(":checked"),this.$submit_revision_button.addClass("disabled").html("Submitting..."),i={submission_id:o,backtest_id:e,change_log:n,author_comment:t,permission:r},$.post("/fund/new_revision",i,function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.redirect()?void 0:(t.$submit_revision_button.removeClass("disabled").html("Submit"),quanto.show_error_popup("Error","There was a problem submitting your revision."))}}(this)).error(function(t){return function(){return t.$submit_revision_button.removeClass("disabled").html("Submit"),quanto.show_error_popup("Error","There was a problem submitting your revision.")}}(this)))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SymbolLookupManager=t=function(t){function n(t,i){this.get_text_to_replace=e(this.get_text_to_replace,this),null==t&&(t=$("#symbol-intellisense-box")),n.__super__.constructor.call(this,t,i),this.$match_template=Handlebars.compile("<div class='match' data-sid='{{sid}}' data-symbol='{{symbol}}' data-name='{{name}}'><span class='ticker'>{{symbol}}</span><span class='name'>{{name}}</span></div>"),this.TEXT_TO_MATCH="symbol"}return i(n,t),n.prototype.get_text_to_replace=function(t,e){return"'"+e+"'"},n}(quanto.SIDLookupManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.TableCheckboxManager=t=function(){function t(t){this.update_delete_button=e(this.update_delete_button,this),this.trigger_event=e(this.trigger_event,this),this.toggle_off=e(this.toggle_off,this),this.toggle_on=e(this.toggle_on,this),this.handle_checkbox_header_clicked=e(this.handle_checkbox_header_clicked,this),this.handle_checkbox_clicked=e(this.handle_checkbox_clicked,this);var n;this.$table=t,this.$table.find(".quanto-checkbox").on("click",this.handle_checkbox_clicked),this.$table.find(".quanto-checkbox-header").on("click",this.handle_checkbox_header_clicked),n=t.attr("delete-button-id"),null!=n&&(this.$delete_button=$("#"+n))}return t.prototype.handle_checkbox_clicked=function(t){var e;return e=$(quanto.get_src_element(t)),e.hasClass("icon-check-empty")?this.toggle_on(e):this.toggle_off(e),this.trigger_event()},t.prototype.handle_checkbox_header_clicked=function(t){var e;return e=$(quanto.get_src_element(t)),this.$table.find(".quanto-checkbox.icon-check-empty").length>0?(this.$table.find(".quanto-checkbox.icon-check-empty").each(function(t){return function(e,n){return t.toggle_on($(n))}}(this)),this.toggle_on(e,!1)):(this.$table.find(".quanto-checkbox").each(function(t){return function(e,n){return t.toggle_off($(n))}}(this)),this.toggle_off(e,!1)),this.trigger_event()},t.prototype.toggle_on=function(t,e){return null==e&&(e=!0),t.removeClass("icon-check-empty").addClass("icon-check"),e?t.closest("tr").addClass("selected-row"):void 0},t.prototype.toggle_off=function(t,e){return null==e&&(e=!0),t.removeClass("icon-check").addClass("icon-check-empty"),e?t.closest("tr").removeClass("selected-row"):void 0},t.prototype.trigger_event=function(){return this.update_delete_button(),this.$table.trigger("checkbox_count_changed")},t.prototype.update_delete_button=function(){var t;return null!=this.$delete_button?(t=quanto.get_selected_rows(this.$table).length,t>0?this.$delete_button.removeClass("disabled"):this.$delete_button.addClass("disabled")):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.TextFilter=t=function(t){function n(t,i){this.include_item=e(this.include_item,this),this.reset_filter=e(this.reset_filter,this),this.is_active=e(this.is_active,this),this.handle_filter_button_clicked=e(this.handle_filter_button_clicked,this),this.handle_selection_changed=e(this.handle_selection_changed,this),this.handle_grid_clicked=e(this.handle_grid_clicked,this),this.toggle_row_selected=e(this.toggle_row_selected,this),this.initialize_controls=e(this.initialize_controls,this),this.initialize_min_max=e(this.initialize_min_max,this),n.__super__.constructor.call(this,t,i),this.items_hash={}}return i(n,t),n.prototype.initialize_min_max=function(t){var e;return n.__super__.initialize_min_max.call(this,t),e=t[this.field],this.items_hash[e]={id:e,value:e}},n.prototype.initialize_controls=function(t){var e,i,r,o,a;return n.__super__.initialize_controls.call(this,t),this.grid_items=_.values(this.items_hash),this.data_view=new Slick.Data.DataView({inlineFilters:!1,enableTextSelectionOnCells:!0}),a=function(){return function(t,e){var n,i;return n=t.value,i=e.value,n>i?1:-1}}(this),this.data_view.beginUpdate(),this.data_view.setItems(this.grid_items),this.data_view.sort(a,!0),this.data_view.endUpdate(),o=function(){return function(t,e,n,i,r){return"<span class='text-filter-value'>"+r.value+"</span>"}}(this),e=new Slick.CheckboxSelectColumn({cssClass:"check-box-cell"}),i=[e.getColumnDefinition(),{id:"name",name:"Name",field:"name",formatter:o,sortable:!0}],r={enableCellNavigation:!0,fullWidthRows:!0,syncColumnCellResize:!0,rowHeight:32,forceFitColumns:!0,enableColumnReorder:!1,autoHeight:!0},this.filter_grid=new Slick.Grid(this.$filter_elem.find(".text-filter-grid"),this.data_view,i,r),this.filter_grid.registerPlugin(e),this.row_selection_model=new Slick.RowSelectionModel({selectActiveRow:!1}),this.row_selection_model.onSelectedRangesChanged.subscribe(this.handle_selection_changed),this.filter_grid.setSelectionModel(this.row_selection_model),this.data_view.syncGridSelection(this.filter_grid,!0,!0),this.filter_grid.render(),this.data_view.onRowCountChanged.subscribe(function(t){return function(){return t.filter_grid.updateRowCount(),t.filter_grid.render()}}(this)),this.data_view.onRowsChanged.subscribe(function(t){return function(e,n){return t.filter_grid.invalidateRows(n.rows),t.filter_grid.render()}}(this)),this.filter_grid.onClick.subscribe(this.handle_grid_clicked),this.filter_grid.onKeyDown.subscribe(this.handle_grid_key_down)},n.prototype.toggle_row_selected=function(t){var e,n;return e=this.row_selection_model.getSelectedRows(),n=e.filter(function(e){return e!==t}),n.length===e.length&&n.push(t),this.row_selection_model.setSelectedRows(n)},n.prototype.handle_grid_clicked=function(t,e){var n;return this.toggle_row_selected(e.row),n=this.filter_grid.getActiveCell(),null==n?t.stopImmediatePropagation():void 0},n.prototype.handle_selection_changed=function(){var t,e,n,i,r;if(n=this.row_selection_model.getSelectedRows(),this.filter_list={},n.length>0)for(i=0,r=n.length;r>i;i++)e=n[i],t=this.data_view.getItem(e),this.filter_list[t.value]=t.value;else this.filter_list=null;return $(this).trigger("filter_changed")},n.prototype.handle_filter_button_clicked=function(t){return n.__super__.handle_filter_button_clicked.call(this,t),this.filter_grid.setColumns(this.filter_grid.getColumns()),this.filter_grid.resizeCanvas(),!1},n.prototype.is_active=function(){return null!=this.filter_list},n.prototype.reset_filter=function(){return this.row_selection_model.setSelectedRows([]),this.filter_list=null},n.prototype.include_item=function(t){return null!=this.filter_list&&null==this.filter_list[t[this.field]]?!1:!0},n}(quanto.FilterBase)}.call(this),function(){function t(t){this.field=t,this.init=function(){this.buys=null,this.sells=null},this.accumulate=function(t){var e=t[this.field];null!=e&&""!==e&&0/0!==e&&(e>0?this.buys+=e:this.sells+=e)},this.storeResult=function(t){t.buys=this.buys,t.sells=this.sells}}var e,n=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};quanto.TransactionsVizManager=e=function(e){function i(){this.format_group_row=n(this.format_group_row,this),this.format_date=n(this.format_date,this),this.format_time=n(this.format_time,this),this.group_by_day_internal=n(this.group_by_day_internal,this),this.get_columns=n(this.get_columns,this),this.$transactions_tab=$("#tab-transactioninfo"),i.__super__.constructor.call(this,this.$transactions_tab,"transactions"),this.is_daily||(this.sort_field="date",this.sort_ascending=!0),Handlebars.registerHelper("position_date",function(){return function(t){return quanto.date.format_date("%Y-%m-%d",new Date(t))}}(this)),Handlebars.registerHelper("format_money",quanto.safe_to_money),this.group_row_template=Handlebars.compile('<span class="group-row-cell left-cell slick-cell l0 r5" data-row="{{row}}"> <a href="#" class="expand-row-link"> <i class="icon slick-group-toggle {{icon_class}}" style="margin-left: {{indentation}}"></i> <span class="group-date">{{position_date value}}</span> </a> <span class="dash transaction-dash">-</span> {{#if buys_total}} <span class="buys-total blue">Buys {{format_money buys_total}}{{#if sells_total}},{{/if}}</span> {{/if}} {{#if sells_total}} <span class="sells-total red">Sells {{format_money sells_total}}</span> {{/if}} {{#if transaction_count}} <span class="transaction-count">({{transaction_count}} transactions)</span> {{/if}} </span>')}return r(i,e),i.prototype.get_columns=function(){var t;return t=this.is_daily?140:190,[{name:"Date",field:"date",type:"date",minWidth:t,resizable:!1},{name:"Security",field:"ticker",type:"ticker",minWidth:130,width:160},{name:"Transaction",field:"transaction",type:"text",minWidth:126},{name:"Quantity",field:"quantity",type:"number",minWidth:110},{name:"Last Sale Price",field:"price",type:"money",minWidth:140,rightAlignFilter:!0},{name:"$ Amount",field:"totalvalue",type:"money",showTotal:!0,minWidth:140,maxWidth:240,rightAlignFilter:!0}]},i.prototype.group_by_day_internal=function(){return this.data_view.setGrouping({getter:function(){return function(t){var e,n;return e=new Date(t.date),n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n.getTime()}}(this),comparer:this.get_group_comparer(),aggregators:[new t("totalvalue")],aggregateCollapsed:!1,lazyTotalsCalculation:!1,displayTotalsRow:!1})},i.prototype.format_time=function(t){return"<span class='time-dash'>-</span><span class='transaction-time'>"+quanto.date.format_date("%l:%M %p",t)+"</span>"},i.prototype.format_date=function(t,e,n){var i;return i=new Date(n),this.is_grouped?this.is_daily?"":quanto.date.format_date("%l:%M %p",i):this.is_daily?quanto.date.format_date("%Y-%m-%d",i):quanto.date.format_date("%Y-%m-%d",i)+this.format_time(i)},i.prototype.format_group_row=function(t,e,n,i,r){return r.indentation=15*r.level+"px",r.icon_class=0===r.collapsed?"icon-chevron-down":"icon-chevron-right",r.row=t,r.buys_total=r.totals.buys,r.sells_total=-r.totals.sells,r.transaction_count=r.rows.length,this.group_row_template(r)},i.prototype.save_transaction_data=function(t){var e,n,i,r,o,a,s;if(null!=t&&0!==t.length){for(a=0,s=t.length;s>a;a++)o=t[a],n=new Date(o.d),i=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=o.sid||o.s,e={date:o.d,day_timestamp:i.getTime(),sid:r,ticker:r,transaction:o.a>=0?"BUY":"SELL",quantity:o.a,price:o.p,totalvalue:o.a*o.p},this.handle_row_data(e);return 0}},i.prototype.populate_transaction_chart_incremental=function(t,e){var n,i,r,o,a,s;for(n=0,r=0,a=0,s=e.length;s>a;a++)o=e[a],i=o.a*o.p,i>0?n+=i:r+=i;return quanto.chart.series[3].addPoint([t,n],!1),quanto.chart.series[4].addPoint([t,r],!1)},i.prototype.populate_transaction_chart_total=function(){var t,e,n,i,r,o,a,s,l,u,c,d;for(e={},o={},d=this.row_data,u=0,c=d.length;c>u;u++)l=d[u],s=l.day_timestamp,e[s]||(e[s]=0),o[s]||(o[s]=0),i=l.totalvalue,i>0?e[s]+=i:o[s]+=i;for(s in e)n=e[s],quanto.chart.series[3].addPoint([parseInt(s),n],!1);for(s in o)a=o[s],quanto.chart.series[4].addPoint([parseInt(s),a],!1);return quanto.chart.redraw(),r=quanto.chart.series[2].currentDataGrouping,null!=r&&"week"===(null!=r?r.unitName:void 0)&&(t=$($(".highcharts-series")[2]).find("rect"),t.each(function(e,n){return e<t.length/2?$(n).remove():void 0})),0},i}(quanto.BacktestTableManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ValidationManager=t=function(){function t(){this.handle_errors=e(this.handle_errors,this),this.trigger_validation=e(this.trigger_validation,this),this.help_template=e(this.help_template,this),this.$validate_button=$("#validate-button"),this.$validate_button.bind("click",function(){return function(){return $(document).trigger("maybe_validate_algo")}}(this)),$(document).bind("validate_algo",function(t){return function(){return t.trigger_validation()}}(this)),this.error_row_template=Handlebars.compile("<tr class='{{type}}-row'><td class='line-col'>{{line_number}}</td><td class='type-col'>{{type}}</td><td class='details-col'>{{warning}}{{{html}}}</td></tr>"),this.symbol_template=Handlebars.compile("<tr style='font-size:11px' class='{{asset}}-row'><td class='asset-col'>{{asset}}</td><td class='start-date-col'>{{start_date}}</td><td class='end-date-col'>{{end_date}}</td></tr>"),$("#output-table tbody").on("click","tr",function(){return function(t){var e,n;if(!$(quanto.get_src_element(t)).hasClass("module-error-link"))return n=$(t.currentTarget).data("marker"),null!=n&&(e=n.find(),null!=e&&null!=e.from&&null!=e.from.line)?$(".CodeMirror-gutter-text pre").eq(e.from.line).scrollintoview({duration:50}):void 0}}(this)),$("#error-button").bind("click",function(t){return function(){return $(t).hasClass("disabled")?void 0:(t.showing_errors=!t.showing_errors,t.filter_output_table())}}(this)),$("#warning-button").bind("click",function(t){return function(){return $(t).hasClass("disabled")?void 0:(t.showing_warnings=!t.showing_warnings,t.filter_output_table())}}(this)),$("#backtest-link").bind("click",function(){return function(){return $(document).trigger("change_pane",["backtest"])}}(this)),quanto.on_click(".whitelist-link",function(){return function(){return $("#whitelist-modal").modal("show")}}(this)),quanto.on_click(".blacklist-link",function(){return function(){return $("#blacklist-modal").modal("show")}}(this)),this.unit_test_messages={0:"Algorithm cannot be empty.",1:"Algorithm compile error.",2:"Unknown error.",3:"Execution timeout.",4:"Runtime exception:",5:"Warning.",6:"Unsupported TALib function.",10:"Algorithm must implement handle_data(context, data) method.",14:"Algorithm must implement initialize(context) method.",15:"Invalid transform.  Check transform method signature.",16:"Invalid transform.",17:"Invalid event property.",18:"The sid(id) method takes one parameter.",19:"Algorithm must reference 1 to 200 SIDs, inclusive.",20:"Algorithm can use up to 10 transforms.",21:"The data.available property has been removed.  Use 'if data.can_trade(sid(#))' or <a href='/help#overview-checkingdata' target='_blank'>Learn more</a>.",22:"The portfolio object has moved from data to context.  Use context.portfolio now instead of data.portfolio.",23:"The parameters to handle_data have changed order. New form: <strong>handle_data(context, data)</strong>.",24:"Invalid SID.",28:"DollarVolumeUniverse takes two integers or floats representing the lower and upper percentile bounds of the universe.",29:"DollarVolumeUniverse can receive up to 10% of the total universe in daily data mode, and 5% in minute data mode.",30:"<strong>Returns</strong> and <strong>benchmark</strong> are reserved keywords that cannot be used for recorded variables.",31:"Transform window sizes must be specified with a directly supplied integer.",44:"history() only supports the 'frequency' values '1d' or '1m'.",45:"history() is only supported in 'Minute' mode. To use the history() function, switch the backtest from 'Daily' to 'Minute'.",76:"A new parameter has been added to before_trading_start. New form: <strong>before_trading_start(context, data)</strong>."},this.invalid_transform_warnings={mavg:"Invalid signature for mavg transform, should be <b>mvg(int)</b>.",vwap:"Invalid signature for vwap transform, should be <b>vwap(int)</b>.",returns:"Invalid signature for returns transform, should be <b>returns()</b>.",stddev:"Invalid signature for stddev transform, should be <b>stddev(int)</b>."},this.nonexistent_transform_template=Handlebars.compile("Nonexistent transform: <b>{{transform}}</b>"),this.nonexistent_property_template=Handlebars.compile("Nonexistent property: <b>{{property}}</b>")}var n,i,r;return n=[],i=!0,r=!0,t.prototype.help_template=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},t.prototype.trigger_validation=function(t){var e,n,i;return $(".datepicker").datepicker("hide"),$(".quanto-tooltip").hide(),this.$validate_button.hasClass("disabled")?void 0:($(document).trigger("validation_triggered"),mixpanel.track("code build triggered"),this.clear_errors(),quanto.editor.save(),n=$("#codebox").val(),quanto.turn_on_busy(this.$validate_button),e=$("#algo-id").val(),i={code:n,algo_id:e,data_frequency:"minute",start_date_str:$("#daily_backtest_start_date_field").val(),end_date_str:$("#daily_backtest_end_date_field").val()},$.post("/algorithms/"+e+"/validate",i,function(e){return function(n){var i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b,y,w,k,x,C,q,T,S,E,D,M,A,N,F,z,P,L,j,R,O,I,H,B,W,U,J,G,Y,V,Q,X,K,Z,te;if(E=new quanto.JsonResponse(n),E.ok()){if(D=E.data(),null!=D&&null!=D.test_results)for(a=D.test_results,I=D.violation_status,H=D.violation_warning_message,quanto.turn_off_busy(e.$validate_button),c=[],O=_.filter(a,function(t){return!t.passed}),J=0,V=O.length;V>J;J++){switch(P=O[J],P.line_number=P.line||"---",P.is_error=!0,f="NotAllowedInLiveWarning: The fundamentals attribute ",_.str.startsWith(P.trace,f)&&(p=_.str.strRight(P.trace,f).split(" ")[0],C={fundies_field:p,algo_id:$("#algo-id").val()},quanto.track_mixpanel("fundamentals warning shown ide",C)),d=function(t,e){var n,i,r,o;for(i=e.line-1,n=e.offset,o=quanto.editor.getSearchCursor(t,{line:i,ch:n});(r=o.findNext())&&o.from().line===i;)return o.from().ch+2;return null},4===P.errorcode&&0===P.trace.indexOf("TypeError: record_variables")&&(P.errorcode=26),P.errorcode){case 1:"warning"===P.type&&(P.is_error=!1,P.warning=P.trace);break;case 2:if(null!=P.trace&&P.trace.length>0)for(l=P.trace[0],G=0,Q=l.length;Q>G;G++)s=l[G],$.isArray(s)&&(s=s[0]),w=s.message,w=w.replace("Import non-whitelisted","Cannot import"),w=w.replace("Import from non-whitelisted","Cannot import from"),w=w.replace("Insecure built-in","Cannot use built-in"),w=w.replace("exec statement","Cannot use exec statement"),w=w.replace("Blacklisted attribute within module open","Use open_price instead of open"),w=w.replace("Blacklisted attribute within module close","Use close_price instead of close"),w=w.replace("Blacklisted","Cannot import"),_.str.endsWith(w,".")||(w+=". "),"import"===s.type?(null!=s.extra.suggestion?(w="Importing "+s.extra.invalid+" raised an ImportError. ",b="Did you mean to <strong>import "+s.extra.suggestion+"</strong>?"):"quandl"===s.extra.invalid?(w="Importing "+s.extra.invalid+" raised an ImportError. ",b="Please use <a target='_blank' href='/help#overview-fetcher'>fetch_csv</a> instead."):(w="Importing "+s.extra.invalid+" raised an ImportError. No modules or attributes with a similar name were found.",b=""),b+="<a class='module-error-link whitelist-link'>Why?</a>"):"import from"===s.type?(S=e.split_dotted_name(s.extra.invalid),q=S[0],o=S[1],null!=s.extra.suggestion?(F=e.split_dotted_name(s.extra.suggestion),N=F[0],A=F[1],w="Importing "+o+" from "+q+" raised an ImportError. ",b="Did you mean to <strong>import "+A+" from "+N+"</strong>?"):(w="Importing "+o+" from "+q+" raised an ImportError. No modules or attributes with a similar name were found.",b=""),b+="<a class='module-error-link whitelist-link'>Why?</a>"):"builtin"===s.type&&("Insecure built-in function type"===s.message?w+="Please use isinstance() instead. ":"Insecure built-in function read_csv"===s.message&&(b="Please use <a target='_blank' href='/help#overview-fetcher'>fetch_csv</a> instead. <a class='module-error-link blacklist-link'>Why?</a>"),b||(b="<a class='module-error-link blacklist-link'>Why?</a>")),null!=w.match(/matplotlib/)&&(w="import from"===s.type?"Importing from matplotlib raised an ImportError.":"Importing matplotlib raised an ImportError.",b=" You cannot import matplotlib in the backtester. Try using the <a target='_blank' href='/research'>research environment</a> for data visualizations.<a class='module-error-link blacklist-link'>Why?</a>"),null!=w.match(/pyfolio/)&&(w="import from"===s.type?"Importing from pyfolio raised an ImportError.":"Importing pyfolio raised an ImportError.",b=" Pyfolio is a visualization library to analyze your algorithm. It's not available in the backtester, but you can use it in <a target='_blank' href='/research'>research</a>.<a class='module-error-link blacklist-link'>Why?</a>"),w+=H,"lockout"===I&&(b="<a class='module-error-link whitelist-link'>Why?</a>"),u={html:b,warning:w,line_number:s.lineno,type:s.type,is_error:!0},c.push(u);break;case 4:w=e.unit_test_messages[P.errorcode],null!=P.trace&&P.trace.length>0?(j=P.trace.replace(/(\r\n|\n|\r)/gm,""),w+=" "+j):w+=" (unknown)",_.str.include(w,"'fetch_eventvestor' is not defined")?P.html=" <br> Please use the <a target='_blank' href='https://www.quantopian.com/data/eventvestor'> EventVestor data sets</a> instead.":_.str.include(w,"'fetch_estimize' is not defined")?P.html=" <br> Please use the <a target='_blank' href='https://www.quantopian.com/data/estimize'> Estimize data sets</a> instead.":_.str.include(w,"'fetch_wikipedia' is not defined")?P.html=" <br> fetch_wikipedia is no longer supported.":_.str.include(w,"'batch_transform' is not defined")?P.html=" <br> batch_transform is no longer supported. Please use <a target='_blank' href='/help#api-history'>history</a> instead.":_.str.include(w,"cannot import name fundamentals")?P.html=" <br> Did you mean 'from quantopian.pipeline.data import morningstar'?":_.str.include(w,"No module named research")&&(P.html=" <br> The 'quantopian.research' module is not available in the backtester. It is only available in <a target='_blank' href='/research'>research</a>."),null!=w.match(/UsageNotAllowed/)&&(i=w.indexOf("(enable access at"),y=w.slice(i),w=w.substr(0,i),P.trace=w,P.html=quanto.linkify(y)),null!=w.match(/interactive.data/)&&(P.html="<br> The interactive namespace is not available in the backtester, but can be used in <a target='_blank' href='/research'>research</a>. Try importing from quantopian.pipeline.data instead."),P.warning=w;break;case 5:P.warning=_.str.capitalize(P.trace||"Unknown error."),P.is_error=!1;break;case 15:h=!1,K=e.invalid_transform_warnings;for(v in K)B=K[v],P.trace.indexOf(v)>0&&(P.html=B,h=!0,P.offset=d(v,P));h||(P.warning="Unknown transform error");break;case 16:g=_.str.words(P.trace)[3],P.html=e.nonexistent_transform_template({transform:g}),P.offset=d(g,P);break;case 17:g=_.str.words(P.trace)[3],P.html=e.nonexistent_property_template({property:g}),P.offset=d(g,P);break;case 19:P.warning=P.trace;break;case 21:P.html=e.unit_test_messages[P.errorcode];break;case 23:case 76:P.html=e.unit_test_messages[P.errorcode],P.is_error=!1;break;case 26:P.html="<strong>record</strong> takes up to five arguments total. This may be a combination of keyword arguments and name/value pairs. "+e.help_template("#ide-record");break;case 27:P.warning=P.trace.replace("FunctionCalledOutsideOfInitialize: 0027","").replace("\n","");break;case 30:P.html=e.unit_test_messages[P.errorcode];break;case 32:try{x=P.trace.substring(P.trace.indexOf("0032")+5).split(" ")[0],P.warning="<strong>"+x+"</strong> can only be used inside the <strong>initialize</strong> method."}catch(ee){s=ee,P.warning=P.trace.substring("MethodCalledOutsideInitialize: 0032 ".length).replace("\n","")}break;case 33:try{U=P.trace.substring(P.trace.indexOf("0033")+5).split(" "),x=U[0],k=quanto.safeParseInt(U[5]),P.warning=isNaN(k)?P.trace:1===k?"<strong>"+x+"</strong> can only be invoked once.":"<strong>"+x+">/strong> can only be called "+k+" times."}catch(ee){t=ee,P.warning=P.trace.substring("MethodCalledOutsideInitialize: 0033 ".length).replace("\n","")}break;case 34:try{U=P.trace.substring(P.trace.indexOf("0034")+5),U=U.replace("Failed to call requests.head on ","Error loading csv data from "),P.warning=U}catch(ee){t=ee,P.warning=P.trace.substring("MethodCalledOutsideInitialize: 0034 ".length).replace("\n","")}break;case 37:P.html="<strong>fetch_csv</strong> can only load CSV data from http and https urls.";break;case 39:P.warning=P.trace.replace("UnsupportedTALibFunction: ","").replace("\n","");break;case 41:P.warning=P.trace.replace("BatchInvalidWindowLength: 0041 ","").replace("\n","");break;case 42:P.warning=P.trace.replace("AlgoSyntaxError: 0042","SyntaxError:"),P.warning.indexOf("SyntaxError: non-keyword arg after keyword arg")>-1?P.warning="SyntaxError: pass the non-keyword argument before the keyword argument.":P.warning.indexOf("SyntaxError: EOL while scanning string literal")>-1&&(P.warning="SyntaxError: End of line while scanning string literal. Did you forget a quotation mark?");
break;case 43:P.warning=P.trace.replace("InvalidHistoryCall: 0043","");break;case 46:P.warning=P.trace.replace("UnsupportedHistoryField: 0046","");break;case 47:L=P.trace.replace("BenchmarkNonAsset: 0047 ","").split(".")[0]+".",P.warning=L.escapeHTML();break;case 48:P.trace.indexOf(",")>-1?P.warning="Each individual asset must be a string.":(P.warning=P.trace.replace("CodedSymbolNotFound: 0048","")+"Did you check set_symbol_lookup_date() to confirm the asset traded at this time? ",P.html=e.help_template("#api-symbollookupdate"));break;case 49:for(z=P.extra[0].symbol,m="<table style='margin-left:10px;margin-bottom:5px;margin-right:10px;margin-top:20px'><tr style='font-weight:bold' class='asset-row'><td class='asset-col'>ASSET</td><td class='first-traded-col'>FIRST TRADED</td><td class='last-traded-col'>LAST TRADED</td></tr>",Z=P.extra,Y=0,X=Z.length;X>Y;Y++)r=Z[Y],r.start_date=quanto.date.format_date("%Y-%m-%d",new Date(r.start_date)),r.end_date=quanto.date.format_date("%Y-%m-%d",new Date(r.end_date)),m+=e.symbol_template(r);m+="</table>",P.html="There are multiple assets that have used the symbol "+z+". You must use set_symbol_lookup_date() before using symbol(). The table below shows when each company traded using the symbol "+z+". "+e.help_template("#api-symbollookupdate")+" "+m;break;case 50:P.warning=P.trace.replace("InvalidSymbolCall: 0050",""),P.warning.indexOf("only 1 allowed")>-1&&(P.html="<br> Did you mean to use symbols()? "+e.help_template("#api-symbols"));break;case 51:P.warning="Invalid NoDataPolicy: only NoDataPolicy.EXCEPTION and NoDataPolicy.LOG_ONLY are accepted.";break;case 54:P.html=""+P.extra.ib_name+" must be imported from "+P.extra.module+". <br>Add 'from "+P.extra.module+" import "+P.extra.ib_name+"' on line 1.";break;case 55:P.warning=""+P.extra.style_name+" expects at most "+P.extra.max_args+" argument(s), you passed "+P.extra.args_passed+".";break;case 56:P.warning=""+P.extra.style_name+" expects at least "+P.extra.min_args+" argument(s), you only passed "+P.extra.args_passed+".";break;case 57:switch(P.extra.style_name){case"VWAPBestEffort":P.html=e.help_template("#api-VWAPBestEffort");break;case"RelativeOrder":P.html=e.help_template("#api-relative-order");break;default:P.html=e.help_template("#ide-ordering")}P.warning=""+P.extra.style_name+" does not support the argument '"+P.extra.invalid_arg+"'. ";break;case 58:P.warning=""+P.extra.func_name+" expects at most "+P.extra.max_args+" argument(s), you passed "+P.extra.args_passed+".";break;case 59:P.warning=""+P.extra.func_name+" expects at least "+P.extra.min_args+" argument(s), you only passed "+P.extra.args_passed+".";break;case 61:P.warning=P.trace.replace("InvalidSetSymbolLookupDateCall: 0061","");break;case 62:P.warning=P.warning=P.trace.replace("InvalidSymbolsCall: 0062","");break;case 63:P.html="There are a mismatched number of names and values in the record function. "+e.help_template("#ide-record");break;case 65:null!=(null!=(te=P.extra)?te.new_url:void 0)?(T=P.extra.new_url.escapeHTML(),P.html="<span style='word-break:break-word'>Attempt to fetch_csv from a redirected URL. Change the URL to <strong>"+T+"</strong></span>"):P.warning="Attempt to fetch_csv from a redirected URL. Please use a different URL.";break;case 67:P.is_error=!1,P.trace.indexOf("batch_transform")>-1?P.html="batch_transform is no longer part of the API, please use <a target='_blank' href='/help#ide-history'>history</a> instead.":P.warning=P.trace;break;case 69:P.warning=P.trace.replace("FunctionCalledOutsideOfTradingStart: 0069","");break;default:P.warning=e.unit_test_messages[P.errorcode]||P.trace}2!==P.errorcode&&c.push(P)}if(W=_.filter(c,function(t){return!t.is_error}),R=_.filter(c,function(t){return t.is_error}),M=!1,c.length>0?(e.handle_errors(c),$("#build-errors-link-container").removeClass("hidden"),$("#build-errors-tab-link").trigger("click"),$("#go-to-backtests").hide(),R.length>0?$(document).trigger("build_failure"):M=!0):M=!0,M&&($(document).trigger("build_success"),0===W.length))return $("#go-to-backtests").show(),$("#build-errors-link-container").addClass("hidden"),$("#daily-logs-link").trigger("click")}}}(this)).error(function(t){return function(e){var n,i;return i=new quanto.JsonResponse(e),n=i.data(),"Invalid start_date_str"===n||"Invalid end_date_str"===n?quanto.show_error_popup("Invalid dates","Looks like there was a problem running the backtest over the supplied dates.<br> Please make sure both the start and end date are valid."):quanto.show_error_popup(),quanto.turn_off_busy(t.$validate_button),$(document).trigger("build_failure")}}(this)))},t.prototype.handle_errors=function(t){var e,n,i,r,o,a,s,l,u,c,d;if(null!=t){for(e=$("#output-table"),e.find("tbody").html(""),r=0,u=0,a=t.sort(function(t,e){return"---"===t.line_number?-1:"---"===e.line_number?1:t.line_number-e.line_number}),c=0,d=a.length;d>c;c++)i=a[c],null!=i.is_error&&i.is_error?(s="error_squiggly",r+=1,i.type="Error"):(s="warning_squiggly",u+=1,i.type="Warning"),n=$(this.error_row_template(i)),null!=i.line_number&&"---"!==i.line_number&&(l=this.get_token(i),o=quanto.editor.markText(l.from,l.to,s),this.markers.push(o),n.data("marker",o)),e.find("tbody").first().append(n);return e.show()}},t.prototype.filter_output_table=function(){return this.showing_errors?$("#output-table tbody tr.Error-row").show():$("#output-table tbody tr.Error-row").hide(),this.showing_warnings?$("#output-table tbody tr.Warning-row").show():$("#output-table tbody tr.Warning-row").hide()},t.prototype.clear_errors=function(){var t,e,n,i,r,o,a,s,l,u;if($("#output-table tbody tr").remove(),null!=this.markers&&this.markers.length>0)for(s=this.markers,i=0,o=s.length;o>i;i++)n=s[i],n.clear();for(this.markers=[],l=$("#error-button, #warning-button"),u=[],r=0,a=l.length;a>r;r++)e=l[r],t=$(e),t.find("i").removeClass().addClass("icon-ok"),t.find("span.button-label").html("No "+t.data("noun")+"s"),u.push(t.addClass("disabled").removeClass("active"));return u},t.prototype.get_token=function(t){var e,n,i;return n=null!=t.offset?this.create_location(t.line_number-1,t.offset+1):this.create_location(t.line_number-1,0),i=quanto.editor.getTokenAt(n),e={from:this.create_location(t.line_number-1,i.start),to:this.create_location(t.line_number-1,i.end)}},t.prototype.create_location=function(t,e){var n;return n={line:t},n.ch=e>0?e:0,n},t.prototype.split_dotted_name=function(t){var e,n,i;return i=t.split("."),n=i.slice(0,-1).join("."),e=i[i.length-1],[n,e]},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LogManager=t=function(){function t(t){this.is_ongoing=e(this.is_ongoing,this),this.prune_logs_if_needed=e(this.prune_logs_if_needed,this),this.add_logs=e(this.add_logs,this),this.format_log_line_date=e(this.format_log_line_date,this),this.more_logs=e(this.more_logs,this),this.scroll_up_fetch_logs=e(this.scroll_up_fetch_logs,this),this.scroll_down_fetch_logs=e(this.scroll_down_fetch_logs,this),this.handle_scroll=e(this.handle_scroll,this),this.get_scroll_direction=e(this.get_scroll_direction,this),this.update_max_count=e(this.update_max_count,this),this.destroy=e(this.destroy,this),this.show_finish_ui_with_no_logs=e(this.show_finish_ui_with_no_logs,this),this.show_finish_ui_with_logs=e(this.show_finish_ui_with_logs,this),this.q2_deprecation_link=e(this.q2_deprecation_link,this),this.$container=$(t.container_selector),this.log_container_height=this.$container.height(),this.$rows_container=this.$container.find(".logs-container"),this.$header=this.$container.find(".logs-header"),this.$footer=this.$container.find(".logs-footer"),this.$rolloff=this.$container.parent().find(".logs-rolloff"),this.$finished=this.$container.find(".logs-finished"),this.$header.hide(),this.$footer.hide(),this.$finished.hide(),this.$rolloff.hide(),this.date_format="%Y-%m-%d",this.$container.scroll(this.handle_scroll),$(document).bind("logs-container-height-changed",function(t){return function(){return null!=t.$container?(t.log_container_height=t.$container.height(),t.handle_scroll()):void 0}}(this)),$(document).bind("main_splitter_resized",function(t){return function(){return t.handle_scroll()}}(this)),this.q2_default_deprecation_link="/quantopian2/migration",this.safe_html_deprecation_log_template=Handlebars.compile("<div class='logline' data-count='{{count}}' data-q1-depr='true'><span class='date'>{{formatted_date}}</span> <span class='method highlight'>{{method}}</span> <span class='logmsg'>{{{msg}}}</span></div>"),this.log_template=Handlebars.compile("<div class='logline' data-count='{{count}}'><span class='date'>{{formatted_date}}</span> <span class='method highlight'>{{method}}</span> <span class='level highlight'>{{level}}</span> <span class='logmsg'>{{msg}}</span><span class='truncated hidden'>...</span></div>"),this.no_method_log_template=Handlebars.compile("<div class='logline' data-count='{{count}}'><span class='date'>{{formatted_date}}</span> <span class='level highlight'>{{level}}</span> <span class='logmsg'>{{msg}}</span><span class='truncated hidden'>...</span></div>"),this.deprecation_log_template=Handlebars.compile("<div class='logline' data-count='{{count}}' data-q1-depr='true'><span class='date'>{{formatted_date}}</span> <span class='method highlight'>{{method}}</span> <span class='logmsg'>{{msg}}</span> <a href='{{migration_link}}' target='_blank'> Learn more here. </a> </div>"),this.last_log_vertical_position=0,this.loading=!1,this.top_log_count=-1,this.bottom_log_count=-1,this.last_received_log_count=-1,this.last_scroll_position=0,this.scroll_direction=this.DOWN,this.suspend_scroll_handler=!1,this.fake_scroll=!1,this.first_load=!0,this.q1_deprecation_warnings=[]}return t.prototype.PAGE_SIZE=150,t.prototype.RED_ZONE_PIXEL_SIZE=200,t.prototype.TOTAL_LIMIT=600,t.prototype.DOWN=0,t.prototype.UP=1,t.prototype.q2_deprecation_link=function(t){return _.str.include(t,"The `history` method")?""+this.q2_default_deprecation_link+"#data-history":_.str.include(t,"Use `data.current`")?""+this.q2_default_deprecation_link+"#data-current":_.str.include(t,"Checking whether an asset is in")||_.str.include(t,"Use `data.can_trade`")?""+this.q2_default_deprecation_link+"#data-can-trade":_.str.include(t,"Iterating over the assets in")?""+this.q2_default_deprecation_link+"#overview-data-object":_.str.include(t,"The `mavg` method")?""+this.q2_default_deprecation_link+"#mavg":_.str.include(t,"The `stddev` method")?""+this.q2_default_deprecation_link+"#stddev":_.str.include(t,"The `vwap` method")?""+this.q2_default_deprecation_link+"#vwap":_.str.include(t,"The `returns` method")?""+this.q2_default_deprecation_link+"#returns":this.q2_default_deprecation_link},t.prototype.show_finish_ui_with_logs=function(){return this.$footer.hide(),this.$finished.show()},t.prototype.show_finish_ui_with_no_logs=function(){return this.$footer.hide(),this.$finished.html("No logs generated.").show()},t.prototype.destroy=function(){return this.$rows_container.html(""),this.$rows_container=null,this.$container=null,this.log_template=null},t.prototype.update_max_count=function(t){return t!==this.max_logs&&0!==t?(this.max_logs=Math.max(t,this.max_logs),this.fake_scroll=!0,this.handle_scroll()):void 0},t.prototype.get_scroll_direction=function(t){var e;return e=t>=this.last_scroll_position?this.DOWN:this.UP},t.prototype.handle_scroll=function(t){var e;if(null==t&&(t=!1),!(this.suspend_scroll_handler||null==this.$container||!t&&this.$container.is(":hidden")||(this.log_container_height=this.$container.height(),e=this.$container.scrollTop(),this.scroll_direction=this.get_scroll_direction(e),this.last_scroll_position=e,this.loading)))if(this.scroll_direction===this.DOWN){if(this.more_logs()&&this.last_log_vertical_position-(this.last_scroll_position+this.log_container_height)<this.RED_ZONE_PIXEL_SIZE&&(this.$footer.show(),this.scroll_down_fetch_logs(),1===this.bottom_log_count))return this.$footer.hide()}else if(this.last_scroll_position<this.RED_ZONE_PIXEL_SIZE&&this.top_log_count>this.min_avail)return this.$header.show(),this.scroll_up_fetch_logs()},t.prototype.scroll_down_fetch_logs=function(){return this.fetch_logs(this.last_received_log_count+1,Math.min(this.max_logs,this.last_received_log_count+this.PAGE_SIZE),this.DOWN)},t.prototype.scroll_up_fetch_logs=function(){var t,e,n;return e=Math.min(this.top_log_count-this.min_avail,this.PAGE_SIZE),t=this.top_log_count-1,n=t-e,this.fetch_logs(n,t,this.UP)},t.prototype.more_logs=function(){return this.last_received_log_count<this.max_logs},t.prototype.format_log_line_date=function(t){return quanto.date.format_date(this.date_format,new Date(t))},t.prototype.add_logs=function(t,e){var n,i,r,o,a,s,l,u,c,d,h,p,f,m;if(null!=t&&0!==t.length){for(d=$("<div></div>"),f=0,m=t.length;m>f;f++)l=t[f],u={},u.count=l.o,u.formatted_date=null!=l.a?this.format_log_line_date(l.a):"(none)",u.msg=l.m,a=!1,o="AlgoWarning"===l.c&&_.str.include(l.m,"ZiplineDeprecationWarning"),"Print"===l.c?(u.level="PRINT",u.method="",a=!0,r=$(this.log_template(u))):o?(c=l.m,c=c.replace("<string>:","Line "),s=_.str.include(c,"set_universe"),s&&(c=c.substring(0,c.indexOf(":")+1)+" 'set_universe' is deprecated.  Use the <a href='/help#ide-dollar-volume' target='_blank'>AverageDollarVolume</a> built-in factor in Pipeline."),c=c.replace("<string>:","Line ").replace("ZiplineDeprecationWarning: ",""),u.msg=c,u.level="ERROR",u.method="DEPRECATION WARNING",s?r=$(this.safe_html_deprecation_log_template(u)):(u.migration_link=this.q2_deprecation_link(u.msg),r=$(this.deprecation_log_template(u))),this.q1_deprecation_warnings.push(c)):l.sl?(u.level=quanto.log_levels[l.l]||"UNKNOWN",u.method="SYSTEM",r=$(this.log_template(u))):(u.level=quanto.log_levels[l.l]||"UNKNOWN",null!=l.f&&null!=l.i?(u.method=l.f+":"+l.i,r=$(this.log_template(u))):r=$(this.no_method_log_template(u))),i=r.find(".level"),a?(r.find(".method").addClass("hidden"),i.addClass("highlight print")):o?r.find(".method").addClass("error"):"ERROR"===quanto.log_levels[l.l]?i.addClass("level highlight error"):"DEBUG"===quanto.log_levels[l.l]?i.addClass("level highlight debug"):"WARN"===quanto.log_levels[l.l]?i.addClass("level highlight warn"):i.addClass("level highlight info"),null!=l.r&&l.r&&r.find(".truncated").show(),d.append(r);return e===this.DOWN?this.$rows_container.append(d.html()):(p=this.last_scroll_position,n=$(".logline").first(),this.$rows_container.prepend(d.html()),n.length>0?(h=n.position().top,h+=p):h=0,this.suspend_scroll_handler=!0,this.$container.scrollTop(h),this.suspend_scroll_handler=!1),this.last_received_log_count=_.last(t).o,this.last_log_vertical_position=this.$rows_container.find(".logline").last().position().top,this.top_log_count=$(".logline").first().data("count"),this.bottom_log_count=$(".logline").last().data("count"),this.more_logs()||this.is_ongoing()||this.show_finish_ui_with_logs(),this.prune_logs_if_needed()}},t.prototype.prune_logs_if_needed=function(){var t,e,n,i,r;return i=$(".logline").length,i>this.TOTAL_LIMIT?(this.scroll_direction===this.DOWN?(e=$($(".logline").get(i-this.TOTAL_LIMIT+1)),r=e.position().top,n=this.last_scroll_position-r,this.suspend_scroll_handler=!0,$(".logline").slice(0,i-this.TOTAL_LIMIT).remove(),this.$container.scrollTop(n),this.suspend_scroll_handler=!1):$(".logline").slice(-1*(i-this.TOTAL_LIMIT)).remove(),t=this.$rows_container.find(".logline").last(),this.last_log_vertical_position=t.position().top,this.last_received_log_count=t.data("count"),this.top_log_count=$(".logline").first().data("count"),this.bottom_log_count=$(".logline").last().data("count")):void 0},t.prototype.is_ongoing=function(){return!1},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.BacktestLogManager=t=function(t){function n(t){this.format_log_line_date=e(this.format_log_line_date,this),this.is_ongoing=e(this.is_ongoing,this),this.destroy=e(this.destroy,this),this.show_finish_ui_with_no_logs=e(this.show_finish_ui_with_no_logs,this),this.fetch_logs=e(this.fetch_logs,this),this.fetch_first_n_logs_and_check_for_q1_deprecation=e(this.fetch_first_n_logs_and_check_for_q1_deprecation,this),this.show_rolloff=e(this.show_rolloff,this),this.mark_backtest_as_deprecated=e(this.mark_backtest_as_deprecated,this),this.disable_live_trading_button_q1_deprecation=e(this.disable_live_trading_button_q1_deprecation,this),this.show_q1_deprecation_warning=e(this.show_q1_deprecation_warning,this),this.parse_logs_container_for_deprecation=e(this.parse_logs_container_for_deprecation,this),this.check_for_q1_deprecation=e(this.check_for_q1_deprecation,this),this.backtest_finished=e(this.backtest_finished,this),n.__super__.constructor.call(this,t),this.backtest_id=t.backtest_id,this.logs_fetched=!1,this.backtest_q1_deprecated="true"===t.backtest_q1_deprecated,this.$container.find(".logs-container").removeAttr("backtestid").attr("backtestid","backtest-"+this.backtest_id),this.$rows_container=this.$container.find(".logs-container[backtestid='backtest-"+this.backtest_id+"']"),$("#daily-logs-link").on("click",function(t){return function(){return t.handle_scroll(!0)}}(this)),$(document).bind("logs-tab-shown",function(t){return function(){return t.handle_scroll()}}(this)),t.backtest_state>2?(this.max_logs=t.backtest_log_count,0===this.max_logs?(this.$footer.hide(),this.$finished.html("This backtest didn't generate any logs.").show()):-1===this.max_logs?(this.$footer.hide(),this.$finished.html("This backtest was run before our logging system was migrated to a new environment.  Run the backtest again to get new logs.")):this.handle_scroll()):(this.ongoing_backtest=!0,this.max_logs=t.backtest_log_count||0,this.$footer.find(".message").html("Waiting for logs...").show(),this.$footer.show()),this.$deprecation_modal=$("#q1-deprecation-modal"),this.deprecation_item_template_full_backtest=Handlebars.compile("<div class='deprecation-item'>{{str}}</div>"),this.deprecation_item_template_ide=Handlebars.compile("<tr class='Error-row'><td class='lineno'>{{line}}</td><td class='details'>{{details}}<a href='{{migration_link}}' target='_blank'> Learn more here. </a></td></tr>"),this.backtest_q1_deprecated&&this.disable_live_trading_button_q1_deprecation(),function(t){t.each(["show","hide"],function(e,n){var i;i=t.fn[n],t.fn[n]=function(){return this.trigger(n),i.apply(this,arguments)}})}(jQuery),this.$footer.on("hide",function(t){return function(){var e;return e=$("#daily-logs-container").find(".logs-container"),e.is(":empty")&&(e=$("#logs-container").find(".logs-container")),t.parse_logs_container_for_deprecation(e)}}(this))}return i(n,t),n.prototype.backtest_finished=function(){return this.ongoing_backtest=!1,this.max_logs<=0?this.show_finish_ui_with_no_logs():this.more_logs()||this.show_finish_ui_with_logs(),this.logs_fetched?this.check_for_q1_deprecation():this.backtest_q1_deprecated?void 0:this.fetch_first_n_logs_and_check_for_q1_deprecation(200)},n.prototype.check_for_q1_deprecation=function(){var t,e,n,i,r;if(this.q1_deprecation_warnings.length>0){for(t=[],r=this.q1_deprecation_warnings,n=0,i=r.length;i>n;n++)e=r[n],t.push(e);this.show_q1_deprecation_warning(t)}},n.prototype.parse_logs_container_for_deprecation=function(t){var e,n,i,r,o,a,s;if(!this.ongoing_backtest){for(n=[],o=t.find(".logline"),e=0,a=0,s=o.length;s>a;a++)i=o[a],r=$(i),"true"===r.data("q1-depr")&&(e+=1,n.push(r.find(".logmsg").html()));e>0&&this.show_q1_deprecation_warning(n)}},n.prototype.show_q1_deprecation_warning=function(t){var e,n,i,r,o,a,s,l;switch(quanto.instances.lm.visible_pane){case"algo":for(n=$("#deprecation-warnings-tab"),s=0,l=t.length;l>s;s++)i=t[s],i=i.replace("Line","").split(":").map(function(t){return _.str.strip(t)}),a=this.deprecation_item_template_ide({line:i[0],details:i[1],migration_link:this.q2_deprecation_link(i[1])}),n.find("tbody").first().append(a);$("#deprecation-warnings-link-container").removeClass("hidden"),$("#dailybars-errors").hasClass("hidden")&&$("#deprecation-warnings-tab-link").trigger("click"),o="ide";break;case"backtest":r=t.map(function(t){return function(e){return t.deprecation_item_template_full_backtest({str:e})}}(this)).join(""),e=$("#q1-deprecation-modal-full-backtest-page"),o="full backtest page",e.hasClass("in")||(e.find("#deprecation-list").html(r),e.modal("show"),this.mark_backtest_as_deprecated())}return quanto.track_mixpanel("q1 deprecation warning shown",{backtest_id:this.backtest_id,place_seen:o})},n.prototype.disable_live_trading_button_q1_deprecation=function(){var t;return t=$("#deploy-algo-button"),t.addClass("disabled").removeAttr("href").removeClass("can-deploy"),t.popover("destroy").popover({content:"It looks like this backtest is using deprecated API methods. Check the 'Log Output' tab for more.",placement:"bottom",trigger:"hover"}),t.popover("show")},n.prototype.mark_backtest_as_deprecated=function(){var t;return this.backtest_q1_deprecated?void 0:(t={backtest_id:this.backtest_id},$.post("/backtests/mark_q1_deprecated",t,function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.disable_live_trading_button_q1_deprecation():quanto.show_error_popup()}}(this)))},n.prototype.show_rolloff=function(t){var e;return e=1===t?"log line has":"log lines have",this.$rolloff.find(".message").html("<strong>"+t+"</strong> "+e+" been expired due to log lines from more recent backtests."),this.$rolloff.show()},n.prototype.fetch_first_n_logs_and_check_for_q1_deprecation=function(t){var e,n;return e={backtest_id:this.backtest_id,start:0,end:t},n=[],$.get("/backtests/log_entries",e,function(t){return function(e){var i,r,o,a,s,l,u,c;if(s=new quanto.JsonResponse(e),s.ok()){for(l=s.data(),o=l.logs,u=0,c=o.length;c>u;u++)r=o[u],i="AlgoWarning"===r.c&&_.str.include(r.m,"ZiplineDeprecationWarning"),i&&(a=r.m,a=a.replace("<string>:","Line ").replace("ZiplineDeprecationWarning: ",""),n.push(a));return 0!==n.length?t.show_q1_deprecation_warning(n.reverse()):void 0}}}(this))},n.prototype.fetch_logs=function(t,e,n){var i;return this.loading=!0,i={backtest_id:this.backtest_id,start:t,end:e},$.get("/backtests/log_entries",i,function(t){return function(e){var r,o,a;if(a=new quanto.JsonResponse(e),a.ok()){if(t.logs_fetched=i.start!==i.end&&0!==i.end,i=a.data(),o=i.logs,t.min_avail=i.min_avail,r=i.id,null==r||null==t.backtest_id||r!==t.backtest_id)return;if(t.min_avail>1&&t.show_rolloff(t.min_avail-1),t.first_load&&0===o.length&&!t.ongoing_backtest){if(-1!==t.min_avail)return console.log("refetching"),t.first_load=!1,t.fetch_logs(t.min_avail,Math.min(t.max_logs,t.min_avail+t.PAGE_SIZE),t.DOWN);t.$footer.hide(),t.$finished.html("The logs for this backtest have been deleted because log output from newer backtests have taken up your log quota.").show(),t.suspend_scroll_handler=!0,t.loading=!1}else{if(t.ongoing_backtest&&0===o.length)return t.$footer.show(),t.first_load=!1,t.loading=!1;if(t.first_load=!1,t.min_avail=i.min_avail,o.reverse(),t.add_logs(o,n),t.loading=!1,t.$header.hide(),t.$footer.hide(),t.more_logs())return setTimeout(function(){return t.handle_scroll()},1e3)}}}}(this))},n.prototype.show_finish_ui_with_no_logs=function(){return this.$footer.hide(),this.$finished.html("This backtest didn't generate any logs.").show()},n.prototype.destroy=function(){return this.backtest_id=null,n.__super__.destroy.call(this)},n.prototype.is_ongoing=function(){return this.ongoing_backtest},n.prototype.format_log_line_date=function(t){var e;return e=new Date(t),quanto.date.format_date(this.date_format,e)},n}(quanto.LogManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.LiveAlgorithmLogManager=t=function(t){function n(t){this.is_ongoing=e(this.is_ongoing,this),this.more_logs=e(this.more_logs,this),this.scroll_up_fetch_logs=e(this.scroll_up_fetch_logs,this),this.scroll_down_fetch_logs=e(this.scroll_down_fetch_logs,this),this.get_scroll_direction=e(this.get_scroll_direction,this),this.fetch_logs=e(this.fetch_logs,this),this.show_rolloff=e(this.show_rolloff,this),n.__super__.constructor.call(this,t),this.date_format="%Y-%m-%d %H:%M",this.PAGE_SIZE=300,this.TOTAL_LIMIT=1500,this.live_algo_id=t.live_algorithm_id,$(document).bind("trading_sidebar_shown",function(t){return function(e,n){return"logs"===n?t.handle_scroll(!0):void 0}}(this)),this.$footer.find(".message").html("Waiting for logs...").show(),this.$footer.show(),this.max_logs=t.live_algorithm_log_count||0,this.max_logs>0&&this.handle_scroll()}return i(n,t),n.prototype.show_rolloff=function(t){var e;return e=1===t?"log line has":"log lines have",this.$rolloff.find(".message").html("<strong>"+t+"</strong> "+e+" been expired due to log lines from more recent live algorithms."),this.$rolloff.show()},n.prototype.fetch_logs=function(t,e,n){var i;return this.loading=!0,i={id:this.live_algo_id,start:t,end:e},$.get("/live_algorithms/log_entries",i,function(t){return function(e){var r,o,a;if(a=new quanto.JsonResponse(e),a.ok()){if(i=a.data(),o=i.logs,t.min_avail=i.min_avail,t.min_avail>1&&t.show_rolloff(t.min_avail-1),!t.first_load||0!==o.length)return 0===o.length?(t.$footer.hide(),t.$finished.html("This algorithm hasn't generated any logs.").show(),t.first_load=!1,t.loading=!1):(t.$finished.hide(),t.first_load=!1,t.min_avail=i.min_avail,0===$(".logs-display").scrollTop()&&(r=!0),t.add_logs(o,n),t.loading=!1,r&&t.top_log_count===t.max_logs&&$(".logs-display").scrollTop(0),t.$header.hide(),t.$footer.hide());if(-1!==t.min_avail)return console.log("refetching"),t.first_load=!1,t.fetch_logs(Math.max(1,t.max_logs-t.PAGE_SIZE),t.max_logs,t.DOWN);t.$footer.hide(),t.$finished.html("The logs for this live algorithm have been deleted because log output from new live algorithms have taken up your log quota.").show(),t.suspend_scroll_handler=!0,t.loading=!1}}}(this))},n.prototype.get_scroll_direction=function(t){var e;return e=n.__super__.get_scroll_direction.call(this,t),this.fake_scroll?(this.fake_scroll=!1,this.UP):e},n.prototype.scroll_down_fetch_logs=function(){return 1!==this.bottom_log_count?this.fetch_logs(Math.max(1,this.bottom_log_count-this.PAGE_SIZE),this.bottom_log_count-1,this.DOWN):void 0},n.prototype.scroll_up_fetch_logs=function(){return this.top_log_count<this.max_logs?this.fetch_logs(this.top_log_count+1,Math.min(this.max_logs,this.top_log_count+this.PAGE_SIZE),this.UP):void 0},n.prototype.more_logs=function(){return 1!==this.bottom_log_count||this.top_log_count<this.max_logs},n.prototype.is_ongoing=function(){return!0},n}(quanto.LogManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BillingUIBase=t=function(){function t(){this.validate_card_field=e(this.validate_card_field,this),this.handle_add_card_clicked=e(this.handle_add_card_clicked,this)}return t.prototype.handle_add_card_clicked=function(t,e,n){var i,r,o,a,s,l,u,c,d,h,p;return o=this.$cardnumber_box.val(),u=this.$carddate_box.val().split("/"),c=$.trim(u[0]),d=$.trim(u[1]),a=this.$cardcvc_box.val(),i=this.$region_box.find(":selected").text(),h=this.validate_card_field(this.$cardnumber_box),l=this.validate_card_field(this.$carddate_box),s=this.validate_card_field(this.$cardcvc_box),p=this.validate_card_field(this.$region_box),h&&l&&s&&p?(r=function(){return function(e,i){var r,o;return i.error?null!=n?n():void 0:(o=i.id,r={card_token:o},$.post("/users/add_billing_info",r,function(e){var n;return n=new quanto.JsonResponse(e),n.ok()&&null!=t?t():void 0}).error(function(){return null!=n?n():void 0}))}}(this),Stripe.card.createToken({number:o,cvc:a,exp_month:c,exp_year:d,address_state:i},r)):(null!=e&&e(),void 0)},t.prototype.validate_card_field=function(t){var e,n,i,r,o,a,s,l,u,c;switch(t){case this.$cardnumber_box:return e=this.$cardnumber_box.val(),l=$.payment.validateCardNumber(e),l?this.$cardnumber_box.removeClass("invalid"):this.$cardnumber_box.addClass("invalid"),l;case this.$carddate_box:return o=this.$carddate_box.val().split("/"),a=$.trim(o[0]),s=$.trim(o[1]),r=$.payment.validateCardExpiry(a,s),r?this.$carddate_box.removeClass("invalid"):this.$carddate_box.addClass("invalid"),r;case this.$cardcvc_box:return n=this.$cardcvc_box.val(),i=$.payment.validateCardCVC(n),i?this.$cardcvc_box.removeClass("invalid"):this.$cardcvc_box.addClass("invalid"),i;case this.$region_box:return u=this.$region_box.find(":selected").text(),c="Select"!==u&&"Region"!==u,c?this.$region_box.removeClass("invalid"):this.$region_box.addClass("invalid"),c}},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.BillingModalManager=t=function(t){function n(){this.show_sales_tax_info=e(this.show_sales_tax_info,this),this.handle_payment_error=e(this.handle_payment_error,this),this.add_paid_feature=e(this.add_paid_feature,this),this.handle_purchase_clicked=e(this.handle_purchase_clicked,this),this.handle_feature=e(this.handle_feature,this),this.set_ui=e(this.set_ui,this),this.$purchase_modal=$("#purchase-feature-modal"),this.$purchase_modal.find(".action-button").click(function(t){return function(){return t.handle_purchase_clicked()}}(this)),this.$cardnumber_box=this.$purchase_modal.find("#card-number"),this.$carddate_box=this.$purchase_modal.find("#card-date"),this.$cardcvc_box=this.$purchase_modal.find("#card-cvc"),this.$region_box=this.$purchase_modal.find("#region"),this.$cardnumber_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$cardnumber_box)}}(this)),this.$carddate_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$carddate_box)}}(this)),this.$cardcvc_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$cardcvc_box)}}(this)),this.$region_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$region_box)}}(this)),$("#tos-checkbox").on("click",function(){return function(){var t,e;return e=$("#tos-checkbox"),t=$(".tos-check"),e[0].checked?t.removeClass("error"):t.addClass("error")}}(this)),this.$region_box.on("change load",function(t){return function(e){var n,i,r;return n=$(e.target).find(":selected").text(),r=$(e.target).data("tax-rates"),i=r[n],t.show_sales_tax_info(i)}}(this)),this.$cardnumber_box.payment("formatCardNumber"),this.$cardnumber_box.bind("payment.cardType",function(t){return function(e,n){return t.$purchase_modal.find(".card-image").removeClass().addClass("card-image").addClass(n)}}(this)),this.$carddate_box.payment("formatCardExpiry"),this.$cardcvc_box.payment("formatCardCVC"),this.user_saved_card=$(".main-cta-button").data("user-saved-card")}return i(n,t),n.prototype.set_ui=function(t){var e,n;switch(this.$purchase_modal.find(".modal-footer").removeClass("hidden"),this.$purchase_modal.find(".default-buttons").removeClass("hidden"),this.$purchase_modal.find(".finish-button").addClass("hidden"),t){case"initial":return this.$purchase_modal.find(".body-content").removeClass("hidden"),this.$purchase_modal.find(".billing-ui, .result-display").addClass("hidden"),this.$purchase_modal.find(".tos-check").removeClass("hidden");case"billing":return this.$purchase_modal.find(".billing-ui").removeClass("hidden"),this.$purchase_modal.find(".invalid").removeClass("invalid"),this.$purchase_modal.find(".tos-check").removeClass("hidden"),n=this.$region_box.find(":selected").text(),e=this.$region_box.data("tax-rates"),this.show_sales_tax_info(e[n]);case"saved-card":return this.$purchase_modal.find(".saved-card-ui").removeClass("hidden"),this.$purchase_modal.find(".invalid").removeClass("invalid"),this.$purchase_modal.find(".tos-check").removeClass("hidden"),n=$(".main-cta-button").data("user-region"),e=this.$region_box.data("tax-rates"),this.show_sales_tax_info(e[n]);case"success":return this.$purchase_modal.find(".body-content, .billing-ui").addClass("hidden"),this.$purchase_modal.find(".result-display").removeClass("hidden"),this.$purchase_modal.find(".result-display .success").removeClass("hidden"),this.$purchase_modal.find(".result-display .failure").addClass("hidden"),this.$purchase_modal.find(".default-buttons").addClass("hidden");case"internal-failure":return this.$purchase_modal.find(".body-content, .billing-ui").addClass("hidden"),this.$purchase_modal.find(".result-display").removeClass("hidden"),this.$purchase_modal.find(".result-display .success").addClass("hidden"),this.$purchase_modal.find(".result-display .failure").removeClass("hidden"),this.$purchase_modal.find(".result-display .failure .internal").removeClass("hidden"),this.$purchase_modal.find(".saved-card-ui").addClass("hidden"),this.$purchase_modal.find(".salestax-info").addClass("hidden"),this.$purchase_modal.find(".tos-check").addClass("hidden"),this.$purchase_modal.find(".modal-footer").addClass("hidden");
case"card-failure":return this.$purchase_modal.find(".body-content, .billing-ui").addClass("hidden"),this.$purchase_modal.find(".result-display").removeClass("hidden"),this.$purchase_modal.find(".result-display .success").addClass("hidden"),this.$purchase_modal.find(".result-display .failure").removeClass("hidden"),this.$purchase_modal.find(".result-display .failure .card").removeClass("hidden"),this.$purchase_modal.find(".saved-card-ui").addClass("hidden"),this.$purchase_modal.find(".salestax-info").addClass("hidden"),this.$purchase_modal.find(".tos-check").addClass("hidden"),this.$purchase_modal.find(".modal-footer").addClass("hidden");case"noretry-failure":return this.$purchase_modal.find(".body-content, .billing-ui").addClass("hidden"),this.$purchase_modal.find(".result-display").removeClass("hidden"),this.$purchase_modal.find(".result-display .success").addClass("hidden"),this.$purchase_modal.find(".result-display .failure").removeClass("hidden"),this.$purchase_modal.find(".result-display .failure .noretry").removeClass("hidden"),this.$purchase_modal.find(".saved-card-ui").addClass("hidden"),this.$purchase_modal.find(".salestax-info").addClass("hidden"),this.$purchase_modal.find(".tos-check").addClass("hidden"),this.$purchase_modal.find(".modal-footer").addClass("hidden")}},n.prototype.handle_feature=function(t,e){return quanto.is_real_user()?(this.feature_to_purchase=t,this.feature_vendor=e,this.set_ui("initial"),this.$purchase_modal.find(".feature-name").html(t),this.user_saved_card?this.set_ui("saved-card"):this.set_ui("billing"),this.$purchase_modal.find(".action-button").removeClass("disabled"),this.$purchase_modal.find(".action-button .content").removeClass("hidden"),this.$purchase_modal.find(".action-button .loading").addClass("hidden"),this.$purchase_modal.modal({show:!0,backdrop:"static"})):(quanto.show_join_popup(),void 0)},n.prototype.handle_purchase_clicked=function(){var t,e,n;return t=function(t){return function(){return t.add_paid_feature(t.feature_to_purchase,t.feature_vendor)}}(this),e=function(t){return function(){return t.$purchase_modal.find(".action-button").removeClass("disabled"),t.$purchase_modal.find(".action-button .content").removeClass("hidden"),t.$purchase_modal.find(".action-button .loading").addClass("hidden")}}(this),n=$("#tos-checkbox")[0].checked,n?(this.$purchase_modal.find(".action-button").addClass("disabled"),$(".tos-check").removeClass("error"),this.$purchase_modal.find(".action-button .content").addClass("hidden"),this.$purchase_modal.find(".action-button .loading").removeClass("hidden"),this.user_saved_card?t():this.handle_add_card_clicked(t,e,e)):(setTimeout(function(){return $(".tos-check").removeClass("shake")},1500),$(".tos-check").addClass("shake"),$(".tos-check").addClass("error"))},n.prototype.add_paid_feature=function(t,e){var n,i,r;return n={feature_name:t},r=t.split(".")[2],i=""+e+"/"+r,$.post("/users/add_paid_feature",n,function(t){return function(e){var r;return r=new quanto.JsonResponse(e),r.ok()?window.location="/data/confirmation/"+i:(n=r.data(),t.handle_payment_error(n))}}(this)).error(function(t){return function(e){var i;return i=new quanto.JsonResponse(e),n=i.data(),t.handle_payment_error(n)}}(this))},n.prototype.handle_payment_error=function(t){if(this.user_saved_card||$.post("/users/delete_billing_info",{},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?void 0:quanto.show_error_popup()}}(this)).error(function(){return function(){return quanto.show_error_popup()}}(this)),!t)return this.set_ui("internal-failure"),void 0;switch(t.type){case"UserPaymentError":return this.set_ui("card-failure");case"PostSuccessfulPaymentError":return this.set_ui("noretry-failure");default:return this.set_ui("internal-failure")}},n.prototype.show_sales_tax_info=function(t){var e,n;return t?(e=parseInt($(".modal-price").data("monthly-price")),n=e*(1+t/100),n=n.toFixed(2),$(".salestax-info").text("Your total charge for this subscription will be $"+n+" per month, inclusive of applicable sales taxes."),$(".salestax-info").removeClass("hidden")):$(".salestax-info").addClass("hidden")},n}(quanto.BillingUIBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DebugManager=t=function(){function t(){this.save_watch_exprs=e(this.save_watch_exprs,this),this.load_watch_exprs=e(this.load_watch_exprs,this),this.handle_tree_node=e(this.handle_tree_node,this),this.handle_watch_list=e(this.handle_watch_list,this),this.handle_stack_frame=e(this.handle_stack_frame,this),this.handle_print=e(this.handle_print,this),this.handle_error=e(this.handle_error,this),this.handle_disable=e(this.handle_disable,this),this.handle_exception=e(this.handle_exception,this),this.handle_return=e(this.handle_return,this),this.handle_violation=e(this.handle_violation,this),this.handle_message=e(this.handle_message,this),this.connect_debug_websocket=e(this.connect_debug_websocket,this),this.send_command=e(this.send_command,this),this.ws_active=e(this.ws_active,this),this.at_a_breakpoint=e(this.at_a_breakpoint,this),this.remove_breakpoint=e(this.remove_breakpoint,this),this.add_breakpoint=e(this.add_breakpoint,this),this.initialize_events=e(this.initialize_events,this),this.initialize_events(),this.at_breakpoint=!1,this.algo_id=$("#algo-id").val()}return t.DATE_MARKER='get_datetime().strftime("%Y-%m-%d %H:%M:%S")#__QUANTOPIAN__',t.prototype.initialize_events=function(){return $(document).bind("send_debug_eval",function(t){return function(e,n){return t.send_command("eval",$.trim(n)),quanto.track_mixpanel("debugger_eval")}}(this)),$(document).bind("send_debug_continue",function(t){return function(){return t.send_command("continue"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_continue")}}(this)),$(document).bind("send_debug_next",function(t){return function(){return t.send_command("next"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_next")}}(this)),$(document).bind("send_debug_step_in",function(t){return function(){return t.send_command("step"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_step")}}(this)),$(document).bind("send_debug_step_out",function(t){return function(){return t.send_command("return"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_return")}}(this)),$(document).bind("send_debug_until",function(t){return function(){return t.send_command("until"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_until")}}(this)),$(document).bind("send_debug_up",function(t){return function(){return t.send_command("up"),quanto.track_mixpanel("debugger_up")}}(this)),$(document).bind("send_debug_down",function(t){return function(){return t.send_command("down"),quanto.track_mixpanel("debugger_down")}}(this)),$(document).bind("send_debug_return_step",function(t){return function(){return t.send_command("return_step"),quanto.track_mixpanel("debugger_return_step")}}(this)),$(document).bind("send_debug_finish",function(t){return function(){return t.send_command("disable","soft"),t.at_breakpoint=!1,quanto.track_mixpanel("debugger_finish")}}(this)),$(document).bind("connect_debug_websocket",function(t){return function(e,n,i){return t.connect_debug_websocket(n,i)}}(this)),$(document).bind("add_breakpoint",function(t){return function(e,n){return t.at_a_breakpoint()?t.add_breakpoint(n.line,n.condition):void 0}}(this)),$(document).bind("remove_breakpoint",function(t){return function(e,n){return t.at_a_breakpoint()?t.remove_breakpoint(n):void 0}}(this)),$(document).bind("modify_breakpoint",function(t){return function(e,n){return t.at_a_breakpoint()?(t.remove_breakpoint(n.line),t.add_breakpoint(n.line,n.condition)):void 0}}(this)),$(document).bind("ide_backtest_done",function(t){return function(){return t.at_breakpoint=!1,null!=t.ws?(t.ws.onmessage=function(){},t.ws.close(),t.ws=null):void 0}}(this)),$(document).bind("eval_child_node",function(t){return function(e,n){return t.send_command("tree_expand",n)}}(this)),$(document).bind("add_watch_expr",function(t){return function(e,n){return-1===t.watch_exprs.indexOf(n)?(t.watch_exprs.push(n),t.save_watch_exprs(),t.send_command("set_watch",[n])):void 0}}(this)),$(document).bind("remove_watch_expr",function(t){return function(e,n){var i;return i=t.watch_exprs.indexOf(n),i>=0?(t.watch_exprs.splice(i,1),t.save_watch_exprs(),t.send_command("clear_watch",[n])):void 0}}(this))},t.prototype.add_breakpoint=function(t,e){var n;return n={line:t+1,cond:e},this.send_command("set_break",n)},t.prototype.remove_breakpoint=function(t){var e;return e={line:t+1},this.send_command("clear_break",e)},t.prototype.at_a_breakpoint=function(){return this.ws_active()&&this.at_breakpoint},t.prototype.ws_active=function(){return null!=this.ws},t.prototype.send_command=function(t,e){var n;return null!=this.ws?(n=JSON.stringify({e:t,p:e}),this.ws.send(n)):void 0},t.prototype.connect_debug_websocket=function(t,e){return this.ws=new WebSocket(t),this.ws.onopen=function(t){return function(){var n;return t.send_command("start",e),n=t.constructor.DATE_MARKER,t.send_command("set_watch",t.watch_exprs),t.send_command("set_watch",[n])}}(this),this.ws.onerror=function(){return function(){return console.log("debug ws error")}}(this),this.ws.onmessage=function(t){return function(e){var n,i;try{i=JSON.parse(e.data)}catch(r){return n=r,console.log("Could not parse msg: "+e.data),void 0}return t.handle_message(i)}}(this),this.ws.onclose=function(t){return function(){return t.ws=null}}(this)},t.prototype.handle_message=function(t){var e;if(null!=t.e)switch(e=t.p,t.e){case"violation":return this.handle_violation(e);case"print":return this.handle_print(e);case"stack":return this.handle_stack_frame(e);case"watchlist":return this.handle_watch_list(e);case"error":return this.handle_error(e);case"disable":return this.handle_disable();case"return":return this.handle_return(e);case"exception":return this.handle_exception(e);case"tree_node":return this.handle_tree_node(e)}},t.prototype.handle_violation=function(t){return $(document).trigger("print_debug_violation_info",t)},t.prototype.handle_return=function(t){return $(document).trigger("print_return_info",t)},t.prototype.handle_exception=function(t){return $(document).trigger("print_exception_info",t)},t.prototype.handle_disable=function(){return $(document).trigger("debugger_timeout")},t.prototype.handle_error=function(t){return $(document).trigger("print_debug_error",t)},t.prototype.handle_print=function(t){return"<stdout>"!==t.input&&"<stdin>"!==t.input&&"<stderr>"!==t.input?$(document).trigger("print_debug_info",t):void 0},t.prototype.handle_stack_frame=function(t){var e,n;return n=t.stack,null!=n&&0!==n.length?(e=n[t.index],$(document).trigger("at_breakpoint",[e.line-1]),this.at_breakpoint=!0):void 0},t.prototype.handle_watch_list=function(t){return $(document).trigger("new_watchlist_data",[t])},t.prototype.handle_tree_node=function(t){var e,n;try{return n=JSON.parse(t),$(document).trigger("child_node_evaluated",n)}catch(i){e=i,console.log(e)}},t.prototype.load_watch_exprs=function(t){return $.get("/algorithms/"+this.algo_id+"/watch_exprs",{},function(e){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()&&(e.watch_exprs=i.data()||[],$(document).trigger("watch_exprs_loaded",[e.watch_exprs]),null!=t)?t():void 0}}(this))},t.prototype.save_watch_exprs=function(){return $.post("/algorithms/"+this.algo_id+"/watch_exprs",{exprs:this.watch_exprs},function(){return function(t){var e;e=new quanto.JsonResponse(t),!e.ok()}}(this))},t}()}.call(this),function(){var t,e,n,i=function(t,e){return function(){return t.apply(e,arguments)}};quanto.DebugUIManager=t=function(){function t(){this.reset_watch_list=i(this.reset_watch_list,this),this.test_command=i(this.test_command,this),this.scroll_into_view=i(this.scroll_into_view,this),this.handle_input=i(this.handle_input,this),this.reset_input=i(this.reset_input,this),this.fetch_from_history=i(this.fetch_from_history,this),this.setup_input=i(this.setup_input,this),this.focus_input=i(this.focus_input,this),this.print_debug_error=i(this.print_debug_error,this),this.print_exception_info=i(this.print_exception_info,this),this.print_return_info=i(this.print_return_info,this),this.print_debug_info=i(this.print_debug_info,this),this.print_debug_violation_info=i(this.print_debug_violation_info,this),this.append_result=i(this.append_result,this),this.display_help=i(this.display_help,this),this.disable_controls=i(this.disable_controls,this),this.enable_controls=i(this.enable_controls,this),this.hide_debug_ui=i(this.hide_debug_ui,this),this.clear_console=i(this.clear_console,this),this.initialize_mouse_events=i(this.initialize_mouse_events,this),this.trigger_command=i(this.trigger_command,this),this.setup_input(),this.history=new e,this.watchlist_manager=new n,setTimeout(function(t){return function(){return t.focus_input()}}(this),100),$(".debug-contents, .command-area-spacer").click(function(t){return function(e){var n;return n=$(quanto.get_src_element(e)),n.closest(".debug-contents").length>0?t.focus_input():void 0}}(this)),$(document).bind("print_debug_violation_info",function(t){return function(e,n){return t.print_debug_violation_info(n)}}(this)),$(document).bind("print_debug_info",function(t){return function(e,n){return t.print_debug_info(n)}}(this)),$(document).bind("print_return_info",function(t){return function(e,n){return t.print_return_info(n)}}(this)),$(document).bind("print_exception_info",function(t){return function(e,n){return t.print_exception_info(n)}}(this)),$(document).bind("print_debug_error",function(t){return function(e,n){return t.print_debug_error(n)}}(this)),$(document).bind("connect_debug_websocket",function(){return function(){return $(".debug-results").html("")}}(this)),$(document).bind("at_breakpoint",function(t){return function(e,n){return $(document).trigger("show_debug_window",[n]),t.enable_controls(),setTimeout(function(){return t.focus_input()},100)}}(this)),$(document).bind("execution_resumed",function(){return function(){return $(".breakpoint-date-field").addClass("hidden"),$(".breakpoint-date-field").find(".date-display").html("")}}(this)),$(document).bind("debug_websocket_dead",function(t){return function(){return t.hide_debug_ui()}}(this)),$(document).bind("ide_backtest_done",function(){return function(){return $(document).trigger("hide_debug_window")}}(this)),$(document).bind("debugger_timeout",function(){return function(){return $(document).trigger("execution_resumed"),$(document).trigger("hide_debug_window")}}(this)),this.initialize_mouse_events()}return t.RESULT_TREE_TEMPLATE=Handlebars.compile("<div class='debug-result' data-result-id='{{id}}'> <div class='debug-result-marker'> <i class='icon icon-angle-right debug-caret'></i> </div> <div class='debug-result-input'>{{input}}</div> <div class='debug-result-content'>{{{result}}}</div> </div>"),t.WATCHLIST_TEMPLATE=Handlebars.compile("<div class='debug-result watchlist-result' data-result-id='{{id}}'> <div class='debug-result-content'>{{{result}}}</div> <div class='remove-watched-expression'><icon class='icon icon-minus'></icon></div> </div>"),t.RESULT_TEMPLATE=Handlebars.compile("<div class='debug-result'> <div class='debug-result-marker'> <i class='icon icon-angle-right debug-caret'></i> </div> <div class='debug-result-input'>{{input}}</div> <div class='debug-result-content'>{{result}}</div> </div>"),t.CONDITIONAL_BREAKPOINT_ERROR_TEMPLATE=Handlebars.compile("<div class='debug-result'> <div class='debug-result-marker'> <i class='icon icon-exclamation-sign red error'></i> </div> <div class='debug-result-error'>ERROR: Could not evaluate the conditional breakpoint on line {{line}}: {{exc}} </div> </div>"),t.GENERIC_ERROR_TEMPLATE=Handlebars.compile("<div class='debug-result'> <div class='debug-result-marker'> <i class='icon icon-exclamation-sign red error'></i> </div> <div class='debug-result-error'>ERROR: {{type}}: {{data}} </div> </div>"),t.COMMAND_RESULT_TEMPLATE=Handlebars.compile("<div class='debug-result'> <div class='debug-result-marker'> <i class='icon icon-angle-right debug-caret'></i> </div> <div class='debug-result-input'>{{input}}</div> <div class='debug-result-content'>{{{message}}}</div> </div>"),t.HELP_TEMPLATE=Handlebars.compile("<div class='debug-result'> <div class='debug-result-marker'> <i class='icon icon-angle-right debug-caret'></i> </div> <div class='debug-result-input'>{{input}}</div> <div class='debug-result-content'> <pre class='debug-help'> Available commands in Quantopian debugger:\n ==========================================\n .c or .continue  Resume execution\n .n or .next      Step over next function call\n .r or .return    Return from current function\n .s or .step      Step into next function call\n .unt or .until   Continue execution until the line is greater than the current\n .u or .up        Step up one stackframe\n .d or .down      Step down one stackframe\n .f or .finish    Disable all breakpoints and finish backtest\n .watch <expr>    Add expression to watchlist\n .unwatch <expr>  Remove expression from watchlist\n .clear           Clear this window\n .h or .help      Show this documentation </pre> See more at <a href='https://www.quantopian.com/help#debugger' target='_blank'>https://www.quantopian.com/help#debugger</a>. </div> </div>"),t.prototype.trigger_command=function(t){switch(t){case"continue":$(document).trigger("send_debug_continue");break;case"next":$(document).trigger("send_debug_next");break;case"step":$(document).trigger("send_debug_step_in");break;case"return":$(document).trigger("send_debug_step_out");break;case"finish":$(document).trigger("send_debug_finish");break;case"until":$(document).trigger("send_debug_until");break;case"up":$(document).trigger("send_debug_up");break;case"down":$(document).trigger("send_debug_down");break;case"help":this.display_help("."+t);break;case"return_step":$(document).trigger("send_debug_return_step")}return $(document).trigger("execution_resumed")},t.prototype.initialize_mouse_events=function(){return $(".debug-toolbar-item.play").click(function(t){return function(){return t.trigger_command("continue")}}(this)),$(".debug-toolbar-item.next").click(function(t){return function(){return t.trigger_command("next")}}(this)),$(".debug-toolbar-item.down").click(function(t){return function(){return t.trigger_command("step")}}(this)),$(".debug-toolbar-item.up").click(function(t){return function(){return t.trigger_command("return"),t.trigger_command("step")}}(this)),$(".debug-toolbar-item.fastforward").click(function(t){return function(){return t.trigger_command("finish"),quanto.trigger_remote_event("fastforward"),t.hide_debug_ui()}}(this)),$(".debug-toolbar-item.clear").click(function(t){return function(){return t.clear_console()}}(this)),$(".debug-toolbar-item.help").click(function(t){return function(){return t.display_help("help")}}(this)),quanto.register_remote_event("fastforward",function(t){return function(){return $(document).trigger("execution_resumed"),t.hide_debug_ui()}}(this)),$(document).on("click","#debug-area .tree",function(){return function(t){var e,n,i;return e=$(quanto.get_src_element(t)),i=e.data("node-id"),n=quanto.tms[i],null!=n&&n.handle_tree_toggled(e),t.consume()}}(this)),$(document).on("paste",".debug-input-box",function(t){var e,n;return t.preventDefault(),n=(t.originalEvent||t).clipboardData.getData("text/plain")||prompt("Paste something..."),e=$("<div />").append(n).text(),document.execCommand("insertText",!1,e)})},t.prototype.clear_console=function(){return $(".debug-results").html(""),setTimeout(function(t){return function(){return t.focus_input()}}(this),1)},t.prototype.hide_debug_ui=function(){var t;return null!=(t=quanto.instances.bpm)&&t.disable_breakpoints(),$(document).trigger("execution_resumed"),$(document).trigger("hide_debug_window")},t.prototype.enable_controls=function(){return $(".debug-toolbar-item").removeClass("disabled")},t.prototype.disable_controls=function(){return $(".debug-toolbar-item").addClass("disabled")},t.prototype.display_help=function(t){return $(".debug-results").append(this.constructor.HELP_TEMPLATE({input:t})),setTimeout(function(t){return function(){return t.scroll_into_view()}}(this),5)},t.prototype.append_result=function(t,e){return $(".debug-results").append(this.constructor.RESULT_TREE_TEMPLATE({input:t,result:e})),setTimeout(function(t){return function(){return t.scroll_into_view()}}(this),5)},t.prototype.print_debug_violation_info=function(t){return t.violation_message=t.violation_message+t.violation_warning_message,""===t.violation_warning_message&&(t.violation_message=t.violation_message+" Repeated security violations will result in Quantopian account suspension."),t.violation_message=t.violation_message.replace(/QdbReplSecurityViolation: /g,""),this.append_result(t.input,t.violation_message)},t.prototype.print_debug_info=function(t){var e,n,i,r;try{i=JSON.parse(t.output)}catch(o){if(e=o,null!=t.exc&&"QdbReplSecurityViolation"===t.exc)return;return this.append_result(t.input,t.output),void 0}return r=new quanto.TreeManager(t.input,i),n=r.render_html(),this.append_result(t.input,n)},t.prototype.print_return_info=function(t){return this.append_result("Returning from function with:",t)},t.prototype.print_exception_info=function(t){return this.append_result(t.type+":",t.value)},t.prototype.print_debug_error=function(t){return"condition"===t.type?$(".debug-results").append(this.constructor.CONDITIONAL_BREAKPOINT_ERROR_TEMPLATE(t.data)):$(".debug-results").append(this.constructor.GENERIC_ERROR_TEMPLATE({type:t.type,data:t.data})),setTimeout(function(t){return function(){return t.scroll_into_view()}}(this),5)},t.prototype.focus_input=function(){var t,e,n,i;return n=window.getSelection(),t=document.getElementsByClassName("debug-input-box")[0],i=t.ownerDocument.createRange(),e=t.childNodes.length,i.setStart(t,e),i.setEnd(t,e),n.removeAllRanges(),n.addRange(i),t.focus()},t.prototype.setup_input=function(){return this.$input=$(".debug-input-box"),this.$input.on("keydown",function(t){return function(e){switch(e.keyCode){case 13:return t.handle_input(),setTimeout(function(){return t.reset_input()},10),e.consume();case 38:return t.fetch_from_history(!0),e.consume();case 40:return t.fetch_from_history(!1),e.consume();case 75:if(e.ctrlKey||e.metaKey)return t.clear_console(),e.consume()}}}(this))},t.prototype.fetch_from_history=function(t){var e;return null==t&&(t=!0),e=t?this.history.get_previous_history():this.history.get_next_history(),null!=e?(this.$input.blur(),this.$input.html(e),setTimeout(function(t){return function(){return t.focus_input()}}(this),1)):void 0},t.prototype.reset_input=function(){return this.$input.html(" ")},t.prototype.handle_input=function(){var t;return t=$.trim(this.$input.html()),t=t.replace(/<br>/g,""),t=$("<div />").html(t).text(),0!==t.length?(this.history.add_to_history(t),this.test_command(t)||$(document).trigger("send_debug_eval",t),setTimeout(function(t){return function(){return t.scroll_into_view()}}(this),5)):void 0},t.prototype.scroll_into_view=function(){var t;return t=$(".command-area-spacer")[0],t.scrollIntoView?t.scrollIntoView():$(".command-area-spacer").scrollintoview()},t.prototype.test_command=function(t){var e;if(_.str.startsWith(t,".watch "))return e=t.substring(7),this.watchlist_manager.handle_new_watch_expr(e)?$(".debug-results").append(this.constructor.COMMAND_RESULT_TEMPLATE({input:t,message:"Added <span class='bold'>"+e+"</span> to watchlist."})):$(".debug-results").append(this.constructor.COMMAND_RESULT_TEMPLATE({input:t,message:"Already watching <span class='bold'>"+e+"</span>."})),!0;if(_.str.startsWith(t,".unwatch "))return e=t.substring(9),this.watchlist_manager.remove_watched_expr(e)?$(".debug-results").append(this.constructor.COMMAND_RESULT_TEMPLATE({input:t,message:"Removed <span class='bold'>"+e+"</span> from watchlist."})):$(".debug-results").append(this.constructor.COMMAND_RESULT_TEMPLATE({input:t,message:"Could not find <span class='bold'>"+e+"</span> in watchlist."})),!0;switch(t){case".n":case".next":this.trigger_command("next");break;case".s":case".step":this.trigger_command("step");break;case".unt":case".until":this.trigger_command("until");break;case".u":case".up":this.trigger_command("up");break;case".d":case".down":this.trigger_command("down");break;case".r":case".return":this.trigger_command("return");break;case".c":case".continue":this.trigger_command("continue");break;case".f":case".finish":this.trigger_command("finish");break;case".clear":this.clear_console();break;case".h":case".help":case"help":case"help()":this.display_help(t);break;default:return!1}return!0},t.prototype.reset_watch_list=function(t){return this.watchlist_manager.reset(),quanto.instances.tms={},$(".watchlist-contents").html(""),quanto.instances.dbm.load_watch_exprs(t)},t}(),e=function(){function t(){this.current_history_item=i(this.current_history_item,this),this.get_previous_history=i(this.get_previous_history,this),this.get_next_history=i(this.get_next_history,this),this.add_to_history=i(this.add_to_history,this),this.history=[],this.history_offset=0}return t.prototype.add_to_history=function(t){return this.history.push(t),this.history_offset=0},t.prototype.get_next_history=function(){return 0===this.history_offset?null:(this.history_offset-=1,this.current_history_item())},t.prototype.get_previous_history=function(){return this.history_offset>this.history.length?null:(this.history_offset+=1,this.current_history_item())},t.prototype.current_history_item=function(){return this.history[this.history.length-this.history_offset]},t}(),n=function(){function t(){this.handle_breakpoint_date=i(this.handle_breakpoint_date,this),this.handle_watchlist_updated=i(this.handle_watchlist_updated,this),this.handle_add_clicked=i(this.handle_add_clicked,this),this.handle_new_watch_expr=i(this.handle_new_watch_expr,this),this.setup_modal=i(this.setup_modal,this),this.load_watchlist=i(this.load_watchlist,this),this.remove_tree_manager=i(this.remove_tree_manager,this),this.remove_watched_expr=i(this.remove_watched_expr,this),this.reset=i(this.reset,this),this.$add_button=$("#watchlist-add-button"),this.$add_button.click(function(t){return function(e){return t.handle_add_clicked(e)}}(this)),this.watched_expressions_managers={},this.setup_modal(),$(document).bind("new_watchlist_data",function(t){return function(e,n){return t.handle_watchlist_updated(n)}}(this)),$(document).bind("watch_exprs_loaded",function(t){return function(e,n){return t.load_watchlist(n)}}(this)),$(document).on("click",".remove-watched-expression",function(t){return function(e){var n,i,r;return n=$(quanto.get_src_element(e)).closest(".watchlist-result"),n.length>0&&(i=n.data("result-id"),r=quanto.tms[i],null!=r)?t.remove_tree_manager(r):void 0}}(this))}return t.prototype.reset=function(){return this.watched_expressions_managers={}},t.prototype.remove_watched_expr=function(t){var e;return e=this.watched_expressions_managers[t],null!=e?(this.remove_tree_manager(e),!0):!1},t.prototype.remove_tree_manager=function(t){var e;return e=t.input,$(document).trigger("remove_watch_expr",[e]),null!=this.watched_expressions_managers[e]&&delete this.watched_expressions_managers[e],$(".debug-result[data-result-id="+t.id+"]").remove(),t=null},t.prototype.load_watchlist=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this.handle_new_watch_expr(e,!1));return r},t.prototype.setup_modal=function(){return this.$add_modal=$("#add-watchlist-expression-modal"),this.$add_modal_textbox=this.$add_modal.find(".watchlist-expression-box"),this.$add_modal.on("show",function(t){return function(){return setTimeout(function(){return t.$add_modal_textbox.focus()},10)}}(this)),this.$add_modal_textbox.on("keydown",function(t){return function(e){return 13===e.keyCode?(t.$modal_submit_button.trigger("click"),e.consume()):void 0}}(this)),this.$modal_submit_button=this.$add_modal.find(".add-expression"),this.$modal_submit_button.click(function(t){return function(e){var n;return n=$.trim(t.$add_modal_textbox.val()),0===n.length?(e.consume(),void 0):(t.handle_new_watch_expr(n),t.$add_modal.modal("hide"))}}(this))},t.prototype.handle_new_watch_expr=function(t,e){var n,i;return null==e&&(e=!0),null!=this.watched_expressions_managers[t]?!1:(i=new quanto.WatchlistTreeManager(t,{}),n=i.render_html(),this.watched_expressions_managers[t]=i,$(".watchlist-contents").append(quanto.DebugUIManager.WATCHLIST_TEMPLATE({input:t,result:n,id:i.id})),e&&$(document).trigger("add_watch_expr",[t]),!0)},t.prototype.handle_add_clicked=function(){return this.$add_modal_textbox.val(""),this.$add_modal.modal("show")},t.prototype.handle_watchlist_updated=function(t){var e,n,i,r,o,a,s,l;for(l=[],a=0,s=t.length;s>a;a++)if(n=t[a],n.expr===quanto.DebugManager.DATE_MARKER&&this.handle_breakpoint_date(n),r=this.watched_expressions_managers[n.expr],null!=r){try{i=JSON.parse(n.value)}catch(u){i={input:r.input,objtype:"error",data:n.value,id:r.id}}o=!1,e=$(".debug-result[data-result-id="+r.id+"]"),0===e.length,null!=i.id&&r.id!==i.id&&(delete quanto.tms[r.id],quanto.tms[i.id]=r,o=!0),r.handle_updated_data(i),e.find(".debug-result-content").html(r.render_html()),o?l.push(e.attr("data-result-id",i.id)):l.push(void 0)}else l.push(void 0);return l},t.prototype.handle_breakpoint_date=function(t){var e,n;try{e=JSON.parse(t.value).data.replace(/'/g,"")}catch(i){return n=i,$(".breakpoint-date-field").addClass("hidden"),$(".breakpoint-date-field").find(".date-display").html(""),void 0}return 0===e.indexOf("AttributeError")?($(".breakpoint-date-field").addClass("hidden"),$(".breakpoint-date-field").find(".date-display").html("")):($(".breakpoint-date-field").removeClass("hidden"),$(".breakpoint-date-field").find(".date-display").html(e))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};quanto.TreeManager=t=function(){function t(t,n){this.handle_updated_data=e(this.handle_updated_data,this),this.handle_tree_toggled=e(this.handle_tree_toggled,this),this.eval_children=e(this.eval_children,this),this.parse_security_repr=e(this.parse_security_repr,this),this.wait_on_child_nodes=e(this.wait_on_child_nodes,this),this.strip_quotes=e(this.strip_quotes,this),this.build_default_title_row=e(this.build_default_title_row,this),this.build_title_row=e(this.build_title_row,this),this.get_positions_template=e(this.get_positions_template,this),this.get_position_template=e(this.get_position_template,this),this.get_order_template=e(this.get_order_template,this),this.get_security_template=e(this.get_security_template,this),this.render_html=e(this.render_html,this),this.check_security_repr=e(this.check_security_repr,this),this.get_data_for_layout=e(this.get_data_for_layout,this),this.build_leaf_node=e(this.build_leaf_node,this),this.build_simple_result=e(this.build_simple_result,this),this.handle_child_node_evaluated=e(this.handle_child_node_evaluated,this),this.input=t,this.json_data=n,this.id=n.id||quanto.generate_UUID(),quanto.tms||(quanto.tms={}),quanto.tms[this.id]=this,this.evaluated_child_nodes={},$(document).bind("child_node_evaluated",function(t){return function(e,n){var i;return i=n.context.parent_id,null!=i&&i===t.json_data.id?t.handle_child_node_evaluated(n):void 0}}(this))}return t.SIMPLE_RESULT_TEMPLATE=Handlebars.compile("<div class='leaf'> <span class='leaf-label'> <span class='property-value'>{{value}}{{truncation_message}}</span> </span> </div>"),t.LEAF_TEMPLATE=Handlebars.compile("<div class='leaf'> <span class='leaf-label'> <span class='property-name'>{{name}}</span>: <span class='property-value'>{{value}}{{truncation_message}}</span> </span> </div>"),t.TREE_TEMPLATE=Handlebars.compile("<div class='tree closed' data-node-id='{{id}}'> <span class='node-label'>{{{title}}}</span> <div class='tree-container'></div> </div>"),t.prototype.handle_child_node_evaluated=function(t){var e,n;return e=t.context.node,n=this.json_data.nodes[e],t.name=n,this.evaluated_child_nodes[e.toString()]=t,null!=this.callback_func?this.callback_func():void 0},t.prototype.build_simple_result=function(){return this.constructor.SIMPLE_RESULT_TEMPLATE({value:this.get_data_for_layout(this.json_data)})},t.prototype.build_leaf_node=function(){return this.constructor.LEAF_TEMPLATE({name:this.json_data.objtype,value:this.get_data_for_layout(this.json_data)})},t.prototype.get_data_for_layout=function(t){var e;return e="DataFrame"===t.objtype?"\n"+t.data:t.data,t.truncated&&(e+="<results truncated>"),e},t.prototype.check_security_repr=function(t){var e;return _.str.startsWith(t,"Security(")&&(e=this.parse_security_repr(t),"unknown"!==e.sid)?"Security("+e.sid+" ["+e.symbol+"])":t},t.prototype.render_html=function(t){var e,n,i,r,o;
if(null==t&&(t=!0),this.json_data.nodes&&0!==this.json_data.nodes.length)return i=this.build_title_row(this.input,this.json_data,t),e=this.constructor.TREE_TEMPLATE({id:this.json_data.id,title:i}),this.eval_children(),e;if(t)return"int"===(o=this.json_data.objtype)||"str"===o||"bool"===o||"error"===o?this.build_simple_result():this.build_leaf_node();switch(n=this.check_security_repr(this.input),r=this.get_data_for_layout(this.json_data),this.json_data.objtype){case"instancemethod":r="<instancemethod>";break;case"Timestamp":({name_ui:this.json_data.objtype})}return this.constructor.LEAF_TEMPLATE({name:n,value:r})},t.prototype.get_security_template=function(){return this.security_template||(this.security_template=Handlebars.compile("<span class='property-name'>Security</span>: <span class='property-value'>{{symbol}} ({{sid}})</span>")),this.security_template},t.prototype.get_order_template=function(){return this.order_template||(this.order_template=Handlebars.compile("<span class='property-name'>Order</span>: {{amount} {{share_noun}} of {{symbol} ({{details}}, {{translated_status}}")),this.order_template},t.prototype.get_position_template=function(){return this.position_template||(this.position_template=Handlebars.compile("<span class='property-name'>Position</span>: {{amount}} {{noun}} of {{symbol}}")),this.position_template},t.prototype.get_positions_template=function(){return this.positions_template||(this.positions_template=Handlebars.compile("<span class='property-name'>positions: ({{position_number}} {{noun}})</span>")),this.positions_template},t.prototype.build_title_row=function(t,e,n){var i,r,o,a,s,l,u;if(null==e.objtype)return"<span class='property-name'>"+t+"</span>: ";switch(e.objtype){case"Security":return r=function(e){return function(n){var i;return n.input=t,i=e.get_security_template()(n),$(".node-"+e.id).html(i)}}(this),this.wait_on_child_nodes(["sid","symbol"],r),"<span class='node-"+e.id+"'><span class='property-name'>Security</span></span>";case"Positions":return l=e.nodes.length,s=1===l?"position":"positions",i={noun:s,position_number:e.nodes.length,input:t},o=this.get_positions_template()(i);case"Position":return r=function(e){return function(n){var i;return i=e.parse_security_repr(n.sid),n.symbol=i.symbol,n.noun="1"===n.amount.toString()?"share":"shares",n.input=t,o=e.get_position_template()(n),$(".node-"+e.id).html(o)}}(this),this.wait_on_child_nodes(["amount","sid"],r),"<span class='node-"+e.id+"'><span class='property-name'>Position</span></span>";case"Order":return this.wait_on_child_nodes(["amount","status","sid","limit","stop"],function(e){return function(n){var i,r,a,s,l,u,c;return i=n.amount,c=quanto.translate_order_status(n.status),s=e.parse_security_repr(n.sid),u=s.symbol,a="None"===n.limit?null:new Number(a).toMoney(),l="None"===n.stop?null:new Number(l).toMoney(),r=null!=a&&null!=l?"Limit "+a+" Stop "+l:null!=a?"Limit "+a:null!=l?"Stop "+l:"Market",n.input=t,n.share_noun="1"===i.toString()?"share":"shares",n.details=r,n.translated_status=c,o=e.get_order_template()(n),$(".node-"+e.id).html(o)}}(this)),"<span class='node-"+e.id+"'><span class='property-name'>Order</span></span>";case"list":return s=1===e.nodes.length?"element":"elements",u="list ("+e.nodes.length+" "+s+")",n?u:(a=this.strip_quotes(e.name||t),"<span class='property-name'>"+a+"</span>: "+u);case"dict":return s=1===e.nodes.length?"element":"elements",u="dict ("+e.nodes.length+" "+s+")",n?u:(a=this.strip_quotes(e.name||t),"<span class='property-name'>"+a+"</span>: "+u);default:return this.build_default_title_row(t,e)}},t.prototype.build_default_title_row=function(t,e){var n;return n=this.check_security_repr(this.strip_quotes(e.name||t)),"<span class='property-name'>"+n+"</span>: "+e.objtype},t.prototype.strip_quotes=function(t){return _.str.trim(t,"'")},t.prototype.wait_on_child_nodes=function(t,e){return this.callback_func=function(i){return function(){var r,o,a,s,l;if(r=_.values(i.evaluated_child_nodes).filter(function(e){var i;return i=e.name,n.call(t,i)>=0}),r.length===t.length){for(a={},s=0,l=r.length;l>s;s++)o=r[s],a[o.name]=o.data;return e(a),i.callback_func=null}}}(this)},t.prototype.parse_security_repr=function(t){var e,n,i,r,o,a,s,l;try{for(t=t.substr(9),o=t.split(","),a={},a.sid=o.shift(),s=0,l=o.length;l>s;s++)r=o[s],i=r.indexOf("="),n=$.trim(r.substring(0,i)),e=$.trim(r.substring(i+1)),e=this.strip_quotes(e),a[n]=e;return a}catch(u){return{sid:"(unknown)",symbol:"(unknown)"}}},t.prototype.eval_children=function(){var t,e,n,i,r,o,a;for(o=this.json_data.nodes,a=[],e=i=0,r=o.length;r>i;e=++i)n=o[e],t={parent_id:this.json_data.id,node:e},a.push($(document).trigger("eval_child_node",[t]));return a},t.prototype.handle_tree_toggled=function(t){var e,n,i,r,o,a,s,l;if(!t.hasClass("closed"))return t.addClass("closed"),void 0;if(t.hasClass("rendered"))return t.removeClass("closed"),void 0;for(i=[],l=this.json_data.nodes,r=a=0,s=l.length;s>a;r=++a)e=l[r],n=this.evaluated_child_nodes[r.toString()],o=new quanto.TreeManager(e,n),i.push(o.render_html(!1));return t.find(".tree-container").append(i.join("\n")),t.addClass("rendered"),t.removeClass("closed")},t.prototype.handle_updated_data=function(t){return this.json_data=t,null!=t.id?this.id=t.id:void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.WatchlistTreeManager=t=function(t){function n(t,i){this.get_positions_template=e(this.get_positions_template,this),this.get_position_template=e(this.get_position_template,this),this.get_order_template=e(this.get_order_template,this),this.get_security_template=e(this.get_security_template,this),this.render_html=e(this.render_html,this),this.build_leaf_node=e(this.build_leaf_node,this),this.build_simple_result=e(this.build_simple_result,this),n.__super__.constructor.call(this,t,i)}return i(n,t),n.prototype.build_simple_result=function(){return this.constructor.LEAF_TEMPLATE({name:this.input,value:this.json_data.data})},n.prototype.build_leaf_node=function(){return this.constructor.LEAF_TEMPLATE({name:this.input,value:this.json_data.data})},n.prototype.render_html=function(t){return null==t&&(t=!0),n.__super__.render_html.call(this,!1)},n.prototype.get_security_template=function(){return this.security_template||(this.security_template=Handlebars.compile("<span class='property-name'>{{input}}</span>: <span class='property-value'>{{symbol}} ({{sid}})</span>")),this.security_template},n.prototype.get_order_template=function(){return this.order_template||(this.order_template=Handlebars.compile("<span class='property-name'>{{input}}</span>: <span class='property-value'>Order for {{amount}} {{share_noun}} of {{symbol}} ({{details}}, {{translated_status}})</span>")),this.order_template},n.prototype.get_position_template=function(){return this.positions_template||(this.positions_template=Handlebars.compile("<span class='property-name'>{{input}}</span>: Position: {{amount}} {{noun}} of {{symbol}}")),this.positions_template},n.prototype.get_positions_template=function(){return this.positions_template||(this.positions_template=Handlebars.compile("<span class='property-name'>{{input}}</span>: {{position_number}} {{noun}}</span>")),this.positions_template},n}(quanto.TreeManager)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SecondaryDropdownManagerBase=t=function(t){function n(t){this.get_help_html=e(this.get_help_html,this),this.handle_special_condition_on_select=e(this.handle_special_condition_on_select,this),this.select=e(this.select,this),this.handle_input_focus=e(this.handle_input_focus,this),this.hide_intermediate_box=e(this.hide_intermediate_box,this),this.focus_editor=e(this.focus_editor,this),this.build_param_string=e(this.build_param_string,this),this.submit_intermediate_box=e(this.submit_intermediate_box,this),this.handle_keydown=e(this.handle_keydown,this),this.intermediate_shown=!1,n.__super__.constructor.call(this,t),this.add_selected_text_to_UI=!0,$(document).bind("click",function(t){return function(e){var n;return n=$(quanto.get_src_element(e)),0===n.closest(".secondary-intellisense-box").length&&t.intermediate_shown?t.hide_intermediate_box():void 0}}(this)),this.$intermediate_box.find("input").on("keydown",this.handle_keydown),$(document).bind("color_theme_changed",function(t){return function(e,n){return"dark"===n?t.$intermediate_box.addClass("dark"):t.$intermediate_box.removeClass("dark")}}(this))}return i(n,t),n.prototype.handle_keydown=function(t){var e;if(27===t.keyCode)return this.hide_intermediate_box();if(9!==t.keyCode||t.shiftKey){if(8===t.keyCode){if(e=$(quanto.get_src_element(t)),e.hasClass("param0")&&""===e.val()&&(this.hide_intermediate_box(),"undefined"!=typeof CodeMirror&&null!==CodeMirror&&null!=quanto.editor))return CodeMirror.commands.delCharBefore(quanto.editor)}else if(13===t.keyCode)return e=$(quanto.get_src_element(t)),e.hasClass("last")?this.submit_intermediate_box():e.find("~ input").first().focus()}else if(e=$(quanto.get_src_element(t)),e.hasClass("last"))return this.submit_intermediate_box()},n.prototype.submit_intermediate_box=function(){var t,e,i,r,o,a,s,l;for(t="",this.add_selected_text_to_UI&&(t+=this.get_selected_item_text()),a=this.data[this.get_selected_item_text()],r=this.add_selected_text_to_UI?t+"(":t,e=s=0,l=a.length;l>s;e=++s)o=a[e],i=this.$intermediate_box.find(".param"+e).val(),(null==i||0===i.length)&&(i=o[2]),r+=this.build_param_string(o[0],i),e<a.length-1&&(r+=", ");return r+=")",this.add_selected_text_to_UI&&(r+=")"),this.select(r),n.__super__.select.call(this,r),this.hide_intermediate_box()},n.prototype.build_param_string=function(t,e){return""+t+"="+e},n.prototype.focus_editor=function(){return setTimeout(function(){return function(){return quanto.editor.focus()}}(this),10)},n.prototype.hide_intermediate_box=function(){return this.$intermediate_box.hide(),this.intermediate_shown=!1,this.focus_editor()},n.prototype.handle_input_focus=function(t){var e,n,i,r;return e=$(quanto.get_src_element(t)),r=e.data("property"),n=_.find(this.data[this.get_selected_item_text()],function(){return function(t){return t[0]===r}}(this)),i=n[1]+this.get_help_html(),this.$intermediate_box.find(".secondrow").html(i),this.$intermediate_box.find(".thirdrow .highlighted").removeClass("highlighted"),this.$intermediate_box.find(".thirdrow ."+r).addClass("highlighted")},n.prototype.select=function(){var t,e,n,i,r,o,a,s,l,u,c;for(l=this.get_selected_item_text(),this.$intermediate_box.find("input").off("keydown"),this.$intermediate_box.html(""),a=this.data[l],t=$("<div class='firstrow'></div>"),n="",this.add_selected_text_to_UI&&(n=l+"("),i=u=0,c=a.length;c>u;i=++u)o=a[i],r=i===a.length-1?"last":"",r+=" param"+i,n+="<span class='param'>"+o[0]+"=</span><input type='text' class='"+r+"' placeholder='"+o[2]+"' data-property='"+o[0]+"'/>",i<a.length-1&&(n+=", ");return n+=")",t.html(n),e=$("<div class='secondrow'></div>"),e.html(a[0][1]+this.get_help_html()),this.$intermediate_box.append(t),this.$intermediate_box.append(e),this.handle_special_condition_on_select(l),s=quanto.editor.cursorCoords(),this.last_x=s.left,this.last_y=s.top,this.$intermediate_box.css("left",this.last_x-1+"px").css("top",this.last_y+8-111+"px").show(),this.intermediate_shown=!0,this.$intermediate_box.find("input").on("keydown",this.handle_keydown),this.$intermediate_box.find("input").on("focus",this.handle_input_focus),setTimeout(function(t){return function(){return t.$intermediate_box.find("input").first().focus()}}(this),10)},n.prototype.handle_special_condition_on_select=function(){},n.prototype.get_help_html=function(){},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.AccountDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.AccountTooltipManager,e.__super__.constructor.call(this,$("#account-intellisense-box")),this.target_regex=new RegExp("context\\.account\\.","i"),this.$tooltip=$("#account-tooltip")}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.CommissionDropdownManager=t=function(t){function n(){this.get_help_html=e(this.get_help_html,this),this.tooltip_mgr=new quanto.CommissionTooltipManager,this.$intermediate_box=$("#commission-intermediate-intellisense-box"),this.target_string="set_commission",this.$tooltip=$("#commission-tooltip"),n.__super__.constructor.call(this,$("#commission-intellisense-box")),this.trigger="(",this.data={"commission.PerShare":[["cost","Fixed dollar commission per share traded.","0.0075"],["min_trade_cost","Optional minimum trade cost.","1.00"]],"commission.PerTrade":[["cost","Fixed dollar commission per trade.","1.00"]]}}return i(n,t),n.prototype.get_help_html=function(){return"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-commission'>Learn More</a></span>"},n}(quanto.SecondaryDropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.ContextDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.ContextTooltipManager,e.__super__.constructor.call(this,$("#context-intellisense-box")),this.$tooltip=$("#context-tooltip"),this.target_string="context"}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.DataDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.DataTooltipManager,e.__super__.constructor.call(this,$("#data-intellisense-box")),this.$tooltip=$("#data-tooltip"),this.target_string="data",this.add_left_paren=!0}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.DateRuleDropdownManager=t=function(t){function n(){this.check_text_match=e(this.check_text_match,this),this.tooltip_mgr=new quanto.DateRuleTooltipManager,n.__super__.constructor.call(this,$("#date-rule-intellisense-box")),this.target_string="date_rule",this.$tooltip=$("#date-rule-tooltip"),this.trigger="=",this.add_left_paren=!0}return i(n,t),n.prototype.check_text_match=function(t,e,n){var i,r;return null==n&&(n=!1),r=t.getLine(e.from.line),i=r.indexOf("schedule_function(")>-1,null!=this.target_string&&t.cm.getTokenAt(e.from).string===this.target_string&&i},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.DateRulesDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.DateRulesTooltipManager,e.__super__.constructor.call(this,$("#date-rules-intellisense-box")),this.target_string="date_rules",this.$tooltip=$("#date-rules-tooltip"),this.trigger=".",this.add_left_paren=!0}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.GetDropdownManager=t=function(t){function n(){this.select=e(this.select,this),this.show_tooltip_after_select=e(this.show_tooltip_after_select,this),this.tooltip_mgr=new quanto.GetTooltipManager,n.__super__.constructor.call(this,$("#get-intellisense-box")),this.target_string="get_",this.$tooltip=$("#get-tooltip"),this.trigger="_",this.add_left_paren=!0}return i(n,t),n.prototype.show_tooltip_after_select=function(){return"get_fundamentals"!==this.get_selected_item_text()?n.__super__.show_tooltip_after_select.call(this):void 0},n.prototype.select=function(t){return n.__super__.select.call(this,t),"get_fundamentals"===this.get_selected_item_text()?setTimeout(function(){return function(){var t,e,n,i,r,o,a,s,l,u;for(e=quanto.editor.getCursor(),n=quanto.editor.getTokenAt({line:e.line,ch:e.ch-1}),i=0,s=0;i<=n.start+1;){if(u=quanto.editor.getTokenAt({line:e.line,ch:i}),u.type){s=u.start;break}i++}return a=new Array(s+1).join(" "),l="    ",o=e.line,t=e.ch,r="\n"+a+l+"query(\n"+a+l+l+'# put your query in here by typing "fundamentals."\n'+a+l+")\n"+a+l+".filter(\n"+a+l+l+"# put your filters here\n"+a+l+")\n"+a+l+".order_by(\n"+a+l+l+"# sort your query\n"+a+l+")\n"+a+l+".limit(100)\n"+a+")",quanto.editor.replaceRange(r,{line:o,ch:t},{line:o,ch:t})}}(this),50):void 0},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e,n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.LogDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.LogTooltipManager,e.__super__.constructor.call(this,$("#log-intellisense-box")),this.target_string="log",this.$tooltip=$("#log-tooltip")}return i(e,t),e}(quanto.DropdownManagerBase),quanto.LogTooltipManager=e=function(t){function e(){var t;t=$("#log-tooltip"),this.token_info={error:["void error","string","Logs a string to error."],info:["void info","string","Logs a string to info."],warn:["void warn","string","Logs a string to warn."],debug:["void debug","string","Logs a string to debug."]},this.property_list=_.keys(this.token_info),this.token_types=["quanto-log-method"],e.__super__.constructor.call(this,t)}return i(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.MaxOrderCountDropdownManager=t=function(t){function n(){this.get_selected_item_text=e(this.get_selected_item_text,this),this.build_param_string=e(this.build_param_string,this),this.select=e(this.select,this),this.show=e(this.show,this),this.get_help_html=e(this.get_help_html,this),this.handle_special_condition_on_select=e(this.handle_special_condition_on_select,this),this.tooltip_mgr=new quanto.MaxOrderCountTooltipManager,this.target_string="set_max_order_count",this.$intermediate_box=$("#maxordercount-intermediate-intellisense-box"),this.$tooltip=$("#maxordercount-tooltip"),n.__super__.constructor.call(this,$("#maxordercount-intellisense-box")),this.trigger="(",this.add_selected_text_to_UI=!1,this.data={set_max_order_count:[["max_order_count","Set a limit on the number of orders that can be placed by this algorithm in a single day.","0"]]}}return i(n,t),n.prototype.handle_special_condition_on_select=function(){},n.prototype.get_help_html=function(){return"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-trading-guards'>Learn More</a></span>"},n.prototype.show=function(t,e){return this.last_x=t,this.last_y=e,this.select(),this.trigger_pos=quanto.editor.getCursor()},n.prototype.select=function(){var t,e,n,i,r,o,a,s,l,u;for(s=this.get_selected_item_text(),this.$intermediate_box.find("input").off("keydown"),this.$intermediate_box.html(""),a=this.data[s],t=$("<div class='firstrow'></div>"),n="",this.add_selected_text_to_UI&&(n=s+"("),i=l=0,u=a.length;u>l;i=++l)o=a[i],r=i===a.length-1?"last":"",r+=" param"+i,n+="<input type='text' class='"+r+"' placeholder='"+o[2]+"' data-property='"+o[0]+"'/>",i<a.length-1&&(n+=", ");return n+=")",t.html(n),e=$("<div class='secondrow'></div>"),e.html(a[0][1]+this.get_help_html()),this.$intermediate_box.append(t),this.$intermediate_box.append(e),this.handle_special_condition_on_select(s),this.$intermediate_box.css("left",this.last_x-1+"px").css("top",this.last_y+8-111+"px").show(),this.intermediate_shown=!0,this.$intermediate_box.find("input").on("keydown",this.handle_keydown),this.$intermediate_box.find("input").on("focus",this.handle_input_focus),setTimeout(function(t){return function(){return t.$intermediate_box.find("input").first().focus()}}(this),10)},n.prototype.build_param_string=function(t,e){return""+e},n.prototype.get_selected_item_text=function(){return"set_max_order_count"},n}(quanto.SecondaryDropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.OrderDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.OrderTooltipManager,e.__super__.constructor.call(this,$("#order-intellisense-box")),this.target_string="order_",this.$tooltip=$("#order-tooltip"),this.trigger="_",this.add_left_paren=!0}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.PortfolioDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.PortfolioTooltipManager,e.__super__.constructor.call(this,$("#portfolio-intellisense-box")),this.target_regex=new RegExp("context\\.portfolio\\.","i"),this.$tooltip=$("#portfolio-tooltip")}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.PositionDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.PositionTooltipManager,e.__super__.constructor.call(this,$("#positions-intellisense-box")),this.target_regex=new RegExp("positions\\[[^\\s]+\\]\\.","i"),this.$tooltip=$("#position-tooltip")}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.SecurityListDropdownManager=t=function(t){function e(){e.__super__.constructor.call(this,$("#security-list-intellisense-box")),this.target_string="security_lists"}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SetDropdownManager=t=function(t){function n(){this.get_help_html=e(this.get_help_html,this),this.build_param_string=e(this.build_param_string,this),this.focus_editor=e(this.focus_editor,this),this.hide_intermediate_box=e(this.hide_intermediate_box,this),this.handle_input_focus=e(this.handle_input_focus,this),this.handle_keydown=e(this.handle_keydown,this),this.submit_intermediate_box=e(this.submit_intermediate_box,this),this.build_second_dropdown=e(this.build_second_dropdown,this),this.build_intermediate_box=e(this.build_intermediate_box,this),this.show_tooltip=e(this.show_tooltip,this),this.tooltip_mgr=new quanto.SetTooltipManager,this.$intermediate_box=$("#set-intermediate-intellisense-box"),this.$intermediate_box.find("input").on("keydown",this.handle_keydown),this.target_string="set_",this.$tooltip=$("#set-tooltip"),$(document).bind("click",function(t){return function(e){var n;return n=$(quanto.get_src_element(e)),0===n.closest(".secondary-intellisense-box").length&&t.intermediate_shown?t.hide_intermediate_box():void 0}}(this)),n.__super__.constructor.call(this,$("#set-intellisense-box")),this.trigger="_",this.add_left_paren=!0,this.data={set_max_order_count:[["max_order_count","Set a limit on the number of orders that can be placed by this algorithm in a single day.","0"]],FixedSlippage:[["spread","Half the spread will be added on buys and subtracted on sells.","0.00"]],VolumeShareSlippage:[["volume_limit","The cap imposed on your order's share of the minute bar volume.","0.025"],["price_impact","The constant used to calculate your order's impact on the price.","0.1"]],PerShare:[["cost","Fixed dollar commission per share traded.","0.0075"],["min_trade_cost","Optional minimum trade cost.","1.00"]],PerTrade:[["cost","Fixed dollar commission per trade.","1.00"]]},this.show_fillable_tooltip=_.keys(this.data),this.show_second_dropdown=["set_commission","set_slippage"]}return i(n,t),n.prototype.show_tooltip=function(){var t;return t=this.previous_token(),this.show_fillable_tooltip.indexOf(t.string)>=0?this.build_intermediate_box():this.show_second_dropdown.indexOf(t.string)>=0?this.build_second_dropdown():this.tooltip_mgr.force_show(t)},n.prototype.build_intermediate_box=function(){var t,e,n,i,r,o,a,s,l,u,c,d;for(u=this.get_selected_item_text(),l=this.previous_token(),this.$intermediate_box.find("input").off("keydown"),this.$intermediate_box.html(""),a=this.data[u]||this.data[l.string],t=$("<div class='firstrow'></div>"),n="",i=c=0,d=a.length;d>c;i=++c)o=a[i],r=i===a.length-1?"last":"",r+=" param"+i,n+="set_max_order_count"===l.string?"<input type='text' class='"+r+"' placeholder='"+o[2]+"' data-property='"+o[0]+"'/>":"<span class='param'>"+o[0]+"=</span><input type='text' class='"+r+"' placeholder='"+o[2]+"' data-property='"+o[0]+"'/>",i<a.length-1&&(n+=", ");return n+=")",t.html(n),e=$("<div class='secondrow'></div>"),e.html(a[0][1]+this.get_help_html()),this.$intermediate_box.append(t),this.$intermediate_box.append(e),s=quanto.editor.cursorCoords(),this.last_x=s.left,this.last_y=s.top,this.$intermediate_box.css("left",this.last_x-1+"px").css("top",this.last_y+8-111+"px").show(),this.intermediate_shown=!0,this.$intermediate_box.find("input").on("keydown",this.handle_keydown),this.$intermediate_box.find("input").on("focus",this.handle_input_focus),setTimeout(function(t){return function(){return t.$intermediate_box.find("input").first().focus()}}(this),10)},n.prototype.build_second_dropdown=function(){var t,e;switch(e=this.previous_token(),e.string){case"set_commission":this.$dropdown=$("#commission-intellisense-box");break;case"set_slippage":this.$dropdown=$("#slippage-intellisense-box")}return this.$listbox=this.$dropdown.find(".matchlist"),this.$listbox.find(".match").removeClass("active").removeClass("hidden"),this.highlight_first(),t=quanto.editor.cursorCoords(),this.last_x=t.left,this.last_y=t.top,this.$dropdown.css("left",this.last_x+"px").css("top",this.last_y+8-90+"px").show(),this.shown=!0},n.prototype.highlight_first=function(){return this.$listbox.find(".match").removeClass("active"),this.$listbox.find(".match").not(".hidden").first().addClass("active")},n.prototype.submit_intermediate_box=function(){var t,e,n,i,r,o,a,s;for(this.add_left_paren=!1,t="",o=this.data[this.get_selected_item_text()]||this.data[this.previous_token().string],i=t,e=a=0,s=o.length;s>a;e=++a)r=o[e],n=this.$intermediate_box.find(".param"+e).val(),(null==n||0===n.length)&&(n=r[2]),i+=this.build_param_string(r[0],n),e<o.length-1&&(i+=", ");return i+=")","set_max_order_count"!==this.previous_token().string&&(i+=")"),this.select(i),this.hide_intermediate_box()},n.prototype.handle_keydown=function(t){var e;if(27===t.keyCode)return this.hide_intermediate_box();if(9!==t.keyCode||t.shiftKey){if(8===t.keyCode){if(e=$(quanto.get_src_element(t)),e.hasClass("param0")&&""===e.val()&&(this.hide_intermediate_box(),"undefined"!=typeof CodeMirror&&null!==CodeMirror&&null!=quanto.editor))return CodeMirror.commands.delCharBefore(quanto.editor)}else if(13===t.keyCode)return e=$(quanto.get_src_element(t)),e.hasClass("last")?this.submit_intermediate_box():e.find("~ input").first().focus()}else if(e=$(quanto.get_src_element(t)),e.hasClass("last"))return this.submit_intermediate_box()},n.prototype.handle_input_focus=function(t){var e,n,i,r;return e=$(quanto.get_src_element(t)),r=e.data("property"),n=_.find(this.data[this.get_selected_item_text()],function(){return function(t){return t[0]===r}}(this))||_.find(this.data[this.previous_token().string],function(){return function(t){return t[0]===r}}(this)),i=n[1]+this.get_help_html(),this.$intermediate_box.find(".secondrow").html(i),this.$intermediate_box.find(".thirdrow .highlighted").removeClass("highlighted"),this.$intermediate_box.find(".thirdrow ."+r).addClass("highlighted")},n.prototype.hide_intermediate_box=function(){return this.$intermediate_box.hide(),this.intermediate_shown=!1,this.focus_editor(),this.add_left_paren=!0,this.$dropdown=$("#set-intellisense-box"),this.$listbox=this.$dropdown.find(".matchlist")},n.prototype.hide=function(){return this.$dropdown.hide(),this.shown=!1,this.add_left_paren=!0,this.$dropdown=$("#set-intellisense-box"),this.$listbox=this.$dropdown.find(".matchlist")},n.prototype.focus_editor=function(){return setTimeout(function(){return function(){return quanto.editor.focus()}}(this),10)},n.prototype.build_param_string=function(t,e){return"set_max_order_count"===this.previous_token().string?""+e:""+t+"="+e},n.prototype.get_help_html=function(){var t;return t=this.previous_token(),["set_max_order_count"].indexOf(t.string)>=0?"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-trading-guards'>Learn More</a></span>":["FixedSlippage","VolumeShareSlippage"].indexOf(t.string)>=0?"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-slippage'>Learn More</a></span>":["DollarVolumeUniverse"].indexOf(t.string)>=0?"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-universe'>Learn More</a></span>":["PerShare","PerTrade"].indexOf(t.string)>=0?"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-commission'>Learn More</a></span>":void 0},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SlippageDropdownManager=t=function(t){function n(){this.get_help_html=e(this.get_help_html,this),this.handle_special_condition_on_select=e(this.handle_special_condition_on_select,this),this.tooltip_mgr=new quanto.SlippageTooltipManager,this.$intermediate_box=$("#slippage-intermediate-intellisense-box"),this.$tooltip=$("#slippage-tooltip"),this.target_string="set_slippage",n.__super__.constructor.call(this,$("#slippage-intellisense-box")),this.trigger="(",this.data={"slippage.FixedSlippage":[["spread","Half the spread will be added on buys and subtracted on sells.","0.00"]],"slippage.VolumeShareSlippage":[["volume_limit","The cap imposed on your order's share of the minute bar volume.","0.025"],["price_impact","The constant used to calculate your order's impact on the price.","0.1"]]}}return i(n,t),n.prototype.handle_special_condition_on_select=function(t){var e,n;return n="<span class='font-11'>Slippage: </span><span class='monospace'>min(<span class='volume_limit'>volume_limit</span>, (order_volume / bar_volume))**2 * <span class='price_impact'>price_impact</span></span>","slippage.VolumeShareSlippage"===t?(e=$("<div class='thirdrow'></div>"),e.append("<span>"+n+"</span>"),this.$intermediate_box.append(e)):void 0},n.prototype.get_help_html=function(){return"<span class='pull-right padding_10l'><a class='underline' target='_blank' href='/help#ide-slippage'>Learn More</a></span>"},n}(quanto.SecondaryDropdownManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)
}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.StyleDropdownManager=t=function(t){function n(){this.check_if_text_contains_an_order=e(this.check_if_text_contains_an_order,this),this.check_text_match=e(this.check_text_match,this),this.tooltip_mgr=new quanto.StyleTooltipManager,n.__super__.constructor.call(this,$("#style-intellisense-box")),this.target_string="style",this.$tooltip=$("#style-tooltip"),this.trigger="=",this.add_left_paren=!0}return i(n,t),n.prototype.check_text_match=function(t,e,n){var i,r;return null==n&&(n=!1),i=t.getLine(e.from.line),r=this.check_if_text_contains_an_order(i),null!=this.target_string&&t.cm.getTokenAt(e.from).string===this.target_string&&r},n.prototype.check_if_text_contains_an_order=function(t){return t.indexOf("order(")>0||t.indexOf("order_percent(")>0||t.indexOf("order_target_value(")>0||t.indexOf("order_target_percent(")>0||t.indexOf("order_value(")>0||t.indexOf("order_target(")>0},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e,n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.TALibDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.TALibTooltipManager,e.__super__.constructor.call(this,$("#talib-intellisense-box")),this.$tooltip=$("#talib-tooltip"),this.target_string="ta"}return i(e,t),e}(quanto.DropdownManagerBase),quanto.TALibTooltipManager=e=function(t){function e(){var t,n,i,r,o,a;t=$("#talib-tooltip"),this.token_info={},a=quanto_data.talib_info;for(i in a)r=a[i],n=r[0],r.shift(),o="",r.length>0&&(o=_.map(r,function(t){return""+t[0]+"="+t[1]}).join(", ")),this.token_info[i]=[i,o,n];this.property_list=[],this.token_types=["quanto-talib"],e.__super__.constructor.call(this,t)}return i(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.TimeRuleDropdownManager=t=function(t){function n(){this.check_text_match=e(this.check_text_match,this),this.tooltip_mgr=new quanto.TimeRuleTooltipManager,n.__super__.constructor.call(this,$("#time-rule-intellisense-box")),this.target_string="time_rule",this.$tooltip=$("#time-rule-tooltip"),this.trigger="=",this.add_left_paren=!0}return i(n,t),n.prototype.check_text_match=function(t,e,n){var i,r;return null==n&&(n=!1),r=t.getLine(e.from.line),i=r.indexOf("schedule_function(")>-1,null!=this.target_string&&t.cm.getTokenAt(e.from).string===this.target_string&&i},n}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.TimeRulesDropdownManager=t=function(t){function e(){this.tooltip_mgr=new quanto.TimeRulesTooltipManager,e.__super__.constructor.call(this,$("#time-rules-intellisense-box")),this.target_string="time_rules",this.$tooltip=$("#time-rules-tooltip"),this.trigger=".",this.add_left_paren=!0}return n(e,t),e}(quanto.DropdownManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.AccountTooltipManager=t=function(t){function e(){var t;t=$("#account-tooltip"),this.token_info={accrued_interest:["float accrued_interest","","Interest that has accumulated but has not been paid or charged."],available_funds:["float available_funds","","Equity with loan value less the initial margin requirement."],buying_power:["float buying_power","","The maximum dollar value of securities that you can buy in your account without depositing additional equity."],cushion:["float cushion","","Excess liquidity as a percentage of net liquidation."],day_trades_remaining:["float day_trades_remaining","","The number of open/close trades a user can place before pattern day trading is detected."],equity_with_loan:["float equity_with_loan","","Total cash, stock, bond, fund, and European & Asian options value."],excess_liquidity:["float excess_liquidity","","Equity with loan value less the maintenance margin."],initial_margin_requirement:["float initial_margin_requirement","","The minimum portion of a new security purchase that an investor must pay for in cash."],leverage:["float leverage","","Gross exposure divided by net liquidation."],maintenance_margin_requirement:["float maintenance_margin_requirement","","The amount of equity which must be maintained in order to continue holding a position."],net_leverage:["float leverage","","Net exposure divided by net liquidation."],net_liquidation:["float net_liquidation","","Total cash, stock, securities options, bond, and fund value."],regt_equity:["float regt_equity","","Total cash, stock, bond, fund, non-U.S. & Canadian securities options, accrued interest, and accrued dividend."],regt_margin:["float regt_margin","","The margin requirement calculated under US Regulation T rules."],settled_cash:["float settled_cash","","Cash recognized at the time of settlement less purchases at the time of trade, commissions, taxes, and fees."],total_positions_value:["float total_positions_value","","The sum of the absolute value of all stock and equity option positions."]},this.property_list=_.keys(this.token_info),this.token_types=["quanto-account"],e.__super__.constructor.call(this,t)}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.CommissionTooltipManager=t=function(t){function n(){this.force_show=e(this.force_show,this);var t,i;t=$("#commission-tooltip"),i="<a class='padding_5l underline' target='_blank' href='/help#ide-commission'>Learn More</a>",this.token_info={set_commission:["void set_commission","commission","Sets the commission model for this backtest. "+i],"commission.PerShare":["Fixed dollar commission per share traded "+i,"",""],"commission.PerTrade":["Fixed dollar commission per trade "+i,"",""]},this.property_list=["PerShare","PerTrade"],this.token_types=["quanto-toplevel","quanto-commission"],n.__super__.constructor.call(this,t)}return i(n,t),n.prototype.force_show=function(){},n}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.ContextTooltipManager=t=function(t){function e(){var t,n;t=$("#context-tooltip"),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={account:["object account","","The current account metrics for your backtest. "+n("#api-account")],portfolio:["object portfolio","","The current portfolio for your backtest. "+n("#api-portfolio")]},this.property_list=["account","portfolio"],this.token_types=["quanto-context-method"],e.__super__.constructor.call(this,t)}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.DataTooltipManager=t=function(t){function e(){var t,n;t=$("#data-tooltip"),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={current:["current","asset, field","Get the current value of the specified field(s) for one or more assets. "+n("")],history:["history","asset, fields, bar_count, frequency","Get a window of values for the given field(s) and given asset(s). "+n("#api-history")],is_stale:["boolean is_stale","asset","Returns whether the last traded date for this asset(s) is different from the current algorithm time. "+n("")],can_trade:["boolean can_trade","asset","True if the asset(s) is alive and has traded at least once. "+n("")],fetcher_assets:["fetcher_assets","","Returns a list of assets for the current date, as defined by the fetcher data. "+n("")]},this.property_list=[],this.token_types=["quanto-data-method"],e.__super__.constructor.call(this,t),$(document).bind("show_tooltip",function(t){return function(e,n,i){return _.contains(_.keys(t.token_info),n)?t.force_show(i):void 0}}(this))}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.DateRuleTooltipManager=t=function(t){function e(){var t,n;t=$("#date-rule-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={every_day:["every_day","","Schedule a function to run once per trading day. "+n("#ide-everyday")],week_start:["week_start","days_offset=0","Schedule a function to run relative to the first trading day of the week. "+n("#ide-weekstart")],week_end:["week_end","days_offset=0","Schedule a function to run relative to the last trading day of the week. "+n("#ide-weekend")],month_start:["month_start","days_offset=0","Schedule a function to run relative to the first trading day of the month. "+n("#ide-monthstart")],month_end:["month_end","days_offset=0","Schedule a function to run relative to the last trading day of the month. "+n("#ide-monthend")]},this.property_list=[],this.has_no_params=["every_day"],this.token_types=["quanto-toplevel"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.DateRulesTooltipManager=t=function(t){function e(){var t,n;t=$("#date-rules-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={every_day:["every_day","","Schedule a function to run once per trading day. "+n("#ide-everyday")],week_start:["week_start","days_offset=0","Schedule a function to run relative to the first trading day of the week. "+n("#ide-weekstart")],week_end:["week_end","days_offset=0","Schedule a function to run relative to the last trading day of the week. "+n("#ide-weekend")],month_start:["month_start","days_offset=0","Schedule a function to run relative to the first trading day of the month. "+n("#ide-monthstart")],month_end:["month_end","days_offset=0","Schedule a function to run relative to the last trading day of the month. "+n("#ide-monthend")]},this.property_list=[],this.has_no_params=["every_day"],this.token_types=["quanto-toplevel"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.FetchCSVTooltipManager=t=function(t){function e(){var t,n;t=$("#fetchcsv-tooltip"),n="<a class='underline' target='_blank' href='/help#overview-fetcher'>Learn More</a>",this.token_info={fetch_csv:["void fetch_csv","url, pre_func=None, post_func=None, universe_func=None, date_column='date', date_format='%m/%d/%y', timezone='UTC', symbol=None, **kwargs","Load a CSV file from a remote server into this backtest.  "+n]},this.property_list=[],this.token_types=["quanto-fetchcsv"],e.__super__.constructor.call(this,t),$(quanto.editor.getScrollerElement()).on("mouseover",function(t){return function(e){return t.handle_mouseover(e)}}(this)),$(document).bind("show_tooltip",function(t){return function(e,n,i){return"fetchcsv"===n?t.force_show(i):void 0}}(this))}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.GetTooltipManager=t=function(t){function e(){var t,n;t=$("#get-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='padding_5l underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={get_datetime:["get_datetime","","Gets the current Python datetime that the algorithm is using. "+n("#api-get-datetime")],get_environment:["get_environment","field","Returns information about the environment in which the backtest or live algorithm is running"+n("#api-get-environment")],get_fundamentals:["get_fundamentals","query","Returns a dataframe containing the fundamental data specified by the query."+n("#api-get-fundamentals")],get_open_orders:["get_open_orders","asset=None","Returns a dict of all open orders keyed by asset, or a list of orders if given an asset. "+n("#api-get-open-orders")],get_order:["get_order","order_id","Returns a copy of an order. "+n("#api-get-order")]},this.property_list=[],this.has_no_params=["get_datetime"],this.token_types=["quanto-toplevel","quanto-get","quanto-fundamentals"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.MaxOrderCountTooltipManager=t=function(t){function n(){this.force_show=e(this.force_show,this);var t,i;t=$("#maxordercount-tooltip"),i="<a class='padding_5l underline' target='_blank' href='/help#ide-trading-guards'>Learn More</a>",this.token_info={set_max_order_count:["set_max_order_count","max_orders","Set a limit on the number of order that can be placed by this algorithm in a single day.  "+i]},this.property_list=["batch_transform"],this.token_types=["quanto-batchtransform"],n.__super__.constructor.call(this,t)}return i(n,t),n.prototype.force_show=function(){},n}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.OrderTooltipManager=t=function(t){function e(){var t,n;t=$("#order-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='padding_5l underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={order_percent:["order_percent","sid, percent, style","Place an order as a given percent of the current portfolio value. "+n("#api-order-percent")],order_target:["order_target","sid, target, style","Place an order to adjust a position to a target number of shares. "+n("#api-order-target")],order_target_value:["order_taget_value","sid, target, style","Place an order to adjust a position to a target value. "+n("#api-order-target-value")],order_target_percent:["order_target_percent","sid, target_percent, style","Place an order to adjust a position to a target percent of the current portfolio value. "+n("#api-order-target-percent")],order_value:["order_value","sid, value, last_price, style","Place an order by desired value rather than desired number of shares. "+n("#api-order-value")]},this.property_list=[],this.token_types=["quanto-toplevel","quanto-order"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.PortfolioTooltipManager=t=function(t){function e(){var t;t=$("#portfolio-tooltip"),this.token_info={start_date:["datetime start_date","","UTC datetime of the algorithm start date (either historical for backtests, or actual for live trading)."],portfolio_value:["float portfolio value","","Value of open positions plus cash."],positions_value:["float positions_value","","Total market value of your open positions."],starting_cash:["float starting_cash","","Initial capital base at the start of the backtest."],cash:["float ending_cash","","Your current cash."],pnl:["float pnl","","Cumulative dollar value profit or loss, including unrealized gains."],returns:["float returns","","Percentage returns for the entire portfolio up to this moment."],capital_used:["float capital_used","","The net cash spent or received by buying and selling securities."],positions:["dictionary positions","","A Python dictionary, keyed by sid, holding all the information for your current positions."]},this.property_list=_.keys(this.token_info),this.token_types=["quanto-portfolio"],e.__super__.constructor.call(this,t)}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.PositionTooltipManager=t=function(t){function e(){var t;t=$("#position-tooltip"),this.token_info={amount:["int amount","","Whole number of shares in this position."],cost_basis:["float cost_basis","","Average cost per share in this position."],last_sale_price:["float last_sale_price","","Last market price of the security held in this position."],sid:["int sid","","The ID of the security."]},this.property_list=_.keys(this.token_info),this.token_types=["quanto-position"],e.__super__.constructor.call(this,t)}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.SetTooltipManager=t=function(t){function e(){var t,n;t=$("#set-tooltip"),e.__super__.constructor.call(this,t),n="<a class='padding_5l underline' target='_blank' href='/help#ide-trading-guards'>Learn More</a>",this.token_info={set_benchmark:["void set_benchmark","sid","Specify the security to use as the benchmark."],set_long_only:["set_long_only","",""],set_symbol_lookup_date:["set_symbol_lookup_date","'YYYY-MM-DD'","Specify the date when looking up symbols."],set_max_order_size:["set_max_order_size","sid, max_shares, max_notional","At least max_shares or max_notional must be specified. "+n],set_max_position_size:["set_max_position_size","sid, max_shares, max_notional","At least max_shares or max_notional must be specified. "+n],set_do_not_order_list:["set_do_not_order_list","security_list","A list of securities that will not be ordered. "+n]},this.property_list=[],this.has_no_params=["set_long_only"],this.token_types=["quanto-toplevel","quanto-tradingcontrols"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SidTooltipManager=t=function(t){function n(){this.is_match=e(this.is_match,this),this.token_types=["sid-value"],n.__super__.constructor.call(this,$("#sid-tooltip"))}return i(n,t),n.prototype.handle_editor_change=function(){},n.prototype.force_show=function(){},n.prototype.build_and_show_tooltip=function(t,e,n){var i,r;return r=t.string,i=quanto.editor.charCoords({line:e,ch:n}),this.$tooltip.find(".ticker").html(quanto.sid_cache.get_ticker(r)),this.$tooltip.find(".longname").html("("+quanto.sid_cache.get_name(r)+")"),this.$tooltip.css("left",i.left+"px").css("top",i.top-21-90+"px").show(),this.shown=!0},n.prototype.is_match=function(t){return null!=t&&this.token_types.indexOf(t.type)>=0&&null!=t.string},n}(quanto.TooltipManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.SlippageTooltipManager=t=function(t){function n(){this.force_show=e(this.force_show,this);var t,i;t=$("#slippage-tooltip"),i="<a class='padding_5l underline' target='_blank' href='/help#ide-slippage'>Learn More</a>",this.token_info={set_slippage:["void set_slippage","slippage","Sets the slippage model for this backtest. "+i],"slippage.FixedSlippage":["Constant slippage model "+i,"","Uses a fixed spread to calculate slippage."],"slippage.VolumeShareSlippage":["Volume share slippage model "+i,"","<div>Calculates slippage using the proportion of order volume to bar volume.</div><div>Slippage: <span class='monospace font-14'>min(volume_limit, (order_volume / bar_volume))**2 * price_impact</span></div>"]},this.property_list=["FixedSlippage","VolumeShareSlippage"],this.token_types=["quanto-toplevel","quanto-slippage"],n.__super__.constructor.call(this,t)}return i(n,t),n.prototype.force_show=function(){},n}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.StyleTooltipManager=t=function(t){function e(){var t,n;t=$("#style-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='padding_5l underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={MarketOrder:["MarketOrder","<b>exchange</b>","Place an order to be executed at the current market price. "+n("#ide-ordering")],LimitOrder:["LimitOrder","<b>limit_price</b> <i>(required)</i><b>, exchange</b>","Place an order to be executed at the given limit_price. "+n("#ide-ordering")],StopOrder:["StopOrder","<b>stop_price</b> <i>(required)</i><b>, exchange</b>","Place an order to be converted into a market order when a security's price crosses a given threshhold. "+n("#ide-ordering")],StopLimitOrder:["StopLimitOrder","<b>limit_price</b> <i>(required)</i><b>, stop_price</b> <i>(required)</i><b>, exchange</b>","Place an order to be converted into a limit order when the price for the given security crosses a given threshhold. "+n("#ide-ordering")],VWAPBestEffort:["VWAPBestEffort","<b>limit_price, start_date, end_date, max_pct_vol, avoid_liquidity, exchange</b>","Place an order so average price equals the Volume Weighted Average Price of security over given period. "+n("#api-VWAPBestEffort")],RelativeOrder:["RelativeOrder","<b>offset, pct_offset, limit_price, exchange</b>","Place an order that increases its odds of being executed in a timely manner. "+n("#api-relative-order")]},this.property_list=[],this.token_types=["quanto-toplevel"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.TimeRuleTooltipManager=t=function(t){function e(){var t,n;t=$("#time-rule-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={market_open:["market_open","hours=0, minutes=1","Schedule a function to run relative to the market open time. "+n("#ide-marketopen")],market_close:["market_close","hours=0, minutes=1","Schedule a function to run relative to the market close time. "+n("#ide-marketclose")]},this.property_list=[],this.token_types=["quanto-toplevel"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.TimeRulesTooltipManager=t=function(t){function e(){var t,n;t=$("#time-rules-tooltip"),e.__super__.constructor.call(this,t),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={market_open:["market_open","hours=0, minutes=1","Schedule a function to run relative to the market open time. "+n("#ide-marketopen")],market_close:["market_close","hours=0, minutes=1","Schedule a function to run relative to the market close time. "+n("#ide-marketclose")]},this.property_list=[],this.token_types=["quanto-toplevel"]}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.TopLevelTooltipManager=t=function(t){function e(){var t,n,i;t=$("#toplevel-tooltip"),n=function(t){return"<a class='underline' target='_blank' href='/help"+t+"'>Learn More</a>"},this.token_info={record:["void record",["series1_name=value1, series2_name=value2, ...","'series1_name', value1, 'series2_name', value_2, ..."],"Record some variables and their values. "+n("#ide-record")],order:["id order","sid, amount, style=OrderType","Place an order. "+n("#api-order")],order_percent:["order_percent","sid, percent, style","Place an order as a given percent of the current portfolio value. "+n("#api-order-percent")],order_target:["order_target","sid, target, style","Place an order to adjust a position to a target number of shares. "+n("#api-order-target")],order_target_value:["order_taget_value","sid, target, style","Place an order to adjust a position to a target value. "+n("#api-order-target-value")],order_target_percent:["order_target_percent","sid, target_percent, style","Place an order to adjust a position to a target percent of the current portfolio value. "+n("#api-order-target-percent")],order_value:["order_value","sid, value, last_price, style","Place an order by desired value rather than desired number of shares. "+n("#api-order-value")],get_open_orders:["get_open_orders","asset=None","Returns a dict of all open orders keyed by asset, or a list of orders if given an asset. "+n("#api-get-open-orders")],get_order:["get_order","order_id","Returns a copy of an order. "+n("#api-get-order")],cancel_order:["cancel_order","order or order_id","Attempts to asynchronously cancel the given order. "+n("#api-cancel-order")],get_datetime:["get_datetime","","Gets the current Python datetime that the algorithm is using. "+n("#api-get-datetime")],symbol:["string symbol","","The ticker symbol of this security."],symbols:["symbols","'symbol_1', 'symbol_2', ...","Look up a list of securities by ticker symbol. "+n("#api-symbols")],set_symbol_lookup_date:["set_symbol_lookup_date","'YYYY-MM-DD'","Specify the date when looking up symbols."],security_name:["string security_name","","The full name of this security."],security_start_date:["datetime security_start_date","","The date when this security first started trading."],security_end_date:["datetime security_end_date","","The date when this security stopped trading."],set_benchmark:["void set_benchmark","sid","Specify the security to use as the benchmark."],set_long_only:["set_long_only","","Do not allow this algorithm to hold short positions. "+n("#ide-trading-guards")],set_max_order_count:["set_max_order_count","max_orders","Set a limit on the number of order that can be placed by this algorithm in a single day. "+n("#ide-trading-guards")],set_max_order_size:["set_max_order_size","sid, max_shares, max_notional","At least max_shares or max_notional must be specified. "+n("#ide-trading-guards")],set_max_position_size:["set_max_position_size","sid, max_shares, max_notional","At least max_shares or max_notional must be specified. "+n("#ide-trading-guards")],set_do_not_order_list:["set_do_not_order_list","security_list","A list of securities that will not be ordered. "+n("#ide-trading-guards")],get_environment:["get_environment","field","Returns information about the environment in which the backtest or live algorithm is running."+n("#api-get-environment")],schedule_function:["schedule_function","func=myfunc, date_rule=date_rule, time_rule=time_rule, half_days=True","Automatically run a function according to the schedule you chose. "+n("#ide-schedulefunction")]},this.property_list=["symbol","security_name","security_start_date","security_end_date"],this.has_no_params=["set_long_only","get_datetime"],this.token_types=["quanto-recordvars","quanto-order","quanto-getdatetime","quanto-sidinfo","quanto-symbol","quanto-lookupdate","quanto-history","quanto-benchmark","quanto-tradingcontrols","quanto-environment","quanto-scheduler"],e.__super__.constructor.call(this,t),$(quanto.editor.getScrollerElement()).on("mouseover",function(t){return function(e){return t.handle_mouseover(e)}}(this)),i=["recordvars","order","history","benchmark","trading_controls","symbols","lookup_date","environment","scheduler"],$(document).bind("show_tooltip",function(t){return function(e,n,r){return-1!==i.indexOf(n)?t.force_show(r):void 0}}(this))}return n(e,t),e}(quanto.TooltipManagerBase)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};quanto.TopLevelTooltipWatcher=quanto.TopLevelTooltipWatcher=function(){function e(){this.try_show_object_method_tooltip=t(this.try_show_object_method_tooltip,this),this.show_tooltip=t(this.show_tooltip,this),this.hide_tooltips=t(this.hide_tooltips,this),this.handle_key_event=t(this.handle_key_event,this),this.showing_tooltip=!1,this.matching_classnames={"quanto-recordvars":!0,"quanto-fetchcsv":!0,"quanto-order":!0,"quanto-history":!0,"quanto-datetime":!0,"quanto-sidinfo":!0,"quanto-symbol":!0,"quanto-lookupdate":!0,"quanto-benchmark":!0,"quanto-tradingcontrols":!0,"quanto-environment":!0,"quanto-scheduler":!0,"quanto-data-method":!0}}return e.prototype.handle_key_event=function(t,e){var n,i,r,o;if("("===(null!=e?null!=(r=e.text)?r[0]:void 0:void 0)&&e.from.ch>0&&(i=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch-1}),null!=this.matching_classnames[i.type]))switch(n=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch}),i.type){case"quanto-recordvars":this.show_tooltip("recordvars",n);break;case"quanto-fetchcsv":this.show_tooltip("fetchcsv",n);break;case"quanto-order":this.show_tooltip("order",n);break;case"quanto-history":this.show_tooltip("history",n);break;case"quanto-benchmark":this.show_tooltip("benchmark",n);break;case"quanto-tradingcontrols":this.show_tooltip("trading_controls",n);break;case"quanto-symbol":this.show_tooltip("symbols",n);break;case"quanto-lookupdate":this.show_tooltip("lookup_date",n);break;case"quanto-environment":this.show_tooltip("environment",n);break;case"quanto-scheduler":this.show_tooltip("scheduler",n);break;case"quanto-data-method":this.try_show_object_method_tooltip(t,e,n,"data")}return")"===(null!=e?null!=(o=e.text)?o[0]:void 0:void 0)&&this.showing_tooltip?this.hide_tooltips():void 0},e.prototype.hide_tooltips=function(){return $(".quanto-tooltip").hide()},e.prototype.show_tooltip=function(t,e){return $(document).trigger("show_tooltip",[t,e])},e.prototype.try_show_object_method_tooltip=function(t,e,n,i){var r;return r=t.cm.getTokenAt({line:e.from.line,ch:e.from.ch-n.string.length-1}),i===r.string?this.show_tooltip(n.string,n):void 0},e}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.Disable2faManagerBase=t=function(){function t(){this.updated_event_name=e(this.updated_event_name,this),this.try_disconnect=e(this.try_disconnect,this),this.show_step_2=e(this.show_step_2,this),this.show_step_1=e(this.show_step_1,this),this.transition_to=e(this.transition_to,this),this.$next_button=this.$modal.find(".next-button"),this.$cancel_button=this.$modal.find(".cancel-button"),this.$token_box=this.$modal.find(".token-box"),this.$error_msg=this.$modal.find(".verification-failed-message"),this.user_id=$("#current_user_id").val(),this.$modal.on("show",function(t){return function(){return t.transition_to("step1"),t.$modal.find("input").val("")}}(this)),this.$next_button.on("click",function(t){return function(){switch(t.current_step){case"step1":return t.try_disconnect();case"step2":return t.$modal.modal("hide")}}}(this)),this.$token_box.on("keydown",function(t){return function(e){return"step1"===t.current_step&&13===e.keyCode?(t.$next_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0
}}(this)),$(document).on("keydown",function(t){return function(e){return 13===e.keyCode&&"step2"===t.current_step&&t.$modal.hasClass("in")?t.$next_button.trigger("click"):void 0}}(this))}return t.prototype.transition_to=function(t){switch(this.$modal.find(".step").addClass("hidden"),this.$next_button.html("Verify").removeClass("disabled"),this.$cancel_button.removeClass("hidden"),t){case"step1":return this.show_step_1();case"step2":return this.show_step_2(),$(document).trigger(this.updated_event_name())}},t.prototype.show_step_1=function(){return this.current_step="step1",this.$modal.find(".step1").removeClass("hidden"),setTimeout(function(t){return function(){return t.$token_box.focus()}}(this),20)},t.prototype.show_step_2=function(){return this.current_step="step2",this.$modal.find(".step2").removeClass("hidden"),this.$next_button.html("Close"),this.$cancel_button.addClass("hidden")},t.prototype.try_disconnect=function(){throw new Error("not implemented!")},t.prototype.updated_event_name=function(){throw new Error("not implemented!")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BackupLoginCodeModalManager=t=function(){function t(){this.populate_backup_code=e(this.populate_backup_code,this),this.show_backup_code=e(this.show_backup_code,this),this.transition_to=e(this.transition_to,this),this.app_enabled=e(this.app_enabled,this),this.sms_enabled=e(this.sms_enabled,this),this.$modal=$("#backup-code-modal"),this.$next_button=this.$modal.find(".next-button"),this.$cancel_button=this.$modal.find(".cancel-button"),this.$token_box=this.$modal.find(".token-box"),this.$error_msg=this.$modal.find(".verification-failed-message"),this.$sms_button_container=this.$modal.find("#sms-button-container"),this.$send_sms_button=this.$modal.find(".send-sms-button"),this.user_id=quanto.user_id,this.$modal.on("show",function(t){return function(){return t.transition_to("step1"),t.$modal.find("input").val("")}}(this)),this.$modal.on("hide",function(t){return function(){return t.$modal.find(".both-methods").addClass("hidden"),t.$modal.find(".app-only").addClass("hidden"),t.$modal.find(".phone-only").addClass("hidden"),t.$sms_button_container.addClass("hidden"),t.populate_backup_code("")}}(this)),this.$next_button.on("click",function(t){return function(){switch(t.current_step){case"step1":return t.show_backup_code();case"step2":return t.$modal.modal("hide")}}}(this)),$(document).on("click",".view-backup-login-code-button",function(t){return function(){return t.$modal.modal("show")}}(this)),this.$send_sms_button.on("click",function(t){return function(){return t.$send_sms_button.addClass("disabled").html("Sending token..."),$.post("/users/send_sms_token",{},function(e){var n;return t.$send_sms_button.removeClass("disabled").html("Send token via SMS"),n=new quanto.JsonResponse(e),n.ok()?void 0:alert("Something went wrong.")}).error(function(){return t.$send_sms_button.removeClass("disabled").html("Send token via SMS"),alert("Something weng wrong.")})}}(this)),this.$token_box.on("keydown",function(t){return function(e){return"step1"===t.current_step&&13===e.keyCode?(t.$next_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),$(document).on("keydown",function(t){return function(e){return 13===e.keyCode&&t.$modal.hasClass("in")&&"step2"===t.current_step?t.$next_button.trigger("click"):void 0}}(this))}return t.prototype.sms_enabled=function(){return $("#user-2fa-phone-enabled").length>0&&"true"===$("#user-2fa-phone-enabled").val()},t.prototype.app_enabled=function(){return $("#user-2fa-app-enabled").length>0&&"true"===$("#user-2fa-app-enabled").val()},t.prototype.transition_to=function(t){switch(this.$modal.find(".step").addClass("hidden"),this.$next_button.html("Verify").removeClass("disabled"),this.$cancel_button.removeClass("hidden"),this.$error_msg.addClass("hidden"),t){case"step1":if(this.current_step="step1",this.$modal.find(".step1").removeClass("hidden"),setTimeout(function(t){return function(){return t.$token_box.focus()}}(this),20),this.sms_enabled()&&this.app_enabled()?(this.$modal.find(".both-methods").removeClass("hidden"),this.$sms_button_container.removeClass("hidden")):this.sms_enabled()?this.$modal.find(".phone-only").removeClass("hidden"):this.$modal.find(".app-only").removeClass("hidden"),this.sms_enabled()&&!this.app_enabled())return $.post("/users/send_sms_token",{},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?void 0:alert("Something went wrong.")}}(this));break;case"step2":return this.current_step="step2",this.$modal.find(".step2").removeClass("hidden"),this.$next_button.html("Close"),this.$cancel_button.addClass("hidden"),$("document").trigger("backup-code-viewed")}},t.prototype.show_backup_code=function(){var t;return t=this.$token_box.val(),this.$next_button.html("Verifying...").addClass("disabled"),$.post("/users/get_backup_code",{token:t},function(t){return function(e){var n,i;return i=new quanto.JsonResponse(e),i.ok()?(n=i.data(),t.populate_backup_code(n),t.transition_to("step2")):(t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden"))}}(this)).error(function(t){return function(){return t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden")}}(this))},t.prototype.populate_backup_code=function(t){return $("#backup-code-container").html(t),$(document).trigger("backup-code-viewed")},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BackupCodeSucceededManager=t=function(){function t(){this.disable_2fa=e(this.disable_2fa,this),this.view_new_code=e(this.view_new_code,this),this.$disable_2fa_button=$("#disable-2fa-button"),this.$disable_2fa_button.on("click",function(t){return function(){return t.disable_2fa()}}(this)),this.$new_code_link=$("#view-new-backup-code"),this.$new_code_link.on("click",function(t){return function(){return t.view_new_code()}}(this)),this.digest=$("#digest-field").val()}return t.prototype.view_new_code=function(){return $("#backup-code-modal").modal("show"),$.post("/twofactor/backup_code_viewed")},t.prototype.disable_2fa=function(){var t;return this.$disable_2fa_button.addClass("disabled").html("Disabling..."),t=function(){return function(){return quanto.show_error_popup("Unexpected error","There was an unexpected error disabling two-factor authentication.  Try again or contact us.")}}(this),$.post("/twofactor/disable_2fa",{digest:this.digest},function(e){return function(n){var i;return e.$disable_2fa_button.removeClass("disabled").html("Disable two-factor authentication"),i=new quanto.JsonResponse(n),i.ok()?($(".disable-2fa-container").html("Two-factor authentication disabled.  To re-enable it, view your <a href='/account'>account page</a>."),$(".new-backup-code-paragraph").addClass("hidden")):t()}}(this)).error(function(){return function(){return t()}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.BackupLoginManager=t=function(){function t(){this.initialize_validation_rules=e(this.initialize_validation_rules,this),this.verify_backup_code=e(this.verify_backup_code,this),this.$form=$("#backup-login-form"),this.$verify_button=$("#verify-token-button"),this.$token_box=this.$form.find("#token-box"),this.initialize_validation_rules(),quanto.on_click(this.$verify_button,function(t){return function(){return t.verify_backup_code()}}(this)),this.$token_box.on("keydown",function(t){return function(e){return 13===e.keyCode?(t.$verify_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),setTimeout(function(t){return function(){return t.$token_box.focus()}}(this),20)}return t.prototype.verify_backup_code=function(){var t,e,n;return n=this.$form.validate(),this.$form.valid()?(t=$("#token-box").val(),this.$verify_button.addClass("disabled").html("Verifying..."),e={backup_code:t},$.post("/twofactor/verify_backup_login_code",e,function(t){return function(e){var i;return i=new quanto.JsonResponse(e),i.redirect()?void 0:(n.showErrors({backup_code:"Invalid backup login code"}),t.$verify_button.removeClass("disabled").html("Verify"))}}(this)).error(function(t){return function(){return n.showErrors({backup_code:"Invalid backup login code"}),t.$verify_button.removeClass("disabled").html("Verify")}}(this))):(n.showErrors(),!1)},t.prototype.initialize_validation_rules=function(){return this.validator=this.$form.validate({onkeyup:!1,onfocusout:!1,rules:{backup_code:{required:!0}},messages:{backup_code:{required:"Enter your backup code"}}})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ConfigureAuthAppManager=t=function(){function t(){this.verify_code=e(this.verify_code,this),this.transition_to=e(this.transition_to,this),this.$modal=$("#configure-google-authenticator-modal"),this.$next_button=this.$modal.find(".next-button"),this.$cancel_button=this.$modal.find(".cancel-button"),this.$verification_code_box=this.$modal.find(".google-auth-verification-code-box"),this.$error_msg=this.$modal.find(".verification-failed-message"),this.user_id=$("#current_user_id").val(),this.$modal.on("show",function(t){return function(){return t.transition_to("step1"),t.$modal.find("input").val("")}}(this)),this.$next_button.on("click",function(t){return function(){switch(t.current_step){case"step1":return t.verify_code();case"step2":return t.$modal.modal("hide")}}}(this)),$(document).on("click","#configure-app-2fa-button",function(t){return function(){return t.$modal.modal("show")}}(this)),this.$verification_code_box.on("keydown",function(t){return function(e){return"step1"===t.current_step&&13===e.keyCode?(t.$next_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),$(document).on("keydown",function(t){return function(e){return 13===e.keyCode&&t.$modal.hasClass("in")&&"step2"===t.current_step?t.$next_button.trigger("click"):void 0}}(this))}return t.prototype.transition_to=function(t){switch(this.$modal.find(".step").addClass("hidden"),this.$next_button.html("Verify").removeClass("disabled"),this.$cancel_button.removeClass("hidden"),this.$error_msg.addClass("hidden"),t){case"step1":return this.current_step="step1",this.$modal.find(".step1").removeClass("hidden"),setTimeout(function(t){return function(){return t.$verification_code_box.focus()}}(this),20);case"step2":return this.current_step="step2",this.$modal.find(".step2").removeClass("hidden"),this.$next_button.html("Close"),this.$cancel_button.addClass("hidden"),$(document).trigger("twofactor_app_updated")}},t.prototype.verify_code=function(){var t;return t=this.$verification_code_box.val(),this.$next_button.addClass("disabled").html("Verifying..."),this.$error_msg.addClass("hidden"),$.post("/users/add_auth_app",{token:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.transition_to("step2"):(t.$error_msg.removeClass("hidden"),t.$next_button.removeClass("disabled").html("Verify"))}}(this)).error(function(t){return function(){return t.$error_msg.removeClass("hidden"),t.$next_button.removeClass("disabled").html("Verify")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.DisconnectAuthAppManager=t=function(t){function n(){this.updated_event_name=e(this.updated_event_name,this),this.try_disconnect=e(this.try_disconnect,this),this.$modal=$("#disconnect-auth-app-modal"),$(document).on("click","#disconnect-auth-app-button",function(t){return function(){return t.$modal.modal("show")}}(this)),n.__super__.constructor.call(this)}return i(n,t),n.prototype.try_disconnect=function(){var t;return t=this.$token_box.val(),this.$next_button.html("Verifying...").addClass("disabled"),this.$error_msg.addClass("hidden"),$.post("/users/disconnect_auth_app",{token:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.transition_to("step2"):(t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden"))}}(this)).error(function(t){return function(){return t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden")}}(this))},n.prototype.updated_event_name=function(){return"twofactor_app_updated"},n}(quanto.Disable2faManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};quanto.DisconnectSMSManager=t=function(t){function n(){this.updated_event_name=e(this.updated_event_name,this),this.try_disconnect=e(this.try_disconnect,this),this.show_step_1=e(this.show_step_1,this),this.$modal=$("#remove-phone-number-modal"),$(document).on("click","#disconnect-sms-button",function(t){return function(){return t.$modal.modal("show")}}(this)),n.__super__.constructor.call(this,this.$modal)}return i(n,t),n.prototype.show_step_1=function(){return n.__super__.show_step_1.call(this),$.post("/users/send_sms_token",{},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?void 0:alert("Something went wrong.")}}(this))},n.prototype.try_disconnect=function(){var t;return t=this.$token_box.val(),this.$next_button.html("Verifying...").addClass("disabled"),$.post("/users/disconnect_phone_number",{token:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.transition_to("step2"):(t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden"))}}(this)).error(function(t){return function(){return t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden")}}(this))},n.prototype.updated_event_name=function(){return"twofactor_phone_updated"},n}(quanto.Disable2faManagerBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LoginManager=t=function(){function t(){this.initialize_validation_rules=e(this.initialize_validation_rules,this),this.$form=$("#new_user"),this.initialize_validation_rules()}return t.prototype.initialize_validation_rules=function(){return this.validator=this.$form.validate({onkeyup:!1,rules:{"user[email]":{required:!0,email:!0},"user[password]":{required:!0}},messages:{"user[email]":"Doesn't look like a valid email address."}})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.RegistrationFormManager=t=function(){function t(t){this.display_server_errors=e(this.display_server_errors,this),this.initialize_validation_rules=e(this.initialize_validation_rules,this),this.$form=t,this.initialize_validation_rules(),this.display_server_errors(),$("#sign-up-button").bind("click",function(){var e;return $(".eula").removeClass("shake"),$("#eula-checkbox").is(":checked")?($(".error-message").addClass("hidden"),$(".javascript-alert").addClass("hidden"),$(".quanto-checkbox").removeClass("error"),e={email:$("#user_email").val()},$("#user_invitation_token").length>0?(t.submit(),!1):t.valid()?($.post("/users/validate_registration",e,function(){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.submit():void 0}}(this)).error(function(){return function(t){var e,n;if(null!=t&&null!=t.responseText){try{n=JSON.parse(t.responseText)}catch(i){e=i}if(null==n)return alert(n.data),void 0;if("email in use"===n.data)return $(".error-message").find(".message").text("That email address is already in use."),$("#user_email").closest(".form-control").addClass("error"),$(".error-message").removeClass("hidden"),void 0}}}(this)),!1):!1):($(".eula").addClass("shake").delay(500).queue(function(){return $(this).removeClass("shake"),$(this).dequeue()}),$(".quanto-checkbox").addClass("error"),$(".eula").find("label").addClass("error"),!1)})}return t.prototype.initialize_validation_rules=function(){return this.validator=this.$form.validate({onkeyup:!1,rules:{"user[firstname]":{required:!0,minlength:2,maxlength:20},"user[lastname]":{required:!0},"user[password]":{minlength:8},"user[email]":{required:!0,email:!0},"user[checkbox]":{required:!0}},messages:{"user[firstname]":{required:"First name is required.",minlength:"First name must be at least 2 characters."},"user[lastname]":{required:"Last name is required."},"user[password]":"Minimum 8 characters.","user[email]":"Doesn't look like a valid email address.","user[checkbox]":"Please accept the End User License Agreement."}})},t.prototype.display_server_errors=function(){var t,e,n,i,r,o,a,s,l,u,c;for(u=$("input[type='hidden'].validation_error"),c=[],s=0,l=u.length;l>s;s++)n=u[s],t=$(n),r=t.data("field"),a=t.val(),e="user["+r+"]","can't be blank"===a&&"current_password"===r?a="Enter your password to save these changes.":(_.str.endsWith(a,".")||(a+="."),o=_.str.capitalize(r).replace(/_/g," "),a=""+_.str.capitalize(o)+" "+a),i={},i[e]=a,c.push(this.validator.showErrors(i));return c},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.TwoFactorAuthManager=t=function(){function t(){this.initialize_validation_rules=e(this.initialize_validation_rules,this),this.send_sms=e(this.send_sms,this),this.verify_token=e(this.verify_token,this),this.$form=$("#two-factor-form"),this.$verify_button=$("#verify-token-button"),this.$send_sms_button=$("#send-sms-button"),this.$token_box=this.$form.find("#token-box"),quanto.on_click(this.$verify_button,function(t){return function(){return t.verify_token()}}(this)),quanto.on_click(this.$send_sms_button,function(t){return function(){return t.send_sms()}}(this)),this.$token_box.on("keydown",function(t){return function(e){return 13===e.keyCode?(t.$verify_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),this.initialize_validation_rules(),setTimeout(function(t){return function(){return t.$token_box.focus()}}(this),20)}return t.prototype.verify_token=function(){var t,e,n;return n=this.$form.validate(),this.$form.valid()?(e=$("#token-box").val(),this.$verify_button.addClass("disabled").html("Verifying..."),t={token:e},$.post("/twofactor/verify_token",t,function(t){return function(e){var i;return i=new quanto.JsonResponse(e),i.redirect()?void 0:(n.showErrors({twofactor_token:"Invalid security token"}),t.$verify_button.removeClass("disabled").html("Verify"))}}(this)).error(function(t){return function(){return n.showErrors({twofactor_token:"Invalid security token"}),t.$verify_button.removeClass("disabled").html("Verify")}}(this))):(n.showErrors(),!1)},t.prototype.send_sms=function(){return this.$send_sms_button.addClass("disabled").html("Sending token..."),$.post("/twofactor/send_sms_token",{},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),t.$send_sms_button.removeClass("disabled").html("Sending token via SMS"),n.ok()?quanto.show_message_popup("Security token sent","We just sent you the security token via SMS."):quanto.show_error_popup("Error sending token","Sorry, something went wrong sending the security token. Try again or contact us at feedback@quantopian.com")}}(this)).error(function(t){return function(){return t.$send_sms_button.removeClass("disabled").html("Send token via SMS"),quanto.show_error_popup("Error sending token","Sorry, something went wrong sending the security token. Try again or contact us at feedback@quantopian.com")}}(this))},t.prototype.initialize_validation_rules=function(){return this.validator=this.$form.validate({onkeyup:!1,onfocusout:!1,rules:{twofactor_token:{required:!0}},messages:{twofactor_token:{required:"Enter your security token"}}})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.VerifyPhoneNumberManager=t=function(){function t(){this.verify_code=e(this.verify_code,this),this.send_sms=e(this.send_sms,this),this.set_focus=e(this.set_focus,this),this.transition_to=e(this.transition_to,this),this.$modal=$("#verify-phone-number-modal"),this.$next_button=this.$modal.find(".next-button"),this.$cancel_button=this.$modal.find(".cancel-button"),this.$phone_number_box=this.$modal.find(".phone-number-box"),this.$verification_box=this.$modal.find(".verification-code-box"),this.$error_msg=this.$modal.find(".verification-failed-message"),this.user_id=$("#current_user_id").val(),this.$modal.on("show",function(t){return function(){return t.transition_to("step1"),t.$modal.find("input").val("")}}(this)),this.$next_button.on("click",function(t){return function(){switch(t.current_step){case"step1":return t.send_sms();case"step2":return t.verify_code();case"step3":return $(document).trigger("twofactor_phone_updated"),t.$modal.modal("hide")}}}(this)),$(document).on("click","#configure-sms-2fa-button",function(t){return function(){return t.$modal.modal("show")}}(this)),this.$phone_number_box.on("keydown",function(t){return function(e){return"step1"===t.current_step&&13===e.keyCode?(t.$next_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),this.$verification_box.on("keydown",function(t){return function(e){return"step2"===t.current_step&&13===e.keyCode?(t.$next_button.trigger("click"),e.preventDefault(),e.stopPropagation(),!1):void 0}}(this)),$(document).on("keydown",function(t){return function(e){return 13===e.keyCode&&t.$modal.hasClass("in")&&"step3"===t.current_step?t.$next_button.trigger("click"):void 0}}(this))}return t.prototype.transition_to=function(t){switch(this.$modal.find(".step").addClass("hidden"),this.$next_button.html("Next").removeClass("disabled"),this.$cancel_button.removeClass("hidden"),this.$error_msg.addClass("hidden"),t){case"step1":return this.current_step="step1",this.$modal.find(".step1").removeClass("hidden"),this.set_focus($(".step1 input"));case"step2":return this.current_step="step2",this.$modal.find(".step2").removeClass("hidden"),this.set_focus($(".step2 input")),this.$next_button.html("Verify");case"step3":return this.current_step="step3",this.$modal.find(".step3").removeClass("hidden"),this.$next_button.html("Close"),this.$cancel_button.addClass("hidden")}},t.prototype.set_focus=function(t){return setTimeout(function(){return function(){return $(t).focus()}}(this),10)},t.prototype.send_sms=function(){var t;return t=this.$modal.find(".phone-number-box").val(),this.$next_button.addClass("disabled").html("Verifying"),$.post("/users/add_phone_number",{phone_number:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.transition_to("step2"):(t.$next_button.removeClass("disabled").html("Next"),alert("Invalid phone number, or other error."))}}(this)).error(function(t){return function(e){var n;return t.$next_button.removeClass("disabled").html("Next"),n=new quanto.JsonResponse(e),"invalid"===n.data()?quanto.show_error_popup("Invalid phone number","That looks like an invalid phone number.  Only US-based phone numbers can be used for now."):quanto.show_error_popup("Unexpected error","Sorry, we were not able to send you an SMS message.  Try again or contact us.")}}(this))},t.prototype.verify_code=function(){var t;return t=this.$modal.find(".verification-code-box").val(),this.$next_button.html("Verifying...").addClass("disabled"),this.$error_msg.addClass("hidden"),$.post("/users/verify_token_for_sms_setup",{token:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.transition_to("step3"):(t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden"))}}(this)).error(function(t){return function(){return t.$next_button.html("Verify").removeClass("disabled"),t.$error_msg.removeClass("hidden")}}(this))},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.AboutManager=t=function(){function t(){this.handle_subscribe=e(this.handle_subscribe,this),quanto.on_click("#subscribe-button",function(t){return function(e){return t.handle_subscribe(e)}}(this)),$("body").scrollspy({target:"#about-toolbar",offset:100}),$("#about-toolbar a").click(function(){var t;return t="#jobs"===$(this).attr("href")?40:120,$("html, body").animate({scrollTop:$($(this).attr("href")).offset().top-t},200),!1}),$("#subscribe-form").validate({onsubmit:!1,showErrors:function(){return function(){}}(this),rules:{email:{required:!0,email:!0}}}),quanto.on_click("a.toggle",function(){return function(t){var e,n;return e=$(quanto.get_src_element(t)),n=$(e.data("toggle-target")),n.hasClass("hidden")?(n.removeClass("hidden"),e.html("Hide Details")):(n.addClass("hidden"),e.html("Read More"))}}(this))}return t.prototype.handle_subscribe=function(t){var e;return t.preventDefault(),$("#subscribe-form").valid()?($("#email-error-message").addClass("hidden"),e={email:$("#email-box").val()},$.post("/about/subscribe",e,function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?($("#email-success-message").show(),$("#subscribe-form").hide(),$(".instructions").hide()):void 0}}(this)).error(function(){return function(){return $("#email-error-message").removeClass("hidden").html("Sorry, something went wrong.")}}(this))):$("#email-error-message").removeClass("hidden").html("Valid email required.")},t}()}.call(this),function(){var t,e,n=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,r=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};quanto.AccountPageManager=t=function(){function t(){this.check_account_table_row_count=n(this.check_account_table_row_count,this),this.initialize_trading_tab=n(this.initialize_trading_tab,this),this.initialize_validation_rules=n(this.initialize_validation_rules,this),this.initialize_account_form=n(this.initialize_account_form,this),this.initialize_preferences=n(this.initialize_preferences,this),this.load_twofactor_overview=n(this.load_twofactor_overview,this),this.check_tooltip=n(this.check_tooltip,this);var t;this.user_id=$("#current_user_id").val(),this.initialize_account_form(),this.initialize_trading_tab(),this.initialize_preferences(),this.billing_tab_mgr=new e,"#trading"===window.location.hash?$("#trading-account-link").trigger("click"):"#account"===window.location.hash?$("#main-account-link").trigger("click"):"#twofactor"===window.location.hash?$("#twofactorauth-link").trigger("click"):"#billing"===window.location.hash&&$("#billing-link").trigger("click"),quanto.on_click("#go-to-account-link",function(){return function(){return $("#main-account-link").trigger("click")}}(this)),t=quanto.get_query_variable("page")||"","trading"===t?($("#trading-account-link").trigger("click"),window.history.pushState({},"","/account#trading")):"preferences"===t?($("#preferences-link").trigger("click"),window.history.pushState({},"","/account#preferences")):"twofactor"===t?($("#twofactorauth-link").trigger("click"),window.history.pushState({},"","/account#twofactor")):"billing"===t&&($("#billing-link").trigger("click"),window.history.pushState({},"","/account#billing")),$(document).bind("twofactor_phone_updated",function(t){return function(){return $.get("/users/twofactor_phone_html",{},function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?$(".phone-2fa-container").html(e.html()):void 0}),t.load_twofactor_overview()}}(this)),$(document).bind("twofactor_app_updated",function(t){return function(){return $.get("/users/twofactor_app_html",{},function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?$(".app-2fa-container").html(e.html()):void 0}),t.load_twofactor_overview()}}(this)),$(document).bind("backup-code-viewed",function(){return function(){return $(".view-backupcode-message").remove(),$(".view-backup-login-code-button").tooltip("hide")}}(this)),this.check_tooltip()}return t.prototype.check_tooltip=function(){var t,e;return t=$(".view-backup-login-code-button.with-tooltip"),t.length>0?(e=t.data("tooltiptext"),t.tooltip({placement:"right",title:e,trigger:"manual"}).tooltip("show")):void 0},t.prototype.load_twofactor_overview=function(){return $.get("/users/twofactor_overview_html",{},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?($(".twofactor-overview-container").html(n.html()),t.check_tooltip()):void 0}}(this)),$.get("/users/twofactor_qr_code_url",{},function(){return function(t){var e,n;return e=new quanto.JsonResponse(t),e.ok()&&null!=e.data()?(n=e.data().url,$("#configure-google-authenticator-modal .barcode-container img").attr("src",n)):void 0}}(this))},t.prototype.initialize_preferences=function(){var t,e,n,i,r,o;for(r=$(".preferences-container").find("input"),o=[],n=0,i=r.length;i>n;n++)e=r[n],t=$(e),o.push(t.change(function(){return function(t){var e,n,i,r;return e=$(quanto.get_src_element(t)),e.attr("disabled","disabled"),r=e.is(":checked"),i=e.data("field"),n={prefs:{}},n.prefs[i]=r,$.post("/users/update_preferences",n,function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.attr("disabled",!1):void 0})}}(this)));return o},t.prototype.initialize_account_form=function(){return this.$account_form=$("#edit_user"),this.$submit_button=$("#update-account-button"),this.$account_alert=$("#account_alert_success"),this.$email_change_alert=$("#email-change-alert"),this.$unconfirmed_user_header=$(".unconfirmed-user-header"),this.initialize_validation_rules(),this.$account_form.on("submit",function(t){return function(){return t.$account_alert.removeClass("in"),t.$account_form.valid()?t.$submit_button.html("Updating...").addClass("disabled"):void 0}}(this)),this.$account_form.on("ajax:success",function(t){return function(e,n){var i,r;return t.$submit_button.html("Update").removeClass("disabled"),null!=(null!=(i=n.data)?i.flashMessage:void 0)&&(t.$email_change_alert.find("p.alert-content").html(n.data.flashMessage),t.$email_change_alert.removeClass("hidden"),t.$email_change_alert.find("a.close").click(function(){return t.$email_change_alert.addClass("hidden"),!1})),null!=(null!=(r=n.data)?r.unconfirmed_email:void 0)&&(t.$unconfirmed_user_header.find(".confirm-email-address").html(n.data.unconfirmed_email),t.$unconfirmed_user_header.removeClass("hidden")),t.$account_alert.find(".alert-payload").html("Successfully updated account."),t.$account_alert.addClass("in")}}(this)),this.$account_form.on("ajax:error",function(t){return function(e,n){var i,r;return r=new quanto.JsonResponse(n),i=r.data(),null!=i?null!=i.email&&"is already taken"===i.email[0]?t.validator.showErrors({"user[email]":"Email is already taken."}):i.current_password&&"is invalid"===i.current_password[0]?t.validator.showErrors({"user[current_password]":"Current password is invalid."}):quanto.show_error_popup():quanto.show_error_popup(),t.$submit_button.html("Update").removeClass("disabled")}}(this))},t.prototype.initialize_validation_rules=function(){return this.validator=this.$account_form.validate({rules:{"user[firstname]":{required:!0,minlength:2,maxlength:40},"user[email]":{required:!0,email:!0},"user[password]":{minlength:8},"user[password_confirmation]":{equalTo:"#user_password"},"user[current_password]":{required:!0}},messages:{"user[password_confirmation]":"Passwords don't match.","user[firstname]":{required:"First name is required.",minlength:"First name must be at least 2 characters."},"user[password]":"Minimum 8 characters.","user[email]":"Doesn't look like a valid email address.","user[current_password]":"Enter current password."}})},t.prototype.initialize_trading_tab=function(){return this.add_account_manager=new quanto.AddTradingAccountManager,this.$accounts_table=$("#all-trading-accounts-table"),this.row_template=Handlebars.compile("<tr class='account-row' data-account-id='{{_id}}' data-broker-name='{{broker_name}}'> <td class='account-broker'>{{display_broker_name}}</td> <td class='account-name'>{{name}}</td> <td class='account-username'>{{username}}</td> <td class='account-number monospace'>{{account_id}}</td> <td class='account-controls'><a class='delete-trading-account'>Delete</a></td> </tr>"),$(document).bind("new_trading_account_created",function(t){return function(e,n){var i;return i=t.row_template(n),t.$accounts_table.find("tbody").append(i),t.check_account_table_row_count()}}(this)),$(".existing-accounts").on("click",".delete-trading-account",function(t){return function(e){var n,i,r,o,a;return n=$(quanto.get_src_element(e)),i=$(quanto.get_src_element(e)).closest("tr"),r=i.data("broker-name"),"IB"===r?a=i.data("account-id"):"ROBINHOOD"===r&&(a=i.data("account-id")),o={trading_account_broker_name:r,data_to_delete:a},n.addClass("disabled").html("Deleting..."),$.post("/users/delete_trading_account",o,function(e){var r;
return r=new quanto.JsonResponse(e),r.ok()?null!=r.data()&&null!=r.data().failed_delete?(alert("This trading account is in use and cannot be deleted."),n.removeClass("disabled").html("Delete")):i.remove():(quanto.show_error_popup(),n.removeClass("disabled").html("Delete")),t.check_account_table_row_count()}).error(function(){return quanto.show_error_popup(),n.removeClass("disabled").html("Delete")})}}(this))},t.prototype.check_account_table_row_count=function(){return 0===this.$accounts_table.find("tr.account-row").length?this.$accounts_table.find("tbody").append("<tr class='accounts-placeholder'><td colspan=4>No trading accounts.</td></tr>"):this.$accounts_table.find("tr.accounts-placeholder").remove()},t}(),e=function(t){function e(){this.handle_delete_card=n(this.handle_delete_card,this),this.handle_add_card=n(this.handle_add_card,this),this.populate_no_saved_card=n(this.populate_no_saved_card,this),this.populate_saved_card=n(this.populate_saved_card,this),this.fetch_billing_info=n(this.fetch_billing_info,this),this.handle_renew_button_toggled=n(this.handle_renew_button_toggled,this),this.initialize_auto_renew_buttons=n(this.initialize_auto_renew_buttons,this),this.$billing_tab=$("#billing"),this.$loading_ui=this.$billing_tab.find(".loading"),this.$saved_card_ui=this.$billing_tab.find(".saved-card"),this.$add_card_ui=this.$billing_tab.find(".add-card"),$("#billing-link").on("shown",function(t){return function(){return t.initialize_auto_renew_buttons(),t.fetch_billing_info()}}(this)),this.card_template=Handlebars.compile("<div class='card-image unknown'></div> <span class='card-data'> <strong>{{capitalize type}}</strong> ending in <strong>{{last4}}</strong>, expires <strong>{{exp_month}}/{{exp_year}}</strong> <strong>({{address_state}})</strong> </span> <div class='btn delete-card'>Delete Card</div>"),this.$cardnumber_box=this.$billing_tab.find("input.card-number"),this.$carddate_box=this.$billing_tab.find("input.card-date"),this.$cardcvc_box=this.$billing_tab.find("input.card-cvc"),this.$region_box=this.$billing_tab.find("select.form-control.region"),this.$cardnumber_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$cardnumber_box)}}(this)),this.$carddate_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$carddate_box)}}(this)),this.$cardcvc_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$cardcvc_box)}}(this)),this.$region_box.on("focusout",function(t){return function(){return t.validate_card_field(t.$region_box)}}(this)),this.$cardnumber_box.payment("formatCardNumber"),this.$cardnumber_box.bind("payment.cardType",function(t){return function(e,n){return t.$billing_tab.find(".card-image").removeClass().addClass("card-image").addClass(n)}}(this)),this.$carddate_box.payment("formatCardExpiry"),this.$cardcvc_box.payment("formatCardCVC"),this.$add_card_button=this.$add_card_ui.find(".save-card-button"),this.$add_card_button.on("click",function(t){return function(){return t.handle_add_card()}}(this)),$(document).on("click",".delete-card",function(t){return function(){return t.handle_delete_card()}}(this))}return r(e,t),e.prototype.initialize_auto_renew_buttons=function(){return quanto.on_click(".toggle-autorenew-button",function(t){return function(e){var n,i,r,o,a,s,l;return i=$(quanto.get_src_element(e)),i.addClass("disabled"),n=i.closest("tr"),o=n.data("purchased-feature-name"),s=n.data("purchased-feature-vendor"),a="data."+s+"."+o,r={feature_name:a,feature_disp:o},l="Restart"===i.html(),l?$.post("/users/add_paid_feature",r,function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.handle_renew_button_toggled(r):(t.handle_renew_button_toggled(r,!0),quanto.show_error_popup())}).error(function(){return t.handle_renew_button_toggled(r,!0),quanto.show_error_popup()}):$.post("/users/remove_paid_feature",r,function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.handle_renew_button_toggled(r):(t.handle_renew_button_toggled(r,!0),quanto.show_error_popup())}).error(function(){return t.handle_renew_button_toggled(r,!0),quanto.show_error_popup()})}}(this))},e.prototype.handle_renew_button_toggled=function(t,e){var n,i,r,o,a,s,l;return null==e&&(e=!1),s=t.feature_name,o=this.$billing_tab.find(".paid-features-table tbody"),a="[data-purchased-feature-name="+t.feature_disp+"]",r=o.find(a),n=r.find(".toggle-autorenew-button"),n.removeClass("disabled"),e!==!0?("Cancel"===n.text()?(n.text("Restart"),n.addClass("btn-primary")):"Restart"===n.text()&&(n.text("Cancel"),n.removeClass("btn-primary")),i=r.find(".renewal_date"),"Expiring"===i.text()?(l=i.data("feature-period-end"),i.text(l)):i.text("Expiring")):void 0},e.prototype.fetch_billing_info=function(){return this.$saved_card_ui.addClass("hidden"),this.$add_card_ui.addClass("hidden"),this.$loading_ui.removeClass("hidden"),$.get("/users/saved_card",{},function(t){return function(e){var n,i;return n=new quanto.JsonResponse(e),n.ok()?(i=n.data(),null!=i?t.populate_saved_card(i):t.populate_no_saved_card()):void 0}}(this)).error(function(){return function(){return quanto.show_error_popup()}}(this))},e.prototype.populate_saved_card=function(t){var e,n,i;return this.$loading_ui.addClass("hidden"),this.$saved_card_ui.removeClass("hidden"),this.$add_card_ui.addClass("hidden"),t.exp_month<10&&(t.exp_month="0"+t.exp_month),e=this.card_template(t),this.$saved_card_ui.html(e),i={Visa:"visa","American Express":"amex",MasterCard:"mastercard",Discover:"discover",JCB:"jcb","Diners Club":"diners",Unknown:"unknown"},n=i[t.type]||"unknown",this.$saved_card_ui.find(".card-image").removeClass().addClass("card-image").addClass(n)},e.prototype.populate_no_saved_card=function(){return this.$loading_ui.addClass("hidden"),this.$saved_card_ui.addClass("hidden"),this.$add_card_ui.removeClass("hidden"),this.$cardnumber_box.val(""),this.$cardcvc_box.val(""),this.$carddate_box.val(""),setTimeout(function(t){return function(){return t.$cardnumber_box.focus()}}(this),10)},e.prototype.handle_add_card=function(){var t,e,n;return n=function(t){return function(){return t.$add_card_button.removeClass("disabled").html("Save Card"),t.fetch_billing_info()}}(this),t=function(t){return function(){return t.$add_card_button.removeClass("disabled").html("Save Card")}}(this),e=function(t){return function(){return t.$add_card_button.removeClass("disabled").html("Save Card"),quanto.show_error_popup()}}(this),this.$add_card_button.addClass("disabled").html("Saving..."),this.handle_add_card_clicked(n,t,e)},e.prototype.handle_delete_card=function(){var t;return t=function(){return function(){return quanto.show_error_popup()}}(this),$.post("/users/delete_billing_info",{},function(e){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()?e.fetch_billing_info():t()}}(this)).error(function(){return function(){return t()}}(this))},e}(quanto.BillingUIBase)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.AddTradingAccountManager=t=function(){function t(){this.show_modal=e(this.show_modal,this),this.add_oauth_account=e(this.add_oauth_account,this),this.add_ib_account=e(this.add_ib_account,this),this.initialize_events=e(this.initialize_events,this),this.user_id=$("#current_user_id").val(),this.$trigger_button=$("#add-generic-trading-account"),this.$popup=$("#add-trading-account-modal"),this.$broker_select=this.$popup.find(".selectpicker"),this.$add_account_button=$("#add-trading-account-button"),this.$cancel_button=$("#cancel-button"),this.$cancel_button.on("click",function(t){return function(){return t.$popup.find("input").val("")}}(this)),this.initialize_events(),this.$popup.on("show show.bs.modal",function(t){return function(){return t.$popup.find("input").val(""),$(".step1").addClass("hidden"),$("#brokerage-names-dropdown").val("(Select a Brokerage)").selectpicker("refresh")}}(this))}return t.prototype.initialize_events=function(){return this.$trigger_button.on("click",function(t){return function(){return t.show_modal()}}(this)),this.$broker_select.change(function(t){return function(){var e;return e=$(".selectpicker option:selected").data("type"),t.$popup.find(".step1").addClass("hidden"),"oauth"===e?($(".add-oauth-account").removeClass("hidden"),t.$add_account_button.removeClass("hidden")):"ib"===e?($(".add-ib-account").removeClass("hidden"),$(".add-ib-account-agreement").removeClass("hidden"),t.$add_account_button.removeClass("hidden"),$(".ib-account-id-error-label").addClass("hidden"),$(".ib-username-error-label").addClass("hidden"),setTimeout(function(){return $("#new-account-name-box").focus()},10)):void 0}}(this)),this.$add_account_button.on("click",function(t){return function(){return $(".add-ib-account").is(":visible")?t.add_ib_account():$(".add-oauth-account").is(":visible")?t.add_oauth_account():void 0}}(this))},t.prototype.add_ib_account=function(){var t,e,n,i,r;return n=$.trim($("#new-account-name-box").val()),i=$.trim($("#new-account-username-box").val()),t=$.trim($("#new-account-number-box").val()),0===n.length||0===i.length||0===t.length?(quanto.show_error_popup("Missing Fields","Enter valid information for account nickname, broker username, and account ID."),void 0):(r=quanto.validate_ib_account(t.escapeHTML(),!1),r.is_valid?(e={trading_account_name:n,trading_account_id:t,trading_account_username:i,trading_account_broker_name:"IB"},$.post("/users/add_trading_account",e,function(t){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()?(e._id=i.data().new_id,e.name=e.trading_account_name,e.broker_name=e.trading_account_broker_name,e.account_id=e.trading_account_id,e.username=e.trading_account_username,e.display_broker_name=e.broker_name,$(document).trigger("new_trading_account_created",e),t.$popup.modal("hide")):void 0}}(this)).error(function(){return function(t){var e;return e=new quanto.JsonResponse(t),"not_unique_account_id"===e.data()?$(".ib-account-id-error-label").removeClass("hidden"):"not_unique_username"===e.data()?$(".ib-username-error-label").removeClass("hidden"):void 0}}(this))):(quanto.show_error_popup("Account problem",r.msg),void 0))},t.prototype.add_oauth_account=function(){var t,e,n;return n=$.trim($("#new-oauth-account-name-box").val()),t=$.trim($("#new-oauth-account-username-box").val()),0===n.length||0===t.length?(quanto.show_error_popup("Missing Fields","Enter valid information for account nickname, broker username."),void 0):(e={trading_account_name:n,trading_account_username:t,trading_account_broker_name:"oauth"},$.post("/users/add_trading_account",e,function(t){return function(n){var i;return i=new quanto.JsonResponse(n),i.ok()?(e._id=i.data().new_id,e.name=e.trading_account_name,e.broker_name=i.data().broker_name,e.username=e.trading_account_username,e.display_broker_name=i.data().display_broker_name,$(document).trigger("new_trading_account_created",e),t.$popup.modal("hide")):void 0}}(this)).error(function(){return function(t){var e;return e=new quanto.JsonResponse(t),"not_unique_oauth_username"===e.data()?$(".oauth-username-error-label").removeClass("hidden"):void 0}}(this)))},t.prototype.show_modal=function(){return this.$popup.find(".step1").addClass("hidden"),this.$popup.modal({backdrop:"static"}),this.$broker_select.selectpicker()},t}()}.call(this),function(){var t;quanto.DashboardManager=t=function(){function t(){$(".server-container").each(function(){return function(t,e){var n,i;return n=$(e),i=n.data("serverip"),$.get("/internal/load_server",{server_ip:i},function(t){var e,i,r,o,a,s,l,u,c,d,h,p,_;if(u=new quanto.JsonResponse(t),u.ok()){for(d=u.data(),a=d.git,h=d.ping,r=a.split("\n"),r.shift(),i="",p=0,_=r.length;_>p;p++)o=r[p],s=o.split(","),l=s[0],e=s[1],c=s[2],null!=l&&l.length>0&&(i+="<span class='module-info'>"+l+" ("+e+"):</span><span class='git-rev'>"+c+"</span><br/>");return n.find(".git-info").html(i),n.find(".state").html(h)}}).error(function(){return n.find(".state").html("Error"),n.find(".git-info").html("Error")})}}(this))}return t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ErrorRenderer=t=function(){function t(t,n,i,r,o){var a,s,l,u,c;if(null==i&&(i=!0),this.handle_trade_data_problem=e(this.handle_trade_data_problem,this),this.handle_user_algo_error=e(this.handle_user_algo_error,this),this.handle_system_error=e(this.handle_system_error,this),this.extract_user_algo_line=e(this.extract_user_algo_line,this),this.$errorcontainer=t,this.$errordetails=this.$errorcontainer.find(".error-details"),this.$errordetails.empty(),this.error_template=Handlebars.compile("<div class='stackframe'><div class='line1'>File {{filename}}:{{lineno}}, in {{method}}</div><div class='line2'><span>{{line}}</span></div></div>"),c=i?Handlebars.compile("<div class='stackframe user-algo'><div class='line1'><span class='label large'>USER ALGORITHM</span><span>:{{lineno}}, in {{method}}</span><span><a id='code-link'>Go to IDE</a></span></div><div class='line2'><code>{{line}}</code></div></div>"):Handlebars.compile("<div class='stackframe user-algo'><div class='line1'><span class='label large'>USER ALGORITHM</span><span>:{{lineno}}, in {{method}}</span></div><div class='line2'><code>{{line}}</code></div></div>"),n.stack||(n.stack=[]),l=n.name,_.str.startsWith(l,"AccountControlViolation"));else if(0===n.stack.length)return this.handle_system_error(n,o),void 0;this.code_snapshot=null==r?_.str.trim($("#code-snapshot-textbox").val()):_.str.trim(r),a=!0,_.str.startsWith(l,"NoTradeDataAvailable")?(this.handle_trade_data_problem(n),a=!1):_.str.startsWith(l,"RestrictedRecordedVariableName")?n.message="Cannot use 'returns' or 'benchmark' when recording variables.":_.str.startsWith(l,"AccountControlViolation")||("<algorithm>"===_.last(n.stack).filename&&"MemoryError"!==l?this.handle_user_algo_error(n,c):this.handle_system_error(n,o)),null!=n.message&&(l+=": "+_.escape(n.message)),0===n.message.indexOf("Insecure attribute access")?(u=n.message.match(/"(.*?)"/),l="The module/attribute '"+u[1]+"' is not available."):_.str.startsWith(l,"TradingControlViolation")?(l=n.name,s=n.message.replace("{","").replace("}","").replace("RestrictedListOrder()","set_do_not_order_list"),this.$errordetails.append("<br>"+s+"<a class='padding_5l underline' target='_blank' href='/help#ide-trading-guards'>Learn More</a>")):_.str.startsWith(n.message,"Cannot call set_universe with a DollarVolumeUniverse for algorithms starting before 2002-04-01")?(l="Cannot call set_universe for a backtest starting before 2002-04-01",this.$errordetails.append("<a class='padding_5l underline' target='_blank' href='/help#ide-universe'>Learn More</a>")):_.str.include(n.message,"'fetch_eventvestor' is not defined")?l=""+n.message+". Please use the <a target='_blank' href='https://www.quantopian.com/data/eventvestor'> EventVestor data sets</a> instead.":_.str.include(n.message,"'fetch_estimize' is not defined")?l=""+n.message+". Please use the <a target='_blank' href='https://www.quantopian.com/data/estimize'> Estimize data sets</a> instead.":_.str.include(n.message,"'fetch_wikipedia' is not defined")?l=""+n.message+". fetch_wikipedia is no longer supported.":_.str.include(n.message,"'batch_transform' is not defined")?l=""+n.message+". batch_transform is no longer supported. Please use <a target='_blank' href='/help#api-data-history'>data.history</a> instead.":_.str.include(n.name,"CannotOrderDelistedAsset")&&(l=""+n.message+" Try using <a target='_blank' href='/help#api-data-can_trade'>data.can_trade</a> to check whether an asset is delisted."),a&&this.$errorcontainer.find(".error-message").html(l)}return t.prototype.extract_user_algo_line=function(t){return this.code_snapshot.split("\n")[t]},t.prototype.handle_system_error=function(t,e){var n,i,r,o,a,s;for(s=t.stack||[],o=0,a=s.length;a>o;o++)i=s[o],"<algorithm>"===i.filename&&-1===this.$errordetails.text().indexOf("There was a runtime error on line")&&(r="There was a runtime error on line "+i.lineno+". ",this.$errordetails.append(r));return"TradingControlViolation"!==t.name&&"BadOrderParameters"!==t.name?"MemoryError"===t.name?(this.$errorcontainer.find(".error-message").html(t.name),this.$errordetails.append("Algorithm used too much memory. Need to optimize your code for better performance. <a class='padding_5l underline' target='_blank' href='/help#api-common-errors'>Learn More</a>"),void 0):(this.$errorcontainer.find(".error-title .yourfault").hide(),this.$errorcontainer.find(".error-title .ourfault").show(),n=$("#algo-id").val(),mixpanel.track("Run time error: our fault",{algorithm_id:n,backtest_id:e})):void 0},t.prototype.handle_user_algo_error=function(t,e){var n,i,r,o,a,s,l,u;for(this.$errordetails.append("<div class='toggle_error'><span>...</span></div>"),n=$("<div class='toggle_payload' style='display:none'></div>"),o=t.stack.pop(),null!=o.lineno&&(a=parseInt(o.lineno),i=this.extract_user_algo_line(a-1),null!=i&&i.length>0&&(o.line=i)),u=t.stack,s=0,l=u.length;l>s;s++)r=u[s],n.append(this.error_template(r));return this.$errordetails.append(n),this.$errordetails.append(e(o))},t.prototype.handle_trade_data_problem=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b,y;for(n=this.$errorcontainer.find(".yourfault"),this.$errordetails.html("<div class='toggle_error'><span>...</span></div>"),e=$("<div class='toggle_payload' style='display:none'></div>"),m=t.name+(": "+t.message),e.append(m),y=t.stack,v=0,b=y.length;b>v;v++)a=y[v],e.append(this.error_template(a));return this.$errordetails.append(e),d=JSON.parse(t.message),f=d.sid,h=d.property,null!=d.first_traded?(p=d.symbol,u=d.first_traded,l=quanto.date.format_date("%b %d, %Y",new Date(u)),i=d.algo_time,i>u?(r=quanto.date.format_date("%b %d, %Y",quanto.date.adjust_date_for_UTC(new Date(i))),n.html("<div class='extra'>At "+r+", your algorithm referenced <code>"+h+"</code> for "+f+" ("+p+").  There was no trade information for this security in this bar.</span>"),n.append("<div class='extra'>To avoid this exception, use <code>if data.can_trade(sid("+f+"))</code> (see more <a href='/help#overview-checkingdata' target='_blank'>here</a>).</div>")):(n.html("<div class='extra'>Your algorithm referenced <code>"+h+"</code> for "+f+" ("+p+") before its first trade, which was "+l+".</span>"),n.append("<div class='extra'>To avoid this exception, use <code>if data.can_trade(sid("+f+"))</code>, or change your backtest dates.</div>"))):n.html("<span class='extra'>You referenced <code>"+h+"</code> on "+f+", which is not a valid security id.</span>"),s=_.filter(t.stack,function(){return function(t){return 0===t.filename.indexOf("<algorithm>")}}(this)),s.length>0&&(g=s[0],c=g.lineno,null!=c)?(o=this.extract_user_algo_line(c-1),n.append("<br/><div>The problematic line:</div>"),n.append("<pre class='prettyprint linenums'>"+o+"</pre>"),window.prettyPrint(),n.find("ol").attr("start",c)):void 0},t}()}.call(this),function(){var t;quanto.FeatureGateManager=t=function(){function t(){this.feature_gate_template=Handlebars.compile("<tr><td class='monospace id'>{{user_id}}</td><td class='name'>{{name}}</td><td class='email'>{{email}}</td><td class='feature-name'>{{feature_name}}</td><td class='feature-amount'>{{feature_amount}}</td><td class='remove-access'><a class='remove-access-link' data-feature-gate-id='{{feature_gate_id}}'>Remove</a></td></tr>"),quanto.on_click("#add-feature-gate-button",function(t){return function(){var e;return e={user_info:$.trim($("#add-feature-user-info").val()),feature_name:$.trim($("#add-feature-name").val()),feature_amount:$.trim($("#add-feature-amount").val())},null==e.user_info||null==e.feature_name?(alert("Invalid input"),void 0):$.post("/internal/add_feature_gate",e,function(n){var i,r,o,a,s;if(o=new quanto.JsonResponse(n),o.ok()){for(i=o.data(),r="",a=0,s=i.length;s>a;a++)e=i[a],null!=e.feature_amount&&(e.feature_amount=new Number(e.feature_amount).toMoney()),r+=t.feature_gate_template(e);return $("#feature-access-table").find("tbody").append(r)}}).error(function(){return alert("Could not add.")})}}(this)),quanto.on_click(".remove-access-link",function(){return function(t){var e,n;return e=$(quanto.get_src_element(t)),n=e.data("feature-gate-id"),null!=n?$.post("/internal/remove_feature_gate",{feature_gate_id:n},function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):void 0}).error(function(){return alert("Error removing feature access.")}):void 0}}(this)),$("#feature-access-table").DataTable()}return t}()}.call(this),function(){var t;quanto.FlaggedAlgoViewer=t=function(){function t(){var t,e;t=$("#code-snapshot-textbox"),t.length>0&&!t.hasClass("codemirror-done")&&(quanto.editor_snapshot=CodeMirror.fromTextArea(t[0],{lineNumbers:!0,mode:"python",indentUnit:4,readOnly:!0}),t.addClass("codemirror-done")),e=$("#offending-line-number").val(),null!=e&&quanto.editor_snapshot.addLineClass(e-1,"wrap","yellow")}return t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.FrontpageBacktestVizManager=t=function(){function t(t,n){this.initialize_chart=e(this.initialize_chart,this),this.resize_chart=e(this.resize_chart,this),this.populate_summary=e(this.populate_summary,this),this.consume=e(this.consume,this);var i,r;this.$container=t,this.backtest_id=n,this.$container.addClass("backtest-loaded"),i=this.$container.find(".backtest-cached-data-url"),i.length>0&&"1"!==quanto.get_query_variable("w")&&(r=i.val(),$.get(r,function(e){return function(n){var i;if(null==n)return t.addClass("hidden");try{e.data_buffer=JSON.parse(n),e.received_perf_data=[],e.consume()}catch(r){return i=r,t.addClass("hidden")}}}(this)))}return t.prototype.consume=function(){var t,e,n,i,r,o,a,s,l,u,c;return e=this.data_buffer,this.data_buffer=[],r=!1,e.length>0&&(t=_.groupBy(e,function(t){return t.e}),n=t.performance,null!=n&&n.length>0&&(this.received_perf_data=this.received_perf_data.concat(n),s=this.received_perf_data[0],i=null!=(l=s.p)?null!=(u=l.daily)?null!=(c=u[0])?c.d:void 0:void 0:void 0,null!=i&&$("#perf-since").html("since "+quanto.date.format_date("%b %d, %Y",new Date(i)))),r=!1,a=!1,o=t.done,null!=o&&o.length>0&&(this.received_done_data=o[0].p,r=!0)),r?(this.$container.find(".loading-overlay").addClass("hidden"),this.populate_summary()):setTimeout(function(t){return function(){return t.consume()}}(this),1e3)},t.prototype.populate_summary=function(){var t,e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b;for(i=[],v=this.received_perf_data,d=0,f=v.length;f>d;d++)if(l=v[d],s=l.p,null!=s)for(b=s.daily,h=0,m=b.length;m>h;h++)n=b[h],i.push(n);for(o=_.last(i),r=new Date(quanto.pick_property(o,"date","d")),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()),this.backtest_end_date=quanto.date.adjust_date_for_UTC_reverse(a),this.initialize_chart(),p=0,g=i.length;g>p;p++)n=i[p],c=quanto.pick_property(n,"date","d"),r=new Date(c),a=new Date(r.getFullYear(),r.getMonth(),r.getDate()),t=quanto.date.adjust_date_for_UTC_reverse(a).getTime(),e=quanto.pick_property(n,"cumulative","c"),u=quanto.pick_property(e,"total_returns","tr"),this.chart.series[0].addPoint([t,u],!1);return this.chart.redraw(),this.$container.find(".nav-tabs a.disabled").removeClass("disabled"),this.$container.find(".loading-tab").remove(),null!=this.error&&this.error||this.$container.find(".tab-pane.perf").addClass("active"),$(window).on("resize",function(t){return function(){return null!=t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(t.resize_chart,100)}}(this)),this.resize_chart()},t.prototype.resize_chart=function(){var t;return t=$(window).width()<767?160:255,this.$container.css("height",t),this.chart.setSize(this.$container.width()+19,t)},t.prototype.initialize_chart=function(){var t;return t={global:{useUTC:!0},chart:{renderTo:"perf-summary-chart-"+this.backtest_id,alignTicks:!0,backgroundColor:"transparent",type:"area"},credits:{enabled:!1},navigator:{enabled:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{name:"Returns",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,color:"#ffffff",fillOpacity:.3}],yAxis:[{title:{text:null},offset:0,labels:{formatter:function(){return 100*this.value+"%"}},minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,minorTickColor:"#c0c0c0",minorGridLineColor:"#c0c0c0",opposite:!0,lineWidth:1,gridLineColor:"#c0c0c0",plotLines:[{value:0,color:"#008654",width:1}]}],xAxis:{ordinal:!1,dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},labels:{style:{color:"#ECE9E9"}},gridLineWidth:1,gridLineColor:"#c0c0c0"},plotOptions:quanto.global_plotOptions,tooltip:{backgroundColor:"transparent",borderWidth:0,borderRadius:0,headerFormat:"",crosshairs:{width:1,color:"#008654"},formatter:function(){return"<b>"+Highcharts.numberFormat(100*this.points[0].y,2)+"</b>%"},positioner:function(t,e,n){return{x:n.plotX-t/2+5,y:7}},style:{color:"#008654"},shadow:!1}},this.chart=new Highcharts.StockChart(t),null==this.backtest_end_date||isNaN(this.backtest_end_date.getTime())?void 0:this.chart.addSeries({name:"End",data:[[this.backtest_end_date.getTime(),0]]})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.HelpManager=t=function(){function t(){this.scroll_to_toc_item=e(this.scroll_to_toc_item,this),this.load_scrollspy=e(this.load_scrollspy,this);var t,n,i,r;this.offset=59,this.$help_toc=$(".help-toc"),this.mouseInToc=!1,this.initializing_toc=!1,$("#help-outline a").click(function(t){return function(e){return $("html, body").animate({scrollTop:$($(e.target).attr("href")).offset().top-t.offset},100),!1}}(this)),r="api-reference.html",$('a[href^="'+r+'"]').each(function(){return function(t,e){var n,i;return n=$(e),i=n.attr("href").slice(r.length),n.attr("href",i)}}(this)),i=function(){return function(t,e){var n,i;return i=$(e).attr("id"),n=i.replace(/\./g,"_"),$(e).attr("id",n),$('a[href="#'+i+'"]').attr("href","#"+n)}}(this),t=$("#research-api-docs, #pipeline-api-docs"),t.find("dl dt").each(i),t.find(".section").each(i),$("#pipeline-overview table").addClass("table table-bordered"),$("#pipeline-overview pre").addClass("prettyprint margin_50l"),$("#quanto-footer").show(),$(".markdown-generated pre").addClass("prettyprint margin_50l"),null!=window.prettyPrint&&window.prettyPrint(),$(".markdown-generated code span").unwrap(),n=$(".help-container").imagesLoaded(),n.done(function(t){return function(){return t.load_scrollspy()}}(this)),n.fail(function(t){return function(){return t.load_scrollspy()}}(this)),$(window).resize(function(){return function(){return $("body").scrollspy("refresh")}}(this))}return t.prototype.load_scrollspy=function(){var t;return null!=window.location.hash&&(t=$("a[href="+quanto.get_safe_window_hash()+"]"),t.length>0&&(t.click(),setTimeout(function(e){return function(){return e.scroll_to_toc_item(t.parent())}}(this),100))),$("body").scrollspy({target:"#help-outline",offset:this.offset+1}),$("#help-outline").on("activate",function(t){return function(e){return t.mouseInToc?void 0:t.scroll_to_toc_item($(e.target))}}(this)),this.$help_toc.hover(function(t){return function(){return t.mouseInToc=!0}}(this),function(t){return function(){return t.mouseInToc=!1}}(this))},t.prototype.scroll_to_toc_item=function(t){var e,n,i,r,o;return o=this.$help_toc.height(),r=this.$help_toc.scrollTop(),i=t.position().top,n=i+t.height(),e=r+i-Math.floor(o/2),0>i||n>=o?this.$help_toc.animate({scrollTop:e},200):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.HomepageManager=t=function(){function t(){this.update_group=e(this.update_group,this);var t;setTimeout(function(t){return function(){return t.update_group(".group1",100)}}(this),100),setTimeout(function(t){return function(){return t.update_group(".group2",500)}}(this),500),setTimeout(function(t){return function(){return t.update_group(".group3",800)}}(this),800),t=$(".background-numbers-container"),Modernizr.cssfilters?(t.removeClass("hidden"),t.parallax({relativeInput:!1,clipRelativeInput:!1,calibrationThreshold:100,calibrationDelay:500,supportDelay:500,calibrateX:!1,calibrateY:!0,invertX:!0,invertY:!0,limitX:!1,limitY:!1,scalarX:6,scalarY:2,frictionX:.1,frictionY:.1,originX:.5,originY:.5})):t.remove(),$("#down").on("click",function(){return $("html,body").animate({scrollTop:$(".page-break-pane").offset().top},"slow")}),$(document).on("click",".learn-more-item",function(){return function(t){var e,n;return e=$(quanto.get_src_element(t)).closest(".learn-more-item"),n=e.data("target"),"contest"===n?window.location="/open":"fund"===n?window.location="/fund":void 0}}(this))}return t.prototype.update_group=function(t,e){var n,i,r,o,a,s;for(n=$(t),a=0,s=n.length;s>a;a++)i=n[a],o=parseFloat(i.textContent),r=(o+.01).toFixed(2),i.textContent?i.textContent=r:$(i).text(r);return setTimeout(function(n){return function(){return n.update_group(t,e)}}(this),e)},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LiveAlgoVizManager=t=function(){function t(t,n){this.initialize_chart=e(this.initialize_chart,this),this.resize_chart=e(this.resize_chart,this),this.get_chart_height=e(this.get_chart_height,this),this.populate_summary=e(this.populate_summary,this),this.populate_risk=e(this.populate_risk,this),this.consume=e(this.consume,this),this.get_data=e(this.get_data,this),this.$container=t,this.live_algo_id=n,this.get_data()}return t.prototype.get_data=function(){return $.get("/live_algorithms/"+this.live_algo_id+"/get_json",function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?(t.data_buffer=n.data(),t.received_perf_data=[],t.consume()):void 0}}(this))},t.prototype.consume=function(){var t,e;return this.data_buffer.length>0?(t=_.groupBy(this.data_buffer,function(t){return t.e}),e=t.performance,this.$container.find(".loading-overlay").hide(),this.populate_summary(e),this.populate_risk(_.last(e).p)):void 0},t.prototype.populate_risk=function(t){var e,n;return e=quanto.pick_property(t.daily[0],"cumulative","c"),n={cumulative_returns:quanto.pick_property(e,"total_returns","tr"),benchmark_returns:quanto.pick_property(e,"benchmark_returns","br"),max_drawdown:quanto.pick_property(e,"max_drawdown","md")},$(document).trigger("risk_data_received",[n])},t.prototype.populate_summary=function(t){var e,n,i,r,o,a,s,l,u,c,d,h,p,f,m,g,v,b,y;for(o=[],p=0,g=t.length;g>p;p++)if(c=t[p],u=c.p,null!=u)for(y=u.daily,f=0,v=y.length;v>f;f++)r=y[f],o.push(r);for(s=_.last(o),a=new Date(quanto.pick_property(s,"date","d")),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),this.initialize_chart(),m=0,b=o.length;b>m;m++)r=o[m],h=quanto.pick_property(r,"date","d"),a=new Date(h),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),e=quanto.date.adjust_date_for_UTC_reverse(l).getTime(),i=quanto.pick_property(r,"cumulative","c"),d=quanto.pick_property(i,"total_returns","tr"),n=quanto.pick_property(i,"benchmark_returns","br"),this.chart.series[0].addPoint([e,d],!1),this.chart.series[1].addPoint([e,n],!1);return this.chart.redraw(),this.$container.find(".nav-tabs a.disabled").removeClass("disabled"),this.$container.find(".loading-tab").remove(),null!=this.error&&this.error||this.$container.find(".tab-pane.perf").addClass("active"),$(window).on("resize",function(t){return function(){return null!=t.resizeTimer&&clearTimeout(t.resizeTimer),t.resizeTimer=setTimeout(t.resize_chart,100)}}(this)),this.resize_chart(!1)},t.prototype.get_chart_height=function(){return $(window).width()<550?190:230},t.prototype.resize_chart=function(t){var e;return null==t&&(t=!0),e=this.get_chart_height(),this.$container.css("height",e),this.chart.setSize(this.$container.width()+19,e,t)},t.prototype.initialize_chart=function(){var t;return t={global:{useUTC:!0},chart:{renderTo:"perf-summary-chart-"+this.live_algo_id,alignTicks:!0,backgroundColor:"transparent",type:"area",plotBorderColor:"#d3d3d3",plotBorderWidth:1,width:this.$container.width(),height:this.get_chart_height(),events:{load:function(t){return function(){return t.$container.find(".perf-chart-container").fadeIn()}}(this)},pinchType:""},credits:{enabled:!1},navigator:{enabled:!1},scrollbar:{enabled:!1},rangeSelector:{buttons:[],selected:1,inputEnabled:!1,labelStyle:{display:"none"}},title:{text:null},series:[{type:"area",name:"Returns",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,color:"#4572A7",fillOpacity:.2},{type:"line",name:"Benchmark",data:[],dataGrouping:quanto.global_grouping_options,yAxis:0,lineWidth:1,color:"#aa4643",enableMouseTracking:!1}],yAxis:[{title:{text:null},offset:0,labels:{formatter:function(){return 100*this.value+"%"}},minorGridLineWidth:1,minorTickInterval:"auto",minorTickWidth:0,opposite:!0,lineWidth:1,plotLines:[{value:0,color:"black",width:1}]}],xAxis:{ordinal:!1,dateTimeLabelFormats:{day:"%b %e",week:"%b %e",month:"%b %Y"},gridLineWidth:1,gridLineColor:"lightgray"},plotOptions:quanto.global_plotOptions,tooltip:{borderWidth:1,borderRadius:2,headerFormat:"",backgroundColor:"rgba(255,255,255,0.8)",crosshairs:{width:1,color:"#4572a7"},formatter:function(){return"<b>"+Highcharts.numberFormat(100*this.points[0].y,2)+"</b>%"
},positioner:function(){return{x:20,y:45}},style:{color:"#4572a7"},shadow:!1}},this.chart=new Highcharts.StockChart(t)},t}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};quanto.LiveTradingErrorRenderer=t=function(t){function e(t,n,i,r){null==i&&(i=!0),e.__super__.constructor.call(this,t,n,i,r),"InvalidWarmupStart"===n.name&&$(".error-message").html("Your algorithm requires a warmup period that is before March 1, 2012.  Use a shorter warmup period and redeploy your algorithm.<br /><br />Contact <a href='mailto:feedback@quantopian.com' target='_blank'>feedback@quantopian.com</a> if you want to be notified when a longer warmup period is available.").html_safe}return n(e,t),e}(quanto.ErrorRenderer)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.LoginStepManager=t=function(){function t(t,n,i){this.submit=e(this.submit,this),this.$login_step=t,this.$login_form=this.$login_step.find("form"),this.$login_form.on("ajax:success",function(){return function(t,e){var r,o;return r=new quanto.JsonResponse(e),r.ok()?(o=r.data(),quanto.user_id=o.id,quanto.set_csrf_token(o.csrfParam,o.csrfToken),null!=o.employeeStatus&&quanto.set_is_employee(o.employeeStatus),n()):i()}}(this)),this.$login_form.on("ajax:error",function(){return function(){return i()}}(this))}return t.prototype.submit=function(t){return t("Logging in..."),this.$login_form.submit()},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.NotebookIframeManager=t=function(){function t(t,n){null==n&&(n=!1),this.fit_to_contents=e(this.fit_to_contents,this),this.receive_post_message=e(this.receive_post_message,this),this.send_post_message=e(this.send_post_message,this),this.show_error=e(this.show_error,this),this.$iframe_elem=t,this.view_full=n,this.nb_preview_url=quanto_data.nb_preview_url,this.received_iframe_message=!1,this.iframe_window=this.$iframe_elem[0].contentWindow,window.addEventListener("message",this.receive_post_message,!1),this.timeout_id=setTimeout(function(t){return function(){return t.received_iframe_message?void 0:t.send_post_message({event:"get_height"})}}(this),2e3),this.$iframe_elem.load(function(t){return function(){return t.iframe_loaded=!0,clearTimeout(t.timeout_id),t.view_full?void 0:setTimeout(function(){return t.received_iframe_message?void 0:t.show_error()},5e3)}}(this)),this.view_full||(this.$nb_widget=this.$iframe_elem.closest(".nb-preview-area"),this.$loading_area=this.$nb_widget.find(".progress-area"),this.$error_area=this.$nb_widget.find(".error-area"),this.$iframe_wrapper=this.$nb_widget.find(".nb-preview-wrapper"),this.timeout_id=setTimeout(function(t){return function(){return t.received_iframe_message?void 0:t.show_error()}}(this),1e4))}return t.prototype.show_error=function(){return this.$loading_area.removeClass("in"),this.$error_area.addClass("in"),this.$nb_widget.closest(".nb-preview-widget").find(".full-notebook-button").addClass("disabled")},t.prototype.send_post_message=function(t){return this.nb_preview_url?this.iframe_window.postMessage(t,this.nb_preview_url):void 0},t.prototype.receive_post_message=function(t){var e;if(t.origin===this.nb_preview_url&&t.source===this.iframe_window&&null!=t.data)if("height_changed"===t.data.event){if(this.view_full||(this.$loading_area.removeClass("in"),this.$iframe_elem.addClass("animate-height"),setTimeout(function(t){return function(){return t.$iframe_wrapper.addClass("in")}}(this),500)),this.received_iframe_message=!0,e=t.data.height,null!=e&&0!==e)return this.$iframe_elem.height(e)}else if("link_clicked"===t.data.event)return window.location.href=t.data.url},t.prototype.fit_to_contents=function(){return this.send_post_message({event:"get_height"})},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.ProfileManager=t=function(){function t(){this.switch_to_view_ui=e(this.switch_to_view_ui,this),this.exit_edit_mode=e(this.exit_edit_mode,this),this.save_bio=e(this.save_bio,this),this.switch_to_edit_mode=e(this.switch_to_edit_mode,this),quanto.on_click(".about .editable",function(t){return function(e){return t.switch_to_edit_mode($(quanto.get_src_element(e)).closest(".about"))}}(this)),quanto.on_click(".edit-controls .save",function(t){return function(){return t.save_bio()}}(this)),quanto.on_click(".edit-controls .cancel",function(t){return function(){return t.switch_to_view_ui()}}(this)),this.$user_message_modal=$("#user-message-modal"),this.$send_message_button=$("#send-user-message-button"),quanto.on_click(".message-user-link",function(t){return function(){return t.$user_message_modal.find("textarea").val(""),t.$user_message_modal.modal({backdrop:"static"}),$("#send-user-message-button").addClass("disabled"),t.$user_message_modal.find(".compose-section").removeClass("hidden").css("display","block"),t.$user_message_modal.find(".compose-buttons").removeClass("hidden"),t.$user_message_modal.find(".success-section").addClass("hidden").css("display",""),t.$user_message_modal.find(".close-buttons").addClass("hidden"),t.$user_message_modal.find(".allotment-spinner").removeClass("hidden"),t.$user_message_modal.find(".allotment-positive-result").addClass("hidden"),t.$user_message_modal.find(".allotment-zero").addClass("hidden"),$.get("/users/get_user_messaging_allotment",{},function(e){var n,i;return i=new quanto.JsonResponse(e),i.ok()&&null!=i.data()&&(n=parseInt(i.data().allotment),!isNaN(n))?($("#message-allotment-field").html(n),t.$user_message_modal.find(".allotment-spinner").addClass("hidden"),n>0?($("#send-user-message-button").removeClass("disabled"),t.$user_message_modal.find(".allotment-positive-result").removeClass("hidden")):t.$user_message_modal.find(".allotment-zero").removeClass("hidden")):void 0}),setTimeout(function(){return t.$user_message_modal.find("textarea").focus()},100)}}(this)),quanto.on_click("#send-user-message-button",function(t){return function(){var e,n;return mixpanel.track("profile message sent",{recipient_id:$("#user-profile-id").val()}),n=$("#user-message-body").val(),e={msg:n,recipient_id:$("#user-profile-id").val()},t.$send_message_button.addClass("disabled"),$.post("/users/send_user_message",e,function(e){var n;return t.$send_message_button.removeClass("disabled"),n=new quanto.JsonResponse(e),n.ok()?(t.$user_message_modal.find(".compose-section").slideUp("fast"),t.$user_message_modal.find(".compose-buttons").addClass("hidden"),t.$user_message_modal.find(".success-section").fadeIn(),t.$user_message_modal.find(".close-buttons").removeClass("hidden")):void 0})}}(this))}return t.prototype.switch_to_edit_mode=function(t){return t.hasClass("editing")?void 0:(t.find(".editable").hide(),t.addClass("editing"),t.find("textarea").show(),t.find(".edit-controls").show(),setTimeout(function(){return function(){return t.find("textarea").focus()}}(this),50))},t.prototype.save_bio=function(){var t,e;return e=$("#current_user_id").val(),t=$("#user-bio-box").val(),$.post("/users/update_bio",{bio:t},function(t){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t.exit_edit_mode(n.data()):alert("There was a problem updating your profile.")}}(this))},t.prototype.exit_edit_mode=function(t){var e;return null==t&&(t=null),null!=t&&$.trim(t.bio).length>0?($(".editable").html(t.formatted_bio),$("#user-bio-box").val(t.bio)):(e=$("<div class='unselectable empty-message'></div>"),e.html("Click to write something about yourself, such as contact information and your areas of expertise and interest."),$(".editable").html(e)),this.switch_to_view_ui()},t.prototype.switch_to_view_ui=function(){return $("#bio-container").removeClass("editing"),$("#user-bio-box").hide(),$(".edit-controls").hide(),$("#bio-container").find(".editable").show()},t}(),$(document).ready(function(){return"profile"===$("#page-id").val()?quanto.instances.pm=new quanto.ProfileManager:void 0})}.call(this),function(){var t;quanto.wmdEditor=t=function(){function t(t){var e,n;null==t&&(t={}),this.converter=Markdown.getSanitizingConverter(),this.editor=new Markdown.Editor(this.converter,t.postfix),this.editor.run(),n=t.postfix||"",$("#wmd-button-row"+n+" button").attr("tabIndex",-1),null!=t["show-attach"]&&t["show-attach"]?$("#wmd-button-group-add-backtest"+n).removeClass("hidden"):$("#wmd-button-group-add-backtest"+n).remove(),quanto.is_mac()?(e="Cmd",$(".wmd-quote-button").tooltip({title:"Blockquote ("+e+"-Shift-9)",container:"body"}),Mousetrap.bindGlobal("command+shift+9",function(t){return t.target===$(".wmd-input")[0]?$("#wmd-quote-button").click():void 0}),Mousetrap.bindGlobal("command+shift+z",function(t){return t.target===$(".wmd-input")[0]?$("#wmd-redo-button").click():void 0})):(e="Ctrl",$(".wmd-quote-button").tooltip({title:"Blockquote ("+e+"-Q)",container:"body"}),Mousetrap.bindGlobal("ctrl+shift+z",function(t){return t.target===$(".wmd-input")[0]?$("#wmd-redo-button").click():void 0})),$(".wmd-bold-button").tooltip({title:"Bold ("+e+"-B)",container:"body"}),$(".wmd-italic-button").tooltip({title:"Italic ("+e+"-I)",container:"body"}),$(".wmd-link-button").tooltip({title:"Link ("+e+"-L)",container:"body"}),$(".wmd-code-button").tooltip({title:"Code Sample ("+e+"-K)",container:"body"}),$(".wmd-olist-button").tooltip({title:"Numbered List ("+e+"-O)",container:"body"}),$(".wmd-ulist-button").tooltip({title:"Bulleted List ("+e+"-U)",container:"body"}),$(".wmd-undo-button").tooltip({title:"Undo ("+e+"-Z)",container:"body"}),$(".wmd-redo-button").tooltip({title:"Redo ("+e+"-Shift-Z)",container:"body"}),this.converter.hooks.chain("postConversion",function(){return function(t){return 0===t.length?"<em class='gray'>(No text)</em>":t}}(this)),this.converter.hooks.chain("postConversion",function(){return function(t){var e,n,i,r,o,a;if(i=$("<div>"+t+"</div>"),n=i.find("code"),n.length>0)for(n.addClass("prettyprint"),n.wrap("<pre />"),o=0,a=n.length;a>o;o++)r=n[o],e=$(r),t=e.html(),_.str.startsWith(t,"\n")&&e.html(t.substr(1));return i.html()}}(this))}return t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.SecurityManager=t=function(){function t(){this.unban_ip=e(this.unban_ip,this),this.unban_user=e(this.unban_user,this),this.ban_ip=e(this.ban_ip,this),this.ban_user=e(this.ban_user,this),this.toggle_maintenance_mode=e(this.toggle_maintenance_mode,this),this.become_user=e(this.become_user,this),quanto.on_click("a.unban-user",function(t){return function(e){return t.unban_user(e)}}(this)),quanto.on_click("a.unban-ip",function(t){return function(e){return t.unban_ip(e)}}(this)),quanto.on_click("#ban-user-button",function(t){return function(e){return t.ban_user(e)}}(this)),quanto.on_click("#ban-ip-button",function(t){return function(e){return t.ban_ip(e)}}(this)),this.new_user_template=Handlebars.compile("<tr><td class='monospace id'>{{id}}</td><td class='name'>{{name}}</td><td class='email'>{{email}}</td><td class='date'>{{banned_date}}</td><td class='ip'>{{last_ip}}</td><td class='unban'><a class='unban-user' data-user-id='{{id}}'>Unban</a></td></tr>"),this.new_ip_template=Handlebars.compile("<tr><td class='ip'>{{ip}}</td><td class='date'>{{date}}</td><td class='unban'><a class='unban-ip' data-ip-id='{{id}}'>Unban</a></td></tr>"),quanto.on_click(".maintenance-mode a.turn-on",function(t){return function(){return t.toggle_maintenance_mode(!0)}}(this)),quanto.on_click(".maintenance-mode a.turn-off",function(t){return function(){return t.toggle_maintenance_mode(!1)}}(this)),quanto.on_click("#become-user-button",function(t){return function(){return t.become_user()}}(this))}return t.prototype.become_user=function(){var t,e;return e=$("#become-user-info").val(),null==e||0===_.str.trim(e).length?(alert("Enter some user info."),void 0):(t=$("#become-user-reason").val(),null==t||0===_.str.trim(t).length?(alert("Enter a reason."),void 0):$.post("/users/become",{user_slug:e,reason:t},function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.redirect()?void 0:alert("There was a problem becoming this user.")}}(this)).error(function(){return function(t){var e;return e=new quanto.JsonResponse(t),alert("There was a problem becoming this user:\n\n"+e.data())}}(this)))},t.prototype.toggle_maintenance_mode=function(t){return t&&!confirm("Turn on maintenance mode?")||!t&&!confirm("Turn off maintenance mode?")?void 0:$.post("/internal/maintenance",{mode:t},function(){return function(e){var n;return n=new quanto.JsonResponse(e),n.ok()?t?($(".maintenance-mode .turn-off").removeClass("hidden"),$(".maintenance-mode .turn-on").addClass("hidden"),$(".maintenance-mode .maintenance").html("ON").addClass("red").removeClass("green")):($(".maintenance-mode .turn-off").addClass("hidden"),$(".maintenance-mode .turn-on").removeClass("hidden"),$(".maintenance-mode .maintenance").html("OFF").removeClass("red").addClass("green")):void 0}}(this)).error(function(){return function(){return alert("Unexpected error.")}}(this))},t.prototype.ban_user=function(){var t;return t=_.str.trim($("#ban-user-info").val()),null!=t.blank||0===t.length?(alert("Enter some user info already."),void 0):$.post("/internal/ban_user",{info:t},function(e){return function(n){var i,r;return r=new quanto.JsonResponse(n),r.ok()?(t=r.data().user_info,i=e.new_user_template(t),$("#banned-users-table tbody").append(i)):void 0}}(this)).error(function(){return function(t){var e;return null!=t.responseText&&(e=JSON.parse(t.responseText),null!=e.data)?(alert(e.data),void 0):alert("Failed to ban user.")}}(this))},t.prototype.ban_ip=function(){var t;return t=_.str.trim($("#ban-ip-info").val()),null!=t.blank||0===t.length?(alert("Enter some ip info already."),void 0):$.post("/internal/ban_ip",{ip:t},function(e){return function(n){var i,r;return r=new quanto.JsonResponse(n),r.ok()?(t=r.data().ip_info,i=e.new_ip_template(t),$("#banned-ips-table tbody").append(i)):void 0}}(this)).error(function(){return function(t){var e;return null!=t.responseText&&(e=JSON.parse(t.responseText),null!=e.data)?(alert(e.data),void 0):alert("Failed to ban ip.")}}(this))},t.prototype.unban_user=function(t){var e,n;return e=$(quanto.get_src_element(t)),n=e.data("user-id"),null!=n?$.post("/internal/unban_user",{user_id:n},function(){return function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):void 0}}(this)).error(function(){return function(){return alert("Error unbanning user.")}}(this)):void 0},t.prototype.unban_ip=function(t){var e,n;return e=$(quanto.get_src_element(t)),n=e.data("ip-id"),null!=n?$.post("/internal/unban_ip",{ip_id:n},function(){return function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):void 0}}(this)).error(function(){return function(){return alert("Error unbanning IP.")}}(this)):void 0},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};quanto.StoreAdminManager=t=function(){function t(){this.update_feature=e(this.update_feature,this);var t;$("#free-sample-table").DataTable(),$("#user-override-table").DataTable(),$("#paid-feature-table").DataTable({scrollX:!0}),$("#free-feature-table").DataTable({scrollX:!0}),t=this,quanto.on_click(".remove-free-sample-access",function(){return function(t){var e,n,i;return e=$(quanto.get_src_element(t)),i=e.data("free-sample-name"),n={feature:i},$.post("/internal/remove_free_sample",n,function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):quanto.show_error_popup("Something went wrong.","Error removing free sample")}).error(function(){return quanto.show_error_popup("Something went wrong.","Error removing free sample")})}}(this)),$("#add-free-sample-button").click(function(){var t,e;return e=$.trim($("#add-free-sample").val()),t={features:e},null!=t?$.post("/internal/add_free_samples",t,function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?quanto.show_message_popup("Success!","Refresh the page to see your changes."):quanto.show_error_popup("Something went wrong.","Error adding free features")}}(this)).error(function(){return function(){return quanto.show_error_popup("Something went wrong.","Error adding free features")}}(this)):void 0}),$("#add-user-acl-button").click(function(){var t,e,n;return e=$.trim($("#user-acl-email").val()),n=$.trim($("#user-acl-features").val()),t={email:e,overrides:n},null!=t?$.post("/internal/add_store_access_override",t,function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?quanto.show_message_popup("Success!","Refresh the page to see your changes."):quanto.show_error_popup("Something went wrong.",e.data())}}(this)).error(function(){return function(t){var e;return e=new quanto.JsonResponse(t),quanto.show_error_popup("Something went wrong.",e.data())}}(this)):void 0}),quanto.on_click(".remove-override-access",function(){return function(t){var e,n,i,r;return e=$(quanto.get_src_element(t)),r=e.closest("tr").find(".user-email").text(),i=e.data("override-name"),n={email:r,override:i},null!=n?$.post("/internal/remove_store_access_override",n,function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):quanto.show_error_popup("Something went wrong.",n.data())}).error(function(t){var e;return e=new quanto.JsonResponse(t),quanto.show_error_popup("Something went wrong.",e.data())}):void 0}}(this)),$("#add-paid-feature-button").click(function(){return t.update_feature("paid")}),$("#add-free-feature-button").click(function(){return t.update_feature("free")}),quanto.on_click(".remove-free-feature",function(){return function(t){var e,n,i;return e=$(quanto.get_src_element(t)),i=e.data("free-feature-name"),n={feature:i},$.post("/internal/remove_free_feature",n,function(t){var n;return n=new quanto.JsonResponse(t),n.ok()?e.closest("tr").fadeOut(250):quanto.show_error_popup("Something went wrong.",n.data())}).error(function(t){var e;return e=new quanto.JsonResponse(t),quanto.show_error_popup("Something went wrong.",e.data())})}}(this))}return t.prototype.update_feature=function(t){var e,n,i,r,o,a,s,l;if(e={},"free"===t)n=$(".add-free-feature-input"),e.feature_type="free";else{if("paid"!==t)return quanto.show_error_popup("Something went wrong.","Don't know whether to add paid or free data!"),void 0;n=$(".add-paid-feature-input"),e.feature_type="paid"}for(s=0,l=n.length;l>s;s++)i=n[s],a="#"+i.id,o=i.id.replace(""+t+"-",""),r=$(a).val(),e[o]=r;return null!=e?$.post("/internal/update_features",e,function(){return function(t){var e;return e=new quanto.JsonResponse(t),e.ok()?quanto.show_message_popup("Success!","Refresh the page to see your changes."):quanto.show_error_popup("Something went wrong.",e.data())}}(this)).error(function(){return function(t){var e;return e=new quanto.JsonResponse(t),quanto.show_error_popup("Something went wrong.",e.data())}}(this)):void 0},t}()}.call(this),function(){var t;quanto.TestLongRequestManager=t=function(){function t(){this.$status=$("#request-result"),this.$seconds_box=$("#long-request-seconds-box"),quanto.on_click("#long-request-btn",function(t){return function(){var e,n;return n=t.$seconds_box.val(),0===n.length?(alert("Enter some number of seconds"),void 0):(t.$status.html("Request sent"),e={delay:n},$.post("/internal/test_long_request",e,function(e){var n;return n=new quanto.JsonResponse(e),n.ok()&&"true"===n.data().success?t.$status.html("Success").addClass("green"):t.$status.html("Failure").addClass("red")}).error(function(){return t.$status.html("Failure").addClass("red")}))}}(this))}return t}()}.call(this),function(){}.call(this);